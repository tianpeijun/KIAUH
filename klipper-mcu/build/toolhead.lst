ARM GAS  /tmp/ccLyNHPk.s 			page 1


   1              		.cpu cortex-m4
   2              		.eabi_attribute 27, 1
   3              		.eabi_attribute 28, 1
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 2
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"toolhead.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text.lookahead_push,"ax",%progbits
  18              		.align	1
  19              		.p2align 2,,3
  20              		.arch armv7e-m
  21              		.syntax unified
  22              		.thumb
  23              		.thumb_func
  24              		.fpu fpv4-sp-d16
  26              	lookahead_push:
  27              	.LVL0:
  28              	.LFB12:
  29              		.file 1 "app/toolhead.c"
   1:app/toolhead.c **** /**
   2:app/toolhead.c ****  * @file    toolhead.c
   3:app/toolhead.c ****  * @brief   运动规划器实现
   4:app/toolhead.c ****  * 
   5:app/toolhead.c ****  * Klipper MCU 移植项目 - 运动规划模块
   6:app/toolhead.c ****  * 移植自 klippy/toolhead.py
   7:app/toolhead.c ****  * 
   8:app/toolhead.c ****  * 本文件实现:
   9:app/toolhead.c ****  * - 任务 4.1: 基础初始化和位置管理
  10:app/toolhead.c ****  * - 任务 4.2: 运动规划 (梯形加速度曲线, 前瞻队列)
  11:app/toolhead.c ****  * - 任务 4.3: 归零逻辑 (限位开关检测)
  12:app/toolhead.c ****  * - 任务 4.4: 辅助功能 (等待完成, 刷新队列)
  13:app/toolhead.c ****  * 
  14:app/toolhead.c ****  * @note    验收标准: 2.2.1-2.2.4, 2.3.1-2.3.3, 2.4.1-2.4.2
  15:app/toolhead.c ****  */
  16:app/toolhead.c **** 
  17:app/toolhead.c **** #include "toolhead.h"
  18:app/toolhead.c **** #include "config.h"
  19:app/toolhead.c **** #include "chelper/trapq.h"
  20:app/toolhead.c **** #include "chelper/itersolve.h"
  21:app/toolhead.c **** #include "src/endstop.h"
  22:app/toolhead.c **** #include "src/stepper.h"
  23:app/toolhead.c **** #include "src/sched.h"
  24:app/toolhead.c **** #include <string.h>
  25:app/toolhead.c **** #include <math.h>
  26:app/toolhead.c **** 
  27:app/toolhead.c **** /* ========== 常量定义 ========== */
  28:app/toolhead.c **** 
  29:app/toolhead.c **** /** 最小运动距离 (mm) */
ARM GAS  /tmp/ccLyNHPk.s 			page 2


  30:app/toolhead.c **** #define MIN_MOVE_DISTANCE       0.000001
  31:app/toolhead.c **** 
  32:app/toolhead.c **** /** 最小运动时间 (秒) */
  33:app/toolhead.c **** #define MIN_MOVE_TIME           0.000001
  34:app/toolhead.c **** 
  35:app/toolhead.c **** /** 归零速度 (mm/s) */
  36:app/toolhead.c **** #define HOMING_SPEED            10.0
  37:app/toolhead.c **** 
  38:app/toolhead.c **** /** 归零回退距离 (mm) */
  39:app/toolhead.c **** #define HOMING_RETRACT          5.0
  40:app/toolhead.c **** 
  41:app/toolhead.c **** /** 归零超时 (秒) */
  42:app/toolhead.c **** #define HOMING_TIMEOUT          30.0
  43:app/toolhead.c **** 
  44:app/toolhead.c **** /** 前瞻队列大小 */
  45:app/toolhead.c **** #define LOOKAHEAD_SIZE          16
  46:app/toolhead.c **** 
  47:app/toolhead.c **** /** 轴数量 */
  48:app/toolhead.c **** #define NUM_AXES                4
  49:app/toolhead.c **** 
  50:app/toolhead.c **** /* ========== 私有类型定义 ========== */
  51:app/toolhead.c **** 
  52:app/toolhead.c **** /**
  53:app/toolhead.c ****  * @brief   前瞻运动段
  54:app/toolhead.c ****  * 
  55:app/toolhead.c ****  * 用于前瞻队列中存储待处理的运动
  56:app/toolhead.c ****  */
  57:app/toolhead.c **** typedef struct {
  58:app/toolhead.c ****     struct coord start_pos;     /* 起始位置 */
  59:app/toolhead.c ****     struct coord end_pos;       /* 结束位置 */
  60:app/toolhead.c ****     double distance;            /* 运动距离 */
  61:app/toolhead.c ****     double max_velocity;        /* 最大速度 */
  62:app/toolhead.c ****     double max_start_v;         /* 最大起始速度 */
  63:app/toolhead.c ****     double max_cruise_v;        /* 最大巡航速度 */
  64:app/toolhead.c ****     double max_end_v;           /* 最大结束速度 */
  65:app/toolhead.c ****     double start_v;             /* 实际起始速度 */
  66:app/toolhead.c ****     double cruise_v;            /* 实际巡航速度 */
  67:app/toolhead.c ****     double end_v;               /* 实际结束速度 */
  68:app/toolhead.c ****     uint8_t valid;              /* 有效标志 */
  69:app/toolhead.c **** } lookahead_move_t;
  70:app/toolhead.c **** 
  71:app/toolhead.c **** /**
  72:app/toolhead.c ****  * @brief   归零状态
  73:app/toolhead.c ****  */
  74:app/toolhead.c **** typedef enum {
  75:app/toolhead.c ****     HOME_STATE_IDLE = 0,        /* 空闲 */
  76:app/toolhead.c ****     HOME_STATE_FAST,            /* 快速归零 */
  77:app/toolhead.c ****     HOME_STATE_RETRACT,         /* 回退 */
  78:app/toolhead.c ****     HOME_STATE_SLOW,            /* 慢速归零 */
  79:app/toolhead.c ****     HOME_STATE_DONE,            /* 完成 */
  80:app/toolhead.c ****     HOME_STATE_ERROR            /* 错误 */
  81:app/toolhead.c **** } home_state_t;
  82:app/toolhead.c **** 
  83:app/toolhead.c **** /**
  84:app/toolhead.c ****  * @brief   归零上下文
  85:app/toolhead.c ****  */
  86:app/toolhead.c **** typedef struct {
ARM GAS  /tmp/ccLyNHPk.s 			page 3


  87:app/toolhead.c ****     home_state_t state;         /* 当前状态 */
  88:app/toolhead.c ****     uint8_t axis_mask;          /* 归零轴掩码 */
  89:app/toolhead.c ****     double start_time;          /* 开始时间 */
  90:app/toolhead.c ****     uint8_t triggered;          /* 触发标志 */
  91:app/toolhead.c **** } home_context_t;
  92:app/toolhead.c **** 
  93:app/toolhead.c **** /* ========== 私有变量 ========== */
  94:app/toolhead.c **** 
  95:app/toolhead.c **** /** 当前工具头位置 */
  96:app/toolhead.c **** static struct coord s_current_pos;
  97:app/toolhead.c **** 
  98:app/toolhead.c **** /** 命令位置 (G-code 命令的目标位置) */
  99:app/toolhead.c **** static struct coord s_commanded_pos;
 100:app/toolhead.c **** 
 101:app/toolhead.c **** /** 运动队列指针 */
 102:app/toolhead.c **** static struct trapq *s_p_trapq = NULL;
 103:app/toolhead.c **** 
 104:app/toolhead.c **** /** 当前打印时间 (秒) */
 105:app/toolhead.c **** static double s_print_time = 0.0;
 106:app/toolhead.c **** 
 107:app/toolhead.c **** /** 运动配置参数 */
 108:app/toolhead.c **** static toolhead_config_t s_config;
 109:app/toolhead.c **** 
 110:app/toolhead.c **** /** 初始化完成标志 */
 111:app/toolhead.c **** static uint8_t s_initialized = 0;
 112:app/toolhead.c **** 
 113:app/toolhead.c **** /** 前瞻队列 */
 114:app/toolhead.c **** static lookahead_move_t s_lookahead[LOOKAHEAD_SIZE];
 115:app/toolhead.c **** static int s_lookahead_head = 0;
 116:app/toolhead.c **** static int s_lookahead_tail = 0;
 117:app/toolhead.c **** static int s_lookahead_count = 0;
 118:app/toolhead.c **** 
 119:app/toolhead.c **** /** 步进运动学 */
 120:app/toolhead.c **** static struct stepper_kinematics *s_steppers[NUM_AXES];
 121:app/toolhead.c **** 
 122:app/toolhead.c **** /** 归零上下文 */
 123:app/toolhead.c **** static home_context_t s_home_ctx;
 124:app/toolhead.c **** 
 125:app/toolhead.c **** /** 运动完成回调 */
 126:app/toolhead.c **** static toolhead_callback_fn_t s_move_complete_cb = NULL;
 127:app/toolhead.c **** static void *s_move_complete_arg = NULL;
 128:app/toolhead.c **** 
 129:app/toolhead.c **** /** 轴限位 */
 130:app/toolhead.c **** static double s_min_pos[NUM_AXES];
 131:app/toolhead.c **** static double s_max_pos[NUM_AXES];
 132:app/toolhead.c **** 
 133:app/toolhead.c **** /** steps_per_mm 配置 */
 134:app/toolhead.c **** static double s_steps_per_mm[NUM_AXES];
 135:app/toolhead.c **** 
 136:app/toolhead.c **** /* ========== 外部函数声明 ========== */
 137:app/toolhead.c **** 
 138:app/toolhead.c **** /* 笛卡尔运动学设置函数 */
 139:app/toolhead.c **** extern void cartesian_stepper_setup(struct stepper_kinematics *sk, int axis,
 140:app/toolhead.c ****                                     double steps_per_mm);
 141:app/toolhead.c **** extern double cartesian_calc_direction(const struct coord *start,
 142:app/toolhead.c ****                                        const struct coord *end,
 143:app/toolhead.c ****                                        struct coord *axes_r);
ARM GAS  /tmp/ccLyNHPk.s 			page 4


 144:app/toolhead.c **** 
 145:app/toolhead.c **** /* ========== 私有函数声明 ========== */
 146:app/toolhead.c **** 
 147:app/toolhead.c **** static void config_init_defaults(void);
 148:app/toolhead.c **** static void coord_clear(struct coord *p_pos);
 149:app/toolhead.c **** static void coord_copy(struct coord *p_dst, const struct coord *p_src);
 150:app/toolhead.c **** static double calc_move_distance(const struct coord *start,
 151:app/toolhead.c ****                                  const struct coord *end);
 152:app/toolhead.c **** static void calc_trapezoidal_profile(double distance, double start_v,
 153:app/toolhead.c ****                                      double cruise_v, double end_v,
 154:app/toolhead.c ****                                      double accel,
 155:app/toolhead.c ****                                      double *accel_t, double *cruise_t,
 156:app/toolhead.c ****                                      double *decel_t);
 157:app/toolhead.c **** static int lookahead_push(const lookahead_move_t *move);
 158:app/toolhead.c **** static int lookahead_pop(lookahead_move_t *move);
 159:app/toolhead.c **** static void lookahead_flush(void);
 160:app/toolhead.c **** static void lookahead_process(void);
 161:app/toolhead.c **** static double calc_junction_velocity(const struct coord *prev_dir,
 162:app/toolhead.c ****                                      const struct coord *next_dir,
 163:app/toolhead.c ****                                      double max_v);
 164:app/toolhead.c **** static void generate_steps(double flush_time);
 165:app/toolhead.c **** static void home_endstop_callback(endstop_id_t id, void *arg);
 166:app/toolhead.c **** 
 167:app/toolhead.c **** /* ========== 私有函数实现 ========== */
 168:app/toolhead.c **** 
 169:app/toolhead.c **** /**
 170:app/toolhead.c ****  * @brief   初始化默认配置
 171:app/toolhead.c ****  */
 172:app/toolhead.c **** static void
 173:app/toolhead.c **** config_init_defaults(void)
 174:app/toolhead.c **** {
 175:app/toolhead.c ****     s_config.max_velocity = MAX_VELOCITY;
 176:app/toolhead.c ****     s_config.max_accel = MAX_ACCEL;
 177:app/toolhead.c ****     s_config.max_accel_to_decel = MAX_ACCEL * 0.5f;
 178:app/toolhead.c ****     s_config.square_corner_velocity = 5.0f;
 179:app/toolhead.c ****     
 180:app/toolhead.c ****     /* 初始化轴限位 */
 181:app/toolhead.c ****     s_min_pos[0] = X_MIN;
 182:app/toolhead.c ****     s_min_pos[1] = Y_MIN;
 183:app/toolhead.c ****     s_min_pos[2] = Z_MIN;
 184:app/toolhead.c ****     s_min_pos[3] = -1e9;  /* E 轴无限位 */
 185:app/toolhead.c ****     
 186:app/toolhead.c ****     s_max_pos[0] = X_MAX;
 187:app/toolhead.c ****     s_max_pos[1] = Y_MAX;
 188:app/toolhead.c ****     s_max_pos[2] = Z_MAX;
 189:app/toolhead.c ****     s_max_pos[3] = 1e9;   /* E 轴无限位 */
 190:app/toolhead.c ****     
 191:app/toolhead.c ****     /* 初始化 steps_per_mm */
 192:app/toolhead.c ****     s_steps_per_mm[0] = STEPS_PER_MM_X;
 193:app/toolhead.c ****     s_steps_per_mm[1] = STEPS_PER_MM_Y;
 194:app/toolhead.c ****     s_steps_per_mm[2] = STEPS_PER_MM_Z;
 195:app/toolhead.c ****     s_steps_per_mm[3] = STEPS_PER_MM_E;
 196:app/toolhead.c **** }
 197:app/toolhead.c **** 
 198:app/toolhead.c **** /**
 199:app/toolhead.c ****  * @brief   清零位置
 200:app/toolhead.c ****  */
ARM GAS  /tmp/ccLyNHPk.s 			page 5


 201:app/toolhead.c **** static void
 202:app/toolhead.c **** coord_clear(struct coord *p_pos)
 203:app/toolhead.c **** {
 204:app/toolhead.c ****     p_pos->x = 0.0;
 205:app/toolhead.c ****     p_pos->y = 0.0;
 206:app/toolhead.c ****     p_pos->z = 0.0;
 207:app/toolhead.c ****     p_pos->e = 0.0;
 208:app/toolhead.c **** }
 209:app/toolhead.c **** 
 210:app/toolhead.c **** /**
 211:app/toolhead.c ****  * @brief   复制位置
 212:app/toolhead.c ****  */
 213:app/toolhead.c **** static void
 214:app/toolhead.c **** coord_copy(struct coord *p_dst, const struct coord *p_src)
 215:app/toolhead.c **** {
 216:app/toolhead.c ****     p_dst->x = p_src->x;
 217:app/toolhead.c ****     p_dst->y = p_src->y;
 218:app/toolhead.c ****     p_dst->z = p_src->z;
 219:app/toolhead.c ****     p_dst->e = p_src->e;
 220:app/toolhead.c **** }
 221:app/toolhead.c **** 
 222:app/toolhead.c **** /**
 223:app/toolhead.c ****  * @brief   计算运动距离
 224:app/toolhead.c ****  * @param   start   起始位置
 225:app/toolhead.c ****  * @param   end     结束位置
 226:app/toolhead.c ****  * @return  运动距离 (mm)
 227:app/toolhead.c ****  */
 228:app/toolhead.c **** static double
 229:app/toolhead.c **** calc_move_distance(const struct coord *start, const struct coord *end)
 230:app/toolhead.c **** {
 231:app/toolhead.c ****     double dx = end->x - start->x;
 232:app/toolhead.c ****     double dy = end->y - start->y;
 233:app/toolhead.c ****     double dz = end->z - start->z;
 234:app/toolhead.c ****     double de = end->e - start->e;
 235:app/toolhead.c ****     
 236:app/toolhead.c ****     return sqrt(dx * dx + dy * dy + dz * dz + de * de);
 237:app/toolhead.c **** }
 238:app/toolhead.c **** 
 239:app/toolhead.c **** /**
 240:app/toolhead.c ****  * @brief   计算梯形速度曲线参数
 241:app/toolhead.c ****  * 
 242:app/toolhead.c ****  * 根据距离、起始/结束速度和加速度计算三个阶段的时间:
 243:app/toolhead.c ****  * - 加速阶段 (accel_t)
 244:app/toolhead.c ****  * - 匀速阶段 (cruise_t)
 245:app/toolhead.c ****  * - 减速阶段 (decel_t)
 246:app/toolhead.c ****  * 
 247:app/toolhead.c ****  * @param   distance    运动距离
 248:app/toolhead.c ****  * @param   start_v     起始速度
 249:app/toolhead.c ****  * @param   cruise_v    巡航速度
 250:app/toolhead.c ****  * @param   end_v       结束速度
 251:app/toolhead.c ****  * @param   accel       加速度
 252:app/toolhead.c ****  * @param   accel_t     输出: 加速时间
 253:app/toolhead.c ****  * @param   cruise_t    输出: 匀速时间
 254:app/toolhead.c ****  * @param   decel_t     输出: 减速时间
 255:app/toolhead.c ****  */
 256:app/toolhead.c **** static void
 257:app/toolhead.c **** calc_trapezoidal_profile(double distance, double start_v, double cruise_v,
ARM GAS  /tmp/ccLyNHPk.s 			page 6


 258:app/toolhead.c ****                          double end_v, double accel,
 259:app/toolhead.c ****                          double *accel_t, double *cruise_t, double *decel_t)
 260:app/toolhead.c **** {
 261:app/toolhead.c ****     /* 计算加速和减速距离 */
 262:app/toolhead.c ****     double accel_dist = 0.0;
 263:app/toolhead.c ****     double decel_dist = 0.0;
 264:app/toolhead.c ****     
 265:app/toolhead.c ****     if (cruise_v > start_v) {
 266:app/toolhead.c ****         /* 需要加速 */
 267:app/toolhead.c ****         *accel_t = (cruise_v - start_v) / accel;
 268:app/toolhead.c ****         accel_dist = (start_v + cruise_v) * 0.5 * (*accel_t);
 269:app/toolhead.c ****     } else {
 270:app/toolhead.c ****         *accel_t = 0.0;
 271:app/toolhead.c ****     }
 272:app/toolhead.c ****     
 273:app/toolhead.c ****     if (cruise_v > end_v) {
 274:app/toolhead.c ****         /* 需要减速 */
 275:app/toolhead.c ****         *decel_t = (cruise_v - end_v) / accel;
 276:app/toolhead.c ****         decel_dist = (cruise_v + end_v) * 0.5 * (*decel_t);
 277:app/toolhead.c ****     } else {
 278:app/toolhead.c ****         *decel_t = 0.0;
 279:app/toolhead.c ****     }
 280:app/toolhead.c ****     
 281:app/toolhead.c ****     /* 检查是否有足够距离达到巡航速度 */
 282:app/toolhead.c ****     double cruise_dist = distance - accel_dist - decel_dist;
 283:app/toolhead.c ****     
 284:app/toolhead.c ****     if (cruise_dist < 0.0) {
 285:app/toolhead.c ****         /* 距离不够，需要降低巡航速度 */
 286:app/toolhead.c ****         /* 使用公式: v^2 = v0^2 + 2*a*d 求解峰值速度 */
 287:app/toolhead.c ****         double peak_v_sq = (start_v * start_v + end_v * end_v) * 0.5 +
 288:app/toolhead.c ****                           accel * distance;
 289:app/toolhead.c ****         double peak_v = sqrt(peak_v_sq);
 290:app/toolhead.c ****         
 291:app/toolhead.c ****         if (peak_v < start_v) {
 292:app/toolhead.c ****             peak_v = start_v;
 293:app/toolhead.c ****         }
 294:app/toolhead.c ****         if (peak_v < end_v) {
 295:app/toolhead.c ****             peak_v = end_v;
 296:app/toolhead.c ****         }
 297:app/toolhead.c ****         
 298:app/toolhead.c ****         /* 重新计算时间 */
 299:app/toolhead.c ****         if (peak_v > start_v) {
 300:app/toolhead.c ****             *accel_t = (peak_v - start_v) / accel;
 301:app/toolhead.c ****         } else {
 302:app/toolhead.c ****             *accel_t = 0.0;
 303:app/toolhead.c ****         }
 304:app/toolhead.c ****         
 305:app/toolhead.c ****         if (peak_v > end_v) {
 306:app/toolhead.c ****             *decel_t = (peak_v - end_v) / accel;
 307:app/toolhead.c ****         } else {
 308:app/toolhead.c ****             *decel_t = 0.0;
 309:app/toolhead.c ****         }
 310:app/toolhead.c ****         
 311:app/toolhead.c ****         *cruise_t = 0.0;
 312:app/toolhead.c ****     } else {
 313:app/toolhead.c ****         /* 有匀速阶段 */
 314:app/toolhead.c ****         *cruise_t = cruise_dist / cruise_v;
ARM GAS  /tmp/ccLyNHPk.s 			page 7


 315:app/toolhead.c ****     }
 316:app/toolhead.c **** }
 317:app/toolhead.c **** 
 318:app/toolhead.c **** /**
 319:app/toolhead.c ****  * @brief   计算结点速度 (junction velocity)
 320:app/toolhead.c ****  * 
 321:app/toolhead.c ****  * 根据两个运动段的方向变化计算允许的最大结点速度。
 322:app/toolhead.c ****  * 方向变化越大，结点速度越低。
 323:app/toolhead.c ****  * 
 324:app/toolhead.c ****  * @param   prev_dir    前一段运动方向 (归一化)
 325:app/toolhead.c ****  * @param   next_dir    下一段运动方向 (归一化)
 326:app/toolhead.c ****  * @param   max_v       最大允许速度
 327:app/toolhead.c ****  * @return  结点速度
 328:app/toolhead.c ****  */
 329:app/toolhead.c **** static double
 330:app/toolhead.c **** calc_junction_velocity(const struct coord *prev_dir,
 331:app/toolhead.c ****                        const struct coord *next_dir,
 332:app/toolhead.c ****                        double max_v)
 333:app/toolhead.c **** {
 334:app/toolhead.c ****     /* 计算方向向量的点积 */
 335:app/toolhead.c ****     double dot = prev_dir->x * next_dir->x +
 336:app/toolhead.c ****                  prev_dir->y * next_dir->y +
 337:app/toolhead.c ****                  prev_dir->z * next_dir->z;
 338:app/toolhead.c ****     
 339:app/toolhead.c ****     /* 点积范围 [-1, 1]，1 表示同向，-1 表示反向 */
 340:app/toolhead.c ****     if (dot < -0.999) {
 341:app/toolhead.c ****         /* 几乎反向，需要完全停止 */
 342:app/toolhead.c ****         return 0.0;
 343:app/toolhead.c ****     }
 344:app/toolhead.c ****     
 345:app/toolhead.c ****     if (dot > 0.999) {
 346:app/toolhead.c ****         /* 几乎同向，可以保持最大速度 */
 347:app/toolhead.c ****         return max_v;
 348:app/toolhead.c ****     }
 349:app/toolhead.c ****     
 350:app/toolhead.c ****     /* 计算转角的一半的正弦值 */
 351:app/toolhead.c ****     /* sin(theta/2) = sqrt((1 - cos(theta)) / 2) */
 352:app/toolhead.c ****     double sin_half_theta = sqrt((1.0 - dot) * 0.5);
 353:app/toolhead.c ****     
 354:app/toolhead.c ****     /* 使用拐角速度公式 */
 355:app/toolhead.c ****     /* v_junction = sqrt(accel * deviation / sin(theta/2)) */
 356:app/toolhead.c ****     /* 其中 deviation 是允许的偏差距离 */
 357:app/toolhead.c ****     double deviation = s_config.square_corner_velocity * 
 358:app/toolhead.c ****                        s_config.square_corner_velocity / s_config.max_accel;
 359:app/toolhead.c ****     
 360:app/toolhead.c ****     double junction_v = sqrt(s_config.max_accel * deviation / sin_half_theta);
 361:app/toolhead.c ****     
 362:app/toolhead.c ****     if (junction_v > max_v) {
 363:app/toolhead.c ****         junction_v = max_v;
 364:app/toolhead.c ****     }
 365:app/toolhead.c ****     
 366:app/toolhead.c ****     return junction_v;
 367:app/toolhead.c **** }
 368:app/toolhead.c **** 
 369:app/toolhead.c **** /**
 370:app/toolhead.c ****  * @brief   向前瞻队列添加运动
 371:app/toolhead.c ****  */
ARM GAS  /tmp/ccLyNHPk.s 			page 8


 372:app/toolhead.c **** static int
 373:app/toolhead.c **** lookahead_push(const lookahead_move_t *move)
 374:app/toolhead.c **** {
  30              		.loc 1 374 1 view -0
  31              		.cfi_startproc
  32              		@ args = 0, pretend = 0, frame = 0
  33              		@ frame_needed = 0, uses_anonymous_args = 0
 375:app/toolhead.c ****     if (s_lookahead_count >= LOOKAHEAD_SIZE) {
  34              		.loc 1 375 5 view .LVU1
 374:app/toolhead.c ****     if (s_lookahead_count >= LOOKAHEAD_SIZE) {
  35              		.loc 1 374 1 is_stmt 0 view .LVU2
  36 0000 F8B5     		push	{r3, r4, r5, r6, r7, lr}
  37              		.cfi_def_cfa_offset 24
  38              		.cfi_offset 3, -24
  39              		.cfi_offset 4, -20
  40              		.cfi_offset 5, -16
  41              		.cfi_offset 6, -12
  42              		.cfi_offset 7, -8
  43              		.cfi_offset 14, -4
  44              		.loc 1 375 27 view .LVU3
  45 0002 104E     		ldr	r6, .L6
  46 0004 3568     		ldr	r5, [r6]
  47              		.loc 1 375 8 view .LVU4
  48 0006 0F2D     		cmp	r5, #15
  49 0008 18DC     		bgt	.L3
 376:app/toolhead.c ****         return -1;  /* 队列满 */
 377:app/toolhead.c ****     }
 378:app/toolhead.c ****     
 379:app/toolhead.c ****     s_lookahead[s_lookahead_tail] = *move;
  50              		.loc 1 379 5 is_stmt 1 view .LVU5
  51              		.loc 1 379 16 is_stmt 0 view .LVU6
  52 000a 0F4F     		ldr	r7, .L6+4
  53              		.loc 1 379 35 view .LVU7
  54 000c 0F4B     		ldr	r3, .L6+8
  55              		.loc 1 379 16 view .LVU8
  56 000e 3C68     		ldr	r4, [r7]
  57 0010 0146     		mov	r1, r0
  58              		.loc 1 379 35 view .LVU9
  59 0012 04EB0410 		add	r0, r4, r4, lsl #4
  60              	.LVL1:
  61              		.loc 1 379 35 view .LVU10
  62 0016 03EBC000 		add	r0, r3, r0, lsl #3
  63 001a 8822     		movs	r2, #136
 380:app/toolhead.c ****     s_lookahead_tail = (s_lookahead_tail + 1) % LOOKAHEAD_SIZE;
  64              		.loc 1 380 42 view .LVU11
  65 001c 0134     		adds	r4, r4, #1
 379:app/toolhead.c ****     s_lookahead_tail = (s_lookahead_tail + 1) % LOOKAHEAD_SIZE;
  66              		.loc 1 379 35 view .LVU12
  67 001e FFF7FEFF 		bl	memcpy
  68              	.LVL2:
  69              		.loc 1 380 5 is_stmt 1 view .LVU13
  70              		.loc 1 380 47 is_stmt 0 view .LVU14
  71 0022 6342     		rsbs	r3, r4, #0
  72 0024 03F00F03 		and	r3, r3, #15
  73 0028 04F00F04 		and	r4, r4, #15
 381:app/toolhead.c ****     s_lookahead_count++;
  74              		.loc 1 381 22 view .LVU15
ARM GAS  /tmp/ccLyNHPk.s 			page 9


  75 002c 05F10105 		add	r5, r5, #1
 380:app/toolhead.c ****     s_lookahead_tail = (s_lookahead_tail + 1) % LOOKAHEAD_SIZE;
  76              		.loc 1 380 47 view .LVU16
  77 0030 58BF     		it	pl
  78 0032 5C42     		rsbpl	r4, r3, #0
 380:app/toolhead.c ****     s_lookahead_tail = (s_lookahead_tail + 1) % LOOKAHEAD_SIZE;
  79              		.loc 1 380 22 view .LVU17
  80 0034 3C60     		str	r4, [r7]
  81              		.loc 1 381 5 is_stmt 1 view .LVU18
  82              		.loc 1 381 22 is_stmt 0 view .LVU19
  83 0036 3560     		str	r5, [r6]
 382:app/toolhead.c ****     
 383:app/toolhead.c ****     return 0;
  84              		.loc 1 383 5 is_stmt 1 view .LVU20
  85              		.loc 1 383 12 is_stmt 0 view .LVU21
  86 0038 0020     		movs	r0, #0
 384:app/toolhead.c **** }
  87              		.loc 1 384 1 view .LVU22
  88 003a F8BD     		pop	{r3, r4, r5, r6, r7, pc}
  89              	.LVL3:
  90              	.L3:
 376:app/toolhead.c ****     }
  91              		.loc 1 376 16 view .LVU23
  92 003c 4FF0FF30 		mov	r0, #-1
  93              	.LVL4:
  94              		.loc 1 384 1 view .LVU24
  95 0040 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
  96              	.L7:
  97 0042 00BF     		.align	2
  98              	.L6:
  99 0044 00000000 		.word	.LANCHOR0
 100 0048 00000000 		.word	.LANCHOR1
 101 004c 00000000 		.word	.LANCHOR2
 102              		.cfi_endproc
 103              	.LFE12:
 105              		.section	.text.lookahead_pop,"ax",%progbits
 106              		.align	1
 107              		.p2align 2,,3
 108              		.syntax unified
 109              		.thumb
 110              		.thumb_func
 111              		.fpu fpv4-sp-d16
 113              	lookahead_pop:
 114              	.LVL5:
 115              	.LFB13:
 385:app/toolhead.c **** 
 386:app/toolhead.c **** /**
 387:app/toolhead.c ****  * @brief   从前瞻队列取出运动
 388:app/toolhead.c ****  */
 389:app/toolhead.c **** static int
 390:app/toolhead.c **** lookahead_pop(lookahead_move_t *move)
 391:app/toolhead.c **** {
 116              		.loc 1 391 1 is_stmt 1 view -0
 117              		.cfi_startproc
 118              		@ args = 0, pretend = 0, frame = 0
 119              		@ frame_needed = 0, uses_anonymous_args = 0
 392:app/toolhead.c ****     if (s_lookahead_count == 0) {
ARM GAS  /tmp/ccLyNHPk.s 			page 10


 120              		.loc 1 392 5 view .LVU26
 391:app/toolhead.c ****     if (s_lookahead_count == 0) {
 121              		.loc 1 391 1 is_stmt 0 view .LVU27
 122 0000 F8B5     		push	{r3, r4, r5, r6, r7, lr}
 123              		.cfi_def_cfa_offset 24
 124              		.cfi_offset 3, -24
 125              		.cfi_offset 4, -20
 126              		.cfi_offset 5, -16
 127              		.cfi_offset 6, -12
 128              		.cfi_offset 7, -8
 129              		.cfi_offset 14, -4
 130              		.loc 1 392 27 view .LVU28
 131 0002 0F4E     		ldr	r6, .L12
 132 0004 3568     		ldr	r5, [r6]
 133              		.loc 1 392 8 view .LVU29
 134 0006 BDB1     		cbz	r5, .L10
 393:app/toolhead.c ****         return -1;  /* 队列空 */
 394:app/toolhead.c ****     }
 395:app/toolhead.c ****     
 396:app/toolhead.c ****     *move = s_lookahead[s_lookahead_head];
 135              		.loc 1 396 5 is_stmt 1 view .LVU30
 136              		.loc 1 396 24 is_stmt 0 view .LVU31
 137 0008 0E4F     		ldr	r7, .L12+4
 138              		.loc 1 396 11 view .LVU32
 139 000a 0F4B     		ldr	r3, .L12+8
 140              		.loc 1 396 24 view .LVU33
 141 000c 3C68     		ldr	r4, [r7]
 142              		.loc 1 396 11 view .LVU34
 143 000e 04EB0411 		add	r1, r4, r4, lsl #4
 144 0012 03EBC101 		add	r1, r3, r1, lsl #3
 145 0016 8822     		movs	r2, #136
 397:app/toolhead.c ****     s_lookahead_head = (s_lookahead_head + 1) % LOOKAHEAD_SIZE;
 146              		.loc 1 397 42 view .LVU35
 147 0018 0134     		adds	r4, r4, #1
 396:app/toolhead.c ****     s_lookahead_head = (s_lookahead_head + 1) % LOOKAHEAD_SIZE;
 148              		.loc 1 396 11 view .LVU36
 149 001a FFF7FEFF 		bl	memcpy
 150              	.LVL6:
 151              		.loc 1 397 5 is_stmt 1 view .LVU37
 152              		.loc 1 397 47 is_stmt 0 view .LVU38
 153 001e 6342     		rsbs	r3, r4, #0
 154 0020 03F00F03 		and	r3, r3, #15
 155 0024 04F00F04 		and	r4, r4, #15
 398:app/toolhead.c ****     s_lookahead_count--;
 156              		.loc 1 398 22 view .LVU39
 157 0028 05F1FF35 		add	r5, r5, #-1
 397:app/toolhead.c ****     s_lookahead_head = (s_lookahead_head + 1) % LOOKAHEAD_SIZE;
 158              		.loc 1 397 47 view .LVU40
 159 002c 58BF     		it	pl
 160 002e 5C42     		rsbpl	r4, r3, #0
 397:app/toolhead.c ****     s_lookahead_head = (s_lookahead_head + 1) % LOOKAHEAD_SIZE;
 161              		.loc 1 397 22 view .LVU41
 162 0030 3C60     		str	r4, [r7]
 163              		.loc 1 398 5 is_stmt 1 view .LVU42
 164              		.loc 1 398 22 is_stmt 0 view .LVU43
 165 0032 3560     		str	r5, [r6]
 399:app/toolhead.c ****     
ARM GAS  /tmp/ccLyNHPk.s 			page 11


 400:app/toolhead.c ****     return 0;
 166              		.loc 1 400 5 is_stmt 1 view .LVU44
 167              		.loc 1 400 12 is_stmt 0 view .LVU45
 168 0034 0020     		movs	r0, #0
 401:app/toolhead.c **** }
 169              		.loc 1 401 1 view .LVU46
 170 0036 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 171              	.LVL7:
 172              	.L10:
 393:app/toolhead.c ****     }
 173              		.loc 1 393 16 view .LVU47
 174 0038 4FF0FF30 		mov	r0, #-1
 175              	.LVL8:
 176              		.loc 1 401 1 view .LVU48
 177 003c F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 178              	.L13:
 179 003e 00BF     		.align	2
 180              	.L12:
 181 0040 00000000 		.word	.LANCHOR0
 182 0044 00000000 		.word	.LANCHOR3
 183 0048 00000000 		.word	.LANCHOR2
 184              		.cfi_endproc
 185              	.LFE13:
 187              		.global	__aeabi_f2d
 188              		.global	__aeabi_dadd
 189              		.global	__aeabi_dmul
 190              		.global	__aeabi_dcmplt
 191              		.global	__aeabi_dcmpgt
 192              		.global	__aeabi_dsub
 193              		.global	__aeabi_ddiv
 194              		.section	.text.lookahead_process,"ax",%progbits
 195              		.align	1
 196              		.p2align 2,,3
 197              		.syntax unified
 198              		.thumb
 199              		.thumb_func
 200              		.fpu fpv4-sp-d16
 202              	lookahead_process:
 203              	.LFB14:
 402:app/toolhead.c **** 
 403:app/toolhead.c **** /**
 404:app/toolhead.c ****  * @brief   处理前瞻队列
 405:app/toolhead.c ****  * 
 406:app/toolhead.c ****  * 实现前瞻算法:
 407:app/toolhead.c ****  * 1. 反向遍历，计算每段运动的最大结束速度
 408:app/toolhead.c ****  * 2. 正向遍历，计算每段运动的实际速度
 409:app/toolhead.c ****  * 3. 将处理好的运动添加到 trapq
 410:app/toolhead.c ****  */
 411:app/toolhead.c **** static void
 412:app/toolhead.c **** lookahead_process(void)
 413:app/toolhead.c **** {
 204              		.loc 1 413 1 is_stmt 1 view -0
 205              		.cfi_startproc
 206              		@ args = 0, pretend = 0, frame = 88
 207              		@ frame_needed = 0, uses_anonymous_args = 0
 414:app/toolhead.c ****     if (s_lookahead_count == 0) {
 208              		.loc 1 414 5 view .LVU50
ARM GAS  /tmp/ccLyNHPk.s 			page 12


 413:app/toolhead.c ****     if (s_lookahead_count == 0) {
 209              		.loc 1 413 1 is_stmt 0 view .LVU51
 210 0000 2DE9F04F 		push	{r4, r5, r6, r7, r8, r9, r10, fp, lr}
 211              		.cfi_def_cfa_offset 36
 212              		.cfi_offset 4, -36
 213              		.cfi_offset 5, -32
 214              		.cfi_offset 6, -28
 215              		.cfi_offset 7, -24
 216              		.cfi_offset 8, -20
 217              		.cfi_offset 9, -16
 218              		.cfi_offset 10, -12
 219              		.cfi_offset 11, -8
 220              		.cfi_offset 14, -4
 221 0004 2DED028B 		vpush.64	{d8}
 222              		.cfi_def_cfa_offset 44
 223              		.cfi_offset 80, -44
 224              		.cfi_offset 81, -40
 225              		.loc 1 414 27 view .LVU52
 226 0008 8F4B     		ldr	r3, .L50+16
 413:app/toolhead.c ****     if (s_lookahead_count == 0) {
 227              		.loc 1 413 1 view .LVU53
 228 000a 97B0     		sub	sp, sp, #92
 229              		.cfi_def_cfa_offset 136
 230              		.loc 1 414 27 view .LVU54
 231 000c 1968     		ldr	r1, [r3]
 232 000e 0391     		str	r1, [sp, #12]
 233              		.loc 1 414 8 view .LVU55
 234 0010 0029     		cmp	r1, #0
 235 0012 00F0C581 		beq	.L14
 415:app/toolhead.c ****         return;
 416:app/toolhead.c ****     }
 417:app/toolhead.c ****     
 418:app/toolhead.c ****     /* 反向遍历: 计算最大结束速度 */
 419:app/toolhead.c ****     /* 最后一段运动的结束速度为 0 (或下一段的起始速度) */
 420:app/toolhead.c ****     int idx = (s_lookahead_tail - 1 + LOOKAHEAD_SIZE) % LOOKAHEAD_SIZE;
 236              		.loc 1 420 5 is_stmt 1 view .LVU56
 237              		.loc 1 420 37 is_stmt 0 view .LVU57
 238 0016 8D4B     		ldr	r3, .L50+20
 239 0018 1B68     		ldr	r3, [r3]
 240 001a 0F33     		adds	r3, r3, #15
 241              		.loc 1 420 9 view .LVU58
 242 001c 5A42     		rsbs	r2, r3, #0
 243 001e 03F00F0A 		and	r10, r3, #15
 244 0022 02F00F03 		and	r3, r2, #15
 245 0026 58BF     		it	pl
 246 0028 C3F1000A 		rsbpl	r10, r3, #0
 247              	.LVL9:
 421:app/toolhead.c ****     s_lookahead[idx].max_end_v = 0.0;
 248              		.loc 1 421 5 is_stmt 1 view .LVU59
 249              		.loc 1 421 32 is_stmt 0 view .LVU60
 250 002c 884A     		ldr	r2, .L50+24
 251 002e 0AEB0A13 		add	r3, r10, r10, lsl #4
 252 0032 02EBC303 		add	r3, r2, r3, lsl #3
 253              	.LBB44:
 422:app/toolhead.c ****     
 423:app/toolhead.c ****     for (int i = s_lookahead_count - 1; i > 0; i--) {
 254              		.loc 1 423 14 view .LVU61
ARM GAS  /tmp/ccLyNHPk.s 			page 13


 255 0036 4A1E     		subs	r2, r1, #1
 256              	.LBE44:
 421:app/toolhead.c ****     s_lookahead[idx].max_end_v = 0.0;
 257              		.loc 1 421 32 view .LVU62
 258 0038 4FF00008 		mov	r8, #0
 259 003c 4FF00009 		mov	r9, #0
 260              	.LBB54:
 261              		.loc 1 423 5 view .LVU63
 262 0040 002A     		cmp	r2, #0
 263              	.LBE54:
 421:app/toolhead.c ****     s_lookahead[idx].max_end_v = 0.0;
 264              		.loc 1 421 32 view .LVU64
 265 0042 C3E91889 		strd	r8, [r3, #96]
 266              		.loc 1 423 5 is_stmt 1 view .LVU65
 267              	.LBB55:
 268              		.loc 1 423 10 view .LVU66
 269              	.LVL10:
 270              		.loc 1 423 41 view .LVU67
 271              		.loc 1 423 14 is_stmt 0 view .LVU68
 272 0046 0492     		str	r2, [sp, #16]
 273              		.loc 1 423 5 view .LVU69
 274 0048 40F30D81 		ble	.L16
 275 004c 814B     		ldr	r3, .L50+28
 276 004e 0193     		str	r3, [sp, #4]
 277 0050 17E0     		b	.L25
 278              	.LVL11:
 279              	.L48:
 280              	.LBB45:
 281              	.LBB46:
 282              	.LBB47:
 345:app/toolhead.c ****         /* 几乎同向，可以保持最大速度 */
 283              		.loc 1 345 5 is_stmt 1 view .LVU70
 345:app/toolhead.c ****         /* 几乎同向，可以保持最大速度 */
 284              		.loc 1 345 8 is_stmt 0 view .LVU71
 285 0052 79A3     		adr	r3, .L50
 286 0054 D3E90023 		ldrd	r2, [r3]
 287 0058 2046     		mov	r0, r4
 288 005a 2946     		mov	r1, r5
 289 005c FFF7FEFF 		bl	__aeabi_dcmpgt
 290              	.LVL12:
 291 0060 0028     		cmp	r0, #0
 292 0062 00F0A980 		beq	.L44
 293              	.LBE47:
 294              	.LBE46:
 424:app/toolhead.c ****         int prev_idx = (idx - 1 + LOOKAHEAD_SIZE) % LOOKAHEAD_SIZE;
 425:app/toolhead.c ****         lookahead_move_t *curr = &s_lookahead[idx];
 426:app/toolhead.c ****         lookahead_move_t *prev = &s_lookahead[prev_idx];
 427:app/toolhead.c ****         
 428:app/toolhead.c ****         /* 计算从当前段结束速度反推的最大起始速度 */
 429:app/toolhead.c ****         /* v_start^2 = v_end^2 + 2 * a * d */
 430:app/toolhead.c ****         double max_start_v_sq = curr->max_end_v * curr->max_end_v +
 431:app/toolhead.c ****                                 2.0 * s_config.max_accel * curr->distance;
 432:app/toolhead.c ****         double max_start_v = sqrt(max_start_v_sq);
 433:app/toolhead.c ****         
 434:app/toolhead.c ****         if (max_start_v > curr->max_cruise_v) {
 435:app/toolhead.c ****             max_start_v = curr->max_cruise_v;
 436:app/toolhead.c ****         }
ARM GAS  /tmp/ccLyNHPk.s 			page 14


 437:app/toolhead.c ****         
 438:app/toolhead.c ****         curr->max_start_v = max_start_v;
 439:app/toolhead.c ****         
 440:app/toolhead.c ****         /* 计算结点速度 */
 441:app/toolhead.c ****         struct coord prev_dir, curr_dir;
 442:app/toolhead.c ****         cartesian_calc_direction(&prev->start_pos, &prev->end_pos, &prev_dir);
 443:app/toolhead.c ****         cartesian_calc_direction(&curr->start_pos, &curr->end_pos, &curr_dir);
 444:app/toolhead.c ****         
 445:app/toolhead.c ****         double junction_v = calc_junction_velocity(&prev_dir, &curr_dir,
 446:app/toolhead.c ****                                                    max_start_v);
 447:app/toolhead.c ****         
 448:app/toolhead.c ****         if (junction_v < max_start_v) {
 449:app/toolhead.c ****             curr->max_start_v = junction_v;
 450:app/toolhead.c ****         }
 451:app/toolhead.c ****         
 452:app/toolhead.c ****         prev->max_end_v = curr->max_start_v;
 295              		.loc 1 452 31 view .LVU72
 296 0066 D8E91489 		ldrd	r8, [r8, #80]
 297              	.LVL13:
 298              	.L22:
 299              		.loc 1 452 9 is_stmt 1 discriminator 2 view .LVU73
 300              		.loc 1 452 25 is_stmt 0 discriminator 2 view .LVU74
 301 006a 059B     		ldr	r3, [sp, #20]
 302 006c 784A     		ldr	r2, .L50+24
 303 006e 5344     		add	r3, r3, r10
 304 0070 02EBC303 		add	r3, r2, r3, lsl #3
 305 0074 C3E91889 		strd	r8, [r3, #96]
 453:app/toolhead.c ****         
 454:app/toolhead.c ****         idx = prev_idx;
 306              		.loc 1 454 9 is_stmt 1 discriminator 2 view .LVU75
 307              	.LVL14:
 308              		.loc 1 454 9 is_stmt 0 discriminator 2 view .LVU76
 309              	.LBE45:
 423:app/toolhead.c ****         int prev_idx = (idx - 1 + LOOKAHEAD_SIZE) % LOOKAHEAD_SIZE;
 310              		.loc 1 423 48 is_stmt 1 discriminator 2 view .LVU77
 423:app/toolhead.c ****         int prev_idx = (idx - 1 + LOOKAHEAD_SIZE) % LOOKAHEAD_SIZE;
 311              		.loc 1 423 41 discriminator 2 view .LVU78
 423:app/toolhead.c ****         int prev_idx = (idx - 1 + LOOKAHEAD_SIZE) % LOOKAHEAD_SIZE;
 312              		.loc 1 423 5 is_stmt 0 discriminator 2 view .LVU79
 313 0078 049B     		ldr	r3, [sp, #16]
 314 007a 013B     		subs	r3, r3, #1
 315              	.LVL15:
 423:app/toolhead.c ****         int prev_idx = (idx - 1 + LOOKAHEAD_SIZE) % LOOKAHEAD_SIZE;
 316              		.loc 1 423 5 discriminator 2 view .LVU80
 317 007c 0493     		str	r3, [sp, #16]
 318 007e 00F0EF80 		beq	.L47
 319              	.LVL16:
 320              	.L25:
 321              	.LBB52:
 424:app/toolhead.c ****         int prev_idx = (idx - 1 + LOOKAHEAD_SIZE) % LOOKAHEAD_SIZE;
 322              		.loc 1 424 9 is_stmt 1 view .LVU81
 431:app/toolhead.c ****         double max_start_v = sqrt(max_start_v_sq);
 323              		.loc 1 431 47 is_stmt 0 view .LVU82
 324 0082 019B     		ldr	r3, [sp, #4]
 325 0084 5868     		ldr	r0, [r3, #4]	@ float
 424:app/toolhead.c ****         lookahead_move_t *curr = &s_lookahead[idx];
 326              		.loc 1 424 33 view .LVU83
ARM GAS  /tmp/ccLyNHPk.s 			page 15


 327 0086 0AF10F03 		add	r3, r10, #15
 328 008a D346     		mov	fp, r10
 424:app/toolhead.c ****         lookahead_move_t *curr = &s_lookahead[idx];
 329              		.loc 1 424 13 view .LVU84
 330 008c 03F00F0A 		and	r10, r3, #15
 331              	.LVL17:
 425:app/toolhead.c ****         lookahead_move_t *prev = &s_lookahead[prev_idx];
 332              		.loc 1 425 9 is_stmt 1 view .LVU85
 426:app/toolhead.c ****         
 333              		.loc 1 426 9 view .LVU86
 430:app/toolhead.c ****                                 2.0 * s_config.max_accel * curr->distance;
 334              		.loc 1 430 9 view .LVU87
 432:app/toolhead.c ****         
 335              		.loc 1 432 9 view .LVU88
 431:app/toolhead.c ****         double max_start_v = sqrt(max_start_v_sq);
 336              		.loc 1 431 47 is_stmt 0 view .LVU89
 337 0090 FFF7FEFF 		bl	__aeabi_f2d
 338              	.LVL18:
 431:app/toolhead.c ****         double max_start_v = sqrt(max_start_v_sq);
 339              		.loc 1 431 47 view .LVU90
 340 0094 0246     		mov	r2, r0
 341 0096 0B46     		mov	r3, r1
 431:app/toolhead.c ****         double max_start_v = sqrt(max_start_v_sq);
 342              		.loc 1 431 37 view .LVU91
 343 0098 FFF7FEFF 		bl	__aeabi_dadd
 344              	.LVL19:
 431:app/toolhead.c ****         double max_start_v = sqrt(max_start_v_sq);
 345              		.loc 1 431 64 view .LVU92
 346 009c 6C4B     		ldr	r3, .L50+24
 347 009e 0BEB0B16 		add	r6, fp, fp, lsl #4
 348 00a2 03EBC606 		add	r6, r3, r6, lsl #3
 349 00a6 4FEA0B13 		lsl	r3, fp, #4
 350 00aa 0293     		str	r3, [sp, #8]
 431:app/toolhead.c ****         double max_start_v = sqrt(max_start_v_sq);
 351              		.loc 1 431 58 view .LVU93
 352 00ac D6E91023 		ldrd	r2, [r6, #64]
 353 00b0 FFF7FEFF 		bl	__aeabi_dmul
 354              	.LVL20:
 430:app/toolhead.c ****                                 2.0 * s_config.max_accel * curr->distance;
 355              		.loc 1 430 49 view .LVU94
 356 00b4 4246     		mov	r2, r8
 431:app/toolhead.c ****         double max_start_v = sqrt(max_start_v_sq);
 357              		.loc 1 431 58 view .LVU95
 358 00b6 0446     		mov	r4, r0
 359 00b8 0D46     		mov	r5, r1
 430:app/toolhead.c ****                                 2.0 * s_config.max_accel * curr->distance;
 360              		.loc 1 430 49 view .LVU96
 361 00ba 4B46     		mov	r3, r9
 362 00bc 4046     		mov	r0, r8
 363 00be 4946     		mov	r1, r9
 364 00c0 FFF7FEFF 		bl	__aeabi_dmul
 365              	.LVL21:
 366 00c4 0246     		mov	r2, r0
 367 00c6 0B46     		mov	r3, r1
 430:app/toolhead.c ****                                 2.0 * s_config.max_accel * curr->distance;
 368              		.loc 1 430 16 view .LVU97
 369 00c8 2046     		mov	r0, r4
ARM GAS  /tmp/ccLyNHPk.s 			page 16


 370 00ca 2946     		mov	r1, r5
 371 00cc FFF7FEFF 		bl	__aeabi_dadd
 372              	.LVL22:
 432:app/toolhead.c ****         
 373              		.loc 1 432 30 view .LVU98
 374 00d0 41EC100B 		vmov	d0, r0, r1
 375 00d4 FFF7FEFF 		bl	sqrt
 376              	.LVL23:
 434:app/toolhead.c ****             max_start_v = curr->max_cruise_v;
 377              		.loc 1 434 31 view .LVU99
 378 00d8 D6E91645 		ldrd	r4, [r6, #88]
 432:app/toolhead.c ****         
 379              		.loc 1 432 30 view .LVU100
 380 00dc 57EC106B 		vmov	r6, r7, d0
 434:app/toolhead.c ****             max_start_v = curr->max_cruise_v;
 381              		.loc 1 434 9 is_stmt 1 view .LVU101
 434:app/toolhead.c ****             max_start_v = curr->max_cruise_v;
 382              		.loc 1 434 12 is_stmt 0 view .LVU102
 383 00e0 10EE102A 		vmov	r2, s0	@ int
 384 00e4 2046     		mov	r0, r4
 385 00e6 2946     		mov	r1, r5
 386 00e8 3B46     		mov	r3, r7
 387 00ea FFF7FEFF 		bl	__aeabi_dcmplt
 388              	.LVL24:
 389 00ee 08B1     		cbz	r0, .L17
 435:app/toolhead.c ****         }
 390              		.loc 1 435 25 view .LVU103
 391 00f0 2646     		mov	r6, r4
 392 00f2 2F46     		mov	r7, r5
 393              	.L17:
 394              	.LVL25:
 438:app/toolhead.c ****         
 395              		.loc 1 438 9 is_stmt 1 view .LVU104
 438:app/toolhead.c ****         
 396              		.loc 1 438 27 is_stmt 0 view .LVU105
 397 00f4 029B     		ldr	r3, [sp, #8]
 442:app/toolhead.c ****         cartesian_calc_direction(&curr->start_pos, &curr->end_pos, &curr_dir);
 398              		.loc 1 442 9 view .LVU106
 399 00f6 564D     		ldr	r5, .L50+24
 400 00f8 0AEB0A10 		add	r0, r10, r10, lsl #4
 438:app/toolhead.c ****         
 401              		.loc 1 438 27 view .LVU107
 402 00fc 5B44     		add	r3, r3, fp
 403 00fe C000     		lsls	r0, r0, #3
 404 0100 05EBC302 		add	r2, r5, r3, lsl #3
 442:app/toolhead.c ****         cartesian_calc_direction(&curr->start_pos, &curr->end_pos, &curr_dir);
 405              		.loc 1 442 52 view .LVU108
 406 0104 00F12001 		add	r1, r0, #32
 442:app/toolhead.c ****         cartesian_calc_direction(&curr->start_pos, &curr->end_pos, &curr_dir);
 407              		.loc 1 442 9 view .LVU109
 408 0108 2944     		add	r1, r1, r5
 409 010a 2844     		add	r0, r0, r5
 438:app/toolhead.c ****         
 410              		.loc 1 438 27 view .LVU110
 411 010c C2E91467 		strd	r6, [r2, #80]
 441:app/toolhead.c ****         cartesian_calc_direction(&prev->start_pos, &prev->end_pos, &prev_dir);
 412              		.loc 1 441 9 is_stmt 1 view .LVU111
ARM GAS  /tmp/ccLyNHPk.s 			page 17


 442:app/toolhead.c ****         cartesian_calc_direction(&curr->start_pos, &curr->end_pos, &curr_dir);
 413              		.loc 1 442 9 view .LVU112
 438:app/toolhead.c ****         
 414              		.loc 1 438 27 is_stmt 0 view .LVU113
 415 0110 0392     		str	r2, [sp, #12]
 442:app/toolhead.c ****         cartesian_calc_direction(&curr->start_pos, &curr->end_pos, &curr_dir);
 416              		.loc 1 442 9 view .LVU114
 417 0112 06AA     		add	r2, sp, #24
 438:app/toolhead.c ****         
 418              		.loc 1 438 27 view .LVU115
 419 0114 DC00     		lsls	r4, r3, #3
 442:app/toolhead.c ****         cartesian_calc_direction(&curr->start_pos, &curr->end_pos, &curr_dir);
 420              		.loc 1 442 9 view .LVU116
 421 0116 FFF7FEFF 		bl	cartesian_calc_direction
 422              	.LVL26:
 443:app/toolhead.c ****         
 423              		.loc 1 443 9 is_stmt 1 view .LVU117
 424 011a DDF80C80 		ldr	r8, [sp, #12]
 425 011e 0EAB     		add	r3, sp, #56
 443:app/toolhead.c ****         
 426              		.loc 1 443 52 is_stmt 0 view .LVU118
 427 0120 04F12001 		add	r1, r4, #32
 443:app/toolhead.c ****         
 428              		.loc 1 443 9 view .LVU119
 429 0124 2944     		add	r1, r1, r5
 430 0126 1A46     		mov	r2, r3
 431 0128 4046     		mov	r0, r8
 432 012a FFF7FEFF 		bl	cartesian_calc_direction
 433              	.LVL27:
 445:app/toolhead.c ****                                                    max_start_v);
 434              		.loc 1 445 9 is_stmt 1 view .LVU120
 435              	.LBB50:
 436              	.LBI46:
 330:app/toolhead.c ****                        const struct coord *next_dir,
 437              		.loc 1 330 1 view .LVU121
 438              	.LBB48:
 335:app/toolhead.c ****                  prev_dir->y * next_dir->y +
 439              		.loc 1 335 5 view .LVU122
 440 012e 4FEA0A13 		lsl	r3, r10, #4
 441 0132 0593     		str	r3, [sp, #20]
 335:app/toolhead.c ****                  prev_dir->y * next_dir->y +
 442              		.loc 1 335 30 is_stmt 0 view .LVU123
 443 0134 DDE90601 		ldrd	r0, [sp, #24]
 444 0138 DDE90E23 		ldrd	r2, [sp, #56]
 445 013c FFF7FEFF 		bl	__aeabi_dmul
 446              	.LVL28:
 336:app/toolhead.c ****                  prev_dir->z * next_dir->z;
 447              		.loc 1 336 30 view .LVU124
 448 0140 DDE91023 		ldrd	r2, [sp, #64]
 335:app/toolhead.c ****                  prev_dir->y * next_dir->y +
 449              		.loc 1 335 30 view .LVU125
 450 0144 0446     		mov	r4, r0
 451 0146 0D46     		mov	r5, r1
 336:app/toolhead.c ****                  prev_dir->z * next_dir->z;
 452              		.loc 1 336 30 view .LVU126
 453 0148 DDE90801 		ldrd	r0, [sp, #32]
 454 014c FFF7FEFF 		bl	__aeabi_dmul
ARM GAS  /tmp/ccLyNHPk.s 			page 18


 455              	.LVL29:
 456 0150 0246     		mov	r2, r0
 457 0152 0B46     		mov	r3, r1
 335:app/toolhead.c ****                  prev_dir->y * next_dir->y +
 458              		.loc 1 335 44 view .LVU127
 459 0154 2046     		mov	r0, r4
 460 0156 2946     		mov	r1, r5
 461 0158 FFF7FEFF 		bl	__aeabi_dadd
 462              	.LVL30:
 337:app/toolhead.c ****     
 463              		.loc 1 337 30 view .LVU128
 464 015c DDE91223 		ldrd	r2, [sp, #72]
 335:app/toolhead.c ****                  prev_dir->y * next_dir->y +
 465              		.loc 1 335 44 view .LVU129
 466 0160 0446     		mov	r4, r0
 467 0162 0D46     		mov	r5, r1
 337:app/toolhead.c ****     
 468              		.loc 1 337 30 view .LVU130
 469 0164 DDE90A01 		ldrd	r0, [sp, #40]
 470 0168 FFF7FEFF 		bl	__aeabi_dmul
 471              	.LVL31:
 472 016c 0246     		mov	r2, r0
 473 016e 0B46     		mov	r3, r1
 335:app/toolhead.c ****                  prev_dir->y * next_dir->y +
 474              		.loc 1 335 12 view .LVU131
 475 0170 2046     		mov	r0, r4
 476 0172 2946     		mov	r1, r5
 477 0174 FFF7FEFF 		bl	__aeabi_dadd
 478              	.LVL32:
 340:app/toolhead.c ****         /* 几乎反向，需要完全停止 */
 479              		.loc 1 340 8 view .LVU132
 480 0178 31A3     		adr	r3, .L50+8
 481 017a D3E90023 		ldrd	r2, [r3]
 335:app/toolhead.c ****                  prev_dir->y * next_dir->y +
 482              		.loc 1 335 12 view .LVU133
 483 017e 0446     		mov	r4, r0
 484 0180 0D46     		mov	r5, r1
 485              	.LVL33:
 340:app/toolhead.c ****         /* 几乎反向，需要完全停止 */
 486              		.loc 1 340 5 is_stmt 1 view .LVU134
 340:app/toolhead.c ****         /* 几乎反向，需要完全停止 */
 487              		.loc 1 340 8 is_stmt 0 view .LVU135
 488 0182 FFF7FEFF 		bl	__aeabi_dcmplt
 489              	.LVL34:
 490 0186 0028     		cmp	r0, #0
 491 0188 3FF463AF 		beq	.L48
 342:app/toolhead.c ****     }
 492              		.loc 1 342 16 view .LVU136
 493 018c 4FF00008 		mov	r8, #0
 494 0190 4FF00009 		mov	r9, #0
 495              	.LVL35:
 496              	.L19:
 342:app/toolhead.c ****     }
 497              		.loc 1 342 16 view .LVU137
 498              	.LBE48:
 499              	.LBE50:
 448:app/toolhead.c ****             curr->max_start_v = junction_v;
ARM GAS  /tmp/ccLyNHPk.s 			page 19


 500              		.loc 1 448 9 is_stmt 1 view .LVU138
 448:app/toolhead.c ****             curr->max_start_v = junction_v;
 501              		.loc 1 448 12 is_stmt 0 view .LVU139
 502 0194 4B46     		mov	r3, r9
 503 0196 3046     		mov	r0, r6
 504 0198 3946     		mov	r1, r7
 505 019a 4246     		mov	r2, r8
 506 019c FFF7FEFF 		bl	__aeabi_dcmpgt
 507              	.LVL36:
 449:app/toolhead.c ****         }
 508              		.loc 1 449 31 view .LVU140
 509 01a0 029B     		ldr	r3, [sp, #8]
 510 01a2 5B44     		add	r3, r3, fp
 448:app/toolhead.c ****             curr->max_start_v = junction_v;
 511              		.loc 1 448 12 view .LVU141
 512 01a4 0028     		cmp	r0, #0
 513 01a6 00F00081 		beq	.L49
 449:app/toolhead.c ****         }
 514              		.loc 1 449 13 is_stmt 1 view .LVU142
 449:app/toolhead.c ****         }
 515              		.loc 1 449 31 is_stmt 0 view .LVU143
 516 01aa 9B46     		mov	fp, r3
 517              	.LVL37:
 449:app/toolhead.c ****         }
 518              		.loc 1 449 31 view .LVU144
 519 01ac 284B     		ldr	r3, .L50+24
 520 01ae 03EBCB0B 		add	fp, r3, fp, lsl #3
 521 01b2 CBE91489 		strd	r8, [fp, #80]
 522 01b6 58E7     		b	.L22
 523              	.LVL38:
 524              	.L44:
 525              	.LBB51:
 526              	.LBB49:
 352:app/toolhead.c ****     
 527              		.loc 1 352 5 is_stmt 1 view .LVU145
 352:app/toolhead.c ****     
 528              		.loc 1 352 39 is_stmt 0 view .LVU146
 529 01b8 2246     		mov	r2, r4
 530 01ba 2B46     		mov	r3, r5
 531 01bc 2649     		ldr	r1, .L50+32
 532 01be 0020     		movs	r0, #0
 533 01c0 FFF7FEFF 		bl	__aeabi_dsub
 534              	.LVL39:
 352:app/toolhead.c ****     
 535              		.loc 1 352 29 view .LVU147
 536 01c4 0022     		movs	r2, #0
 537 01c6 254B     		ldr	r3, .L50+36
 538 01c8 FFF7FEFF 		bl	__aeabi_dmul
 539              	.LVL40:
 540 01cc 41EC100B 		vmov	d0, r0, r1
 541 01d0 FFF7FEFF 		bl	sqrt
 542              	.LVL41:
 357:app/toolhead.c ****                        s_config.square_corner_velocity / s_config.max_accel;
 543              		.loc 1 357 32 view .LVU148
 544 01d4 019B     		ldr	r3, [sp, #4]
 545 01d6 D3ED037A 		vldr.32	s15, [r3, #12]
 358:app/toolhead.c ****     
ARM GAS  /tmp/ccLyNHPk.s 			page 20


 546              		.loc 1 358 66 view .LVU149
 547 01da 93ED018A 		vldr.32	s16, [r3, #4]
 357:app/toolhead.c ****                        s_config.square_corner_velocity / s_config.max_accel;
 548              		.loc 1 357 56 view .LVU150
 549 01de 67EEA77A 		vmul.f32	s15, s15, s15
 352:app/toolhead.c ****     
 550              		.loc 1 352 29 view .LVU151
 551 01e2 55EC104B 		vmov	r4, r5, d0
 552              	.LVL42:
 357:app/toolhead.c ****                        s_config.square_corner_velocity / s_config.max_accel;
 553              		.loc 1 357 5 is_stmt 1 view .LVU152
 360:app/toolhead.c ****     
 554              		.loc 1 360 5 view .LVU153
 357:app/toolhead.c ****                        s_config.square_corner_velocity / s_config.max_accel;
 555              		.loc 1 357 12 is_stmt 0 view .LVU154
 556 01e6 C7EE887A 		vdiv.f32	s15, s15, s16
 557 01ea 17EE900A 		vmov	r0, s15
 558 01ee FFF7FEFF 		bl	__aeabi_f2d
 559              	.LVL43:
 357:app/toolhead.c ****                        s_config.square_corner_velocity / s_config.max_accel;
 560              		.loc 1 357 12 view .LVU155
 561 01f2 8046     		mov	r8, r0
 360:app/toolhead.c ****     
 562              		.loc 1 360 38 view .LVU156
 563 01f4 18EE100A 		vmov	r0, s16
 357:app/toolhead.c ****                        s_config.square_corner_velocity / s_config.max_accel;
 564              		.loc 1 357 12 view .LVU157
 565 01f8 8946     		mov	r9, r1
 360:app/toolhead.c ****     
 566              		.loc 1 360 38 view .LVU158
 567 01fa FFF7FEFF 		bl	__aeabi_f2d
 568              	.LVL44:
 569 01fe 0246     		mov	r2, r0
 570 0200 0B46     		mov	r3, r1
 360:app/toolhead.c ****     
 571              		.loc 1 360 49 view .LVU159
 572 0202 4046     		mov	r0, r8
 573 0204 4946     		mov	r1, r9
 574 0206 FFF7FEFF 		bl	__aeabi_dmul
 575              	.LVL45:
 360:app/toolhead.c ****     
 576              		.loc 1 360 25 view .LVU160
 577 020a 2246     		mov	r2, r4
 578 020c 2B46     		mov	r3, r5
 579 020e FFF7FEFF 		bl	__aeabi_ddiv
 580              	.LVL46:
 581 0212 41EC100B 		vmov	d0, r0, r1
 582 0216 FFF7FEFF 		bl	sqrt
 583              	.LVL47:
 584 021a 59EC108B 		vmov	r8, r9, d0
 362:app/toolhead.c ****         junction_v = max_v;
 585              		.loc 1 362 5 is_stmt 1 view .LVU161
 362:app/toolhead.c ****         junction_v = max_v;
 586              		.loc 1 362 8 is_stmt 0 view .LVU162
 587 021e 10EE102A 		vmov	r2, s0	@ int
 588 0222 3046     		mov	r0, r6
 589 0224 3946     		mov	r1, r7
ARM GAS  /tmp/ccLyNHPk.s 			page 21


 590 0226 4B46     		mov	r3, r9
 591 0228 FFF7FEFF 		bl	__aeabi_dcmplt
 592              	.LVL48:
 593 022c 0028     		cmp	r0, #0
 594 022e B1D0     		beq	.L19
 595              	.LBE49:
 596              	.LBE51:
 452:app/toolhead.c ****         
 597              		.loc 1 452 31 view .LVU163
 598 0230 039B     		ldr	r3, [sp, #12]
 599 0232 D3E91489 		ldrd	r8, [r3, #80]
 600 0236 18E7     		b	.L22
 601              	.L51:
 602              		.align	3
 603              	.L50:
 604 0238 2B8716D9 		.word	-652835029
 605 023c CEF7EF3F 		.word	1072691150
 606 0240 2B8716D9 		.word	-652835029
 607 0244 CEF7EFBF 		.word	-1074792498
 608 0248 00000000 		.word	.LANCHOR0
 609 024c 00000000 		.word	.LANCHOR1
 610 0250 00000000 		.word	.LANCHOR2
 611 0254 00000000 		.word	.LANCHOR4
 612 0258 0000F03F 		.word	1072693248
 613 025c 0000E03F 		.word	1071644672
 614              	.LVL49:
 615              	.L47:
 452:app/toolhead.c ****         
 616              		.loc 1 452 31 view .LVU164
 617              	.LBE52:
 618              	.LBE55:
 619              	.LBB56:
 455:app/toolhead.c ****     }
 456:app/toolhead.c ****     
 457:app/toolhead.c ****     /* 正向遍历: 计算实际速度并添加到 trapq */
 458:app/toolhead.c ****     idx = s_lookahead_head;
 459:app/toolhead.c ****     double prev_end_v = 0.0;
 460:app/toolhead.c ****     
 461:app/toolhead.c ****     for (int i = 0; i < s_lookahead_count; i++) {
 620              		.loc 1 461 23 view .LVU165
 621 0260 554B     		ldr	r3, .L52
 622              	.LVL50:
 623              		.loc 1 461 23 view .LVU166
 624 0262 1B68     		ldr	r3, [r3]
 625 0264 0393     		str	r3, [sp, #12]
 626              	.LVL51:
 627              	.L16:
 628              		.loc 1 461 23 view .LVU167
 629              	.LBE56:
 458:app/toolhead.c ****     double prev_end_v = 0.0;
 630              		.loc 1 458 5 is_stmt 1 view .LVU168
 458:app/toolhead.c ****     double prev_end_v = 0.0;
 631              		.loc 1 458 9 is_stmt 0 view .LVU169
 632 0266 554B     		ldr	r3, .L52+4
 633 0268 1C68     		ldr	r4, [r3]
 634              	.LVL52:
 459:app/toolhead.c ****     
ARM GAS  /tmp/ccLyNHPk.s 			page 22


 635              		.loc 1 459 5 is_stmt 1 view .LVU170
 636              		.loc 1 461 5 view .LVU171
 637              	.LBB61:
 638              		.loc 1 461 10 view .LVU172
 639              		.loc 1 461 21 view .LVU173
 640              		.loc 1 461 5 is_stmt 0 view .LVU174
 641 026a 039B     		ldr	r3, [sp, #12]
 642 026c 002B     		cmp	r3, #0
 643 026e 40F39780 		ble	.L14
 644              		.loc 1 461 14 view .LVU175
 645 0272 0023     		movs	r3, #0
 646 0274 0293     		str	r3, [sp, #8]
 647 0276 524B     		ldr	r3, .L52+8
 648 0278 0193     		str	r3, [sp, #4]
 649              	.LBE61:
 459:app/toolhead.c ****     
 650              		.loc 1 459 12 view .LVU176
 651 027a 4FF0000A 		mov	r10, #0
 652 027e 4FF0000B 		mov	fp, #0
 653              	.LVL53:
 654              	.L33:
 655              	.LBB62:
 656              	.LBB57:
 462:app/toolhead.c ****         lookahead_move_t *move = &s_lookahead[idx];
 657              		.loc 1 462 9 is_stmt 1 view .LVU177
 463:app/toolhead.c ****         
 464:app/toolhead.c ****         /* 起始速度 = 前一段的结束速度 */
 465:app/toolhead.c ****         move->start_v = prev_end_v;
 658              		.loc 1 465 9 view .LVU178
 659              		.loc 1 465 23 is_stmt 0 view .LVU179
 660 0282 504B     		ldr	r3, .L52+12
 661 0284 04EB0418 		add	r8, r4, r4, lsl #4
 662 0288 03EBC808 		add	r8, r3, r8, lsl #3
 466:app/toolhead.c ****         
 467:app/toolhead.c ****         /* 检查是否能达到巡航速度 */
 468:app/toolhead.c ****         /* v_cruise^2 = v_start^2 + 2 * a * d_accel */
 469:app/toolhead.c ****         double max_cruise_v_sq = move->start_v * move->start_v +
 470:app/toolhead.c ****                                  2.0 * s_config.max_accel * move->distance;
 663              		.loc 1 470 48 view .LVU180
 664 028c 019B     		ldr	r3, [sp, #4]
 465:app/toolhead.c ****         
 665              		.loc 1 465 23 view .LVU181
 666 028e C8E91AAB 		strd	r10, [r8, #104]
 469:app/toolhead.c ****                                  2.0 * s_config.max_accel * move->distance;
 667              		.loc 1 469 9 is_stmt 1 view .LVU182
 668              	.LVL54:
 471:app/toolhead.c ****         double max_cruise_v = sqrt(max_cruise_v_sq);
 669              		.loc 1 471 9 view .LVU183
 470:app/toolhead.c ****         double max_cruise_v = sqrt(max_cruise_v_sq);
 670              		.loc 1 470 48 is_stmt 0 view .LVU184
 671 0292 5868     		ldr	r0, [r3, #4]	@ float
 672 0294 FFF7FEFF 		bl	__aeabi_f2d
 673              	.LVL55:
 470:app/toolhead.c ****         double max_cruise_v = sqrt(max_cruise_v_sq);
 674              		.loc 1 470 48 view .LVU185
 675 0298 0246     		mov	r2, r0
 676 029a 0B46     		mov	r3, r1
ARM GAS  /tmp/ccLyNHPk.s 			page 23


 470:app/toolhead.c ****         double max_cruise_v = sqrt(max_cruise_v_sq);
 677              		.loc 1 470 38 view .LVU186
 678 029c FFF7FEFF 		bl	__aeabi_dadd
 679              	.LVL56:
 470:app/toolhead.c ****         double max_cruise_v = sqrt(max_cruise_v_sq);
 680              		.loc 1 470 59 view .LVU187
 681 02a0 D8E91023 		ldrd	r2, [r8, #64]
 682 02a4 FFF7FEFF 		bl	__aeabi_dmul
 683              	.LVL57:
 469:app/toolhead.c ****                                  2.0 * s_config.max_accel * move->distance;
 684              		.loc 1 469 48 view .LVU188
 685 02a8 5246     		mov	r2, r10
 470:app/toolhead.c ****         double max_cruise_v = sqrt(max_cruise_v_sq);
 686              		.loc 1 470 59 view .LVU189
 687 02aa 0646     		mov	r6, r0
 688 02ac 0F46     		mov	r7, r1
 469:app/toolhead.c ****                                  2.0 * s_config.max_accel * move->distance;
 689              		.loc 1 469 48 view .LVU190
 690 02ae 5B46     		mov	r3, fp
 691 02b0 5046     		mov	r0, r10
 692 02b2 5946     		mov	r1, fp
 693 02b4 FFF7FEFF 		bl	__aeabi_dmul
 694              	.LVL58:
 695 02b8 0246     		mov	r2, r0
 696 02ba 0B46     		mov	r3, r1
 469:app/toolhead.c ****                                  2.0 * s_config.max_accel * move->distance;
 697              		.loc 1 469 16 view .LVU191
 698 02bc 3046     		mov	r0, r6
 699 02be 3946     		mov	r1, r7
 700 02c0 FFF7FEFF 		bl	__aeabi_dadd
 701              	.LVL59:
 702              		.loc 1 471 31 view .LVU192
 703 02c4 41EC100B 		vmov	d0, r0, r1
 704 02c8 FFF7FEFF 		bl	sqrt
 705              	.LVL60:
 472:app/toolhead.c ****         
 473:app/toolhead.c ****         if (max_cruise_v > move->max_cruise_v) {
 706              		.loc 1 473 32 view .LVU193
 707 02cc D8E91689 		ldrd	r8, [r8, #88]
 471:app/toolhead.c ****         
 708              		.loc 1 471 31 view .LVU194
 709 02d0 57EC106B 		vmov	r6, r7, d0
 710              		.loc 1 473 9 is_stmt 1 view .LVU195
 711              		.loc 1 473 12 is_stmt 0 view .LVU196
 712 02d4 10EE102A 		vmov	r2, s0	@ int
 713 02d8 3B46     		mov	r3, r7
 714 02da 4046     		mov	r0, r8
 715 02dc 4946     		mov	r1, r9
 465:app/toolhead.c ****         
 716              		.loc 1 465 23 view .LVU197
 717 02de 2501     		lsls	r5, r4, #4
 474:app/toolhead.c ****             max_cruise_v = move->max_cruise_v;
 475:app/toolhead.c ****         }
 476:app/toolhead.c ****         
 477:app/toolhead.c ****         move->cruise_v = max_cruise_v;
 478:app/toolhead.c ****         
 479:app/toolhead.c ****         /* 计算结束速度 */
ARM GAS  /tmp/ccLyNHPk.s 			page 24


 480:app/toolhead.c ****         /* v_end^2 = v_cruise^2 - 2 * a * d_decel */
 481:app/toolhead.c ****         double max_end_v_sq = move->cruise_v * move->cruise_v -
 482:app/toolhead.c ****                               2.0 * s_config.max_accel_to_decel * move->distance;
 483:app/toolhead.c ****         double max_end_v = (max_end_v_sq > 0.0) ? sqrt(max_end_v_sq) : 0.0;
 718              		.loc 1 483 70 view .LVU198
 719 02e0 4FF0000A 		mov	r10, #0
 720              	.LVL61:
 721              		.loc 1 483 70 view .LVU199
 722 02e4 4FF0000B 		mov	fp, #0
 473:app/toolhead.c ****             max_cruise_v = move->max_cruise_v;
 723              		.loc 1 473 12 view .LVU200
 724 02e8 FFF7FEFF 		bl	__aeabi_dcmplt
 725              	.LVL62:
 726 02ec 08B1     		cbz	r0, .L27
 474:app/toolhead.c ****             max_cruise_v = move->max_cruise_v;
 727              		.loc 1 474 26 view .LVU201
 728 02ee 4646     		mov	r6, r8
 729 02f0 4F46     		mov	r7, r9
 730              	.L27:
 731              	.LVL63:
 477:app/toolhead.c ****         
 732              		.loc 1 477 9 is_stmt 1 view .LVU202
 477:app/toolhead.c ****         
 733              		.loc 1 477 24 is_stmt 0 view .LVU203
 734 02f2 344B     		ldr	r3, .L52+12
 735 02f4 05EB0408 		add	r8, r5, r4
 736 02f8 03EBC808 		add	r8, r3, r8, lsl #3
 481:app/toolhead.c ****                               2.0 * s_config.max_accel_to_decel * move->distance;
 737              		.loc 1 481 46 view .LVU204
 738 02fc 3246     		mov	r2, r6
 477:app/toolhead.c ****         
 739              		.loc 1 477 24 view .LVU205
 740 02fe C8E91C67 		strd	r6, [r8, #112]
 481:app/toolhead.c ****                               2.0 * s_config.max_accel_to_decel * move->distance;
 741              		.loc 1 481 9 is_stmt 1 view .LVU206
 481:app/toolhead.c ****                               2.0 * s_config.max_accel_to_decel * move->distance;
 742              		.loc 1 481 46 is_stmt 0 view .LVU207
 743 0302 3B46     		mov	r3, r7
 744 0304 3046     		mov	r0, r6
 745 0306 3946     		mov	r1, r7
 746 0308 FFF7FEFF 		bl	__aeabi_dmul
 747              	.LVL64:
 482:app/toolhead.c ****         double max_end_v = (max_end_v_sq > 0.0) ? sqrt(max_end_v_sq) : 0.0;
 748              		.loc 1 482 45 view .LVU208
 749 030c 019B     		ldr	r3, [sp, #4]
 481:app/toolhead.c ****                               2.0 * s_config.max_accel_to_decel * move->distance;
 750              		.loc 1 481 46 view .LVU209
 751 030e 0646     		mov	r6, r0
 752              	.LVL65:
 482:app/toolhead.c ****         double max_end_v = (max_end_v_sq > 0.0) ? sqrt(max_end_v_sq) : 0.0;
 753              		.loc 1 482 45 view .LVU210
 754 0310 9868     		ldr	r0, [r3, #8]	@ float
 481:app/toolhead.c ****                               2.0 * s_config.max_accel_to_decel * move->distance;
 755              		.loc 1 481 46 view .LVU211
 756 0312 0F46     		mov	r7, r1
 482:app/toolhead.c ****         double max_end_v = (max_end_v_sq > 0.0) ? sqrt(max_end_v_sq) : 0.0;
 757              		.loc 1 482 45 view .LVU212
ARM GAS  /tmp/ccLyNHPk.s 			page 25


 758 0314 FFF7FEFF 		bl	__aeabi_f2d
 759              	.LVL66:
 760 0318 0246     		mov	r2, r0
 761 031a 0B46     		mov	r3, r1
 482:app/toolhead.c ****         double max_end_v = (max_end_v_sq > 0.0) ? sqrt(max_end_v_sq) : 0.0;
 762              		.loc 1 482 35 view .LVU213
 763 031c FFF7FEFF 		bl	__aeabi_dadd
 764              	.LVL67:
 482:app/toolhead.c ****         double max_end_v = (max_end_v_sq > 0.0) ? sqrt(max_end_v_sq) : 0.0;
 765              		.loc 1 482 65 view .LVU214
 766 0320 D8E91023 		ldrd	r2, [r8, #64]
 767 0324 FFF7FEFF 		bl	__aeabi_dmul
 768              	.LVL68:
 769 0328 0246     		mov	r2, r0
 770 032a 0B46     		mov	r3, r1
 481:app/toolhead.c ****                               2.0 * s_config.max_accel_to_decel * move->distance;
 771              		.loc 1 481 16 view .LVU215
 772 032c 3046     		mov	r0, r6
 773 032e 3946     		mov	r1, r7
 774 0330 FFF7FEFF 		bl	__aeabi_dsub
 775              	.LVL69:
 776 0334 0246     		mov	r2, r0
 777 0336 0B46     		mov	r3, r1
 778 0338 43EC182B 		vmov	d8, r2, r3
 779              	.LVL70:
 780              		.loc 1 483 9 is_stmt 1 view .LVU216
 781              		.loc 1 483 70 is_stmt 0 view .LVU217
 782 033c 0022     		movs	r2, #0
 783              	.LVL71:
 784              		.loc 1 483 70 view .LVU218
 785 033e 0023     		movs	r3, #0
 786 0340 FFF7FEFF 		bl	__aeabi_dcmpgt
 787              	.LVL72:
 788              		.loc 1 483 51 view .LVU219
 789 0344 B0EE480A 		vmov.f32	s0, s16
 790 0348 F0EE680A 		vmov.f32	s1, s17
 791              		.loc 1 483 70 view .LVU220
 792 034c 18B1     		cbz	r0, .L29
 793              		.loc 1 483 51 discriminator 1 view .LVU221
 794 034e FFF7FEFF 		bl	sqrt
 795              	.LVL73:
 796 0352 5BEC10AB 		vmov	r10, fp, d0
 797              	.L29:
 798              	.LVL74:
 484:app/toolhead.c ****         
 485:app/toolhead.c ****         if (max_end_v > move->max_end_v) {
 799              		.loc 1 485 9 is_stmt 1 discriminator 4 view .LVU222
 800              		.loc 1 485 29 is_stmt 0 discriminator 4 view .LVU223
 801 0356 1B4A     		ldr	r2, .L52+12
 802              	.LBE57:
 461:app/toolhead.c ****         lookahead_move_t *move = &s_lookahead[idx];
 803              		.loc 1 461 45 discriminator 4 view .LVU224
 804 0358 0299     		ldr	r1, [sp, #8]
 805              	.LBB58:
 806              		.loc 1 485 29 discriminator 4 view .LVU225
 807 035a 2B19     		adds	r3, r5, r4
 808 035c 02EBC303 		add	r3, r2, r3, lsl #3
ARM GAS  /tmp/ccLyNHPk.s 			page 26


 809 0360 D3E91867 		ldrd	r6, [r3, #96]
 810              	.LBE58:
 461:app/toolhead.c ****         lookahead_move_t *move = &s_lookahead[idx];
 811              		.loc 1 461 45 discriminator 4 view .LVU226
 812 0364 0131     		adds	r1, r1, #1
 813 0366 0291     		str	r1, [sp, #8]
 814              	.LVL75:
 815              	.LBB59:
 816              		.loc 1 485 12 discriminator 4 view .LVU227
 817 0368 5246     		mov	r2, r10
 818 036a 5B46     		mov	r3, fp
 819 036c 3046     		mov	r0, r6
 820 036e 3946     		mov	r1, r7
 821 0370 FFF7FEFF 		bl	__aeabi_dcmplt
 822              	.LVL76:
 486:app/toolhead.c ****             max_end_v = move->max_end_v;
 487:app/toolhead.c ****         }
 488:app/toolhead.c ****         
 489:app/toolhead.c ****         move->end_v = max_end_v;
 823              		.loc 1 489 21 discriminator 4 view .LVU228
 824 0374 134B     		ldr	r3, .L52+12
 825 0376 2544     		add	r5, r5, r4
 490:app/toolhead.c ****         prev_end_v = move->end_v;
 491:app/toolhead.c ****         
 492:app/toolhead.c ****         idx = (idx + 1) % LOOKAHEAD_SIZE;
 826              		.loc 1 492 20 discriminator 4 view .LVU229
 827 0378 621C     		adds	r2, r4, #1
 489:app/toolhead.c ****         prev_end_v = move->end_v;
 828              		.loc 1 489 21 discriminator 4 view .LVU230
 829 037a 03EBC505 		add	r5, r3, r5, lsl #3
 485:app/toolhead.c ****             max_end_v = move->max_end_v;
 830              		.loc 1 485 12 discriminator 4 view .LVU231
 831 037e 08B1     		cbz	r0, .L31
 486:app/toolhead.c ****         }
 832              		.loc 1 486 23 view .LVU232
 833 0380 B246     		mov	r10, r6
 834              	.LVL77:
 486:app/toolhead.c ****         }
 835              		.loc 1 486 23 view .LVU233
 836 0382 BB46     		mov	fp, r7
 837              	.L31:
 838              	.LVL78:
 489:app/toolhead.c ****         prev_end_v = move->end_v;
 839              		.loc 1 489 9 is_stmt 1 discriminator 2 view .LVU234
 840              		.loc 1 492 13 is_stmt 0 discriminator 2 view .LVU235
 841 0384 5342     		rsbs	r3, r2, #0
 842 0386 03F00F03 		and	r3, r3, #15
 843 038a 02F00F04 		and	r4, r2, #15
 844              	.LVL79:
 845              		.loc 1 492 13 discriminator 2 view .LVU236
 846 038e 58BF     		it	pl
 847 0390 5C42     		rsbpl	r4, r3, #0
 848              	.LBE59:
 461:app/toolhead.c ****         lookahead_move_t *move = &s_lookahead[idx];
 849              		.loc 1 461 5 discriminator 2 view .LVU237
 850 0392 DDE90232 		ldrd	r3, r2, [sp, #8]
 851              	.LVL80:
ARM GAS  /tmp/ccLyNHPk.s 			page 27


 461:app/toolhead.c ****         lookahead_move_t *move = &s_lookahead[idx];
 852              		.loc 1 461 5 discriminator 2 view .LVU238
 853 0396 9342     		cmp	r3, r2
 854              	.LBB60:
 489:app/toolhead.c ****         prev_end_v = move->end_v;
 855              		.loc 1 489 21 discriminator 2 view .LVU239
 856 0398 C5E91EAB 		strd	r10, [r5, #120]
 490:app/toolhead.c ****         
 857              		.loc 1 490 9 is_stmt 1 discriminator 2 view .LVU240
 858              	.LVL81:
 859              		.loc 1 492 9 discriminator 2 view .LVU241
 860              		.loc 1 492 9 is_stmt 0 discriminator 2 view .LVU242
 861              	.LBE60:
 461:app/toolhead.c ****         lookahead_move_t *move = &s_lookahead[idx];
 862              		.loc 1 461 44 is_stmt 1 discriminator 2 view .LVU243
 461:app/toolhead.c ****         lookahead_move_t *move = &s_lookahead[idx];
 863              		.loc 1 461 21 discriminator 2 view .LVU244
 461:app/toolhead.c ****         lookahead_move_t *move = &s_lookahead[idx];
 864              		.loc 1 461 5 is_stmt 0 discriminator 2 view .LVU245
 865 039c 7FF471AF 		bne	.L33
 866              	.LVL82:
 867              	.L14:
 461:app/toolhead.c ****         lookahead_move_t *move = &s_lookahead[idx];
 868              		.loc 1 461 5 discriminator 2 view .LVU246
 869              	.LBE62:
 493:app/toolhead.c ****     }
 494:app/toolhead.c **** }
 870              		.loc 1 494 1 view .LVU247
 871 03a0 17B0     		add	sp, sp, #92
 872              		.cfi_remember_state
 873              		.cfi_def_cfa_offset 44
 874              		@ sp needed
 875 03a2 BDEC028B 		vldm	sp!, {d8}
 876              		.cfi_restore 80
 877              		.cfi_restore 81
 878              		.cfi_def_cfa_offset 36
 879 03a6 BDE8F08F 		pop	{r4, r5, r6, r7, r8, r9, r10, fp, pc}
 880              	.LVL83:
 881              	.L49:
 882              		.cfi_restore_state
 883              	.LBB63:
 884              	.LBB53:
 452:app/toolhead.c ****         
 885              		.loc 1 452 31 view .LVU248
 886 03aa 064A     		ldr	r2, .L52+12
 887 03ac 02EBC303 		add	r3, r2, r3, lsl #3
 888 03b0 D3E91489 		ldrd	r8, [r3, #80]
 889              	.LVL84:
 452:app/toolhead.c ****         
 890              		.loc 1 452 31 view .LVU249
 891 03b4 59E6     		b	.L22
 892              	.L53:
 893 03b6 00BF     		.align	2
 894              	.L52:
 895 03b8 00000000 		.word	.LANCHOR0
 896 03bc 00000000 		.word	.LANCHOR3
 897 03c0 00000000 		.word	.LANCHOR4
ARM GAS  /tmp/ccLyNHPk.s 			page 28


 898 03c4 00000000 		.word	.LANCHOR2
 899              	.LBE53:
 900              	.LBE63:
 901              		.cfi_endproc
 902              	.LFE14:
 904              		.section	.text.calc_trapezoidal_profile,"ax",%progbits
 905              		.align	1
 906              		.p2align 2,,3
 907              		.syntax unified
 908              		.thumb
 909              		.thumb_func
 910              		.fpu fpv4-sp-d16
 912              	calc_trapezoidal_profile:
 913              	.LVL85:
 914              	.LFB10:
 260:app/toolhead.c ****     /* 计算加速和减速距离 */
 915              		.loc 1 260 1 is_stmt 1 view -0
 916              		.cfi_startproc
 917              		@ args = 36, pretend = 0, frame = 8
 918              		@ frame_needed = 0, uses_anonymous_args = 0
 262:app/toolhead.c ****     double decel_dist = 0.0;
 919              		.loc 1 262 5 view .LVU251
 263:app/toolhead.c ****     
 920              		.loc 1 263 5 view .LVU252
 265:app/toolhead.c ****         /* 需要加速 */
 921              		.loc 1 265 5 view .LVU253
 260:app/toolhead.c ****     /* 计算加速和减速距离 */
 922              		.loc 1 260 1 is_stmt 0 view .LVU254
 923 0000 2DE9F04F 		push	{r4, r5, r6, r7, r8, r9, r10, fp, lr}
 924              		.cfi_def_cfa_offset 36
 925              		.cfi_offset 4, -36
 926              		.cfi_offset 5, -32
 927              		.cfi_offset 6, -28
 928              		.cfi_offset 7, -24
 929              		.cfi_offset 8, -20
 930              		.cfi_offset 9, -16
 931              		.cfi_offset 10, -12
 932              		.cfi_offset 11, -8
 933              		.cfi_offset 14, -4
 934 0004 83B0     		sub	sp, sp, #12
 935              		.cfi_def_cfa_offset 48
 260:app/toolhead.c ****     /* 计算加速和减速距离 */
 936              		.loc 1 260 1 view .LVU255
 937 0006 DDE90C89 		ldrd	r8, [sp, #48]
 938 000a 0446     		mov	r4, r0
 939 000c 0D46     		mov	r5, r1
 265:app/toolhead.c ****         /* 需要加速 */
 940              		.loc 1 265 8 view .LVU256
 941 000e 4046     		mov	r0, r8
 942              	.LVL86:
 265:app/toolhead.c ****         /* 需要加速 */
 943              		.loc 1 265 8 view .LVU257
 944 0010 4946     		mov	r1, r9
 260:app/toolhead.c ****     /* 计算加速和减速距离 */
 945              		.loc 1 260 1 view .LVU258
 946 0012 CDE90045 		strd	r4, [sp]
 947 0016 9246     		mov	r10, r2
ARM GAS  /tmp/ccLyNHPk.s 			page 29


 948 0018 9B46     		mov	fp, r3
 265:app/toolhead.c ****         /* 需要加速 */
 949              		.loc 1 265 8 view .LVU259
 950 001a FFF7FEFF 		bl	__aeabi_dcmpgt
 951              	.LVL87:
 265:app/toolhead.c ****         /* 需要加速 */
 952              		.loc 1 265 8 view .LVU260
 953 001e 0028     		cmp	r0, #0
 954 0020 66D0     		beq	.L80
 267:app/toolhead.c ****         accel_dist = (start_v + cruise_v) * 0.5 * (*accel_t);
 955              		.loc 1 267 9 is_stmt 1 view .LVU261
 267:app/toolhead.c ****         accel_dist = (start_v + cruise_v) * 0.5 * (*accel_t);
 956              		.loc 1 267 30 is_stmt 0 view .LVU262
 957 0022 5246     		mov	r2, r10
 958 0024 5B46     		mov	r3, fp
 959 0026 4046     		mov	r0, r8
 960 0028 4946     		mov	r1, r9
 961 002a FFF7FEFF 		bl	__aeabi_dsub
 962              	.LVL88:
 267:app/toolhead.c ****         accel_dist = (start_v + cruise_v) * 0.5 * (*accel_t);
 963              		.loc 1 267 41 view .LVU263
 964 002e DDE91023 		ldrd	r2, [sp, #64]
 965 0032 FFF7FEFF 		bl	__aeabi_ddiv
 966              	.LVL89:
 268:app/toolhead.c ****     } else {
 967              		.loc 1 268 31 view .LVU264
 968 0036 5246     		mov	r2, r10
 267:app/toolhead.c ****         accel_dist = (start_v + cruise_v) * 0.5 * (*accel_t);
 969              		.loc 1 267 41 view .LVU265
 970 0038 0646     		mov	r6, r0
 971 003a 0F46     		mov	r7, r1
 268:app/toolhead.c ****     } else {
 972              		.loc 1 268 9 is_stmt 1 view .LVU266
 973              	.LVL90:
 268:app/toolhead.c ****     } else {
 974              		.loc 1 268 31 is_stmt 0 view .LVU267
 975 003c 5B46     		mov	r3, fp
 976 003e 4046     		mov	r0, r8
 977 0040 4946     		mov	r1, r9
 978 0042 FFF7FEFF 		bl	__aeabi_dadd
 979              	.LVL91:
 268:app/toolhead.c ****     } else {
 980              		.loc 1 268 43 view .LVU268
 981 0046 754B     		ldr	r3, .L90
 982 0048 0022     		movs	r2, #0
 983 004a FFF7FEFF 		bl	__aeabi_dmul
 984              	.LVL92:
 268:app/toolhead.c ****     } else {
 985              		.loc 1 268 20 view .LVU269
 986 004e 3246     		mov	r2, r6
 987 0050 3B46     		mov	r3, r7
 988 0052 FFF7FEFF 		bl	__aeabi_dmul
 989              	.LVL93:
 990 0056 0246     		mov	r2, r0
 991 0058 0B46     		mov	r3, r1
 282:app/toolhead.c ****     
 992              		.loc 1 282 35 view .LVU270
ARM GAS  /tmp/ccLyNHPk.s 			page 30


 993 005a 2046     		mov	r0, r4
 994 005c 2946     		mov	r1, r5
 995 005e FFF7FEFF 		bl	__aeabi_dsub
 996              	.LVL94:
 997 0062 0446     		mov	r4, r0
 998 0064 0D46     		mov	r5, r1
 999              	.LVL95:
 1000              	.L55:
 282:app/toolhead.c ****     
 1001              		.loc 1 282 35 view .LVU271
 1002 0066 129B     		ldr	r3, [sp, #72]
 273:app/toolhead.c ****         /* 需要减速 */
 1003              		.loc 1 273 8 view .LVU272
 1004 0068 4046     		mov	r0, r8
 1005 006a C3E90067 		strd	r6, [r3]
 273:app/toolhead.c ****         /* 需要减速 */
 1006              		.loc 1 273 5 is_stmt 1 view .LVU273
 273:app/toolhead.c ****         /* 需要减速 */
 1007              		.loc 1 273 8 is_stmt 0 view .LVU274
 1008 006e 4946     		mov	r1, r9
 1009 0070 DDE90E23 		ldrd	r2, [sp, #56]
 1010 0074 FFF7FEFF 		bl	__aeabi_dcmpgt
 1011              	.LVL96:
 1012 0078 0028     		cmp	r0, #0
 1013 007a 3ED0     		beq	.L81
 275:app/toolhead.c ****         decel_dist = (cruise_v + end_v) * 0.5 * (*decel_t);
 1014              		.loc 1 275 9 is_stmt 1 view .LVU275
 275:app/toolhead.c ****         decel_dist = (cruise_v + end_v) * 0.5 * (*decel_t);
 1015              		.loc 1 275 30 is_stmt 0 view .LVU276
 1016 007c DDE90E23 		ldrd	r2, [sp, #56]
 1017 0080 4046     		mov	r0, r8
 1018 0082 4946     		mov	r1, r9
 1019 0084 FFF7FEFF 		bl	__aeabi_dsub
 1020              	.LVL97:
 275:app/toolhead.c ****         decel_dist = (cruise_v + end_v) * 0.5 * (*decel_t);
 1021              		.loc 1 275 39 view .LVU277
 1022 0088 DDE91023 		ldrd	r2, [sp, #64]
 1023 008c FFF7FEFF 		bl	__aeabi_ddiv
 1024              	.LVL98:
 276:app/toolhead.c ****     } else {
 1025              		.loc 1 276 32 view .LVU278
 1026 0090 DDE90E23 		ldrd	r2, [sp, #56]
 275:app/toolhead.c ****         decel_dist = (cruise_v + end_v) * 0.5 * (*decel_t);
 1027              		.loc 1 275 39 view .LVU279
 1028 0094 0646     		mov	r6, r0
 1029 0096 0F46     		mov	r7, r1
 276:app/toolhead.c ****     } else {
 1030              		.loc 1 276 9 is_stmt 1 view .LVU280
 1031              	.LVL99:
 276:app/toolhead.c ****     } else {
 1032              		.loc 1 276 32 is_stmt 0 view .LVU281
 1033 0098 4046     		mov	r0, r8
 1034 009a 4946     		mov	r1, r9
 1035 009c FFF7FEFF 		bl	__aeabi_dadd
 1036              	.LVL100:
 276:app/toolhead.c ****     } else {
 1037              		.loc 1 276 41 view .LVU282
ARM GAS  /tmp/ccLyNHPk.s 			page 31


 1038 00a0 5E4B     		ldr	r3, .L90
 1039 00a2 0022     		movs	r2, #0
 1040 00a4 FFF7FEFF 		bl	__aeabi_dmul
 1041              	.LVL101:
 276:app/toolhead.c ****     } else {
 1042              		.loc 1 276 20 view .LVU283
 1043 00a8 3246     		mov	r2, r6
 1044 00aa 3B46     		mov	r3, r7
 1045 00ac FFF7FEFF 		bl	__aeabi_dmul
 1046              	.LVL102:
 1047 00b0 0246     		mov	r2, r0
 1048 00b2 0B46     		mov	r3, r1
 282:app/toolhead.c ****     
 1049              		.loc 1 282 12 view .LVU284
 1050 00b4 2046     		mov	r0, r4
 1051 00b6 2946     		mov	r1, r5
 1052 00b8 FFF7FEFF 		bl	__aeabi_dsub
 1053              	.LVL103:
 1054 00bc 0446     		mov	r4, r0
 1055 00be 0D46     		mov	r5, r1
 1056              	.LVL104:
 1057              	.L57:
 282:app/toolhead.c ****     
 1058              		.loc 1 282 12 view .LVU285
 1059 00c0 149B     		ldr	r3, [sp, #80]
 1060 00c2 C3E90067 		strd	r6, [r3]
 282:app/toolhead.c ****     
 1061              		.loc 1 282 5 is_stmt 1 view .LVU286
 284:app/toolhead.c ****         /* 距离不够，需要降低巡航速度 */
 1062              		.loc 1 284 5 view .LVU287
 284:app/toolhead.c ****         /* 距离不够，需要降低巡航速度 */
 1063              		.loc 1 284 8 is_stmt 0 view .LVU288
 1064 00c6 0026     		movs	r6, #0
 1065 00c8 0027     		movs	r7, #0
 1066 00ca 2046     		mov	r0, r4
 1067 00cc 2946     		mov	r1, r5
 1068 00ce 3246     		mov	r2, r6
 1069 00d0 3B46     		mov	r3, r7
 1070 00d2 FFF7FEFF 		bl	__aeabi_dcmplt
 1071              	.LVL105:
 1072 00d6 98B9     		cbnz	r0, .L87
 314:app/toolhead.c ****     }
 1073              		.loc 1 314 9 is_stmt 1 view .LVU289
 314:app/toolhead.c ****     }
 1074              		.loc 1 314 33 is_stmt 0 view .LVU290
 1075 00d8 4B46     		mov	r3, r9
 1076 00da 4246     		mov	r2, r8
 1077 00dc 2046     		mov	r0, r4
 1078 00de 2946     		mov	r1, r5
 1079 00e0 FFF7FEFF 		bl	__aeabi_ddiv
 1080              	.LVL106:
 314:app/toolhead.c ****     }
 1081              		.loc 1 314 19 view .LVU291
 1082 00e4 139B     		ldr	r3, [sp, #76]
 1083 00e6 C3E90001 		strd	r0, [r3]
 316:app/toolhead.c **** 
 1084              		.loc 1 316 1 view .LVU292
ARM GAS  /tmp/ccLyNHPk.s 			page 32


 1085 00ea 03B0     		add	sp, sp, #12
 1086              		.cfi_remember_state
 1087              		.cfi_def_cfa_offset 36
 1088              		@ sp needed
 1089 00ec BDE8F08F 		pop	{r4, r5, r6, r7, r8, r9, r10, fp, pc}
 1090              	.LVL107:
 1091              	.L80:
 1092              		.cfi_restore_state
 316:app/toolhead.c **** 
 1093              		.loc 1 316 1 view .LVU293
 1094 00f0 DDE90045 		ldrd	r4, [sp]
 270:app/toolhead.c ****     }
 1095              		.loc 1 270 18 view .LVU294
 1096 00f4 0026     		movs	r6, #0
 1097 00f6 0027     		movs	r7, #0
 1098 00f8 B5E7     		b	.L55
 1099              	.LVL108:
 1100              	.L81:
 278:app/toolhead.c ****     }
 1101              		.loc 1 278 18 view .LVU295
 1102 00fa 0026     		movs	r6, #0
 1103 00fc 0027     		movs	r7, #0
 1104 00fe DFE7     		b	.L57
 1105              	.LVL109:
 1106              	.L87:
 1107              	.LBB64:
 287:app/toolhead.c ****                           accel * distance;
 1108              		.loc 1 287 9 is_stmt 1 view .LVU296
 289:app/toolhead.c ****         
 1109              		.loc 1 289 9 view .LVU297
 287:app/toolhead.c ****                           accel * distance;
 1110              		.loc 1 287 37 is_stmt 0 view .LVU298
 1111 0100 5246     		mov	r2, r10
 1112 0102 5B46     		mov	r3, fp
 1113 0104 5046     		mov	r0, r10
 1114 0106 5946     		mov	r1, fp
 1115 0108 FFF7FEFF 		bl	__aeabi_dmul
 1116              	.LVL110:
 287:app/toolhead.c ****                           accel * distance;
 1117              		.loc 1 287 55 view .LVU299
 1118 010c DDE90E23 		ldrd	r2, [sp, #56]
 287:app/toolhead.c ****                           accel * distance;
 1119              		.loc 1 287 37 view .LVU300
 1120 0110 0446     		mov	r4, r0
 1121 0112 0D46     		mov	r5, r1
 287:app/toolhead.c ****                           accel * distance;
 1122              		.loc 1 287 55 view .LVU301
 1123 0114 1046     		mov	r0, r2
 1124 0116 1946     		mov	r1, r3
 1125 0118 FFF7FEFF 		bl	__aeabi_dmul
 1126              	.LVL111:
 1127 011c 0246     		mov	r2, r0
 1128 011e 0B46     		mov	r3, r1
 287:app/toolhead.c ****                           accel * distance;
 1129              		.loc 1 287 47 view .LVU302
 1130 0120 2046     		mov	r0, r4
 1131 0122 2946     		mov	r1, r5
ARM GAS  /tmp/ccLyNHPk.s 			page 33


 1132 0124 FFF7FEFF 		bl	__aeabi_dadd
 1133              	.LVL112:
 287:app/toolhead.c ****                           accel * distance;
 1134              		.loc 1 287 64 view .LVU303
 1135 0128 3C4B     		ldr	r3, .L90
 1136 012a 0022     		movs	r2, #0
 1137 012c FFF7FEFF 		bl	__aeabi_dmul
 1138              	.LVL113:
 288:app/toolhead.c ****         double peak_v = sqrt(peak_v_sq);
 1139              		.loc 1 288 33 view .LVU304
 1140 0130 DDE90023 		ldrd	r2, [sp]
 287:app/toolhead.c ****                           accel * distance;
 1141              		.loc 1 287 64 view .LVU305
 1142 0134 0446     		mov	r4, r0
 1143 0136 0D46     		mov	r5, r1
 288:app/toolhead.c ****         double peak_v = sqrt(peak_v_sq);
 1144              		.loc 1 288 33 view .LVU306
 1145 0138 DDE91001 		ldrd	r0, [sp, #64]
 1146 013c FFF7FEFF 		bl	__aeabi_dmul
 1147              	.LVL114:
 1148 0140 0246     		mov	r2, r0
 1149 0142 0B46     		mov	r3, r1
 287:app/toolhead.c ****                           accel * distance;
 1150              		.loc 1 287 16 view .LVU307
 1151 0144 2046     		mov	r0, r4
 1152 0146 2946     		mov	r1, r5
 1153 0148 FFF7FEFF 		bl	__aeabi_dadd
 1154              	.LVL115:
 289:app/toolhead.c ****         
 1155              		.loc 1 289 25 view .LVU308
 1156 014c 41EC100B 		vmov	d0, r0, r1
 1157 0150 FFF7FEFF 		bl	sqrt
 1158              	.LVL116:
 1159 0154 55EC104B 		vmov	r4, r5, d0
 291:app/toolhead.c ****             peak_v = start_v;
 1160              		.loc 1 291 9 is_stmt 1 view .LVU309
 291:app/toolhead.c ****             peak_v = start_v;
 1161              		.loc 1 291 12 is_stmt 0 view .LVU310
 1162 0158 10EE102A 		vmov	r2, s0	@ int
 1163 015c 5046     		mov	r0, r10
 1164 015e 5946     		mov	r1, fp
 1165 0160 2B46     		mov	r3, r5
 1166 0162 FFF7FEFF 		bl	__aeabi_dcmpgt
 1167              	.LVL117:
 1168 0166 50B3     		cbz	r0, .L88
 292:app/toolhead.c ****         }
 1169              		.loc 1 292 13 is_stmt 1 view .LVU311
 1170              	.LVL118:
 294:app/toolhead.c ****             peak_v = end_v;
 1171              		.loc 1 294 9 view .LVU312
 294:app/toolhead.c ****             peak_v = end_v;
 1172              		.loc 1 294 12 is_stmt 0 view .LVU313
 1173 0168 DDE90E23 		ldrd	r2, [sp, #56]
 1174 016c 5046     		mov	r0, r10
 1175 016e 5946     		mov	r1, fp
 1176 0170 FFF7FEFF 		bl	__aeabi_dcmplt
 1177              	.LVL119:
ARM GAS  /tmp/ccLyNHPk.s 			page 34


 1178 0174 0028     		cmp	r0, #0
 1179 0176 45D1     		bne	.L75
 292:app/toolhead.c ****         }
 1180              		.loc 1 292 20 view .LVU314
 1181 0178 5446     		mov	r4, r10
 1182 017a 5D46     		mov	r5, fp
 302:app/toolhead.c ****         }
 1183              		.loc 1 302 22 view .LVU315
 1184 017c 3046     		mov	r0, r6
 1185 017e 3946     		mov	r1, r7
 1186              	.LVL120:
 1187              	.L63:
 302:app/toolhead.c ****         }
 1188              		.loc 1 302 22 view .LVU316
 1189 0180 129B     		ldr	r3, [sp, #72]
 305:app/toolhead.c ****             *decel_t = (peak_v - end_v) / accel;
 1190              		.loc 1 305 12 view .LVU317
 1191 0182 2246     		mov	r2, r4
 1192 0184 C3E90001 		strd	r0, [r3]
 305:app/toolhead.c ****             *decel_t = (peak_v - end_v) / accel;
 1193              		.loc 1 305 9 is_stmt 1 view .LVU318
 305:app/toolhead.c ****             *decel_t = (peak_v - end_v) / accel;
 1194              		.loc 1 305 12 is_stmt 0 view .LVU319
 1195 0188 DDE90E01 		ldrd	r0, [sp, #56]
 1196 018c 2B46     		mov	r3, r5
 1197 018e FFF7FEFF 		bl	__aeabi_dcmplt
 1198              	.LVL121:
 1199 0192 68B3     		cbz	r0, .L84
 306:app/toolhead.c ****         } else {
 1200              		.loc 1 306 13 is_stmt 1 view .LVU320
 306:app/toolhead.c ****         } else {
 1201              		.loc 1 306 32 is_stmt 0 view .LVU321
 1202 0194 DDE90E23 		ldrd	r2, [sp, #56]
 1203 0198 2046     		mov	r0, r4
 1204 019a 2946     		mov	r1, r5
 1205 019c FFF7FEFF 		bl	__aeabi_dsub
 1206              	.LVL122:
 306:app/toolhead.c ****         } else {
 1207              		.loc 1 306 41 view .LVU322
 1208 01a0 DDE91023 		ldrd	r2, [sp, #64]
 1209 01a4 FFF7FEFF 		bl	__aeabi_ddiv
 1210              	.LVL123:
 1211              	.L65:
 1212 01a8 149B     		ldr	r3, [sp, #80]
 1213 01aa C3E90001 		strd	r0, [r3]
 311:app/toolhead.c ****     } else {
 1214              		.loc 1 311 9 is_stmt 1 view .LVU323
 311:app/toolhead.c ****     } else {
 1215              		.loc 1 311 19 is_stmt 0 view .LVU324
 1216 01ae 1399     		ldr	r1, [sp, #76]
 1217 01b0 0022     		movs	r2, #0
 1218 01b2 0023     		movs	r3, #0
 1219 01b4 C1E90023 		strd	r2, [r1]
 1220              	.LBE64:
 316:app/toolhead.c **** 
 1221              		.loc 1 316 1 view .LVU325
 1222 01b8 03B0     		add	sp, sp, #12
ARM GAS  /tmp/ccLyNHPk.s 			page 35


 1223              		.cfi_remember_state
 1224              		.cfi_def_cfa_offset 36
 1225              	.LVL124:
 316:app/toolhead.c **** 
 1226              		.loc 1 316 1 view .LVU326
 1227              		@ sp needed
 1228 01ba BDE8F08F 		pop	{r4, r5, r6, r7, r8, r9, r10, fp, pc}
 1229              	.LVL125:
 1230              	.L88:
 1231              		.cfi_restore_state
 1232              	.LBB65:
 294:app/toolhead.c ****             peak_v = end_v;
 1233              		.loc 1 294 9 is_stmt 1 view .LVU327
 294:app/toolhead.c ****             peak_v = end_v;
 1234              		.loc 1 294 12 is_stmt 0 view .LVU328
 1235 01be DDE90E01 		ldrd	r0, [sp, #56]
 1236 01c2 2246     		mov	r2, r4
 1237 01c4 2B46     		mov	r3, r5
 1238 01c6 FFF7FEFF 		bl	__aeabi_dcmpgt
 1239              	.LVL126:
 1240 01ca A0B9     		cbnz	r0, .L62
 299:app/toolhead.c ****             *accel_t = (peak_v - start_v) / accel;
 1241              		.loc 1 299 9 is_stmt 1 view .LVU329
 299:app/toolhead.c ****             *accel_t = (peak_v - start_v) / accel;
 1242              		.loc 1 299 12 is_stmt 0 view .LVU330
 1243 01cc 2246     		mov	r2, r4
 1244 01ce 2B46     		mov	r3, r5
 1245 01d0 5046     		mov	r0, r10
 1246 01d2 5946     		mov	r1, fp
 1247 01d4 FFF7FEFF 		bl	__aeabi_dcmplt
 1248              	.LVL127:
 1249 01d8 E8B1     		cbz	r0, .L89
 1250              	.LVL128:
 1251              	.L68:
 300:app/toolhead.c ****         } else {
 1252              		.loc 1 300 13 is_stmt 1 view .LVU331
 300:app/toolhead.c ****         } else {
 1253              		.loc 1 300 32 is_stmt 0 view .LVU332
 1254 01da 5246     		mov	r2, r10
 1255 01dc 5B46     		mov	r3, fp
 1256 01de 2046     		mov	r0, r4
 1257 01e0 2946     		mov	r1, r5
 1258 01e2 FFF7FEFF 		bl	__aeabi_dsub
 1259              	.LVL129:
 300:app/toolhead.c ****         } else {
 1260              		.loc 1 300 43 view .LVU333
 1261 01e6 DDE91023 		ldrd	r2, [sp, #64]
 1262 01ea FFF7FEFF 		bl	__aeabi_ddiv
 1263              	.LVL130:
 1264 01ee C7E7     		b	.L63
 1265              	.L84:
 308:app/toolhead.c ****         }
 1266              		.loc 1 308 22 view .LVU334
 1267 01f0 0020     		movs	r0, #0
 1268 01f2 0021     		movs	r1, #0
 1269 01f4 D8E7     		b	.L65
 1270              	.LVL131:
ARM GAS  /tmp/ccLyNHPk.s 			page 36


 1271              	.L62:
 295:app/toolhead.c ****         }
 1272              		.loc 1 295 13 is_stmt 1 view .LVU335
 299:app/toolhead.c ****             *accel_t = (peak_v - start_v) / accel;
 1273              		.loc 1 299 9 view .LVU336
 299:app/toolhead.c ****             *accel_t = (peak_v - start_v) / accel;
 1274              		.loc 1 299 12 is_stmt 0 view .LVU337
 1275 01f6 DDE90E23 		ldrd	r2, [sp, #56]
 1276 01fa 5046     		mov	r0, r10
 1277 01fc 5946     		mov	r1, fp
 1278 01fe FFF7FEFF 		bl	__aeabi_dcmplt
 1279              	.LVL132:
 1280 0202 10B1     		cbz	r0, .L85
 1281              	.LVL133:
 1282              	.L75:
 295:app/toolhead.c ****         }
 1283              		.loc 1 295 20 view .LVU338
 1284 0204 DDE90E45 		ldrd	r4, [sp, #56]
 1285 0208 E7E7     		b	.L68
 1286              	.LVL134:
 1287              	.L85:
 295:app/toolhead.c ****         }
 1288              		.loc 1 295 20 view .LVU339
 1289 020a 129B     		ldr	r3, [sp, #72]
 308:app/toolhead.c ****         }
 1290              		.loc 1 308 22 view .LVU340
 1291 020c 3046     		mov	r0, r6
 1292 020e C3E90067 		strd	r6, [r3]
 305:app/toolhead.c ****             *decel_t = (peak_v - end_v) / accel;
 1293              		.loc 1 305 9 is_stmt 1 view .LVU341
 308:app/toolhead.c ****         }
 1294              		.loc 1 308 22 is_stmt 0 view .LVU342
 1295 0212 3946     		mov	r1, r7
 1296 0214 C8E7     		b	.L65
 1297              	.LVL135:
 1298              	.L89:
 302:app/toolhead.c ****         }
 1299              		.loc 1 302 22 view .LVU343
 1300 0216 3046     		mov	r0, r6
 1301 0218 3946     		mov	r1, r7
 1302 021a B1E7     		b	.L63
 1303              	.L91:
 1304              		.align	2
 1305              	.L90:
 1306 021c 0000E03F 		.word	1071644672
 1307              	.LBE65:
 1308              		.cfi_endproc
 1309              	.LFE10:
 1311              		.section	.text.lookahead_flush,"ax",%progbits
 1312              		.align	1
 1313              		.p2align 2,,3
 1314              		.syntax unified
 1315              		.thumb
 1316              		.thumb_func
 1317              		.fpu fpv4-sp-d16
 1319              	lookahead_flush:
 1320              	.LFB15:
ARM GAS  /tmp/ccLyNHPk.s 			page 37


 495:app/toolhead.c **** 
 496:app/toolhead.c **** /**
 497:app/toolhead.c ****  * @brief   刷新前瞻队列到 trapq
 498:app/toolhead.c ****  * 
 499:app/toolhead.c ****  * 将前瞻队列中的运动转换为 trapq 运动段
 500:app/toolhead.c ****  */
 501:app/toolhead.c **** static void
 502:app/toolhead.c **** lookahead_flush(void)
 503:app/toolhead.c **** {
 1321              		.loc 1 503 1 is_stmt 1 view -0
 1322              		.cfi_startproc
 1323              		@ args = 0, pretend = 0, frame = 200
 1324              		@ frame_needed = 0, uses_anonymous_args = 0
 504:app/toolhead.c ****     lookahead_move_t move;
 1325              		.loc 1 504 5 view .LVU345
 505:app/toolhead.c ****     
 506:app/toolhead.c ****     while (lookahead_pop(&move) == 0) {
 1326              		.loc 1 506 5 view .LVU346
 503:app/toolhead.c ****     lookahead_move_t move;
 1327              		.loc 1 503 1 is_stmt 0 view .LVU347
 1328 0000 2DE9F047 		push	{r4, r5, r6, r7, r8, r9, r10, lr}
 1329              		.cfi_def_cfa_offset 32
 1330              		.cfi_offset 4, -32
 1331              		.cfi_offset 5, -28
 1332              		.cfi_offset 6, -24
 1333              		.cfi_offset 7, -20
 1334              		.cfi_offset 8, -16
 1335              		.cfi_offset 9, -12
 1336              		.cfi_offset 10, -8
 1337              		.cfi_offset 14, -4
 1338              	.LBB66:
 507:app/toolhead.c ****         /* 计算梯形曲线参数 */
 508:app/toolhead.c ****         double accel_t, cruise_t, decel_t;
 509:app/toolhead.c ****         calc_trapezoidal_profile(move.distance, move.start_v, move.cruise_v,
 510:app/toolhead.c ****                                  move.end_v, s_config.max_accel,
 1339              		.loc 1 510 54 view .LVU348
 1340 0004 2D4D     		ldr	r5, .L96
 511:app/toolhead.c ****                                  &accel_t, &cruise_t, &decel_t);
 512:app/toolhead.c ****         
 513:app/toolhead.c ****         /* 计算方向向量 */
 514:app/toolhead.c ****         struct coord axes_r;
 515:app/toolhead.c ****         cartesian_calc_direction(&move.start_pos, &move.end_pos, &axes_r);
 516:app/toolhead.c ****         
 517:app/toolhead.c ****         /* 添加到 trapq */
 518:app/toolhead.c ****         trapq_append(s_p_trapq, s_print_time,
 1341              		.loc 1 518 9 view .LVU349
 1342 0006 2E4C     		ldr	r4, .L96+4
 1343 0008 DFF8B8A0 		ldr	r10, .L96+8
 1344              	.LBE66:
 503:app/toolhead.c ****     lookahead_move_t move;
 1345              		.loc 1 503 1 view .LVU350
 1346 000c BCB0     		sub	sp, sp, #240
 1347              		.cfi_def_cfa_offset 272
 506:app/toolhead.c ****         /* 计算梯形曲线参数 */
 1348              		.loc 1 506 11 view .LVU351
 1349 000e 4CE0     		b	.L93
 1350              	.L94:
ARM GAS  /tmp/ccLyNHPk.s 			page 38


 1351              	.LBB67:
 509:app/toolhead.c ****                                  move.end_v, s_config.max_accel,
 1352              		.loc 1 509 9 view .LVU352
 1353 0010 DDE93423 		ldrd	r2, [sp, #208]
 1354 0014 CDE90A23 		strd	r2, [sp, #40]
 1355 0018 10AB     		add	r3, sp, #64
 1356 001a 0893     		str	r3, [sp, #32]
 1357 001c 0EAB     		add	r3, sp, #56
 1358 001e 6868     		ldr	r0, [r5, #4]	@ float
 1359 0020 0793     		str	r3, [sp, #28]
 1360 0022 0CAB     		add	r3, sp, #48
 1361 0024 DDE92A67 		ldrd	r6, [sp, #168]
 1362 0028 0693     		str	r3, [sp, #24]
 1363 002a FFF7FEFF 		bl	__aeabi_f2d
 1364              	.LVL136:
 1365 002e 9DED387B 		vldr.64	d7, [sp, #224]
 1366 0032 8046     		mov	r8, r0
 1367 0034 8946     		mov	r9, r1
 1368 0036 3046     		mov	r0, r6
 1369 0038 3946     		mov	r1, r7
 1370 003a DDE93667 		ldrd	r6, [sp, #216]
 1371 003e 8DED027B 		vstr.64	d7, [sp, #8]
 1372 0042 DDE90A23 		ldrd	r2, [sp, #40]
 1373 0046 CDE90489 		strd	r8, [sp, #16]
 1374 004a CDE90067 		strd	r6, [sp]
 1375 004e FFF7FEFF 		bl	calc_trapezoidal_profile
 1376              	.LVL137:
 514:app/toolhead.c ****         cartesian_calc_direction(&move.start_pos, &move.end_pos, &axes_r);
 1377              		.loc 1 514 9 is_stmt 1 view .LVU353
 515:app/toolhead.c ****         
 1378              		.loc 1 515 9 view .LVU354
 1379 0052 12AA     		add	r2, sp, #72
 1380 0054 22A9     		add	r1, sp, #136
 1381 0056 1AA8     		add	r0, sp, #104
 1382 0058 FFF7FEFF 		bl	cartesian_calc_direction
 1383              	.LVL138:
 1384              		.loc 1 518 9 view .LVU355
 1385 005c 6868     		ldr	r0, [r5, #4]	@ float
 1386 005e FFF7FEFF 		bl	__aeabi_f2d
 1387              	.LVL139:
 1388 0062 94ED000B 		vldr.64	d0, [r4]
 1389 0066 41EC160B 		vmov	d6, r0, r1
 1390 006a 9DED365B 		vldr.64	d5, [sp, #216]
 1391 006e 9DED344B 		vldr.64	d4, [sp, #208]
 1392 0072 9DED103B 		vldr.64	d3, [sp, #64]
 1393 0076 9DED0E2B 		vldr.64	d2, [sp, #56]
 1394 007a 9DED0C1B 		vldr.64	d1, [sp, #48]
 1395 007e DAF80000 		ldr	r0, [r10]
 1396 0082 12AA     		add	r2, sp, #72
 1397 0084 1AA9     		add	r1, sp, #104
 1398 0086 FFF7FEFF 		bl	trapq_append
 1399              	.LVL140:
 519:app/toolhead.c ****                      accel_t, cruise_t, decel_t,
 520:app/toolhead.c ****                      &move.start_pos, &axes_r,
 521:app/toolhead.c ****                      move.start_v, move.cruise_v, s_config.max_accel);
 522:app/toolhead.c ****         
 523:app/toolhead.c ****         /* 更新打印时间 */
ARM GAS  /tmp/ccLyNHPk.s 			page 39


 524:app/toolhead.c ****         s_print_time += accel_t + cruise_t + decel_t;
 1400              		.loc 1 524 9 view .LVU356
 1401              		.loc 1 524 33 is_stmt 0 view .LVU357
 1402 008a DDE90E23 		ldrd	r2, [sp, #56]
 1403 008e DDE90C01 		ldrd	r0, [sp, #48]
 1404 0092 FFF7FEFF 		bl	__aeabi_dadd
 1405              	.LVL141:
 1406              		.loc 1 524 44 view .LVU358
 1407 0096 DDE91023 		ldrd	r2, [sp, #64]
 1408 009a FFF7FEFF 		bl	__aeabi_dadd
 1409              	.LVL142:
 1410              		.loc 1 524 22 view .LVU359
 1411 009e D4E90023 		ldrd	r2, [r4]
 1412 00a2 FFF7FEFF 		bl	__aeabi_dadd
 1413              	.LVL143:
 1414 00a6 C4E90001 		strd	r0, [r4]
 525:app/toolhead.c ****         
 526:app/toolhead.c ****         /* 更新当前位置 */
 527:app/toolhead.c ****         coord_copy(&s_current_pos, &move.end_pos);
 1415              		.loc 1 527 9 is_stmt 1 view .LVU360
 1416              	.LVL144:
 1417              		.loc 1 527 9 is_stmt 0 view .LVU361
 1418              	.LBE67:
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 1419              		.loc 1 216 5 is_stmt 1 view .LVU362
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 1420              		.loc 1 217 5 view .LVU363
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 1421              		.loc 1 218 5 view .LVU364
 219:app/toolhead.c **** }
 1422              		.loc 1 219 5 view .LVU365
 1423              	.L93:
 506:app/toolhead.c ****         /* 计算梯形曲线参数 */
 1424              		.loc 1 506 11 view .LVU366
 506:app/toolhead.c ****         /* 计算梯形曲线参数 */
 1425              		.loc 1 506 12 is_stmt 0 view .LVU367
 1426 00aa 1AA8     		add	r0, sp, #104
 1427 00ac FFF7FEFF 		bl	lookahead_pop
 1428              	.LVL145:
 1429              	.LBB68:
 508:app/toolhead.c ****         calc_trapezoidal_profile(move.distance, move.start_v, move.cruise_v,
 1430              		.loc 1 508 9 is_stmt 1 view .LVU368
 509:app/toolhead.c ****                                  move.end_v, s_config.max_accel,
 1431              		.loc 1 509 9 view .LVU369
 1432              	.LBE68:
 506:app/toolhead.c ****         /* 计算梯形曲线参数 */
 1433              		.loc 1 506 11 is_stmt 0 view .LVU370
 1434 00b0 0028     		cmp	r0, #0
 1435 00b2 ADD0     		beq	.L94
 528:app/toolhead.c ****     }
 529:app/toolhead.c **** }
 1436              		.loc 1 529 1 view .LVU371
 1437 00b4 3CB0     		add	sp, sp, #240
 1438              		.cfi_def_cfa_offset 32
 1439              		@ sp needed
 1440 00b6 BDE8F087 		pop	{r4, r5, r6, r7, r8, r9, r10, pc}
 1441              	.L97:
ARM GAS  /tmp/ccLyNHPk.s 			page 40


 1442 00ba 00BF     		.align	2
 1443              	.L96:
 1444 00bc 00000000 		.word	.LANCHOR4
 1445 00c0 00000000 		.word	.LANCHOR5
 1446 00c4 00000000 		.word	.LANCHOR6
 1447              		.cfi_endproc
 1448              	.LFE15:
 1450              		.section	.text.home_endstop_callback,"ax",%progbits
 1451              		.align	1
 1452              		.p2align 2,,3
 1453              		.syntax unified
 1454              		.thumb
 1455              		.thumb_func
 1456              		.fpu fpv4-sp-d16
 1458              	home_endstop_callback:
 1459              	.LVL146:
 1460              	.LFB17:
 530:app/toolhead.c **** 
 531:app/toolhead.c **** /**
 532:app/toolhead.c ****  * @brief   生成步进时序
 533:app/toolhead.c ****  * @param   flush_time  刷新时间
 534:app/toolhead.c ****  */
 535:app/toolhead.c **** static void
 536:app/toolhead.c **** generate_steps(double flush_time)
 537:app/toolhead.c **** {
 538:app/toolhead.c ****     for (int i = 0; i < NUM_AXES; i++) {
 539:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 540:app/toolhead.c ****             itersolve_generate_steps(s_steppers[i], flush_time);
 541:app/toolhead.c ****         }
 542:app/toolhead.c ****     }
 543:app/toolhead.c **** }
 544:app/toolhead.c **** 
 545:app/toolhead.c **** /**
 546:app/toolhead.c ****  * @brief   归零限位开关回调
 547:app/toolhead.c ****  */
 548:app/toolhead.c **** static void
 549:app/toolhead.c **** home_endstop_callback(endstop_id_t id, void *arg)
 550:app/toolhead.c **** {
 1461              		.loc 1 550 1 is_stmt 1 view -0
 1462              		.cfi_startproc
 1463              		@ args = 0, pretend = 0, frame = 0
 1464              		@ frame_needed = 0, uses_anonymous_args = 0
 1465              		@ link register save eliminated.
 551:app/toolhead.c ****     (void)arg;
 1466              		.loc 1 551 5 view .LVU373
 552:app/toolhead.c ****     
 553:app/toolhead.c ****     /* 标记触发 */
 554:app/toolhead.c ****     s_home_ctx.triggered = 1;
 1467              		.loc 1 554 5 view .LVU374
 1468              		.loc 1 554 26 is_stmt 0 view .LVU375
 1469 0000 0121     		movs	r1, #1
 1470              	.LVL147:
 1471              		.loc 1 554 26 view .LVU376
 1472 0002 054A     		ldr	r2, .L102
 555:app/toolhead.c ****     
 556:app/toolhead.c ****     /* 停止对应的步进电机 */
 557:app/toolhead.c ****     switch (id) {
ARM GAS  /tmp/ccLyNHPk.s 			page 41


 1473              		.loc 1 557 5 view .LVU377
 1474 0004 8842     		cmp	r0, r1
 554:app/toolhead.c ****     
 1475              		.loc 1 554 26 view .LVU378
 1476 0006 1174     		strb	r1, [r2, #16]
 1477              		.loc 1 557 5 is_stmt 1 view .LVU379
 1478 0008 03D0     		beq	.L100
 1479 000a 0228     		cmp	r0, #2
 1480 000c 01D0     		beq	.L100
 1481 000e 00B1     		cbz	r0, .L100
 558:app/toolhead.c ****     case ENDSTOP_X:
 559:app/toolhead.c ****         stepper_stop(STEPPER_X);
 560:app/toolhead.c ****         break;
 561:app/toolhead.c ****     case ENDSTOP_Y:
 562:app/toolhead.c ****         stepper_stop(STEPPER_Y);
 563:app/toolhead.c ****         break;
 564:app/toolhead.c ****     case ENDSTOP_Z:
 565:app/toolhead.c ****         stepper_stop(STEPPER_Z);
 566:app/toolhead.c ****         break;
 567:app/toolhead.c ****     default:
 568:app/toolhead.c ****         break;
 569:app/toolhead.c ****     }
 570:app/toolhead.c **** }
 1482              		.loc 1 570 1 is_stmt 0 view .LVU380
 1483 0010 7047     		bx	lr
 1484              	.L100:
 565:app/toolhead.c ****         break;
 1485              		.loc 1 565 9 is_stmt 1 view .LVU381
 1486 0012 FFF7FEBF 		b	stepper_stop
 1487              	.LVL148:
 1488              	.L103:
 565:app/toolhead.c ****         break;
 1489              		.loc 1 565 9 is_stmt 0 view .LVU382
 1490 0016 00BF     		.align	2
 1491              	.L102:
 1492 0018 00000000 		.word	.LANCHOR7
 1493              		.cfi_endproc
 1494              	.LFE17:
 1496              		.section	.text.toolhead_init,"ax",%progbits
 1497              		.align	1
 1498              		.p2align 2,,3
 1499              		.global	toolhead_init
 1500              		.syntax unified
 1501              		.thumb
 1502              		.thumb_func
 1503              		.fpu fpv4-sp-d16
 1505              	toolhead_init:
 1506              	.LFB18:
 571:app/toolhead.c **** 
 572:app/toolhead.c **** /* ========== 公有函数实现 ========== */
 573:app/toolhead.c **** 
 574:app/toolhead.c **** void
 575:app/toolhead.c **** toolhead_init(void)
 576:app/toolhead.c **** {
 1507              		.loc 1 576 1 is_stmt 1 view -0
 1508              		.cfi_startproc
 1509              		@ args = 0, pretend = 0, frame = 0
ARM GAS  /tmp/ccLyNHPk.s 			page 42


 1510              		@ frame_needed = 0, uses_anonymous_args = 0
 577:app/toolhead.c ****     /* 防止重复初始化 */
 578:app/toolhead.c ****     if (s_initialized) {
 1511              		.loc 1 578 5 view .LVU384
 576:app/toolhead.c ****     /* 防止重复初始化 */
 1512              		.loc 1 576 1 is_stmt 0 view .LVU385
 1513 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 1514              		.cfi_def_cfa_offset 24
 1515              		.cfi_offset 4, -24
 1516              		.cfi_offset 5, -20
 1517              		.cfi_offset 6, -16
 1518              		.cfi_offset 7, -12
 1519              		.cfi_offset 8, -8
 1520              		.cfi_offset 14, -4
 1521              		.loc 1 578 9 view .LVU386
 1522 0004 404F     		ldr	r7, .L119+16
 1523              		.loc 1 578 8 view .LVU387
 1524 0006 3C78     		ldrb	r4, [r7]	@ zero_extendqisi2
 1525 0008 0CB1     		cbz	r4, .L118
 1526              	.L104:
 579:app/toolhead.c ****         return;
 580:app/toolhead.c ****     }
 581:app/toolhead.c ****     
 582:app/toolhead.c ****     /* 初始化 trapq 内存池 */
 583:app/toolhead.c ****     trapq_pool_init();
 584:app/toolhead.c ****     
 585:app/toolhead.c ****     /* 初始化 itersolve 内存池 */
 586:app/toolhead.c ****     itersolve_pool_init();
 587:app/toolhead.c ****     
 588:app/toolhead.c ****     /* 分配运动队列 */
 589:app/toolhead.c ****     s_p_trapq = trapq_alloc();
 590:app/toolhead.c ****     if (s_p_trapq == NULL) {
 591:app/toolhead.c ****         /* 内存池分配失败 - 严重错误 */
 592:app/toolhead.c ****         return;
 593:app/toolhead.c ****     }
 594:app/toolhead.c ****     
 595:app/toolhead.c ****     /* 初始化默认配置 */
 596:app/toolhead.c ****     config_init_defaults();
 597:app/toolhead.c ****     
 598:app/toolhead.c ****     /* 分配并配置步进运动学 */
 599:app/toolhead.c ****     for (int i = 0; i < NUM_AXES; i++) {
 600:app/toolhead.c ****         s_steppers[i] = itersolve_alloc();
 601:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 602:app/toolhead.c ****             cartesian_stepper_setup(s_steppers[i], i, s_steps_per_mm[i]);
 603:app/toolhead.c ****             itersolve_set_trapq(s_steppers[i], s_p_trapq);
 604:app/toolhead.c ****         }
 605:app/toolhead.c ****     }
 606:app/toolhead.c ****     
 607:app/toolhead.c ****     /* 初始化位置为零 */
 608:app/toolhead.c ****     coord_clear(&s_current_pos);
 609:app/toolhead.c ****     coord_clear(&s_commanded_pos);
 610:app/toolhead.c ****     
 611:app/toolhead.c ****     /* 初始化打印时间 */
 612:app/toolhead.c ****     s_print_time = 0.0;
 613:app/toolhead.c ****     
 614:app/toolhead.c ****     /* 初始化前瞻队列 */
 615:app/toolhead.c ****     s_lookahead_head = 0;
ARM GAS  /tmp/ccLyNHPk.s 			page 43


 616:app/toolhead.c ****     s_lookahead_tail = 0;
 617:app/toolhead.c ****     s_lookahead_count = 0;
 618:app/toolhead.c ****     
 619:app/toolhead.c ****     /* 初始化归零上下文 */
 620:app/toolhead.c ****     s_home_ctx.state = HOME_STATE_IDLE;
 621:app/toolhead.c ****     s_home_ctx.axis_mask = 0;
 622:app/toolhead.c ****     s_home_ctx.triggered = 0;
 623:app/toolhead.c ****     
 624:app/toolhead.c ****     /* 标记初始化完成 */
 625:app/toolhead.c ****     s_initialized = 1;
 626:app/toolhead.c **** }
 1527              		.loc 1 626 1 view .LVU388
 1528 000a BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 1529              	.L118:
 583:app/toolhead.c ****     
 1530              		.loc 1 583 5 is_stmt 1 view .LVU389
 1531 000e FFF7FEFF 		bl	trapq_pool_init
 1532              	.LVL149:
 586:app/toolhead.c ****     
 1533              		.loc 1 586 5 view .LVU390
 1534 0012 FFF7FEFF 		bl	itersolve_pool_init
 1535              	.LVL150:
 589:app/toolhead.c ****     if (s_p_trapq == NULL) {
 1536              		.loc 1 589 5 view .LVU391
 589:app/toolhead.c ****     if (s_p_trapq == NULL) {
 1537              		.loc 1 589 17 is_stmt 0 view .LVU392
 1538 0016 FFF7FEFF 		bl	trapq_alloc
 1539              	.LVL151:
 589:app/toolhead.c ****     if (s_p_trapq == NULL) {
 1540              		.loc 1 589 15 view .LVU393
 1541 001a DFF84081 		ldr	r8, .L119+100
 1542 001e C8F80000 		str	r0, [r8]
 590:app/toolhead.c ****         /* 内存池分配失败 - 严重错误 */
 1543              		.loc 1 590 5 is_stmt 1 view .LVU394
 590:app/toolhead.c ****         /* 内存池分配失败 - 严重错误 */
 1544              		.loc 1 590 8 is_stmt 0 view .LVU395
 1545 0022 0028     		cmp	r0, #0
 1546 0024 F1D0     		beq	.L104
 596:app/toolhead.c ****     
 1547              		.loc 1 596 5 is_stmt 1 view .LVU396
 1548              	.LBB76:
 1549              	.LBI76:
 173:app/toolhead.c **** {
 1550              		.loc 1 173 1 view .LVU397
 1551              	.LBB77:
 175:app/toolhead.c ****     s_config.max_accel = MAX_ACCEL;
 1552              		.loc 1 175 5 view .LVU398
 175:app/toolhead.c ****     s_config.max_accel = MAX_ACCEL;
 1553              		.loc 1 175 27 is_stmt 0 view .LVU399
 1554 0026 394B     		ldr	r3, .L119+20
 1555 0028 394A     		ldr	r2, .L119+24
 1556 002a 1A60     		str	r2, [r3]	@ float
 176:app/toolhead.c ****     s_config.max_accel_to_decel = MAX_ACCEL * 0.5f;
 1557              		.loc 1 176 5 is_stmt 1 view .LVU400
 176:app/toolhead.c ****     s_config.max_accel_to_decel = MAX_ACCEL * 0.5f;
 1558              		.loc 1 176 24 is_stmt 0 view .LVU401
 1559 002c 394A     		ldr	r2, .L119+28
ARM GAS  /tmp/ccLyNHPk.s 			page 44


 1560 002e 5A60     		str	r2, [r3, #4]	@ float
 177:app/toolhead.c ****     s_config.square_corner_velocity = 5.0f;
 1561              		.loc 1 177 5 is_stmt 1 view .LVU402
 177:app/toolhead.c ****     s_config.square_corner_velocity = 5.0f;
 1562              		.loc 1 177 33 is_stmt 0 view .LVU403
 1563 0030 394A     		ldr	r2, .L119+32
 1564 0032 9A60     		str	r2, [r3, #8]	@ float
 178:app/toolhead.c ****     
 1565              		.loc 1 178 5 is_stmt 1 view .LVU404
 178:app/toolhead.c ****     
 1566              		.loc 1 178 37 is_stmt 0 view .LVU405
 1567 0034 394A     		ldr	r2, .L119+36
 1568 0036 DA60     		str	r2, [r3, #12]	@ float
 181:app/toolhead.c ****     s_min_pos[1] = Y_MIN;
 1569              		.loc 1 181 5 is_stmt 1 view .LVU406
 181:app/toolhead.c ****     s_min_pos[1] = Y_MIN;
 1570              		.loc 1 181 18 is_stmt 0 view .LVU407
 1571 0038 394B     		ldr	r3, .L119+40
 192:app/toolhead.c ****     s_steps_per_mm[1] = STEPS_PER_MM_Y;
 1572              		.loc 1 192 23 view .LVU408
 1573 003a 3A4D     		ldr	r5, .L119+44
 1574 003c 3A4E     		ldr	r6, .L119+48
 181:app/toolhead.c ****     s_min_pos[1] = Y_MIN;
 1575              		.loc 1 181 18 view .LVU409
 1576 003e 0020     		movs	r0, #0
 1577 0040 0021     		movs	r1, #0
 1578 0042 C3E90001 		strd	r0, [r3]
 182:app/toolhead.c ****     s_min_pos[2] = Z_MIN;
 1579              		.loc 1 182 5 is_stmt 1 view .LVU410
 182:app/toolhead.c ****     s_min_pos[2] = Z_MIN;
 1580              		.loc 1 182 18 is_stmt 0 view .LVU411
 1581 0046 C3E90201 		strd	r0, [r3, #8]
 183:app/toolhead.c ****     s_min_pos[3] = -1e9;  /* E 轴无限位 */
 1582              		.loc 1 183 5 is_stmt 1 view .LVU412
 183:app/toolhead.c ****     s_min_pos[3] = -1e9;  /* E 轴无限位 */
 1583              		.loc 1 183 18 is_stmt 0 view .LVU413
 1584 004a C3E90401 		strd	r0, [r3, #16]
 184:app/toolhead.c ****     
 1585              		.loc 1 184 5 is_stmt 1 view .LVU414
 184:app/toolhead.c ****     
 1586              		.loc 1 184 18 is_stmt 0 view .LVU415
 1587 004e 2AA1     		adr	r1, .L119
 1588 0050 D1E90001 		ldrd	r0, [r1]
 1589 0054 C3E90601 		strd	r0, [r3, #24]
 186:app/toolhead.c ****     s_max_pos[1] = Y_MAX;
 1590              		.loc 1 186 5 is_stmt 1 view .LVU416
 186:app/toolhead.c ****     s_max_pos[1] = Y_MAX;
 1591              		.loc 1 186 18 is_stmt 0 view .LVU417
 1592 0058 344B     		ldr	r3, .L119+52
 1593 005a 3549     		ldr	r1, .L119+56
 1594 005c 0020     		movs	r0, #0
 1595 005e C3E90001 		strd	r0, [r3]
 187:app/toolhead.c ****     s_max_pos[2] = Z_MAX;
 1596              		.loc 1 187 5 is_stmt 1 view .LVU418
 187:app/toolhead.c ****     s_max_pos[2] = Z_MAX;
 1597              		.loc 1 187 18 is_stmt 0 view .LVU419
 1598 0062 C3E90201 		strd	r0, [r3, #8]
ARM GAS  /tmp/ccLyNHPk.s 			page 45


 188:app/toolhead.c ****     s_max_pos[3] = 1e9;   /* E 轴无限位 */
 1599              		.loc 1 188 5 is_stmt 1 view .LVU420
 188:app/toolhead.c ****     s_max_pos[3] = 1e9;   /* E 轴无限位 */
 1600              		.loc 1 188 18 is_stmt 0 view .LVU421
 1601 0066 3349     		ldr	r1, .L119+60
 1602 0068 0020     		movs	r0, #0
 1603 006a C3E90401 		strd	r0, [r3, #16]
 189:app/toolhead.c ****     
 1604              		.loc 1 189 5 is_stmt 1 view .LVU422
 189:app/toolhead.c ****     
 1605              		.loc 1 189 18 is_stmt 0 view .LVU423
 1606 006e 24A1     		adr	r1, .L119+8
 1607 0070 D1E90001 		ldrd	r0, [r1]
 1608 0074 C3E90601 		strd	r0, [r3, #24]
 192:app/toolhead.c ****     s_steps_per_mm[1] = STEPS_PER_MM_Y;
 1609              		.loc 1 192 5 is_stmt 1 view .LVU424
 192:app/toolhead.c ****     s_steps_per_mm[1] = STEPS_PER_MM_Y;
 1610              		.loc 1 192 23 is_stmt 0 view .LVU425
 1611 0078 2F4B     		ldr	r3, .L119+64
 1612 007a 0022     		movs	r2, #0
 1613 007c C5E90023 		strd	r2, [r5]
 193:app/toolhead.c ****     s_steps_per_mm[2] = STEPS_PER_MM_Z;
 1614              		.loc 1 193 5 is_stmt 1 view .LVU426
 193:app/toolhead.c ****     s_steps_per_mm[2] = STEPS_PER_MM_Z;
 1615              		.loc 1 193 23 is_stmt 0 view .LVU427
 1616 0080 C5E90223 		strd	r2, [r5, #8]
 194:app/toolhead.c ****     s_steps_per_mm[3] = STEPS_PER_MM_E;
 1617              		.loc 1 194 5 is_stmt 1 view .LVU428
 194:app/toolhead.c ****     s_steps_per_mm[3] = STEPS_PER_MM_E;
 1618              		.loc 1 194 23 is_stmt 0 view .LVU429
 1619 0084 2D4B     		ldr	r3, .L119+68
 1620 0086 0022     		movs	r2, #0
 1621 0088 C5E90423 		strd	r2, [r5, #16]
 195:app/toolhead.c **** }
 1622              		.loc 1 195 5 is_stmt 1 view .LVU430
 195:app/toolhead.c **** }
 1623              		.loc 1 195 23 is_stmt 0 view .LVU431
 1624 008c 2C4B     		ldr	r3, .L119+72
 1625 008e 0022     		movs	r2, #0
 1626 0090 C5E90623 		strd	r2, [r5, #24]
 1627              	.LVL152:
 195:app/toolhead.c **** }
 1628              		.loc 1 195 23 view .LVU432
 1629              	.LBE77:
 1630              	.LBE76:
 1631              	.LBB78:
 599:app/toolhead.c ****         s_steppers[i] = itersolve_alloc();
 1632              		.loc 1 599 21 is_stmt 1 view .LVU433
 1633              	.L109:
 600:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 1634              		.loc 1 600 9 view .LVU434
 600:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 1635              		.loc 1 600 25 is_stmt 0 view .LVU435
 1636 0094 FFF7FEFF 		bl	itersolve_alloc
 1637              	.LVL153:
 602:app/toolhead.c ****             itersolve_set_trapq(s_steppers[i], s_p_trapq);
 1638              		.loc 1 602 13 is_stmt 1 view .LVU436
ARM GAS  /tmp/ccLyNHPk.s 			page 46


 1639 0098 2146     		mov	r1, r4
 600:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 1640              		.loc 1 600 23 is_stmt 0 view .LVU437
 1641 009a 46F8040B 		str	r0, [r6], #4
 601:app/toolhead.c ****             cartesian_stepper_setup(s_steppers[i], i, s_steps_per_mm[i]);
 1642              		.loc 1 601 9 is_stmt 1 view .LVU438
 599:app/toolhead.c ****         s_steppers[i] = itersolve_alloc();
 1643              		.loc 1 599 36 is_stmt 0 view .LVU439
 1644 009e 0134     		adds	r4, r4, #1
 1645              	.LVL154:
 601:app/toolhead.c ****             cartesian_stepper_setup(s_steppers[i], i, s_steps_per_mm[i]);
 1646              		.loc 1 601 12 view .LVU440
 1647 00a0 48B1     		cbz	r0, .L108
 602:app/toolhead.c ****             itersolve_set_trapq(s_steppers[i], s_p_trapq);
 1648              		.loc 1 602 13 view .LVU441
 1649 00a2 95ED000B 		vldr.64	d0, [r5]
 1650 00a6 FFF7FEFF 		bl	cartesian_stepper_setup
 1651              	.LVL155:
 603:app/toolhead.c ****         }
 1652              		.loc 1 603 13 is_stmt 1 view .LVU442
 1653 00aa D8F80010 		ldr	r1, [r8]
 1654 00ae 56F8040C 		ldr	r0, [r6, #-4]
 1655 00b2 FFF7FEFF 		bl	itersolve_set_trapq
 1656              	.LVL156:
 1657              	.L108:
 599:app/toolhead.c ****         s_steppers[i] = itersolve_alloc();
 1658              		.loc 1 599 35 discriminator 2 view .LVU443
 599:app/toolhead.c ****         s_steppers[i] = itersolve_alloc();
 1659              		.loc 1 599 21 discriminator 2 view .LVU444
 599:app/toolhead.c ****         s_steppers[i] = itersolve_alloc();
 1660              		.loc 1 599 5 is_stmt 0 discriminator 2 view .LVU445
 1661 00b6 042C     		cmp	r4, #4
 1662 00b8 05F10805 		add	r5, r5, #8
 1663 00bc EAD1     		bne	.L109
 1664              	.LBE78:
 608:app/toolhead.c ****     coord_clear(&s_commanded_pos);
 1665              		.loc 1 608 5 is_stmt 1 view .LVU446
 1666              	.LVL157:
 204:app/toolhead.c ****     p_pos->y = 0.0;
 1667              		.loc 1 204 5 view .LVU447
 205:app/toolhead.c ****     p_pos->z = 0.0;
 1668              		.loc 1 205 5 view .LVU448
 206:app/toolhead.c ****     p_pos->e = 0.0;
 1669              		.loc 1 206 5 view .LVU449
 207:app/toolhead.c **** }
 1670              		.loc 1 207 5 view .LVU450
 609:app/toolhead.c ****     
 1671              		.loc 1 609 5 view .LVU451
 1672              	.LBB79:
 1673              	.LBI79:
 202:app/toolhead.c **** {
 1674              		.loc 1 202 1 view .LVU452
 1675              	.LBB80:
 204:app/toolhead.c ****     p_pos->y = 0.0;
 1676              		.loc 1 204 5 view .LVU453
 204:app/toolhead.c ****     p_pos->y = 0.0;
 1677              		.loc 1 204 14 is_stmt 0 view .LVU454
ARM GAS  /tmp/ccLyNHPk.s 			page 47


 1678 00be 2149     		ldr	r1, .L119+76
 1679              	.LBE80:
 1680              	.LBE79:
 612:app/toolhead.c ****     
 1681              		.loc 1 612 18 view .LVU455
 1682 00c0 2148     		ldr	r0, .L119+80
 615:app/toolhead.c ****     s_lookahead_tail = 0;
 1683              		.loc 1 615 22 view .LVU456
 1684 00c2 224C     		ldr	r4, .L119+84
 1685              	.LVL158:
 1686              	.LBB83:
 1687              	.LBB81:
 204:app/toolhead.c ****     p_pos->y = 0.0;
 1688              		.loc 1 204 14 view .LVU457
 1689 00c4 0022     		movs	r2, #0
 1690 00c6 0023     		movs	r3, #0
 1691 00c8 C1E90023 		strd	r2, [r1]
 205:app/toolhead.c ****     p_pos->z = 0.0;
 1692              		.loc 1 205 5 is_stmt 1 view .LVU458
 1693              	.LBE81:
 1694              	.LBE83:
 612:app/toolhead.c ****     
 1695              		.loc 1 612 18 is_stmt 0 view .LVU459
 1696 00cc C0E90023 		strd	r2, [r0]
 1697              	.LBB84:
 1698              	.LBB82:
 205:app/toolhead.c ****     p_pos->z = 0.0;
 1699              		.loc 1 205 14 view .LVU460
 1700 00d0 C1E90223 		strd	r2, [r1, #8]
 206:app/toolhead.c ****     p_pos->e = 0.0;
 1701              		.loc 1 206 5 is_stmt 1 view .LVU461
 206:app/toolhead.c ****     p_pos->e = 0.0;
 1702              		.loc 1 206 14 is_stmt 0 view .LVU462
 1703 00d4 C1E90423 		strd	r2, [r1, #16]
 207:app/toolhead.c **** }
 1704              		.loc 1 207 5 is_stmt 1 view .LVU463
 207:app/toolhead.c **** }
 1705              		.loc 1 207 14 is_stmt 0 view .LVU464
 1706 00d8 C1E90623 		strd	r2, [r1, #24]
 1707              	.LVL159:
 207:app/toolhead.c **** }
 1708              		.loc 1 207 14 view .LVU465
 1709              	.LBE82:
 1710              	.LBE84:
 612:app/toolhead.c ****     
 1711              		.loc 1 612 5 is_stmt 1 view .LVU466
 615:app/toolhead.c ****     s_lookahead_tail = 0;
 1712              		.loc 1 615 5 view .LVU467
 620:app/toolhead.c ****     s_home_ctx.axis_mask = 0;
 1713              		.loc 1 620 22 is_stmt 0 view .LVU468
 1714 00dc 1C4A     		ldr	r2, .L119+88
 616:app/toolhead.c ****     s_lookahead_count = 0;
 1715              		.loc 1 616 22 view .LVU469
 1716 00de 1D49     		ldr	r1, .L119+92
 617:app/toolhead.c ****     
 1717              		.loc 1 617 23 view .LVU470
 1718 00e0 1D48     		ldr	r0, .L119+96
ARM GAS  /tmp/ccLyNHPk.s 			page 48


 615:app/toolhead.c ****     s_lookahead_tail = 0;
 1719              		.loc 1 615 22 view .LVU471
 1720 00e2 0023     		movs	r3, #0
 616:app/toolhead.c ****     s_lookahead_count = 0;
 1721              		.loc 1 616 22 view .LVU472
 1722 00e4 0B60     		str	r3, [r1]
 620:app/toolhead.c ****     s_home_ctx.axis_mask = 0;
 1723              		.loc 1 620 22 view .LVU473
 1724 00e6 1380     		strh	r3, [r2]	@ movhi
 625:app/toolhead.c **** }
 1725              		.loc 1 625 19 view .LVU474
 1726 00e8 0121     		movs	r1, #1
 622:app/toolhead.c ****     
 1727              		.loc 1 622 26 view .LVU475
 1728 00ea 1374     		strb	r3, [r2, #16]
 615:app/toolhead.c ****     s_lookahead_tail = 0;
 1729              		.loc 1 615 22 view .LVU476
 1730 00ec 2360     		str	r3, [r4]
 616:app/toolhead.c ****     s_lookahead_count = 0;
 1731              		.loc 1 616 5 is_stmt 1 view .LVU477
 617:app/toolhead.c ****     
 1732              		.loc 1 617 5 view .LVU478
 617:app/toolhead.c ****     
 1733              		.loc 1 617 23 is_stmt 0 view .LVU479
 1734 00ee 0360     		str	r3, [r0]
 620:app/toolhead.c ****     s_home_ctx.axis_mask = 0;
 1735              		.loc 1 620 5 is_stmt 1 view .LVU480
 621:app/toolhead.c ****     s_home_ctx.triggered = 0;
 1736              		.loc 1 621 5 view .LVU481
 622:app/toolhead.c ****     
 1737              		.loc 1 622 5 view .LVU482
 625:app/toolhead.c **** }
 1738              		.loc 1 625 5 view .LVU483
 625:app/toolhead.c **** }
 1739              		.loc 1 625 19 is_stmt 0 view .LVU484
 1740 00f0 3970     		strb	r1, [r7]
 1741              		.loc 1 626 1 view .LVU485
 1742 00f2 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 1743              	.L120:
 1744 00f6 00BF     		.align	3
 1745              	.L119:
 1746 00f8 00000000 		.word	0
 1747 00fc 65CDCDC1 		.word	-1043477147
 1748 0100 00000000 		.word	0
 1749 0104 65CDCD41 		.word	1104006501
 1750 0108 00000000 		.word	.LANCHOR8
 1751 010c 00000000 		.word	.LANCHOR4
 1752 0110 00004843 		.word	1128792064
 1753 0114 00803B45 		.word	1161527296
 1754 0118 0080BB44 		.word	1153138688
 1755 011c 0000A040 		.word	1084227584
 1756 0120 00000000 		.word	.LANCHOR9
 1757 0124 00000000 		.word	.LANCHOR11
 1758 0128 00000000 		.word	.LANCHOR12
 1759 012c 00000000 		.word	.LANCHOR10
 1760 0130 00806B40 		.word	1080786944
 1761 0134 00406F40 		.word	1081032704
ARM GAS  /tmp/ccLyNHPk.s 			page 49


 1762 0138 00005440 		.word	1079246848
 1763 013c 00007940 		.word	1081671680
 1764 0140 00405740 		.word	1079459840
 1765 0144 00000000 		.word	.LANCHOR13
 1766 0148 00000000 		.word	.LANCHOR5
 1767 014c 00000000 		.word	.LANCHOR3
 1768 0150 00000000 		.word	.LANCHOR7
 1769 0154 00000000 		.word	.LANCHOR1
 1770 0158 00000000 		.word	.LANCHOR0
 1771 015c 00000000 		.word	.LANCHOR6
 1772              		.cfi_endproc
 1773              	.LFE18:
 1775              		.section	.text.toolhead_get_position,"ax",%progbits
 1776              		.align	1
 1777              		.p2align 2,,3
 1778              		.global	toolhead_get_position
 1779              		.syntax unified
 1780              		.thumb
 1781              		.thumb_func
 1782              		.fpu fpv4-sp-d16
 1784              	toolhead_get_position:
 1785              	.LVL160:
 1786              	.LFB19:
 627:app/toolhead.c **** 
 628:app/toolhead.c **** int
 629:app/toolhead.c **** toolhead_get_position(struct coord *p_pos)
 630:app/toolhead.c **** {
 1787              		.loc 1 630 1 is_stmt 1 view -0
 1788              		.cfi_startproc
 1789              		@ args = 0, pretend = 0, frame = 0
 1790              		@ frame_needed = 0, uses_anonymous_args = 0
 1791              		@ link register save eliminated.
 631:app/toolhead.c ****     /* 参数检查 */
 632:app/toolhead.c ****     if (p_pos == NULL) {
 1792              		.loc 1 632 5 view .LVU487
 1793              		.loc 1 632 8 is_stmt 0 view .LVU488
 1794 0000 0346     		mov	r3, r0
 1795 0002 90B1     		cbz	r0, .L123
 633:app/toolhead.c ****         return TOOLHEAD_ERR_NULL;
 634:app/toolhead.c ****     }
 635:app/toolhead.c ****     
 636:app/toolhead.c ****     /* 复制命令位置 */
 637:app/toolhead.c ****     coord_copy(p_pos, &s_commanded_pos);
 1796              		.loc 1 637 5 is_stmt 1 view .LVU489
 1797              	.LVL161:
 1798              	.LBB85:
 1799              	.LBI85:
 214:app/toolhead.c **** {
 1800              		.loc 1 214 1 view .LVU490
 1801              	.LBB86:
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 1802              		.loc 1 216 5 view .LVU491
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 1803              		.loc 1 216 21 is_stmt 0 view .LVU492
 1804 0004 0A4A     		ldr	r2, .L124
 1805 0006 92ED007B 		vldr.64	d7, [r2]
 216:app/toolhead.c ****     p_dst->y = p_src->y;
ARM GAS  /tmp/ccLyNHPk.s 			page 50


 1806              		.loc 1 216 14 view .LVU493
 1807 000a 83ED007B 		vstr.64	d7, [r3]
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 1808              		.loc 1 217 5 is_stmt 1 view .LVU494
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 1809              		.loc 1 217 21 is_stmt 0 view .LVU495
 1810 000e 92ED027B 		vldr.64	d7, [r2, #8]
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 1811              		.loc 1 217 14 view .LVU496
 1812 0012 83ED027B 		vstr.64	d7, [r3, #8]
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 1813              		.loc 1 218 5 is_stmt 1 view .LVU497
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 1814              		.loc 1 218 21 is_stmt 0 view .LVU498
 1815 0016 92ED047B 		vldr.64	d7, [r2, #16]
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 1816              		.loc 1 218 14 view .LVU499
 1817 001a 83ED047B 		vstr.64	d7, [r3, #16]
 219:app/toolhead.c **** }
 1818              		.loc 1 219 5 is_stmt 1 view .LVU500
 219:app/toolhead.c **** }
 1819              		.loc 1 219 21 is_stmt 0 view .LVU501
 1820 001e 92ED067B 		vldr.64	d7, [r2, #24]
 1821              	.LBE86:
 1822              	.LBE85:
 638:app/toolhead.c ****     
 639:app/toolhead.c ****     return TOOLHEAD_OK;
 1823              		.loc 1 639 12 view .LVU502
 1824 0022 0020     		movs	r0, #0
 1825              	.LVL162:
 1826              	.LBB88:
 1827              	.LBB87:
 219:app/toolhead.c **** }
 1828              		.loc 1 219 14 view .LVU503
 1829 0024 83ED067B 		vstr.64	d7, [r3, #24]
 1830              	.LVL163:
 219:app/toolhead.c **** }
 1831              		.loc 1 219 14 view .LVU504
 1832              	.LBE87:
 1833              	.LBE88:
 1834              		.loc 1 639 5 is_stmt 1 view .LVU505
 1835              		.loc 1 639 12 is_stmt 0 view .LVU506
 1836 0028 7047     		bx	lr
 1837              	.LVL164:
 1838              	.L123:
 633:app/toolhead.c ****     }
 1839              		.loc 1 633 16 view .LVU507
 1840 002a 4FF0FF30 		mov	r0, #-1
 1841              	.LVL165:
 640:app/toolhead.c **** }
 1842              		.loc 1 640 1 view .LVU508
 1843 002e 7047     		bx	lr
 1844              	.L125:
 1845              		.align	2
 1846              	.L124:
 1847 0030 00000000 		.word	.LANCHOR13
 1848              		.cfi_endproc
ARM GAS  /tmp/ccLyNHPk.s 			page 51


 1849              	.LFE19:
 1851              		.section	.text.toolhead_set_position,"ax",%progbits
 1852              		.align	1
 1853              		.p2align 2,,3
 1854              		.global	toolhead_set_position
 1855              		.syntax unified
 1856              		.thumb
 1857              		.thumb_func
 1858              		.fpu fpv4-sp-d16
 1860              	toolhead_set_position:
 1861              	.LVL166:
 1862              	.LFB20:
 641:app/toolhead.c **** 
 642:app/toolhead.c **** int
 643:app/toolhead.c **** toolhead_set_position(const struct coord *p_pos)
 644:app/toolhead.c **** {
 1863              		.loc 1 644 1 is_stmt 1 view -0
 1864              		.cfi_startproc
 1865              		@ args = 0, pretend = 0, frame = 0
 1866              		@ frame_needed = 0, uses_anonymous_args = 0
 645:app/toolhead.c ****     /* 参数检查 */
 646:app/toolhead.c ****     if (p_pos == NULL) {
 1867              		.loc 1 646 5 view .LVU510
 1868              		.loc 1 646 8 is_stmt 0 view .LVU511
 1869 0000 0028     		cmp	r0, #0
 1870 0002 4CD0     		beq	.L134
 644:app/toolhead.c ****     /* 参数检查 */
 1871              		.loc 1 644 1 view .LVU512
 1872 0004 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 1873              		.cfi_def_cfa_offset 24
 1874              		.cfi_offset 4, -24
 1875              		.cfi_offset 5, -20
 1876              		.cfi_offset 6, -16
 1877              		.cfi_offset 7, -12
 1878              		.cfi_offset 8, -8
 1879              		.cfi_offset 14, -4
 1880              	.LBB89:
 1881              	.LBB90:
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 1882              		.loc 1 216 21 view .LVU513
 1883 0008 D0E90067 		ldrd	r6, [r0]
 1884 000c 0546     		mov	r5, r0
 1885              	.LBE90:
 1886              	.LBE89:
 647:app/toolhead.c ****         return TOOLHEAD_ERR_NULL;
 648:app/toolhead.c ****     }
 649:app/toolhead.c ****     
 650:app/toolhead.c ****     /* 设置当前位置和命令位置 */
 651:app/toolhead.c ****     coord_copy(&s_current_pos, p_pos);
 1887              		.loc 1 651 5 is_stmt 1 view .LVU514
 1888              	.LVL167:
 1889              	.LBB94:
 1890              	.LBI89:
 214:app/toolhead.c **** {
 1891              		.loc 1 214 1 view .LVU515
 1892              	.LBB91:
 216:app/toolhead.c ****     p_dst->y = p_src->y;
ARM GAS  /tmp/ccLyNHPk.s 			page 52


 1893              		.loc 1 216 5 view .LVU516
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 1894              		.loc 1 217 5 view .LVU517
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 1895              		.loc 1 217 21 is_stmt 0 view .LVU518
 1896 000e D0E90201 		ldrd	r0, [r0, #8]
 1897              	.LVL168:
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 1898              		.loc 1 218 5 is_stmt 1 view .LVU519
 1899              	.LBE91:
 1900              	.LBE94:
 1901              	.LBB95:
 1902              	.LBB96:
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 1903              		.loc 1 216 14 is_stmt 0 view .LVU520
 1904 0012 244B     		ldr	r3, .L143
 1905              	.LBE96:
 1906              	.LBE95:
 1907              	.LBB101:
 1908              	.LBB102:
 652:app/toolhead.c ****     coord_copy(&s_commanded_pos, p_pos);
 653:app/toolhead.c ****     
 654:app/toolhead.c ****     /* 更新步进运动学位置 */
 655:app/toolhead.c ****     for (int i = 0; i < NUM_AXES; i++) {
 656:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 657:app/toolhead.c ****             double pos = 0.0;
 658:app/toolhead.c ****             switch (i) {
 659:app/toolhead.c ****             case 0: pos = p_pos->x * s_steps_per_mm[0]; break;
 660:app/toolhead.c ****             case 1: pos = p_pos->y * s_steps_per_mm[1]; break;
 661:app/toolhead.c ****             case 2: pos = p_pos->z * s_steps_per_mm[2]; break;
 1909              		.loc 1 661 52 view .LVU521
 1910 0014 DFF89480 		ldr	r8, .L143+8
 1911              	.LBE102:
 1912              	.LBE101:
 1913              	.LBB106:
 1914              	.LBB97:
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 1915              		.loc 1 217 14 view .LVU522
 1916 0018 C3E90201 		strd	r0, [r3, #8]
 1917              	.LBE97:
 1918              	.LBE106:
 1919              	.LBB107:
 1920              	.LBB92:
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 1921              		.loc 1 218 21 view .LVU523
 1922 001c D5E90401 		ldrd	r0, [r5, #16]
 219:app/toolhead.c **** }
 1923              		.loc 1 219 5 is_stmt 1 view .LVU524
 1924              	.LBE92:
 1925              	.LBE107:
 1926              	.LBB108:
 1927              	.LBB98:
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 1928              		.loc 1 218 14 is_stmt 0 view .LVU525
 1929 0020 C3E90401 		strd	r0, [r3, #16]
 1930              	.LBE98:
 1931              	.LBE108:
ARM GAS  /tmp/ccLyNHPk.s 			page 53


 1932              	.LBB109:
 1933              	.LBB93:
 219:app/toolhead.c **** }
 1934              		.loc 1 219 21 view .LVU526
 1935 0024 D5E90601 		ldrd	r0, [r5, #24]
 1936              	.LVL169:
 219:app/toolhead.c **** }
 1937              		.loc 1 219 21 view .LVU527
 1938              	.LBE93:
 1939              	.LBE109:
 652:app/toolhead.c ****     
 1940              		.loc 1 652 5 is_stmt 1 view .LVU528
 1941              	.LBB110:
 1942              	.LBI95:
 214:app/toolhead.c **** {
 1943              		.loc 1 214 1 view .LVU529
 1944              	.LBB99:
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 1945              		.loc 1 216 5 view .LVU530
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 1946              		.loc 1 217 5 view .LVU531
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 1947              		.loc 1 218 5 view .LVU532
 219:app/toolhead.c **** }
 1948              		.loc 1 219 5 view .LVU533
 219:app/toolhead.c **** }
 1949              		.loc 1 219 14 is_stmt 0 view .LVU534
 1950 0028 C3E90601 		strd	r0, [r3, #24]
 1951              	.LVL170:
 219:app/toolhead.c **** }
 1952              		.loc 1 219 14 view .LVU535
 1953              	.LBE99:
 1954              	.LBE110:
 655:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 1955              		.loc 1 655 5 is_stmt 1 view .LVU536
 1956              	.LBB111:
 655:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 1957              		.loc 1 655 10 view .LVU537
 655:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 1958              		.loc 1 655 21 view .LVU538
 1959              	.LBE111:
 1960              	.LBB112:
 1961              	.LBB100:
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 1962              		.loc 1 216 14 is_stmt 0 view .LVU539
 1963 002c C3E90067 		strd	r6, [r3]
 1964 0030 1D4F     		ldr	r7, .L143+4
 1965              	.LBE100:
 1966              	.LBE112:
 1967              	.LBB113:
 655:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 1968              		.loc 1 655 14 view .LVU540
 1969 0032 0024     		movs	r4, #0
 1970              	.LVL171:
 1971              	.L133:
 656:app/toolhead.c ****             double pos = 0.0;
 1972              		.loc 1 656 9 is_stmt 1 view .LVU541
ARM GAS  /tmp/ccLyNHPk.s 			page 54


 1973              	.LBB103:
 657:app/toolhead.c ****             switch (i) {
 1974              		.loc 1 657 13 view .LVU542
 658:app/toolhead.c ****             case 0: pos = p_pos->x * s_steps_per_mm[0]; break;
 1975              		.loc 1 658 13 view .LVU543
 658:app/toolhead.c ****             case 0: pos = p_pos->x * s_steps_per_mm[0]; break;
 1976              		.loc 1 658 13 is_stmt 0 view .LVU544
 1977              	.LBE103:
 656:app/toolhead.c ****             double pos = 0.0;
 1978              		.loc 1 656 23 view .LVU545
 1979 0034 57F8046B 		ldr	r6, [r7], #4
 656:app/toolhead.c ****             double pos = 0.0;
 1980              		.loc 1 656 12 view .LVU546
 1981 0038 86B1     		cbz	r6, .L128
 1982              	.LBB104:
 658:app/toolhead.c ****             case 0: pos = p_pos->x * s_steps_per_mm[0]; break;
 1983              		.loc 1 658 13 view .LVU547
 1984 003a 022C     		cmp	r4, #2
 1985 003c 26D0     		beq	.L129
 659:app/toolhead.c ****             case 1: pos = p_pos->y * s_steps_per_mm[1]; break;
 1986              		.loc 1 659 21 is_stmt 1 view .LVU548
 658:app/toolhead.c ****             case 0: pos = p_pos->x * s_steps_per_mm[0]; break;
 1987              		.loc 1 658 13 is_stmt 0 view .LVU549
 1988 003e 032C     		cmp	r4, #3
 1989 0040 1BD0     		beq	.L130
 1990 0042 012C     		cmp	r4, #1
 1991 0044 10D0     		beq	.L131
 659:app/toolhead.c ****             case 1: pos = p_pos->y * s_steps_per_mm[1]; break;
 1992              		.loc 1 659 25 view .LVU550
 1993 0046 D8E90023 		ldrd	r2, [r8]
 1994 004a D5E90001 		ldrd	r0, [r5]
 1995 004e FFF7FEFF 		bl	__aeabi_dmul
 1996              	.LVL172:
 1997 0052 41EC100B 		vmov	d0, r0, r1
 1998              	.LVL173:
 659:app/toolhead.c ****             case 1: pos = p_pos->y * s_steps_per_mm[1]; break;
 1999              		.loc 1 659 57 is_stmt 1 view .LVU551
 2000              	.L132:
 662:app/toolhead.c ****             case 3: pos = p_pos->e * s_steps_per_mm[3]; break;
 663:app/toolhead.c ****             }
 664:app/toolhead.c ****             itersolve_set_position(s_steppers[i], pos);
 2001              		.loc 1 664 13 view .LVU552
 2002 0056 3046     		mov	r0, r6
 2003              	.LVL174:
 2004              		.loc 1 664 13 is_stmt 0 view .LVU553
 2005 0058 FFF7FEFF 		bl	itersolve_set_position
 2006              	.LVL175:
 2007              	.L128:
 2008              		.loc 1 664 13 view .LVU554
 2009              	.LBE104:
 655:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 2010              		.loc 1 655 35 is_stmt 1 discriminator 2 view .LVU555
 655:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 2011              		.loc 1 655 36 is_stmt 0 discriminator 2 view .LVU556
 2012 005c 0134     		adds	r4, r4, #1
 2013              	.LVL176:
 655:app/toolhead.c ****         if (s_steppers[i] != NULL) {
ARM GAS  /tmp/ccLyNHPk.s 			page 55


 2014              		.loc 1 655 21 is_stmt 1 discriminator 2 view .LVU557
 655:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 2015              		.loc 1 655 5 is_stmt 0 discriminator 2 view .LVU558
 2016 005e 042C     		cmp	r4, #4
 2017 0060 E8D1     		bne	.L133
 2018              	.LBE113:
 665:app/toolhead.c ****         }
 666:app/toolhead.c ****     }
 667:app/toolhead.c ****     
 668:app/toolhead.c ****     return TOOLHEAD_OK;
 2019              		.loc 1 668 12 view .LVU559
 2020 0062 0020     		movs	r0, #0
 669:app/toolhead.c **** }
 2021              		.loc 1 669 1 view .LVU560
 2022 0064 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 2023              	.LVL177:
 2024              	.L131:
 2025              	.LBB114:
 2026              	.LBB105:
 660:app/toolhead.c ****             case 2: pos = p_pos->z * s_steps_per_mm[2]; break;
 2027              		.loc 1 660 21 is_stmt 1 view .LVU561
 660:app/toolhead.c ****             case 2: pos = p_pos->z * s_steps_per_mm[2]; break;
 2028              		.loc 1 660 25 is_stmt 0 view .LVU562
 2029 0068 D8E90223 		ldrd	r2, [r8, #8]
 2030 006c D5E90201 		ldrd	r0, [r5, #8]
 2031 0070 FFF7FEFF 		bl	__aeabi_dmul
 2032              	.LVL178:
 2033 0074 41EC100B 		vmov	d0, r0, r1
 2034              	.LVL179:
 660:app/toolhead.c ****             case 2: pos = p_pos->z * s_steps_per_mm[2]; break;
 2035              		.loc 1 660 57 is_stmt 1 view .LVU563
 660:app/toolhead.c ****             case 2: pos = p_pos->z * s_steps_per_mm[2]; break;
 2036              		.loc 1 660 13 is_stmt 0 view .LVU564
 2037 0078 EDE7     		b	.L132
 2038              	.LVL180:
 2039              	.L130:
 662:app/toolhead.c ****             }
 2040              		.loc 1 662 21 is_stmt 1 view .LVU565
 662:app/toolhead.c ****             }
 2041              		.loc 1 662 25 is_stmt 0 view .LVU566
 2042 007a D8E90623 		ldrd	r2, [r8, #24]
 2043 007e D5E90601 		ldrd	r0, [r5, #24]
 2044 0082 FFF7FEFF 		bl	__aeabi_dmul
 2045              	.LVL181:
 2046 0086 41EC100B 		vmov	d0, r0, r1
 2047              	.LVL182:
 662:app/toolhead.c ****             }
 2048              		.loc 1 662 57 is_stmt 1 view .LVU567
 662:app/toolhead.c ****             }
 2049              		.loc 1 662 13 is_stmt 0 view .LVU568
 2050 008a E4E7     		b	.L132
 2051              	.LVL183:
 2052              	.L129:
 661:app/toolhead.c ****             case 3: pos = p_pos->e * s_steps_per_mm[3]; break;
 2053              		.loc 1 661 21 is_stmt 1 view .LVU569
 661:app/toolhead.c ****             case 3: pos = p_pos->e * s_steps_per_mm[3]; break;
 2054              		.loc 1 661 25 is_stmt 0 view .LVU570
ARM GAS  /tmp/ccLyNHPk.s 			page 56


 2055 008c D8E90423 		ldrd	r2, [r8, #16]
 2056 0090 D5E90401 		ldrd	r0, [r5, #16]
 2057 0094 FFF7FEFF 		bl	__aeabi_dmul
 2058              	.LVL184:
 2059 0098 41EC100B 		vmov	d0, r0, r1
 2060              	.LVL185:
 661:app/toolhead.c ****             case 3: pos = p_pos->e * s_steps_per_mm[3]; break;
 2061              		.loc 1 661 57 is_stmt 1 view .LVU571
 661:app/toolhead.c ****             case 3: pos = p_pos->e * s_steps_per_mm[3]; break;
 2062              		.loc 1 661 13 is_stmt 0 view .LVU572
 2063 009c DBE7     		b	.L132
 2064              	.LVL186:
 2065              	.L134:
 2066              		.cfi_def_cfa_offset 0
 2067              		.cfi_restore 4
 2068              		.cfi_restore 5
 2069              		.cfi_restore 6
 2070              		.cfi_restore 7
 2071              		.cfi_restore 8
 2072              		.cfi_restore 14
 661:app/toolhead.c ****             case 3: pos = p_pos->e * s_steps_per_mm[3]; break;
 2073              		.loc 1 661 13 view .LVU573
 2074              	.LBE105:
 2075              	.LBE114:
 647:app/toolhead.c ****     }
 2076              		.loc 1 647 16 view .LVU574
 2077 009e 4FF0FF30 		mov	r0, #-1
 2078              	.LVL187:
 2079              		.loc 1 669 1 view .LVU575
 2080 00a2 7047     		bx	lr
 2081              	.L144:
 2082              		.align	2
 2083              	.L143:
 2084 00a4 00000000 		.word	.LANCHOR13
 2085 00a8 00000000 		.word	.LANCHOR12
 2086 00ac 00000000 		.word	.LANCHOR11
 2087              		.cfi_endproc
 2088              	.LFE20:
 2090              		.section	.text.toolhead_move,"ax",%progbits
 2091              		.align	1
 2092              		.p2align 2,,3
 2093              		.global	toolhead_move
 2094              		.syntax unified
 2095              		.thumb
 2096              		.thumb_func
 2097              		.fpu fpv4-sp-d16
 2099              	toolhead_move:
 2100              	.LVL188:
 2101              	.LFB21:
 670:app/toolhead.c **** 
 671:app/toolhead.c **** int
 672:app/toolhead.c **** toolhead_move(const struct coord *p_end_pos, float speed)
 673:app/toolhead.c **** {
 2102              		.loc 1 673 1 is_stmt 1 view -0
 2103              		.cfi_startproc
 2104              		@ args = 0, pretend = 0, frame = 336
 2105              		@ frame_needed = 0, uses_anonymous_args = 0
ARM GAS  /tmp/ccLyNHPk.s 			page 57


 674:app/toolhead.c ****     /* 参数检查 */
 675:app/toolhead.c ****     if (p_end_pos == NULL) {
 2106              		.loc 1 675 5 view .LVU577
 2107              		.loc 1 675 8 is_stmt 0 view .LVU578
 2108 0000 0028     		cmp	r0, #0
 2109 0002 00F0BA81 		beq	.L163
 676:app/toolhead.c ****         return TOOLHEAD_ERR_NULL;
 677:app/toolhead.c ****     }
 678:app/toolhead.c ****     
 679:app/toolhead.c ****     if (s_p_trapq == NULL) {
 2110              		.loc 1 679 5 is_stmt 1 view .LVU579
 2111              		.loc 1 679 8 is_stmt 0 view .LVU580
 2112 0006 9E4B     		ldr	r3, .L186+16
 2113 0008 1B68     		ldr	r3, [r3]
 2114 000a 002B     		cmp	r3, #0
 2115 000c 00F0B881 		beq	.L184
 680:app/toolhead.c ****         return TOOLHEAD_ERR_QUEUE;
 681:app/toolhead.c ****     }
 682:app/toolhead.c ****     
 683:app/toolhead.c ****     /* 计算运动距离 */
 684:app/toolhead.c ****     double distance = calc_move_distance(&s_commanded_pos, p_end_pos);
 2116              		.loc 1 684 5 is_stmt 1 view .LVU581
 2117              	.LVL189:
 2118              	.LBB130:
 2119              	.LBI130:
 229:app/toolhead.c **** {
 2120              		.loc 1 229 1 view .LVU582
 2121              	.LBB131:
 231:app/toolhead.c ****     double dy = end->y - start->y;
 2122              		.loc 1 231 5 view .LVU583
 2123              	.LBE131:
 2124              	.LBE130:
 673:app/toolhead.c ****     /* 参数检查 */
 2125              		.loc 1 673 1 is_stmt 0 view .LVU584
 2126 0010 2DE9F04F 		push	{r4, r5, r6, r7, r8, r9, r10, fp, lr}
 2127              		.cfi_def_cfa_offset 36
 2128              		.cfi_offset 4, -36
 2129              		.cfi_offset 5, -32
 2130              		.cfi_offset 6, -28
 2131              		.cfi_offset 7, -24
 2132              		.cfi_offset 8, -20
 2133              		.cfi_offset 9, -16
 2134              		.cfi_offset 10, -12
 2135              		.cfi_offset 11, -8
 2136              		.cfi_offset 14, -4
 2137 0014 2DED048B 		vpush.64	{d8, d9}
 2138              		.cfi_def_cfa_offset 52
 2139              		.cfi_offset 80, -52
 2140              		.cfi_offset 81, -48
 2141              		.cfi_offset 82, -44
 2142              		.cfi_offset 83, -40
 2143              	.LBB135:
 2144              	.LBB132:
 231:app/toolhead.c ****     double dy = end->y - start->y;
 2145              		.loc 1 231 31 view .LVU585
 2146 0018 DFF87CB2 		ldr	fp, .L186+40
 2147              	.LBE132:
ARM GAS  /tmp/ccLyNHPk.s 			page 58


 2148              	.LBE135:
 673:app/toolhead.c ****     /* 参数检查 */
 2149              		.loc 1 673 1 view .LVU586
 2150 001c DFB0     		sub	sp, sp, #380
 2151              		.cfi_def_cfa_offset 432
 2152 001e 8246     		mov	r10, r0
 2153              	.LBB136:
 2154              	.LBB133:
 231:app/toolhead.c ****     double dy = end->y - start->y;
 2155              		.loc 1 231 12 view .LVU587
 2156 0020 DBE90023 		ldrd	r2, [fp]
 2157 0024 D0E90001 		ldrd	r0, [r0]
 2158              	.LVL190:
 231:app/toolhead.c ****     double dy = end->y - start->y;
 2159              		.loc 1 231 12 view .LVU588
 2160 0028 B0EE408A 		vmov.f32	s16, s0
 2161 002c FFF7FEFF 		bl	__aeabi_dsub
 2162              	.LVL191:
 232:app/toolhead.c ****     double dz = end->z - start->z;
 2163              		.loc 1 232 12 view .LVU589
 2164 0030 DBE90223 		ldrd	r2, [fp, #8]
 231:app/toolhead.c ****     double dy = end->y - start->y;
 2165              		.loc 1 231 12 view .LVU590
 2166 0034 0646     		mov	r6, r0
 2167 0036 0F46     		mov	r7, r1
 2168              	.LVL192:
 232:app/toolhead.c ****     double dz = end->z - start->z;
 2169              		.loc 1 232 5 is_stmt 1 view .LVU591
 232:app/toolhead.c ****     double dz = end->z - start->z;
 2170              		.loc 1 232 12 is_stmt 0 view .LVU592
 2171 0038 DAE90201 		ldrd	r0, [r10, #8]
 2172 003c FFF7FEFF 		bl	__aeabi_dsub
 2173              	.LVL193:
 233:app/toolhead.c ****     double de = end->e - start->e;
 2174              		.loc 1 233 12 view .LVU593
 2175 0040 DBE90423 		ldrd	r2, [fp, #16]
 232:app/toolhead.c ****     double dz = end->z - start->z;
 2176              		.loc 1 232 12 view .LVU594
 2177 0044 8046     		mov	r8, r0
 2178 0046 8946     		mov	r9, r1
 2179              	.LVL194:
 233:app/toolhead.c ****     double de = end->e - start->e;
 2180              		.loc 1 233 5 is_stmt 1 view .LVU595
 233:app/toolhead.c ****     double de = end->e - start->e;
 2181              		.loc 1 233 12 is_stmt 0 view .LVU596
 2182 0048 DAE90401 		ldrd	r0, [r10, #16]
 2183 004c FFF7FEFF 		bl	__aeabi_dsub
 2184              	.LVL195:
 234:app/toolhead.c ****     
 2185              		.loc 1 234 12 view .LVU597
 2186 0050 DBE90623 		ldrd	r2, [fp, #24]
 233:app/toolhead.c ****     double de = end->e - start->e;
 2187              		.loc 1 233 12 view .LVU598
 2188 0054 41EC190B 		vmov	d9, r0, r1
 2189              	.LVL196:
 234:app/toolhead.c ****     
 2190              		.loc 1 234 5 is_stmt 1 view .LVU599
ARM GAS  /tmp/ccLyNHPk.s 			page 59


 234:app/toolhead.c ****     
 2191              		.loc 1 234 12 is_stmt 0 view .LVU600
 2192 0058 DAE90601 		ldrd	r0, [r10, #24]
 2193              	.LVL197:
 234:app/toolhead.c ****     
 2194              		.loc 1 234 12 view .LVU601
 2195 005c FFF7FEFF 		bl	__aeabi_dsub
 2196              	.LVL198:
 236:app/toolhead.c **** }
 2197              		.loc 1 236 20 view .LVU602
 2198 0060 3246     		mov	r2, r6
 234:app/toolhead.c ****     
 2199              		.loc 1 234 12 view .LVU603
 2200 0062 0446     		mov	r4, r0
 2201 0064 0D46     		mov	r5, r1
 2202              	.LVL199:
 236:app/toolhead.c **** }
 2203              		.loc 1 236 5 is_stmt 1 view .LVU604
 236:app/toolhead.c **** }
 2204              		.loc 1 236 20 is_stmt 0 view .LVU605
 2205 0066 3B46     		mov	r3, r7
 2206 0068 3046     		mov	r0, r6
 2207 006a 3946     		mov	r1, r7
 2208 006c FFF7FEFF 		bl	__aeabi_dmul
 2209              	.LVL200:
 236:app/toolhead.c **** }
 2210              		.loc 1 236 30 view .LVU606
 2211 0070 4246     		mov	r2, r8
 236:app/toolhead.c **** }
 2212              		.loc 1 236 20 view .LVU607
 2213 0072 0646     		mov	r6, r0
 2214              	.LVL201:
 236:app/toolhead.c **** }
 2215              		.loc 1 236 20 view .LVU608
 2216 0074 0F46     		mov	r7, r1
 236:app/toolhead.c **** }
 2217              		.loc 1 236 30 view .LVU609
 2218 0076 4B46     		mov	r3, r9
 2219 0078 4046     		mov	r0, r8
 2220 007a 4946     		mov	r1, r9
 2221 007c FFF7FEFF 		bl	__aeabi_dmul
 2222              	.LVL202:
 2223 0080 0246     		mov	r2, r0
 2224 0082 0B46     		mov	r3, r1
 236:app/toolhead.c **** }
 2225              		.loc 1 236 25 view .LVU610
 2226 0084 3046     		mov	r0, r6
 2227 0086 3946     		mov	r1, r7
 2228 0088 FFF7FEFF 		bl	__aeabi_dadd
 2229              	.LVL203:
 236:app/toolhead.c **** }
 2230              		.loc 1 236 40 view .LVU611
 2231 008c 53EC192B 		vmov	r2, r3, d9
 236:app/toolhead.c **** }
 2232              		.loc 1 236 25 view .LVU612
 2233 0090 0646     		mov	r6, r0
 2234 0092 0F46     		mov	r7, r1
ARM GAS  /tmp/ccLyNHPk.s 			page 60


 236:app/toolhead.c **** }
 2235              		.loc 1 236 40 view .LVU613
 2236 0094 19EE100A 		vmov	r0, s18	@ int
 2237 0098 1946     		mov	r1, r3
 2238 009a FFF7FEFF 		bl	__aeabi_dmul
 2239              	.LVL204:
 2240 009e 0246     		mov	r2, r0
 2241 00a0 0B46     		mov	r3, r1
 236:app/toolhead.c **** }
 2242              		.loc 1 236 35 view .LVU614
 2243 00a2 3046     		mov	r0, r6
 2244 00a4 3946     		mov	r1, r7
 2245 00a6 FFF7FEFF 		bl	__aeabi_dadd
 2246              	.LVL205:
 236:app/toolhead.c **** }
 2247              		.loc 1 236 50 view .LVU615
 2248 00aa 2246     		mov	r2, r4
 236:app/toolhead.c **** }
 2249              		.loc 1 236 35 view .LVU616
 2250 00ac 0646     		mov	r6, r0
 2251 00ae 0F46     		mov	r7, r1
 236:app/toolhead.c **** }
 2252              		.loc 1 236 50 view .LVU617
 2253 00b0 2B46     		mov	r3, r5
 2254 00b2 2046     		mov	r0, r4
 2255 00b4 2946     		mov	r1, r5
 2256 00b6 FFF7FEFF 		bl	__aeabi_dmul
 2257              	.LVL206:
 2258 00ba 0246     		mov	r2, r0
 2259 00bc 0B46     		mov	r3, r1
 236:app/toolhead.c **** }
 2260              		.loc 1 236 12 view .LVU618
 2261 00be 3046     		mov	r0, r6
 2262 00c0 3946     		mov	r1, r7
 2263 00c2 FFF7FEFF 		bl	__aeabi_dadd
 2264              	.LVL207:
 2265 00c6 41EC100B 		vmov	d0, r0, r1
 2266 00ca FFF7FEFF 		bl	sqrt
 2267              	.LVL208:
 2268              	.LBE133:
 2269              	.LBE136:
 685:app/toolhead.c ****     
 686:app/toolhead.c ****     /* 忽略零距离运动 */
 687:app/toolhead.c ****     if (distance < MIN_MOVE_DISTANCE) {
 2270              		.loc 1 687 8 view .LVU619
 2271 00ce 68A3     		adr	r3, .L186
 2272 00d0 D3E90023 		ldrd	r2, [r3]
 2273              	.LBB137:
 2274              	.LBB134:
 236:app/toolhead.c **** }
 2275              		.loc 1 236 12 view .LVU620
 2276 00d4 51EC100B 		vmov	r0, r1, d0
 2277 00d8 8DED0A0B 		vstr.64	d0, [sp, #40]
 2278              	.LVL209:
 236:app/toolhead.c **** }
 2279              		.loc 1 236 12 view .LVU621
 2280              	.LBE134:
ARM GAS  /tmp/ccLyNHPk.s 			page 61


 2281              	.LBE137:
 2282              		.loc 1 687 5 is_stmt 1 view .LVU622
 2283              		.loc 1 687 8 is_stmt 0 view .LVU623
 2284 00dc FFF7FEFF 		bl	__aeabi_dcmplt
 2285              	.LVL210:
 2286              		.loc 1 687 8 view .LVU624
 2287 00e0 0028     		cmp	r0, #0
 2288 00e2 40F0B080 		bne	.L155
 688:app/toolhead.c ****         return TOOLHEAD_OK;
 689:app/toolhead.c ****     }
 690:app/toolhead.c ****     
 691:app/toolhead.c ****     /* 限制速度 */
 692:app/toolhead.c ****     double max_v = (double)speed;
 2289              		.loc 1 692 5 is_stmt 1 view .LVU625
 2290              	.LVL211:
 693:app/toolhead.c ****     if (max_v > s_config.max_velocity) {
 2291              		.loc 1 693 5 view .LVU626
 2292              		.loc 1 693 25 is_stmt 0 view .LVU627
 2293 00e6 674E     		ldr	r6, .L186+20
 2294 00e8 D6ED008A 		vldr.32	s17, [r6]
 2295 00ec 18EE900A 		vmov	r0, s17
 2296 00f0 FFF7FEFF 		bl	__aeabi_f2d
 2297              	.LVL212:
 2298              		.loc 1 693 8 view .LVU628
 2299 00f4 F4EEC88A 		vcmpe.f32	s17, s16
 2300 00f8 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 2301              		.loc 1 693 25 view .LVU629
 2302 00fc 0446     		mov	r4, r0
 2303 00fe 0D46     		mov	r5, r1
 2304              		.loc 1 693 8 view .LVU630
 2305 0100 00F1A780 		bmi	.L164
 692:app/toolhead.c ****     if (max_v > s_config.max_velocity) {
 2306              		.loc 1 692 12 view .LVU631
 2307 0104 18EE100A 		vmov	r0, s16
 2308 0108 FFF7FEFF 		bl	__aeabi_f2d
 2309              	.LVL213:
 2310 010c 8046     		mov	r8, r0
 2311 010e 8946     		mov	r9, r1
 2312              	.L150:
 2313              	.LVL214:
 694:app/toolhead.c ****         max_v = s_config.max_velocity;
 695:app/toolhead.c ****     }
 696:app/toolhead.c ****     if (max_v < 0.001) {
 2314              		.loc 1 696 5 is_stmt 1 view .LVU632
 2315              		.loc 1 696 8 is_stmt 0 view .LVU633
 2316 0110 59A3     		adr	r3, .L186+8
 2317 0112 D3E90023 		ldrd	r2, [r3]
 2318 0116 4046     		mov	r0, r8
 2319 0118 4946     		mov	r1, r9
 2320 011a FFF7FEFF 		bl	__aeabi_dcmplt
 2321              	.LVL215:
 2322 011e 08B1     		cbz	r0, .L151
 697:app/toolhead.c ****         max_v = s_config.max_velocity;
 2323              		.loc 1 697 15 view .LVU634
 2324 0120 A046     		mov	r8, r4
 2325              	.LVL216:
 2326              		.loc 1 697 15 view .LVU635
ARM GAS  /tmp/ccLyNHPk.s 			page 62


 2327 0122 A946     		mov	r9, r5
 2328              	.L151:
 2329              	.LVL217:
 698:app/toolhead.c ****     }
 699:app/toolhead.c ****     
 700:app/toolhead.c ****     /* 检查位置限位 */
 701:app/toolhead.c ****     if (p_end_pos->x < s_min_pos[0] || p_end_pos->x > s_max_pos[0] ||
 2330              		.loc 1 701 5 is_stmt 1 view .LVU636
 2331              		.loc 1 701 18 is_stmt 0 view .LVU637
 2332 0124 9AED007B 		vldr.64	d7, [r10]
 2333              		.loc 1 701 33 view .LVU638
 2334 0128 574C     		ldr	r4, .L186+24
 2335              		.loc 1 701 18 view .LVU639
 2336 012a B0EE478A 		vmov.f32	s16, s14
 2337 012e F0EE678A 		vmov.f32	s17, s15
 2338              	.LVL218:
 2339              		.loc 1 701 8 view .LVU640
 2340 0132 D4E90023 		ldrd	r2, [r4]
 2341 0136 51EC170B 		vmov	r0, r1, d7
 2342 013a FFF7FEFF 		bl	__aeabi_dcmplt
 2343              	.LVL219:
 2344 013e 0028     		cmp	r0, #0
 2345 0140 40F01881 		bne	.L170
 2346              		.loc 1 701 64 discriminator 1 view .LVU641
 2347 0144 514F     		ldr	r7, .L186+28
 2348              		.loc 1 701 37 discriminator 1 view .LVU642
 2349 0146 51EC180B 		vmov	r0, r1, d8
 2350 014a D7E90023 		ldrd	r2, [r7]
 2351 014e FFF7FEFF 		bl	__aeabi_dcmpgt
 2352              	.LVL220:
 2353 0152 0028     		cmp	r0, #0
 2354 0154 40F00E81 		bne	.L170
 702:app/toolhead.c ****         p_end_pos->y < s_min_pos[1] || p_end_pos->y > s_max_pos[1] ||
 2355              		.loc 1 702 18 discriminator 2 view .LVU643
 2356 0158 9AED026B 		vldr.64	d6, [r10, #8]
 701:app/toolhead.c ****         p_end_pos->y < s_min_pos[1] || p_end_pos->y > s_max_pos[1] ||
 2357              		.loc 1 701 68 discriminator 2 view .LVU644
 2358 015c D4E90223 		ldrd	r2, [r4, #8]
 2359              		.loc 1 702 18 discriminator 2 view .LVU645
 2360 0160 B0EE469A 		vmov.f32	s18, s12
 2361 0164 F0EE669A 		vmov.f32	s19, s13
 701:app/toolhead.c ****         p_end_pos->y < s_min_pos[1] || p_end_pos->y > s_max_pos[1] ||
 2362              		.loc 1 701 68 discriminator 2 view .LVU646
 2363 0168 51EC160B 		vmov	r0, r1, d6
 2364 016c FFF7FEFF 		bl	__aeabi_dcmplt
 2365              	.LVL221:
 2366 0170 0028     		cmp	r0, #0
 2367 0172 40F0FF80 		bne	.L170
 2368              		.loc 1 702 37 view .LVU647
 2369 0176 D7E90223 		ldrd	r2, [r7, #8]
 2370 017a 51EC190B 		vmov	r0, r1, d9
 2371 017e FFF7FEFF 		bl	__aeabi_dcmpgt
 2372              	.LVL222:
 2373 0182 0028     		cmp	r0, #0
 2374 0184 40F0F680 		bne	.L170
 2375              		.loc 1 702 68 discriminator 1 view .LVU648
 2376 0188 D4E90423 		ldrd	r2, [r4, #16]
ARM GAS  /tmp/ccLyNHPk.s 			page 63


 703:app/toolhead.c ****         p_end_pos->z < s_min_pos[2] || p_end_pos->z > s_max_pos[2]) {
 2377              		.loc 1 703 18 discriminator 1 view .LVU649
 2378 018c DAE90445 		ldrd	r4, [r10, #16]
 702:app/toolhead.c ****         p_end_pos->y < s_min_pos[1] || p_end_pos->y > s_max_pos[1] ||
 2379              		.loc 1 702 68 discriminator 1 view .LVU650
 2380 0190 2046     		mov	r0, r4
 2381 0192 2946     		mov	r1, r5
 2382 0194 FFF7FEFF 		bl	__aeabi_dcmplt
 2383              	.LVL223:
 2384 0198 0028     		cmp	r0, #0
 2385 019a 40F0EB80 		bne	.L170
 2386              		.loc 1 703 37 view .LVU651
 2387 019e D7E90423 		ldrd	r2, [r7, #16]
 2388 01a2 2046     		mov	r0, r4
 2389 01a4 2946     		mov	r1, r5
 2390 01a6 FFF7FEFF 		bl	__aeabi_dcmpgt
 2391              	.LVL224:
 2392 01aa 0028     		cmp	r0, #0
 2393 01ac 40F0E280 		bne	.L170
 704:app/toolhead.c ****         return TOOLHEAD_ERR_LIMIT;
 705:app/toolhead.c ****     }
 706:app/toolhead.c ****     
 707:app/toolhead.c ****     /* 创建前瞻运动段 */
 708:app/toolhead.c ****     lookahead_move_t move;
 2394              		.loc 1 708 5 is_stmt 1 view .LVU652
 709:app/toolhead.c ****     coord_copy(&move.start_pos, &s_commanded_pos);
 2395              		.loc 1 709 5 view .LVU653
 2396              	.LVL225:
 2397              	.LBB138:
 2398              	.LBI138:
 214:app/toolhead.c **** {
 2399              		.loc 1 214 1 view .LVU654
 2400              	.LBB139:
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 2401              		.loc 1 216 5 view .LVU655
 2402              	.LBE139:
 2403              	.LBE138:
 710:app/toolhead.c ****     coord_copy(&move.end_pos, p_end_pos);
 711:app/toolhead.c ****     move.distance = distance;
 712:app/toolhead.c ****     move.max_velocity = max_v;
 713:app/toolhead.c ****     move.max_cruise_v = max_v;
 714:app/toolhead.c ****     move.max_start_v = max_v;
 715:app/toolhead.c ****     move.max_end_v = max_v;
 716:app/toolhead.c ****     move.start_v = 0.0;
 717:app/toolhead.c ****     move.cruise_v = max_v;
 718:app/toolhead.c ****     move.end_v = 0.0;
 719:app/toolhead.c ****     move.valid = 1;
 2404              		.loc 1 719 16 is_stmt 0 view .LVU656
 2405 01b0 0123     		movs	r3, #1
 2406 01b2 8DF8E830 		strb	r3, [sp, #232]
 2407              	.LBB141:
 2408              	.LBB140:
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 2409              		.loc 1 216 14 view .LVU657
 2410 01b6 DBE90023 		ldrd	r2, [fp]
 2411 01ba CDE91A23 		strd	r2, [sp, #104]
 217:app/toolhead.c ****     p_dst->z = p_src->z;
ARM GAS  /tmp/ccLyNHPk.s 			page 64


 2412              		.loc 1 217 5 is_stmt 1 view .LVU658
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 2413              		.loc 1 217 14 is_stmt 0 view .LVU659
 2414 01be DBE90223 		ldrd	r2, [fp, #8]
 2415 01c2 CDE91C23 		strd	r2, [sp, #112]
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 2416              		.loc 1 218 5 is_stmt 1 view .LVU660
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 2417              		.loc 1 218 14 is_stmt 0 view .LVU661
 2418 01c6 DBE90423 		ldrd	r2, [fp, #16]
 2419 01ca CDE91E23 		strd	r2, [sp, #120]
 219:app/toolhead.c **** }
 2420              		.loc 1 219 5 is_stmt 1 view .LVU662
 219:app/toolhead.c **** }
 2421              		.loc 1 219 14 is_stmt 0 view .LVU663
 2422 01ce DBE90623 		ldrd	r2, [fp, #24]
 2423 01d2 CDE92023 		strd	r2, [sp, #128]
 2424              	.LVL226:
 219:app/toolhead.c **** }
 2425              		.loc 1 219 14 view .LVU664
 2426              	.LBE140:
 2427              	.LBE141:
 710:app/toolhead.c ****     move.distance = distance;
 2428              		.loc 1 710 5 is_stmt 1 view .LVU665
 2429              	.LBB142:
 2430              	.LBI142:
 214:app/toolhead.c **** {
 2431              		.loc 1 214 1 view .LVU666
 2432              	.LBB143:
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 2433              		.loc 1 216 5 view .LVU667
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 2434              		.loc 1 217 5 view .LVU668
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 2435              		.loc 1 218 5 view .LVU669
 219:app/toolhead.c **** }
 2436              		.loc 1 219 5 view .LVU670
 219:app/toolhead.c **** }
 2437              		.loc 1 219 14 is_stmt 0 view .LVU671
 2438 01d6 DAE90623 		ldrd	r2, [r10, #24]
 2439              	.LBE143:
 2440              	.LBE142:
 711:app/toolhead.c ****     move.max_velocity = max_v;
 2441              		.loc 1 711 19 view .LVU672
 2442 01da 9DED0A7B 		vldr.64	d7, [sp, #40]
 2443              	.LBB146:
 2444              	.LBB144:
 219:app/toolhead.c **** }
 2445              		.loc 1 219 14 view .LVU673
 2446 01de CDE92823 		strd	r2, [sp, #160]
 2447              	.LVL227:
 219:app/toolhead.c **** }
 2448              		.loc 1 219 14 view .LVU674
 2449              	.LBE144:
 2450              	.LBE146:
 711:app/toolhead.c ****     move.max_velocity = max_v;
 2451              		.loc 1 711 5 is_stmt 1 view .LVU675
ARM GAS  /tmp/ccLyNHPk.s 			page 65


 712:app/toolhead.c ****     move.max_cruise_v = max_v;
 2452              		.loc 1 712 5 view .LVU676
 713:app/toolhead.c ****     move.max_start_v = max_v;
 2453              		.loc 1 713 5 view .LVU677
 714:app/toolhead.c ****     move.max_end_v = max_v;
 2454              		.loc 1 714 5 view .LVU678
 715:app/toolhead.c ****     move.start_v = 0.0;
 2455              		.loc 1 715 5 view .LVU679
 716:app/toolhead.c ****     move.cruise_v = max_v;
 2456              		.loc 1 716 5 view .LVU680
 720:app/toolhead.c ****     
 721:app/toolhead.c ****     /* 添加到前瞻队列 */
 722:app/toolhead.c ****     if (lookahead_push(&move) != 0) {
 2457              		.loc 1 722 9 is_stmt 0 view .LVU681
 2458 01e2 1AA8     		add	r0, sp, #104
 716:app/toolhead.c ****     move.cruise_v = max_v;
 2459              		.loc 1 716 18 view .LVU682
 2460 01e4 0022     		movs	r2, #0
 2461 01e6 0023     		movs	r3, #0
 2462              	.LBB147:
 2463              	.LBB145:
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 2464              		.loc 1 216 14 view .LVU683
 2465 01e8 8DED228B 		vstr.64	d8, [sp, #136]
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 2466              		.loc 1 217 14 view .LVU684
 2467 01ec 8DED249B 		vstr.64	d9, [sp, #144]
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 2468              		.loc 1 218 14 view .LVU685
 2469 01f0 CDE92645 		strd	r4, [sp, #152]
 2470              	.LBE145:
 2471              	.LBE147:
 711:app/toolhead.c ****     move.max_velocity = max_v;
 2472              		.loc 1 711 19 view .LVU686
 2473 01f4 8DED2A7B 		vstr.64	d7, [sp, #168]
 712:app/toolhead.c ****     move.max_cruise_v = max_v;
 2474              		.loc 1 712 23 view .LVU687
 2475 01f8 CDE92C89 		strd	r8, [sp, #176]
 713:app/toolhead.c ****     move.max_start_v = max_v;
 2476              		.loc 1 713 23 view .LVU688
 2477 01fc CDE93089 		strd	r8, [sp, #192]
 714:app/toolhead.c ****     move.max_end_v = max_v;
 2478              		.loc 1 714 22 view .LVU689
 2479 0200 CDE92E89 		strd	r8, [sp, #184]
 715:app/toolhead.c ****     move.start_v = 0.0;
 2480              		.loc 1 715 20 view .LVU690
 2481 0204 CDE93289 		strd	r8, [sp, #200]
 717:app/toolhead.c ****     move.end_v = 0.0;
 2482              		.loc 1 717 19 view .LVU691
 2483 0208 CDE93689 		strd	r8, [sp, #216]
 716:app/toolhead.c ****     move.cruise_v = max_v;
 2484              		.loc 1 716 18 view .LVU692
 2485 020c CDE93423 		strd	r2, [sp, #208]
 717:app/toolhead.c ****     move.end_v = 0.0;
 2486              		.loc 1 717 5 is_stmt 1 view .LVU693
 718:app/toolhead.c ****     move.valid = 1;
 2487              		.loc 1 718 5 view .LVU694
ARM GAS  /tmp/ccLyNHPk.s 			page 66


 718:app/toolhead.c ****     move.valid = 1;
 2488              		.loc 1 718 16 is_stmt 0 view .LVU695
 2489 0210 CDE93823 		strd	r2, [sp, #224]
 719:app/toolhead.c ****     
 2490              		.loc 1 719 5 is_stmt 1 view .LVU696
 2491              		.loc 1 722 5 view .LVU697
 2492              		.loc 1 722 9 is_stmt 0 view .LVU698
 2493 0214 FFF7FEFF 		bl	lookahead_push
 2494              	.LVL228:
 2495              		.loc 1 722 8 view .LVU699
 2496 0218 0028     		cmp	r0, #0
 2497 021a 40F09E80 		bne	.L153
 2498              	.L157:
 723:app/toolhead.c ****         /* 队列满，先刷新 */
 724:app/toolhead.c ****         lookahead_process();
 725:app/toolhead.c ****         lookahead_flush();
 726:app/toolhead.c ****         
 727:app/toolhead.c ****         /* 重试 */
 728:app/toolhead.c ****         if (lookahead_push(&move) != 0) {
 729:app/toolhead.c ****             return TOOLHEAD_ERR_QUEUE;
 730:app/toolhead.c ****         }
 731:app/toolhead.c ****     }
 732:app/toolhead.c ****     
 733:app/toolhead.c ****     /* 更新命令位置 */
 734:app/toolhead.c ****     coord_copy(&s_commanded_pos, p_end_pos);
 2499              		.loc 1 734 5 is_stmt 1 view .LVU700
 2500              	.LVL229:
 2501              	.LBB148:
 2502              	.LBI148:
 214:app/toolhead.c **** {
 2503              		.loc 1 214 1 view .LVU701
 2504              	.LBB149:
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 2505              		.loc 1 216 5 view .LVU702
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 2506              		.loc 1 217 21 is_stmt 0 view .LVU703
 2507 021e DAE90201 		ldrd	r0, [r10, #8]
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 2508              		.loc 1 216 21 view .LVU704
 2509 0222 DAE90023 		ldrd	r2, [r10]
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 2510              		.loc 1 217 14 view .LVU705
 2511 0226 CBE90201 		strd	r0, [fp, #8]
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 2512              		.loc 1 218 21 view .LVU706
 2513 022a DAE90401 		ldrd	r0, [r10, #16]
 2514              	.LBE149:
 2515              	.LBE148:
 735:app/toolhead.c ****     
 736:app/toolhead.c ****     /* 如果队列接近满，处理前瞻 */
 737:app/toolhead.c ****     if (s_lookahead_count >= LOOKAHEAD_SIZE - 2) {
 2516              		.loc 1 737 27 view .LVU707
 2517 022e 184C     		ldr	r4, .L186+32
 2518              	.LBB153:
 2519              	.LBB150:
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 2520              		.loc 1 216 14 view .LVU708
ARM GAS  /tmp/ccLyNHPk.s 			page 67


 2521 0230 CBE90023 		strd	r2, [fp]
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 2522              		.loc 1 217 5 is_stmt 1 view .LVU709
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 2523              		.loc 1 218 5 view .LVU710
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 2524              		.loc 1 218 14 is_stmt 0 view .LVU711
 2525 0234 CBE90401 		strd	r0, [fp, #16]
 219:app/toolhead.c **** }
 2526              		.loc 1 219 5 is_stmt 1 view .LVU712
 2527              	.LBE150:
 2528              	.LBE153:
 2529              		.loc 1 737 8 is_stmt 0 view .LVU713
 2530 0238 2368     		ldr	r3, [r4]
 2531              	.LBB154:
 2532              	.LBB151:
 219:app/toolhead.c **** }
 2533              		.loc 1 219 21 view .LVU714
 2534 023a DAE90601 		ldrd	r0, [r10, #24]
 2535              	.LBE151:
 2536              	.LBE154:
 2537              		.loc 1 737 8 view .LVU715
 2538 023e 0D2B     		cmp	r3, #13
 2539              	.LBB155:
 2540              	.LBB152:
 219:app/toolhead.c **** }
 2541              		.loc 1 219 14 view .LVU716
 2542 0240 CBE90601 		strd	r0, [fp, #24]
 2543              	.LVL230:
 219:app/toolhead.c **** }
 2544              		.loc 1 219 14 view .LVU717
 2545              	.LBE152:
 2546              	.LBE155:
 2547              		.loc 1 737 5 is_stmt 1 view .LVU718
 2548              		.loc 1 737 8 is_stmt 0 view .LVU719
 2549 0244 08DC     		bgt	.L185
 2550              	.LVL231:
 2551              	.L155:
 688:app/toolhead.c ****     }
 2552              		.loc 1 688 16 view .LVU720
 2553 0246 0020     		movs	r0, #0
 2554              	.L145:
 738:app/toolhead.c ****         lookahead_process();
 739:app/toolhead.c ****         
 740:app/toolhead.c ****         /* 保留最后几个运动用于前瞻 */
 741:app/toolhead.c ****         while (s_lookahead_count > 2) {
 742:app/toolhead.c ****             lookahead_move_t m;
 743:app/toolhead.c ****             if (lookahead_pop(&m) == 0) {
 744:app/toolhead.c ****                 /* 计算梯形曲线参数 */
 745:app/toolhead.c ****                 double accel_t, cruise_t, decel_t;
 746:app/toolhead.c ****                 calc_trapezoidal_profile(m.distance, m.start_v, m.cruise_v,
 747:app/toolhead.c ****                                          m.end_v, s_config.max_accel,
 748:app/toolhead.c ****                                          &accel_t, &cruise_t, &decel_t);
 749:app/toolhead.c ****                 
 750:app/toolhead.c ****                 /* 计算方向向量 */
 751:app/toolhead.c ****                 struct coord axes_r;
 752:app/toolhead.c ****                 cartesian_calc_direction(&m.start_pos, &m.end_pos, &axes_r);
ARM GAS  /tmp/ccLyNHPk.s 			page 68


 753:app/toolhead.c ****                 
 754:app/toolhead.c ****                 /* 添加到 trapq */
 755:app/toolhead.c ****                 trapq_append(s_p_trapq, s_print_time,
 756:app/toolhead.c ****                              accel_t, cruise_t, decel_t,
 757:app/toolhead.c ****                              &m.start_pos, &axes_r,
 758:app/toolhead.c ****                              m.start_v, m.cruise_v, s_config.max_accel);
 759:app/toolhead.c ****                 
 760:app/toolhead.c ****                 /* 更新打印时间 */
 761:app/toolhead.c ****                 s_print_time += accel_t + cruise_t + decel_t;
 762:app/toolhead.c ****                 
 763:app/toolhead.c ****                 /* 更新当前位置 */
 764:app/toolhead.c ****                 coord_copy(&s_current_pos, &m.end_pos);
 765:app/toolhead.c ****             }
 766:app/toolhead.c ****         }
 767:app/toolhead.c ****         
 768:app/toolhead.c ****         /* 生成步进时序 */
 769:app/toolhead.c ****         generate_steps(s_print_time);
 770:app/toolhead.c ****     }
 771:app/toolhead.c ****     
 772:app/toolhead.c ****     return TOOLHEAD_OK;
 773:app/toolhead.c **** }
 2555              		.loc 1 773 1 view .LVU721
 2556 0248 5FB0     		add	sp, sp, #380
 2557              		.cfi_remember_state
 2558              		.cfi_def_cfa_offset 52
 2559              		@ sp needed
 2560 024a BDEC048B 		vldm	sp!, {d8-d9}
 2561              		.cfi_restore 82
 2562              		.cfi_restore 83
 2563              		.cfi_restore 80
 2564              		.cfi_restore 81
 2565              		.cfi_def_cfa_offset 36
 2566 024e BDE8F08F 		pop	{r4, r5, r6, r7, r8, r9, r10, fp, pc}
 2567              	.LVL232:
 2568              	.L164:
 2569              		.cfi_restore_state
 694:app/toolhead.c ****     }
 2570              		.loc 1 694 15 view .LVU722
 2571 0252 8046     		mov	r8, r0
 2572 0254 8946     		mov	r9, r1
 2573 0256 5BE7     		b	.L150
 2574              	.LVL233:
 2575              	.L185:
 738:app/toolhead.c ****         lookahead_process();
 2576              		.loc 1 738 9 is_stmt 1 view .LVU723
 2577 0258 FFF7FEFF 		bl	lookahead_process
 2578              	.LVL234:
 741:app/toolhead.c ****             lookahead_move_t m;
 2579              		.loc 1 741 9 view .LVU724
 741:app/toolhead.c ****             lookahead_move_t m;
 2580              		.loc 1 741 15 view .LVU725
 2581 025c 2368     		ldr	r3, [r4]
 2582 025e 0D4F     		ldr	r7, .L186+36
 2583 0260 022B     		cmp	r3, #2
 2584 0262 69DD     		ble	.L158
 2585              	.LBB156:
 2586              	.LBB157:
ARM GAS  /tmp/ccLyNHPk.s 			page 69


 746:app/toolhead.c ****                                          m.end_v, s_config.max_accel,
 2587              		.loc 1 746 17 is_stmt 0 view .LVU726
 2588 0264 0DF14009 		add	r9, sp, #64
 2589 0268 0EAD     		add	r5, sp, #56
 2590 026a 0DF13008 		add	r8, sp, #48
 2591              	.LVL235:
 746:app/toolhead.c ****                                          m.end_v, s_config.max_accel,
 2592              		.loc 1 746 17 view .LVU727
 2593 026e 18E0     		b	.L160
 2594              	.L187:
 2595              		.align	3
 2596              	.L186:
 2597 0270 8DEDB5A0 		.word	-1598689907
 2598 0274 F7C6B03E 		.word	1051772663
 2599 0278 FCA9F1D2 		.word	-755914244
 2600 027c 4D62503F 		.word	1062232653
 2601 0280 00000000 		.word	.LANCHOR6
 2602 0284 00000000 		.word	.LANCHOR4
 2603 0288 00000000 		.word	.LANCHOR9
 2604 028c 00000000 		.word	.LANCHOR10
 2605 0290 00000000 		.word	.LANCHOR0
 2606 0294 00000000 		.word	.LANCHOR5
 2607 0298 00000000 		.word	.LANCHOR13
 2608              	.LVL236:
 2609              	.L159:
 746:app/toolhead.c ****                                          m.end_v, s_config.max_accel,
 2610              		.loc 1 746 17 view .LVU728
 2611              	.LBE157:
 2612              	.LBE156:
 741:app/toolhead.c ****             lookahead_move_t m;
 2613              		.loc 1 741 15 is_stmt 1 discriminator 1 view .LVU729
 2614 029c 2368     		ldr	r3, [r4]
 2615 029e 022B     		cmp	r3, #2
 2616 02a0 4ADD     		ble	.L158
 2617              	.L160:
 2618              	.LBB160:
 742:app/toolhead.c ****             if (lookahead_pop(&m) == 0) {
 2619              		.loc 1 742 13 view .LVU730
 743:app/toolhead.c ****                 /* 计算梯形曲线参数 */
 2620              		.loc 1 743 13 view .LVU731
 743:app/toolhead.c ****                 /* 计算梯形曲线参数 */
 2621              		.loc 1 743 17 is_stmt 0 view .LVU732
 2622 02a2 3CA8     		add	r0, sp, #240
 2623 02a4 FFF7FEFF 		bl	lookahead_pop
 2624              	.LVL237:
 743:app/toolhead.c ****                 /* 计算梯形曲线参数 */
 2625              		.loc 1 743 16 view .LVU733
 2626 02a8 0028     		cmp	r0, #0
 2627 02aa F7D1     		bne	.L159
 2628              	.LBB158:
 745:app/toolhead.c ****                 calc_trapezoidal_profile(m.distance, m.start_v, m.cruise_v,
 2629              		.loc 1 745 17 is_stmt 1 view .LVU734
 746:app/toolhead.c ****                                          m.end_v, s_config.max_accel,
 2630              		.loc 1 746 17 view .LVU735
 2631 02ac CDE90759 		strd	r5, r9, [sp, #28]
 2632 02b0 CDF81880 		str	r8, [sp, #24]
 2633 02b4 7068     		ldr	r0, [r6, #4]	@ float
ARM GAS  /tmp/ccLyNHPk.s 			page 70


 2634 02b6 FFF7FEFF 		bl	__aeabi_f2d
 2635              	.LVL238:
 2636 02ba DDE95AAB 		ldrd	r10, [sp, #360]
 2637 02be CDE902AB 		strd	r10, [sp, #8]
 2638 02c2 DDE958AB 		ldrd	r10, [sp, #352]
 2639 02c6 DDE95623 		ldrd	r2, [sp, #344]
 2640 02ca CDE90401 		strd	r0, [sp, #16]
 2641 02ce CDE900AB 		strd	r10, [sp]
 2642 02d2 DDE94C01 		ldrd	r0, [sp, #304]
 2643 02d6 FFF7FEFF 		bl	calc_trapezoidal_profile
 2644              	.LVL239:
 751:app/toolhead.c ****                 cartesian_calc_direction(&m.start_pos, &m.end_pos, &axes_r);
 2645              		.loc 1 751 17 view .LVU736
 752:app/toolhead.c ****                 
 2646              		.loc 1 752 17 view .LVU737
 2647 02da 12AA     		add	r2, sp, #72
 2648 02dc 44A9     		add	r1, sp, #272
 2649 02de 3CA8     		add	r0, sp, #240
 2650 02e0 FFF7FEFF 		bl	cartesian_calc_direction
 2651              	.LVL240:
 755:app/toolhead.c ****                              accel_t, cruise_t, decel_t,
 2652              		.loc 1 755 17 view .LVU738
 2653 02e4 7068     		ldr	r0, [r6, #4]	@ float
 2654 02e6 FFF7FEFF 		bl	__aeabi_f2d
 2655              	.LVL241:
 2656 02ea 274B     		ldr	r3, .L188
 2657 02ec 41EC160B 		vmov	d6, r0, r1
 2658 02f0 9DED103B 		vldr.64	d3, [sp, #64]
 2659 02f4 95ED002B 		vldr.64	d2, [r5]
 2660 02f8 15ED021B 		vldr.64	d1, [r5, #-8]
 2661 02fc 97ED000B 		vldr.64	d0, [r7]
 2662 0300 9DED585B 		vldr.64	d5, [sp, #352]
 2663 0304 9DED564B 		vldr.64	d4, [sp, #344]
 2664 0308 1868     		ldr	r0, [r3]
 2665 030a 12AA     		add	r2, sp, #72
 2666 030c 3CA9     		add	r1, sp, #240
 2667 030e FFF7FEFF 		bl	trapq_append
 2668              	.LVL242:
 761:app/toolhead.c ****                 
 2669              		.loc 1 761 17 view .LVU739
 761:app/toolhead.c ****                 
 2670              		.loc 1 761 41 is_stmt 0 view .LVU740
 2671 0312 D5E90023 		ldrd	r2, [r5]
 2672 0316 55E90201 		ldrd	r0, [r5, #-8]
 2673 031a FFF7FEFF 		bl	__aeabi_dadd
 2674              	.LVL243:
 761:app/toolhead.c ****                 
 2675              		.loc 1 761 52 view .LVU741
 2676 031e DDE91023 		ldrd	r2, [sp, #64]
 2677 0322 FFF7FEFF 		bl	__aeabi_dadd
 2678              	.LVL244:
 761:app/toolhead.c ****                 
 2679              		.loc 1 761 30 view .LVU742
 2680 0326 D7E90023 		ldrd	r2, [r7]
 2681 032a FFF7FEFF 		bl	__aeabi_dadd
 2682              	.LVL245:
 2683              	.LBE158:
ARM GAS  /tmp/ccLyNHPk.s 			page 71


 2684              	.LBE160:
 741:app/toolhead.c ****             lookahead_move_t m;
 2685              		.loc 1 741 15 view .LVU743
 2686 032e 2368     		ldr	r3, [r4]
 2687 0330 022B     		cmp	r3, #2
 2688              	.LBB161:
 2689              	.LBB159:
 761:app/toolhead.c ****                 
 2690              		.loc 1 761 30 view .LVU744
 2691 0332 C7E90001 		strd	r0, [r7]
 764:app/toolhead.c ****             }
 2692              		.loc 1 764 17 is_stmt 1 view .LVU745
 2693              	.LVL246:
 764:app/toolhead.c ****             }
 2694              		.loc 1 764 17 is_stmt 0 view .LVU746
 2695              	.LBE159:
 2696              	.LBE161:
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 2697              		.loc 1 216 5 is_stmt 1 view .LVU747
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 2698              		.loc 1 217 5 view .LVU748
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 2699              		.loc 1 218 5 view .LVU749
 219:app/toolhead.c **** }
 2700              		.loc 1 219 5 view .LVU750
 741:app/toolhead.c ****             lookahead_move_t m;
 2701              		.loc 1 741 15 view .LVU751
 2702 0336 B4DC     		bgt	.L160
 2703              	.L158:
 769:app/toolhead.c ****     }
 2704              		.loc 1 769 9 view .LVU752
 2705 0338 144C     		ldr	r4, .L188+4
 2706 033a 97ED008B 		vldr.64	d8, [r7]
 2707              	.LVL247:
 2708              	.LBB162:
 2709              	.LBI162:
 536:app/toolhead.c **** {
 2710              		.loc 1 536 1 view .LVU753
 2711              	.LBE162:
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 2712              		.loc 1 538 5 view .LVU754
 2713              	.LBB164:
 2714              	.LBB163:
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 2715              		.loc 1 538 10 view .LVU755
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 2716              		.loc 1 538 21 view .LVU756
 2717 033e 04F11005 		add	r5, r4, #16
 2718              	.LVL248:
 2719              	.L162:
 539:app/toolhead.c ****             itersolve_generate_steps(s_steppers[i], flush_time);
 2720              		.loc 1 539 9 view .LVU757
 540:app/toolhead.c ****         }
 2721              		.loc 1 540 13 view .LVU758
 539:app/toolhead.c ****             itersolve_generate_steps(s_steppers[i], flush_time);
 2722              		.loc 1 539 23 is_stmt 0 view .LVU759
 2723 0342 54F8040B 		ldr	r0, [r4], #4
ARM GAS  /tmp/ccLyNHPk.s 			page 72


 540:app/toolhead.c ****         }
 2724              		.loc 1 540 13 view .LVU760
 2725 0346 B0EE480A 		vmov.f32	s0, s16
 2726 034a F0EE680A 		vmov.f32	s1, s17
 539:app/toolhead.c ****             itersolve_generate_steps(s_steppers[i], flush_time);
 2727              		.loc 1 539 12 view .LVU761
 2728 034e 08B1     		cbz	r0, .L161
 2729              	.LVL249:
 540:app/toolhead.c ****         }
 2730              		.loc 1 540 13 view .LVU762
 2731 0350 FFF7FEFF 		bl	itersolve_generate_steps
 2732              	.LVL250:
 2733              	.L161:
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 2734              		.loc 1 538 35 is_stmt 1 view .LVU763
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 2735              		.loc 1 538 21 view .LVU764
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 2736              		.loc 1 538 5 is_stmt 0 view .LVU765
 2737 0354 A542     		cmp	r5, r4
 2738 0356 F4D1     		bne	.L162
 2739 0358 75E7     		b	.L155
 2740              	.LVL251:
 2741              	.L153:
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 2742              		.loc 1 538 5 view .LVU766
 2743              	.LBE163:
 2744              	.LBE164:
 724:app/toolhead.c ****         lookahead_flush();
 2745              		.loc 1 724 9 is_stmt 1 view .LVU767
 2746 035a FFF7FEFF 		bl	lookahead_process
 2747              	.LVL252:
 725:app/toolhead.c ****         
 2748              		.loc 1 725 9 view .LVU768
 2749 035e FFF7FEFF 		bl	lookahead_flush
 2750              	.LVL253:
 728:app/toolhead.c ****             return TOOLHEAD_ERR_QUEUE;
 2751              		.loc 1 728 9 view .LVU769
 728:app/toolhead.c ****             return TOOLHEAD_ERR_QUEUE;
 2752              		.loc 1 728 13 is_stmt 0 view .LVU770
 2753 0362 1AA8     		add	r0, sp, #104
 2754 0364 FFF7FEFF 		bl	lookahead_push
 2755              	.LVL254:
 728:app/toolhead.c ****             return TOOLHEAD_ERR_QUEUE;
 2756              		.loc 1 728 12 view .LVU771
 2757 0368 0028     		cmp	r0, #0
 2758 036a 3FF458AF 		beq	.L157
 680:app/toolhead.c ****     }
 2759              		.loc 1 680 16 view .LVU772
 2760 036e 6FF00200 		mvn	r0, #2
 2761 0372 69E7     		b	.L145
 2762              	.L170:
 704:app/toolhead.c ****     }
 2763              		.loc 1 704 16 view .LVU773
 2764 0374 6FF00100 		mvn	r0, #1
 2765 0378 66E7     		b	.L145
 2766              	.LVL255:
ARM GAS  /tmp/ccLyNHPk.s 			page 73


 2767              	.L163:
 2768              		.cfi_def_cfa_offset 0
 2769              		.cfi_restore 4
 2770              		.cfi_restore 5
 2771              		.cfi_restore 6
 2772              		.cfi_restore 7
 2773              		.cfi_restore 8
 2774              		.cfi_restore 9
 2775              		.cfi_restore 10
 2776              		.cfi_restore 11
 2777              		.cfi_restore 14
 2778              		.cfi_restore 80
 2779              		.cfi_restore 81
 2780              		.cfi_restore 82
 2781              		.cfi_restore 83
 676:app/toolhead.c ****     }
 2782              		.loc 1 676 16 view .LVU774
 2783 037a 4FF0FF30 		mov	r0, #-1
 2784              	.LVL256:
 676:app/toolhead.c ****     }
 2785              		.loc 1 676 16 view .LVU775
 2786 037e 7047     		bx	lr
 2787              	.LVL257:
 2788              	.L184:
 680:app/toolhead.c ****     }
 2789              		.loc 1 680 16 view .LVU776
 2790 0380 6FF00200 		mvn	r0, #2
 2791              	.LVL258:
 2792              		.loc 1 773 1 view .LVU777
 2793 0384 7047     		bx	lr
 2794              	.L189:
 2795 0386 00BF     		.align	2
 2796              	.L188:
 2797 0388 00000000 		.word	.LANCHOR6
 2798 038c 00000000 		.word	.LANCHOR12
 2799              		.cfi_endproc
 2800              	.LFE21:
 2802              		.section	.text.toolhead_wait_moves,"ax",%progbits
 2803              		.align	1
 2804              		.p2align 2,,3
 2805              		.global	toolhead_wait_moves
 2806              		.syntax unified
 2807              		.thumb
 2808              		.thumb_func
 2809              		.fpu fpv4-sp-d16
 2811              	toolhead_wait_moves:
 2812              	.LFB23:
 774:app/toolhead.c **** 
 775:app/toolhead.c **** int
 776:app/toolhead.c **** toolhead_home(uint8_t axes_mask)
 777:app/toolhead.c **** {
 778:app/toolhead.c ****     /* 等待当前运动完成 */
 779:app/toolhead.c ****     toolhead_wait_moves();
 780:app/toolhead.c ****     
 781:app/toolhead.c ****     /* 设置归零回调 */
 782:app/toolhead.c ****     if (axes_mask & AXIS_X_MASK) {
 783:app/toolhead.c ****         endstop_set_callback(ENDSTOP_X, home_endstop_callback, NULL);
ARM GAS  /tmp/ccLyNHPk.s 			page 74


 784:app/toolhead.c ****         endstop_home_start(ENDSTOP_X);
 785:app/toolhead.c ****     }
 786:app/toolhead.c ****     if (axes_mask & AXIS_Y_MASK) {
 787:app/toolhead.c ****         endstop_set_callback(ENDSTOP_Y, home_endstop_callback, NULL);
 788:app/toolhead.c ****         endstop_home_start(ENDSTOP_Y);
 789:app/toolhead.c ****     }
 790:app/toolhead.c ****     if (axes_mask & AXIS_Z_MASK) {
 791:app/toolhead.c ****         endstop_set_callback(ENDSTOP_Z, home_endstop_callback, NULL);
 792:app/toolhead.c ****         endstop_home_start(ENDSTOP_Z);
 793:app/toolhead.c ****     }
 794:app/toolhead.c ****     
 795:app/toolhead.c ****     /* 初始化归零上下文 */
 796:app/toolhead.c ****     s_home_ctx.state = HOME_STATE_FAST;
 797:app/toolhead.c ****     s_home_ctx.axis_mask = axes_mask;
 798:app/toolhead.c ****     s_home_ctx.triggered = 0;
 799:app/toolhead.c ****     s_home_ctx.start_time = s_print_time;
 800:app/toolhead.c ****     
 801:app/toolhead.c ****     /* 快速归零: 向负方向运动直到触发限位 */
 802:app/toolhead.c ****     struct coord home_target;
 803:app/toolhead.c ****     coord_copy(&home_target, &s_commanded_pos);
 804:app/toolhead.c ****     
 805:app/toolhead.c ****     /* 设置归零目标 (向负方向移动最大行程) */
 806:app/toolhead.c ****     if (axes_mask & AXIS_X_MASK) {
 807:app/toolhead.c ****         home_target.x = s_min_pos[0] - 10.0;  /* 超出限位一点 */
 808:app/toolhead.c ****     }
 809:app/toolhead.c ****     if (axes_mask & AXIS_Y_MASK) {
 810:app/toolhead.c ****         home_target.y = s_min_pos[1] - 10.0;
 811:app/toolhead.c ****     }
 812:app/toolhead.c ****     if (axes_mask & AXIS_Z_MASK) {
 813:app/toolhead.c ****         home_target.z = s_min_pos[2] - 10.0;
 814:app/toolhead.c ****     }
 815:app/toolhead.c ****     
 816:app/toolhead.c ****     /* 临时禁用限位检查，执行归零运动 */
 817:app/toolhead.c ****     double saved_min[NUM_AXES];
 818:app/toolhead.c ****     for (int i = 0; i < NUM_AXES; i++) {
 819:app/toolhead.c ****         saved_min[i] = s_min_pos[i];
 820:app/toolhead.c ****         s_min_pos[i] = -1e9;
 821:app/toolhead.c ****     }
 822:app/toolhead.c ****     
 823:app/toolhead.c ****     /* 执行快速归零运动 */
 824:app/toolhead.c ****     toolhead_move(&home_target, HOMING_SPEED * 2.0f);
 825:app/toolhead.c ****     
 826:app/toolhead.c ****     /* 刷新并等待 */
 827:app/toolhead.c ****     toolhead_flush();
 828:app/toolhead.c ****     
 829:app/toolhead.c ****     /* 等待限位触发或超时 */
 830:app/toolhead.c ****     double timeout_time = s_print_time + HOMING_TIMEOUT;
 831:app/toolhead.c ****     while (!s_home_ctx.triggered && s_print_time < timeout_time) {
 832:app/toolhead.c ****         /* 在实际硬件上，这里会等待中断 */
 833:app/toolhead.c ****         /* 模拟环境下直接检查限位状态 */
 834:app/toolhead.c ****         if (axes_mask & AXIS_X_MASK) {
 835:app/toolhead.c ****             if (endstop_is_triggered(ENDSTOP_X)) {
 836:app/toolhead.c ****                 s_home_ctx.triggered = 1;
 837:app/toolhead.c ****             }
 838:app/toolhead.c ****         }
 839:app/toolhead.c ****         if (axes_mask & AXIS_Y_MASK) {
 840:app/toolhead.c ****             if (endstop_is_triggered(ENDSTOP_Y)) {
ARM GAS  /tmp/ccLyNHPk.s 			page 75


 841:app/toolhead.c ****                 s_home_ctx.triggered = 1;
 842:app/toolhead.c ****             }
 843:app/toolhead.c ****         }
 844:app/toolhead.c ****         if (axes_mask & AXIS_Z_MASK) {
 845:app/toolhead.c ****             if (endstop_is_triggered(ENDSTOP_Z)) {
 846:app/toolhead.c ****                 s_home_ctx.triggered = 1;
 847:app/toolhead.c ****             }
 848:app/toolhead.c ****         }
 849:app/toolhead.c ****         
 850:app/toolhead.c ****         /* 短暂延时 */
 851:app/toolhead.c ****         sched_main();
 852:app/toolhead.c ****     }
 853:app/toolhead.c ****     
 854:app/toolhead.c ****     /* 停止所有运动 */
 855:app/toolhead.c ****     stepper_stop_all();
 856:app/toolhead.c ****     
 857:app/toolhead.c ****     /* 恢复限位 */
 858:app/toolhead.c ****     for (int i = 0; i < NUM_AXES; i++) {
 859:app/toolhead.c ****         s_min_pos[i] = saved_min[i];
 860:app/toolhead.c ****     }
 861:app/toolhead.c ****     
 862:app/toolhead.c ****     /* 检查是否超时 */
 863:app/toolhead.c ****     if (!s_home_ctx.triggered) {
 864:app/toolhead.c ****         s_home_ctx.state = HOME_STATE_ERROR;
 865:app/toolhead.c ****         
 866:app/toolhead.c ****         /* 结束归零模式 */
 867:app/toolhead.c ****         if (axes_mask & AXIS_X_MASK) {
 868:app/toolhead.c ****             endstop_home_end(ENDSTOP_X);
 869:app/toolhead.c ****         }
 870:app/toolhead.c ****         if (axes_mask & AXIS_Y_MASK) {
 871:app/toolhead.c ****             endstop_home_end(ENDSTOP_Y);
 872:app/toolhead.c ****         }
 873:app/toolhead.c ****         if (axes_mask & AXIS_Z_MASK) {
 874:app/toolhead.c ****             endstop_home_end(ENDSTOP_Z);
 875:app/toolhead.c ****         }
 876:app/toolhead.c ****         
 877:app/toolhead.c ****         return TOOLHEAD_ERR_HOMING;
 878:app/toolhead.c ****     }
 879:app/toolhead.c ****     
 880:app/toolhead.c ****     /* 回退一小段距离 */
 881:app/toolhead.c ****     s_home_ctx.state = HOME_STATE_RETRACT;
 882:app/toolhead.c ****     s_home_ctx.triggered = 0;
 883:app/toolhead.c ****     
 884:app/toolhead.c ****     struct coord retract_target;
 885:app/toolhead.c ****     coord_copy(&retract_target, &s_commanded_pos);
 886:app/toolhead.c ****     
 887:app/toolhead.c ****     if (axes_mask & AXIS_X_MASK) {
 888:app/toolhead.c ****         retract_target.x = HOMING_RETRACT;
 889:app/toolhead.c ****     }
 890:app/toolhead.c ****     if (axes_mask & AXIS_Y_MASK) {
 891:app/toolhead.c ****         retract_target.y = HOMING_RETRACT;
 892:app/toolhead.c ****     }
 893:app/toolhead.c ****     if (axes_mask & AXIS_Z_MASK) {
 894:app/toolhead.c ****         retract_target.z = HOMING_RETRACT;
 895:app/toolhead.c ****     }
 896:app/toolhead.c ****     
 897:app/toolhead.c ****     /* 设置当前位置为 0 */
ARM GAS  /tmp/ccLyNHPk.s 			page 76


 898:app/toolhead.c ****     struct coord zero_pos;
 899:app/toolhead.c ****     coord_clear(&zero_pos);
 900:app/toolhead.c ****     if (axes_mask & AXIS_X_MASK) {
 901:app/toolhead.c ****         s_commanded_pos.x = 0.0;
 902:app/toolhead.c ****         s_current_pos.x = 0.0;
 903:app/toolhead.c ****     }
 904:app/toolhead.c ****     if (axes_mask & AXIS_Y_MASK) {
 905:app/toolhead.c ****         s_commanded_pos.y = 0.0;
 906:app/toolhead.c ****         s_current_pos.y = 0.0;
 907:app/toolhead.c ****     }
 908:app/toolhead.c ****     if (axes_mask & AXIS_Z_MASK) {
 909:app/toolhead.c ****         s_commanded_pos.z = 0.0;
 910:app/toolhead.c ****         s_current_pos.z = 0.0;
 911:app/toolhead.c ****     }
 912:app/toolhead.c ****     
 913:app/toolhead.c ****     /* 执行回退运动 */
 914:app/toolhead.c ****     toolhead_move(&retract_target, HOMING_SPEED);
 915:app/toolhead.c ****     toolhead_flush();
 916:app/toolhead.c ****     toolhead_wait_moves();
 917:app/toolhead.c ****     
 918:app/toolhead.c ****     /* 结束归零模式 */
 919:app/toolhead.c ****     if (axes_mask & AXIS_X_MASK) {
 920:app/toolhead.c ****         endstop_home_end(ENDSTOP_X);
 921:app/toolhead.c ****     }
 922:app/toolhead.c ****     if (axes_mask & AXIS_Y_MASK) {
 923:app/toolhead.c ****         endstop_home_end(ENDSTOP_Y);
 924:app/toolhead.c ****     }
 925:app/toolhead.c ****     if (axes_mask & AXIS_Z_MASK) {
 926:app/toolhead.c ****         endstop_home_end(ENDSTOP_Z);
 927:app/toolhead.c ****     }
 928:app/toolhead.c ****     
 929:app/toolhead.c ****     s_home_ctx.state = HOME_STATE_DONE;
 930:app/toolhead.c ****     
 931:app/toolhead.c ****     return TOOLHEAD_OK;
 932:app/toolhead.c **** }
 933:app/toolhead.c **** 
 934:app/toolhead.c **** void
 935:app/toolhead.c **** toolhead_wait_moves(void)
 936:app/toolhead.c **** {
 2813              		.loc 1 936 1 is_stmt 1 view -0
 2814              		.cfi_startproc
 2815              		@ args = 0, pretend = 0, frame = 0
 2816              		@ frame_needed = 0, uses_anonymous_args = 0
 937:app/toolhead.c ****     /* 处理并刷新前瞻队列 */
 938:app/toolhead.c ****     lookahead_process();
 2817              		.loc 1 938 5 view .LVU779
 936:app/toolhead.c ****     /* 处理并刷新前瞻队列 */
 2818              		.loc 1 936 1 is_stmt 0 view .LVU780
 2819 0000 70B5     		push	{r4, r5, r6, lr}
 2820              		.cfi_def_cfa_offset 16
 2821              		.cfi_offset 4, -16
 2822              		.cfi_offset 5, -12
 2823              		.cfi_offset 6, -8
 2824              		.cfi_offset 14, -4
 2825 0002 2DED028B 		vpush.64	{d8}
 2826              		.cfi_def_cfa_offset 24
 2827              		.cfi_offset 80, -24
ARM GAS  /tmp/ccLyNHPk.s 			page 77


 2828              		.cfi_offset 81, -20
 2829              		.loc 1 938 5 view .LVU781
 2830 0006 FFF7FEFF 		bl	lookahead_process
 2831              	.LVL259:
 939:app/toolhead.c ****     lookahead_flush();
 2832              		.loc 1 939 5 is_stmt 1 view .LVU782
 2833 000a FFF7FEFF 		bl	lookahead_flush
 2834              	.LVL260:
 940:app/toolhead.c ****     
 941:app/toolhead.c ****     /* 生成所有步进时序 */
 942:app/toolhead.c ****     generate_steps(s_print_time);
 2835              		.loc 1 942 5 view .LVU783
 2836 000e 1E4B     		ldr	r3, .L202
 2837 0010 1E4C     		ldr	r4, .L202+4
 2838 0012 93ED008B 		vldr.64	d8, [r3]
 2839              	.LVL261:
 2840              	.LBB170:
 2841              	.LBI170:
 536:app/toolhead.c **** {
 2842              		.loc 1 536 1 view .LVU784
 2843              	.LBE170:
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 2844              		.loc 1 538 5 view .LVU785
 2845              	.LBB172:
 2846              	.LBB171:
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 2847              		.loc 1 538 10 view .LVU786
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 2848              		.loc 1 538 21 view .LVU787
 2849 0016 04F11005 		add	r5, r4, #16
 2850              	.LVL262:
 2851              	.L192:
 539:app/toolhead.c ****             itersolve_generate_steps(s_steppers[i], flush_time);
 2852              		.loc 1 539 9 view .LVU788
 540:app/toolhead.c ****         }
 2853              		.loc 1 540 13 view .LVU789
 539:app/toolhead.c ****             itersolve_generate_steps(s_steppers[i], flush_time);
 2854              		.loc 1 539 23 is_stmt 0 view .LVU790
 2855 001a 54F8040B 		ldr	r0, [r4], #4
 540:app/toolhead.c ****         }
 2856              		.loc 1 540 13 view .LVU791
 2857 001e B0EE480A 		vmov.f32	s0, s16
 2858 0022 F0EE680A 		vmov.f32	s1, s17
 539:app/toolhead.c ****             itersolve_generate_steps(s_steppers[i], flush_time);
 2859              		.loc 1 539 12 view .LVU792
 2860 0026 08B1     		cbz	r0, .L191
 2861              	.LVL263:
 540:app/toolhead.c ****         }
 2862              		.loc 1 540 13 view .LVU793
 2863 0028 FFF7FEFF 		bl	itersolve_generate_steps
 2864              	.LVL264:
 2865              	.L191:
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 2866              		.loc 1 538 35 is_stmt 1 view .LVU794
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 2867              		.loc 1 538 21 view .LVU795
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
ARM GAS  /tmp/ccLyNHPk.s 			page 78


 2868              		.loc 1 538 5 is_stmt 0 view .LVU796
 2869 002c AC42     		cmp	r4, r5
 2870 002e F4D1     		bne	.L192
 2871              	.LVL265:
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 2872              		.loc 1 538 5 view .LVU797
 2873              	.LBE171:
 2874              	.LBE172:
 943:app/toolhead.c ****     
 944:app/toolhead.c ****     /* 等待所有步进电机停止 */
 945:app/toolhead.c ****     while (stepper_is_moving(STEPPER_X) ||
 2875              		.loc 1 945 11 is_stmt 1 view .LVU798
 2876              		.loc 1 945 12 is_stmt 0 view .LVU799
 2877 0030 0020     		movs	r0, #0
 2878 0032 FFF7FEFF 		bl	stepper_is_moving
 2879              	.LVL266:
 2880 0036 0346     		mov	r3, r0
 946:app/toolhead.c ****            stepper_is_moving(STEPPER_Y) ||
 2881              		.loc 1 946 12 view .LVU800
 2882 0038 0120     		movs	r0, #1
 945:app/toolhead.c ****            stepper_is_moving(STEPPER_Y) ||
 2883              		.loc 1 945 11 view .LVU801
 2884 003a 43B1     		cbz	r3, .L201
 2885              	.L194:
 947:app/toolhead.c ****            stepper_is_moving(STEPPER_Z) ||
 948:app/toolhead.c ****            stepper_is_moving(STEPPER_E)) {
 949:app/toolhead.c ****         sched_main();
 2886              		.loc 1 949 9 is_stmt 1 view .LVU802
 2887 003c FFF7FEFF 		bl	sched_main
 2888              	.LVL267:
 945:app/toolhead.c ****            stepper_is_moving(STEPPER_Y) ||
 2889              		.loc 1 945 11 view .LVU803
 945:app/toolhead.c ****            stepper_is_moving(STEPPER_Y) ||
 2890              		.loc 1 945 12 is_stmt 0 view .LVU804
 2891 0040 0020     		movs	r0, #0
 2892 0042 FFF7FEFF 		bl	stepper_is_moving
 2893              	.LVL268:
 2894 0046 0346     		mov	r3, r0
 946:app/toolhead.c ****            stepper_is_moving(STEPPER_Z) ||
 2895              		.loc 1 946 12 view .LVU805
 2896 0048 0120     		movs	r0, #1
 945:app/toolhead.c ****            stepper_is_moving(STEPPER_Y) ||
 2897              		.loc 1 945 11 view .LVU806
 2898 004a 002B     		cmp	r3, #0
 2899 004c F6D1     		bne	.L194
 2900              	.L201:
 946:app/toolhead.c ****            stepper_is_moving(STEPPER_Z) ||
 2901              		.loc 1 946 12 discriminator 1 view .LVU807
 2902 004e FFF7FEFF 		bl	stepper_is_moving
 2903              	.LVL269:
 2904 0052 0346     		mov	r3, r0
 947:app/toolhead.c ****            stepper_is_moving(STEPPER_Z) ||
 2905              		.loc 1 947 12 discriminator 1 view .LVU808
 2906 0054 0220     		movs	r0, #2
 945:app/toolhead.c ****            stepper_is_moving(STEPPER_Y) ||
 2907              		.loc 1 945 41 discriminator 1 view .LVU809
 2908 0056 002B     		cmp	r3, #0
ARM GAS  /tmp/ccLyNHPk.s 			page 79


 2909 0058 F0D1     		bne	.L194
 947:app/toolhead.c ****            stepper_is_moving(STEPPER_Z) ||
 2910              		.loc 1 947 12 view .LVU810
 2911 005a FFF7FEFF 		bl	stepper_is_moving
 2912              	.LVL270:
 2913 005e 0346     		mov	r3, r0
 948:app/toolhead.c ****         sched_main();
 2914              		.loc 1 948 12 view .LVU811
 2915 0060 0320     		movs	r0, #3
 946:app/toolhead.c ****            stepper_is_moving(STEPPER_Z) ||
 2916              		.loc 1 946 41 view .LVU812
 2917 0062 002B     		cmp	r3, #0
 2918 0064 EAD1     		bne	.L194
 948:app/toolhead.c ****         sched_main();
 2919              		.loc 1 948 12 view .LVU813
 2920 0066 FFF7FEFF 		bl	stepper_is_moving
 2921              	.LVL271:
 947:app/toolhead.c ****            stepper_is_moving(STEPPER_Z) ||
 2922              		.loc 1 947 41 view .LVU814
 2923 006a 0028     		cmp	r0, #0
 2924 006c E6D1     		bne	.L194
 950:app/toolhead.c ****     }
 951:app/toolhead.c ****     
 952:app/toolhead.c ****     /* 同步当前位置和命令位置 */
 953:app/toolhead.c ****     coord_copy(&s_current_pos, &s_commanded_pos);
 2925              		.loc 1 953 5 is_stmt 1 view .LVU815
 2926              	.LVL272:
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 2927              		.loc 1 216 5 view .LVU816
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 2928              		.loc 1 217 5 view .LVU817
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 2929              		.loc 1 218 5 view .LVU818
 219:app/toolhead.c **** }
 2930              		.loc 1 219 5 view .LVU819
 954:app/toolhead.c ****     
 955:app/toolhead.c ****     /* 调用完成回调 */
 956:app/toolhead.c ****     if (s_move_complete_cb != NULL) {
 2931              		.loc 1 956 5 view .LVU820
 2932              		.loc 1 956 28 is_stmt 0 view .LVU821
 2933 006e 084B     		ldr	r3, .L202+8
 2934 0070 1B68     		ldr	r3, [r3]
 2935              		.loc 1 956 8 view .LVU822
 2936 0072 33B1     		cbz	r3, .L190
 957:app/toolhead.c ****         s_move_complete_cb(s_move_complete_arg);
 2937              		.loc 1 957 9 is_stmt 1 view .LVU823
 958:app/toolhead.c ****     }
 959:app/toolhead.c **** }
 2938              		.loc 1 959 1 is_stmt 0 view .LVU824
 2939 0074 BDEC028B 		vldm	sp!, {d8}
 2940              		.cfi_remember_state
 2941              		.cfi_restore 80
 2942              		.cfi_restore 81
 2943              		.cfi_def_cfa_offset 16
 957:app/toolhead.c ****         s_move_complete_cb(s_move_complete_arg);
 2944              		.loc 1 957 9 view .LVU825
 2945 0078 064A     		ldr	r2, .L202+12
ARM GAS  /tmp/ccLyNHPk.s 			page 80


 2946              		.loc 1 959 1 view .LVU826
 2947 007a BDE87040 		pop	{r4, r5, r6, lr}
 2948              		.cfi_restore 14
 2949              		.cfi_restore 6
 2950              		.cfi_restore 5
 2951              		.cfi_restore 4
 2952              		.cfi_def_cfa_offset 0
 957:app/toolhead.c ****         s_move_complete_cb(s_move_complete_arg);
 2953              		.loc 1 957 9 view .LVU827
 2954 007e 1068     		ldr	r0, [r2]
 2955 0080 1847     		bx	r3	@ indirect register sibling call
 2956              	.LVL273:
 2957              	.L190:
 2958              		.cfi_restore_state
 2959              		.loc 1 959 1 view .LVU828
 2960 0082 BDEC028B 		vldm	sp!, {d8}
 2961              		.cfi_restore 80
 2962              		.cfi_restore 81
 2963              		.cfi_def_cfa_offset 16
 2964 0086 70BD     		pop	{r4, r5, r6, pc}
 2965              	.L203:
 2966              		.align	2
 2967              	.L202:
 2968 0088 00000000 		.word	.LANCHOR5
 2969 008c 00000000 		.word	.LANCHOR12
 2970 0090 00000000 		.word	.LANCHOR14
 2971 0094 00000000 		.word	.LANCHOR15
 2972              		.cfi_endproc
 2973              	.LFE23:
 2975              		.section	.text.toolhead_flush,"ax",%progbits
 2976              		.align	1
 2977              		.p2align 2,,3
 2978              		.global	toolhead_flush
 2979              		.syntax unified
 2980              		.thumb
 2981              		.thumb_func
 2982              		.fpu fpv4-sp-d16
 2984              	toolhead_flush:
 2985              	.LFB24:
 960:app/toolhead.c **** 
 961:app/toolhead.c **** void
 962:app/toolhead.c **** toolhead_flush(void)
 963:app/toolhead.c **** {
 2986              		.loc 1 963 1 is_stmt 1 view -0
 2987              		.cfi_startproc
 2988              		@ args = 0, pretend = 0, frame = 0
 2989              		@ frame_needed = 0, uses_anonymous_args = 0
 964:app/toolhead.c ****     /* 处理前瞻队列 */
 965:app/toolhead.c ****     lookahead_process();
 2990              		.loc 1 965 5 view .LVU830
 963:app/toolhead.c ****     /* 处理前瞻队列 */
 2991              		.loc 1 963 1 is_stmt 0 view .LVU831
 2992 0000 70B5     		push	{r4, r5, r6, lr}
 2993              		.cfi_def_cfa_offset 16
 2994              		.cfi_offset 4, -16
 2995              		.cfi_offset 5, -12
 2996              		.cfi_offset 6, -8
ARM GAS  /tmp/ccLyNHPk.s 			page 81


 2997              		.cfi_offset 14, -4
 966:app/toolhead.c ****     
 967:app/toolhead.c ****     /* 刷新到 trapq */
 968:app/toolhead.c ****     lookahead_flush();
 969:app/toolhead.c ****     
 970:app/toolhead.c ****     /* 生成步进时序 */
 971:app/toolhead.c ****     generate_steps(s_print_time);
 2998              		.loc 1 971 5 view .LVU832
 2999 0002 184E     		ldr	r6, .L213
 3000 0004 184C     		ldr	r4, .L213+4
 963:app/toolhead.c ****     /* 处理前瞻队列 */
 3001              		.loc 1 963 1 view .LVU833
 3002 0006 2DED028B 		vpush.64	{d8}
 3003              		.cfi_def_cfa_offset 24
 3004              		.cfi_offset 80, -24
 3005              		.cfi_offset 81, -20
 965:app/toolhead.c ****     
 3006              		.loc 1 965 5 view .LVU834
 3007 000a FFF7FEFF 		bl	lookahead_process
 3008              	.LVL274:
 968:app/toolhead.c ****     
 3009              		.loc 1 968 5 is_stmt 1 view .LVU835
 3010 000e FFF7FEFF 		bl	lookahead_flush
 3011              	.LVL275:
 3012              		.loc 1 971 5 view .LVU836
 3013 0012 96ED008B 		vldr.64	d8, [r6]
 3014              	.LVL276:
 3015              	.LBB176:
 3016              	.LBI176:
 536:app/toolhead.c **** {
 3017              		.loc 1 536 1 view .LVU837
 3018              	.LBE176:
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 3019              		.loc 1 538 5 view .LVU838
 3020              	.LBB178:
 3021              	.LBB177:
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 3022              		.loc 1 538 10 view .LVU839
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 3023              		.loc 1 538 21 view .LVU840
 3024 0016 04F11005 		add	r5, r4, #16
 3025              	.LVL277:
 3026              	.L206:
 539:app/toolhead.c ****             itersolve_generate_steps(s_steppers[i], flush_time);
 3027              		.loc 1 539 9 view .LVU841
 540:app/toolhead.c ****         }
 3028              		.loc 1 540 13 view .LVU842
 539:app/toolhead.c ****             itersolve_generate_steps(s_steppers[i], flush_time);
 3029              		.loc 1 539 23 is_stmt 0 view .LVU843
 3030 001a 54F8040B 		ldr	r0, [r4], #4
 540:app/toolhead.c ****         }
 3031              		.loc 1 540 13 view .LVU844
 3032 001e B0EE480A 		vmov.f32	s0, s16
 3033 0022 F0EE680A 		vmov.f32	s1, s17
 539:app/toolhead.c ****             itersolve_generate_steps(s_steppers[i], flush_time);
 3034              		.loc 1 539 12 view .LVU845
 3035 0026 08B1     		cbz	r0, .L205
ARM GAS  /tmp/ccLyNHPk.s 			page 82


 3036              	.LVL278:
 540:app/toolhead.c ****         }
 3037              		.loc 1 540 13 view .LVU846
 3038 0028 FFF7FEFF 		bl	itersolve_generate_steps
 3039              	.LVL279:
 3040              	.L205:
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 3041              		.loc 1 538 35 is_stmt 1 view .LVU847
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 3042              		.loc 1 538 21 view .LVU848
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 3043              		.loc 1 538 5 is_stmt 0 view .LVU849
 3044 002c AC42     		cmp	r4, r5
 3045 002e F4D1     		bne	.L206
 3046              	.LVL280:
 538:app/toolhead.c ****         if (s_steppers[i] != NULL) {
 3047              		.loc 1 538 5 view .LVU850
 3048              	.LBE177:
 3049              	.LBE178:
 972:app/toolhead.c ****     
 973:app/toolhead.c ****     /* 清理历史运动 */
 974:app/toolhead.c ****     if (s_p_trapq != NULL) {
 3050              		.loc 1 974 5 is_stmt 1 view .LVU851
 3051              		.loc 1 974 19 is_stmt 0 view .LVU852
 3052 0030 0E4C     		ldr	r4, .L213+8
 3053 0032 2068     		ldr	r0, [r4]
 3054              		.loc 1 974 8 view .LVU853
 3055 0034 90B1     		cbz	r0, .L204
 975:app/toolhead.c ****         trapq_finalize_moves(s_p_trapq, s_print_time);
 3056              		.loc 1 975 9 is_stmt 1 view .LVU854
 3057 0036 96ED000B 		vldr.64	d0, [r6]
 3058 003a FFF7FEFF 		bl	trapq_finalize_moves
 3059              	.LVL281:
 976:app/toolhead.c ****         trapq_free_moves(s_p_trapq, s_print_time - 1.0);
 3060              		.loc 1 976 9 view .LVU855
 3061 003e D6E90001 		ldrd	r0, [r6]
 3062 0042 0B4B     		ldr	r3, .L213+12
 3063 0044 0022     		movs	r2, #0
 3064 0046 FFF7FEFF 		bl	__aeabi_dsub
 3065              	.LVL282:
 977:app/toolhead.c ****     }
 978:app/toolhead.c **** }
 3066              		.loc 1 978 1 is_stmt 0 view .LVU856
 3067 004a BDEC028B 		vldm	sp!, {d8}
 3068              		.cfi_remember_state
 3069              		.cfi_restore 80
 3070              		.cfi_restore 81
 3071              		.cfi_def_cfa_offset 16
 976:app/toolhead.c ****         trapq_free_moves(s_p_trapq, s_print_time - 1.0);
 3072              		.loc 1 976 9 view .LVU857
 3073 004e 41EC100B 		vmov	d0, r0, r1
 3074 0052 2068     		ldr	r0, [r4]
 3075              		.loc 1 978 1 view .LVU858
 3076 0054 BDE87040 		pop	{r4, r5, r6, lr}
 3077              		.cfi_restore 14
 3078              		.cfi_restore 6
 3079              		.cfi_restore 5
ARM GAS  /tmp/ccLyNHPk.s 			page 83


 3080              		.cfi_restore 4
 3081              		.cfi_def_cfa_offset 0
 976:app/toolhead.c ****         trapq_free_moves(s_p_trapq, s_print_time - 1.0);
 3082              		.loc 1 976 9 view .LVU859
 3083 0058 FFF7FEBF 		b	trapq_free_moves
 3084              	.LVL283:
 3085              	.L204:
 3086              		.cfi_restore_state
 3087              		.loc 1 978 1 view .LVU860
 3088 005c BDEC028B 		vldm	sp!, {d8}
 3089              		.cfi_restore 80
 3090              		.cfi_restore 81
 3091              		.cfi_def_cfa_offset 16
 3092 0060 70BD     		pop	{r4, r5, r6, pc}
 3093              	.L214:
 3094 0062 00BF     		.align	2
 3095              	.L213:
 3096 0064 00000000 		.word	.LANCHOR5
 3097 0068 00000000 		.word	.LANCHOR12
 3098 006c 00000000 		.word	.LANCHOR6
 3099 0070 0000F03F 		.word	1072693248
 3100              		.cfi_endproc
 3101              	.LFE24:
 3103              		.section	.text.toolhead_home,"ax",%progbits
 3104              		.align	1
 3105              		.p2align 2,,3
 3106              		.global	toolhead_home
 3107              		.syntax unified
 3108              		.thumb
 3109              		.thumb_func
 3110              		.fpu fpv4-sp-d16
 3112              	toolhead_home:
 3113              	.LVL284:
 3114              	.LFB22:
 777:app/toolhead.c ****     /* 等待当前运动完成 */
 3115              		.loc 1 777 1 is_stmt 1 view -0
 3116              		.cfi_startproc
 3117              		@ args = 0, pretend = 0, frame = 104
 3118              		@ frame_needed = 0, uses_anonymous_args = 0
 779:app/toolhead.c ****     
 3119              		.loc 1 779 5 view .LVU862
 777:app/toolhead.c ****     /* 等待当前运动完成 */
 3120              		.loc 1 777 1 is_stmt 0 view .LVU863
 3121 0000 2DE9F04F 		push	{r4, r5, r6, r7, r8, r9, r10, fp, lr}
 3122              		.cfi_def_cfa_offset 36
 3123              		.cfi_offset 4, -36
 3124              		.cfi_offset 5, -32
 3125              		.cfi_offset 6, -28
 3126              		.cfi_offset 7, -24
 3127              		.cfi_offset 8, -20
 3128              		.cfi_offset 9, -16
 3129              		.cfi_offset 10, -12
 3130              		.cfi_offset 11, -8
 3131              		.cfi_offset 14, -4
 3132 0004 0646     		mov	r6, r0
 3133 0006 9BB0     		sub	sp, sp, #108
 3134              		.cfi_def_cfa_offset 144
ARM GAS  /tmp/ccLyNHPk.s 			page 84


 779:app/toolhead.c ****     
 3135              		.loc 1 779 5 view .LVU864
 3136 0008 FFF7FEFF 		bl	toolhead_wait_moves
 3137              	.LVL285:
 782:app/toolhead.c ****         endstop_set_callback(ENDSTOP_X, home_endstop_callback, NULL);
 3138              		.loc 1 782 5 is_stmt 1 view .LVU865
 782:app/toolhead.c ****         endstop_set_callback(ENDSTOP_X, home_endstop_callback, NULL);
 3139              		.loc 1 782 8 is_stmt 0 view .LVU866
 3140 000c 16F00103 		ands	r3, r6, #1
 3141 0010 0093     		str	r3, [sp]
 3142 0012 40F02A81 		bne	.L314
 3143              	.L216:
 786:app/toolhead.c ****         endstop_set_callback(ENDSTOP_Y, home_endstop_callback, NULL);
 3144              		.loc 1 786 5 is_stmt 1 view .LVU867
 786:app/toolhead.c ****         endstop_set_callback(ENDSTOP_Y, home_endstop_callback, NULL);
 3145              		.loc 1 786 8 is_stmt 0 view .LVU868
 3146 0016 16F00205 		ands	r5, r6, #2
 3147 001a 40F01D81 		bne	.L315
 3148              	.L217:
 790:app/toolhead.c ****         endstop_set_callback(ENDSTOP_Z, home_endstop_callback, NULL);
 3149              		.loc 1 790 5 is_stmt 1 view .LVU869
 790:app/toolhead.c ****         endstop_set_callback(ENDSTOP_Z, home_endstop_callback, NULL);
 3150              		.loc 1 790 8 is_stmt 0 view .LVU870
 3151 001e 16F00403 		ands	r3, r6, #4
 3152 0022 0193     		str	r3, [sp, #4]
 3153 0024 40F00F81 		bne	.L316
 3154              	.L218:
 796:app/toolhead.c ****     s_home_ctx.axis_mask = axes_mask;
 3155              		.loc 1 796 5 is_stmt 1 view .LVU871
 796:app/toolhead.c ****     s_home_ctx.axis_mask = axes_mask;
 3156              		.loc 1 796 22 is_stmt 0 view .LVU872
 3157 0028 9D4C     		ldr	r4, .L327+8
 799:app/toolhead.c ****     
 3158              		.loc 1 799 27 view .LVU873
 3159 002a DFF890A2 		ldr	r10, .L327+36
 3160              	.LBB179:
 3161              	.LBB180:
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 3162              		.loc 1 216 21 view .LVU874
 3163 002e DFF890B2 		ldr	fp, .L327+40
 3164              	.LBE180:
 3165              	.LBE179:
 797:app/toolhead.c ****     s_home_ctx.triggered = 0;
 3166              		.loc 1 797 26 view .LVU875
 3167 0032 6670     		strb	r6, [r4, #1]
 798:app/toolhead.c ****     s_home_ctx.start_time = s_print_time;
 3168              		.loc 1 798 26 view .LVU876
 3169 0034 0023     		movs	r3, #0
 3170 0036 2374     		strb	r3, [r4, #16]
 796:app/toolhead.c ****     s_home_ctx.axis_mask = axes_mask;
 3171              		.loc 1 796 22 view .LVU877
 3172 0038 0123     		movs	r3, #1
 3173 003a 2370     		strb	r3, [r4]
 797:app/toolhead.c ****     s_home_ctx.triggered = 0;
 3174              		.loc 1 797 5 is_stmt 1 view .LVU878
 798:app/toolhead.c ****     s_home_ctx.start_time = s_print_time;
 3175              		.loc 1 798 5 view .LVU879
ARM GAS  /tmp/ccLyNHPk.s 			page 85


 799:app/toolhead.c ****     
 3176              		.loc 1 799 5 view .LVU880
 799:app/toolhead.c ****     
 3177              		.loc 1 799 27 is_stmt 0 view .LVU881
 3178 003c DAE90023 		ldrd	r2, [r10]
 3179 0040 C4E90223 		strd	r2, [r4, #8]
 802:app/toolhead.c ****     coord_copy(&home_target, &s_commanded_pos);
 3180              		.loc 1 802 5 is_stmt 1 view .LVU882
 803:app/toolhead.c ****     
 3181              		.loc 1 803 5 view .LVU883
 3182              	.LVL286:
 3183              	.LBB182:
 3184              	.LBI179:
 214:app/toolhead.c **** {
 3185              		.loc 1 214 1 view .LVU884
 3186              	.LBB181:
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 3187              		.loc 1 216 5 view .LVU885
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 3188              		.loc 1 216 14 is_stmt 0 view .LVU886
 3189 0044 DBE90023 		ldrd	r2, [fp]
 3190 0048 CDE90223 		strd	r2, [sp, #8]
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 3191              		.loc 1 217 5 is_stmt 1 view .LVU887
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 3192              		.loc 1 217 14 is_stmt 0 view .LVU888
 3193 004c DBE90223 		ldrd	r2, [fp, #8]
 3194 0050 CDE90423 		strd	r2, [sp, #16]
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 3195              		.loc 1 218 5 is_stmt 1 view .LVU889
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 3196              		.loc 1 218 14 is_stmt 0 view .LVU890
 3197 0054 DBE90423 		ldrd	r2, [fp, #16]
 3198 0058 CDE90623 		strd	r2, [sp, #24]
 219:app/toolhead.c **** }
 3199              		.loc 1 219 5 is_stmt 1 view .LVU891
 219:app/toolhead.c **** }
 3200              		.loc 1 219 14 is_stmt 0 view .LVU892
 3201 005c DBE90623 		ldrd	r2, [fp, #24]
 3202 0060 CDE90823 		strd	r2, [sp, #32]
 3203              	.LVL287:
 219:app/toolhead.c **** }
 3204              		.loc 1 219 14 view .LVU893
 3205              	.LBE181:
 3206              	.LBE182:
 806:app/toolhead.c ****         home_target.x = s_min_pos[0] - 10.0;  /* 超出限位一点 */
 3207              		.loc 1 806 5 is_stmt 1 view .LVU894
 806:app/toolhead.c ****         home_target.x = s_min_pos[0] - 10.0;  /* 超出限位一点 */
 3208              		.loc 1 806 8 is_stmt 0 view .LVU895
 3209 0064 009B     		ldr	r3, [sp]
 807:app/toolhead.c ****     }
 3210              		.loc 1 807 34 view .LVU896
 3211 0066 8F4E     		ldr	r6, .L327+12
 806:app/toolhead.c ****         home_target.x = s_min_pos[0] - 10.0;  /* 超出限位一点 */
 3212              		.loc 1 806 8 view .LVU897
 3213 0068 002B     		cmp	r3, #0
 3214 006a 40F0D280 		bne	.L219
ARM GAS  /tmp/ccLyNHPk.s 			page 86


 807:app/toolhead.c ****     }
 3215              		.loc 1 807 34 view .LVU898
 3216 006e D6E90089 		ldrd	r8, [r6]
 3217              	.L220:
 809:app/toolhead.c ****         home_target.y = s_min_pos[1] - 10.0;
 3218              		.loc 1 809 5 is_stmt 1 view .LVU899
 809:app/toolhead.c ****         home_target.y = s_min_pos[1] - 10.0;
 3219              		.loc 1 809 8 is_stmt 0 view .LVU900
 3220 0072 3DB1     		cbz	r5, .L221
 810:app/toolhead.c ****     }
 3221              		.loc 1 810 9 is_stmt 1 view .LVU901
 810:app/toolhead.c ****     }
 3222              		.loc 1 810 38 is_stmt 0 view .LVU902
 3223 0074 D6E90201 		ldrd	r0, [r6, #8]
 3224 0078 8B4B     		ldr	r3, .L327+16
 3225 007a 0022     		movs	r2, #0
 3226 007c FFF7FEFF 		bl	__aeabi_dsub
 3227              	.LVL288:
 810:app/toolhead.c ****     }
 3228              		.loc 1 810 23 view .LVU903
 3229 0080 CDE90401 		strd	r0, [sp, #16]
 3230              	.L221:
 812:app/toolhead.c ****         home_target.z = s_min_pos[2] - 10.0;
 3231              		.loc 1 812 5 is_stmt 1 view .LVU904
 812:app/toolhead.c ****         home_target.z = s_min_pos[2] - 10.0;
 3232              		.loc 1 812 8 is_stmt 0 view .LVU905
 3233 0084 019B     		ldr	r3, [sp, #4]
 3234 0086 3BB1     		cbz	r3, .L222
 813:app/toolhead.c ****     }
 3235              		.loc 1 813 9 is_stmt 1 view .LVU906
 813:app/toolhead.c ****     }
 3236              		.loc 1 813 38 is_stmt 0 view .LVU907
 3237 0088 D6E90401 		ldrd	r0, [r6, #16]
 3238 008c 864B     		ldr	r3, .L327+16
 3239 008e 0022     		movs	r2, #0
 3240 0090 FFF7FEFF 		bl	__aeabi_dsub
 3241              	.LVL289:
 813:app/toolhead.c ****     }
 3242              		.loc 1 813 23 view .LVU908
 3243 0094 CDE90601 		strd	r0, [sp, #24]
 3244              	.L222:
 3245              	.LBB183:
 820:app/toolhead.c ****     }
 3246              		.loc 1 820 22 discriminator 3 view .LVU909
 3247 0098 7FA1     		adr	r1, .L327
 3248 009a D1E90001 		ldrd	r0, [r1]
 3249 009e 834A     		ldr	r2, .L327+20
 3250 00a0 0AAB     		add	r3, sp, #40
 3251              	.L224:
 819:app/toolhead.c ****         s_min_pos[i] = -1e9;
 3252              		.loc 1 819 9 is_stmt 1 discriminator 3 view .LVU910
 819:app/toolhead.c ****         s_min_pos[i] = -1e9;
 3253              		.loc 1 819 22 is_stmt 0 discriminator 3 view .LVU911
 3254 00a2 E3E80289 		strd	r8, [r3], #8
 820:app/toolhead.c ****     }
 3255              		.loc 1 820 9 is_stmt 1 discriminator 3 view .LVU912
 818:app/toolhead.c ****         saved_min[i] = s_min_pos[i];
ARM GAS  /tmp/ccLyNHPk.s 			page 87


 3256              		.loc 1 818 5 is_stmt 0 discriminator 3 view .LVU913
 3257 00a6 12AE     		add	r6, sp, #72
 3258 00a8 9E42     		cmp	r6, r3
 820:app/toolhead.c ****     }
 3259              		.loc 1 820 22 discriminator 3 view .LVU914
 3260 00aa 42E90201 		strd	r0, [r2, #-8]
 818:app/toolhead.c ****         saved_min[i] = s_min_pos[i];
 3261              		.loc 1 818 35 is_stmt 1 discriminator 3 view .LVU915
 818:app/toolhead.c ****         saved_min[i] = s_min_pos[i];
 3262              		.loc 1 818 21 discriminator 3 view .LVU916
 818:app/toolhead.c ****         saved_min[i] = s_min_pos[i];
 3263              		.loc 1 818 5 is_stmt 0 discriminator 3 view .LVU917
 3264 00ae 02D0     		beq	.L223
 819:app/toolhead.c ****         s_min_pos[i] = -1e9;
 3265              		.loc 1 819 33 view .LVU918
 3266 00b0 F2E80289 		ldrd	r8, [r2], #8
 3267 00b4 F5E7     		b	.L224
 3268              	.L223:
 3269              	.LBE183:
 824:app/toolhead.c ****     
 3270              		.loc 1 824 5 is_stmt 1 view .LVU919
 3271 00b6 B3EE040A 		vmov.f32	s0, #2.0e+1
 3272 00ba 02A8     		add	r0, sp, #8
 3273 00bc FFF7FEFF 		bl	toolhead_move
 3274              	.LVL290:
 827:app/toolhead.c ****     
 3275              		.loc 1 827 5 view .LVU920
 3276 00c0 FFF7FEFF 		bl	toolhead_flush
 3277              	.LVL291:
 830:app/toolhead.c ****     while (!s_home_ctx.triggered && s_print_time < timeout_time) {
 3278              		.loc 1 830 5 view .LVU921
 830:app/toolhead.c ****     while (!s_home_ctx.triggered && s_print_time < timeout_time) {
 3279              		.loc 1 830 40 is_stmt 0 view .LVU922
 3280 00c4 DAE90067 		ldrd	r6, [r10]
 830:app/toolhead.c ****     while (!s_home_ctx.triggered && s_print_time < timeout_time) {
 3281              		.loc 1 830 12 view .LVU923
 3282 00c8 794B     		ldr	r3, .L327+24
 3283 00ca 0022     		movs	r2, #0
 3284 00cc 3046     		mov	r0, r6
 3285 00ce 3946     		mov	r1, r7
 3286 00d0 FFF7FEFF 		bl	__aeabi_dadd
 3287              	.LVL292:
 831:app/toolhead.c ****         /* 在实际硬件上，这里会等待中断 */
 3288              		.loc 1 831 11 view .LVU924
 3289 00d4 237C     		ldrb	r3, [r4, #16]	@ zero_extendqisi2
 830:app/toolhead.c ****     while (!s_home_ctx.triggered && s_print_time < timeout_time) {
 3290              		.loc 1 830 12 view .LVU925
 3291 00d6 8046     		mov	r8, r0
 3292 00d8 8946     		mov	r9, r1
 3293              	.LVL293:
 831:app/toolhead.c ****         /* 在实际硬件上，这里会等待中断 */
 3294              		.loc 1 831 5 is_stmt 1 view .LVU926
 831:app/toolhead.c ****         /* 在实际硬件上，这里会等待中断 */
 3295              		.loc 1 831 11 view .LVU927
 3296 00da EBB9     		cbnz	r3, .L237
 831:app/toolhead.c ****         /* 在实际硬件上，这里会等待中断 */
 3297              		.loc 1 831 34 is_stmt 0 discriminator 1 view .LVU928
ARM GAS  /tmp/ccLyNHPk.s 			page 88


 3298 00dc 3246     		mov	r2, r6
 3299 00de 3B46     		mov	r3, r7
 3300 00e0 4046     		mov	r0, r8
 3301 00e2 4946     		mov	r1, r9
 3302 00e4 FFF7FEFF 		bl	__aeabi_dcmpgt
 3303              	.LVL294:
 3304 00e8 B0B1     		cbz	r0, .L237
 3305              	.L238:
 834:app/toolhead.c ****             if (endstop_is_triggered(ENDSTOP_X)) {
 3306              		.loc 1 834 9 is_stmt 1 view .LVU929
 834:app/toolhead.c ****             if (endstop_is_triggered(ENDSTOP_X)) {
 3307              		.loc 1 834 12 is_stmt 0 view .LVU930
 3308 00ea 009B     		ldr	r3, [sp]
 3309 00ec 002B     		cmp	r3, #0
 3310 00ee 70D1     		bne	.L317
 3311              	.L229:
 839:app/toolhead.c ****             if (endstop_is_triggered(ENDSTOP_Y)) {
 3312              		.loc 1 839 9 is_stmt 1 view .LVU931
 839:app/toolhead.c ****             if (endstop_is_triggered(ENDSTOP_Y)) {
 3313              		.loc 1 839 12 is_stmt 0 view .LVU932
 3314 00f0 002D     		cmp	r5, #0
 3315 00f2 78D1     		bne	.L318
 3316              	.L232:
 844:app/toolhead.c ****             if (endstop_is_triggered(ENDSTOP_Z)) {
 3317              		.loc 1 844 9 is_stmt 1 view .LVU933
 844:app/toolhead.c ****             if (endstop_is_triggered(ENDSTOP_Z)) {
 3318              		.loc 1 844 12 is_stmt 0 view .LVU934
 3319 00f4 019B     		ldr	r3, [sp, #4]
 3320 00f6 002B     		cmp	r3, #0
 3321 00f8 40F08180 		bne	.L319
 3322              	.L235:
 851:app/toolhead.c ****     }
 3323              		.loc 1 851 9 is_stmt 1 view .LVU935
 3324 00fc FFF7FEFF 		bl	sched_main
 3325              	.LVL295:
 831:app/toolhead.c ****         /* 在实际硬件上，这里会等待中断 */
 3326              		.loc 1 831 11 view .LVU936
 3327 0100 237C     		ldrb	r3, [r4, #16]	@ zero_extendqisi2
 3328 0102 4BB9     		cbnz	r3, .L237
 831:app/toolhead.c ****         /* 在实际硬件上，这里会等待中断 */
 3329              		.loc 1 831 50 is_stmt 0 view .LVU937
 3330 0104 DAE90067 		ldrd	r6, [r10]
 831:app/toolhead.c ****         /* 在实际硬件上，这里会等待中断 */
 3331              		.loc 1 831 34 view .LVU938
 3332 0108 4046     		mov	r0, r8
 3333 010a 3246     		mov	r2, r6
 3334 010c 3B46     		mov	r3, r7
 3335 010e 4946     		mov	r1, r9
 3336 0110 FFF7FEFF 		bl	__aeabi_dcmpgt
 3337              	.LVL296:
 3338 0114 0028     		cmp	r0, #0
 3339 0116 E8D1     		bne	.L238
 3340              	.L237:
 855:app/toolhead.c ****     
 3341              		.loc 1 855 5 is_stmt 1 view .LVU939
 3342              	.LBB184:
 859:app/toolhead.c ****     }
ARM GAS  /tmp/ccLyNHPk.s 			page 89


 3343              		.loc 1 859 22 is_stmt 0 view .LVU940
 3344 0118 0AAF     		add	r7, sp, #40
 3345              	.LBE184:
 855:app/toolhead.c ****     
 3346              		.loc 1 855 5 view .LVU941
 3347 011a FFF7FEFF 		bl	stepper_stop_all
 3348              	.LVL297:
 858:app/toolhead.c ****         s_min_pos[i] = saved_min[i];
 3349              		.loc 1 858 5 is_stmt 1 view .LVU942
 3350              	.LBB185:
 858:app/toolhead.c ****         s_min_pos[i] = saved_min[i];
 3351              		.loc 1 858 10 view .LVU943
 858:app/toolhead.c ****         s_min_pos[i] = saved_min[i];
 3352              		.loc 1 858 21 view .LVU944
 859:app/toolhead.c ****     }
 3353              		.loc 1 859 22 is_stmt 0 view .LVU945
 3354 011e 0FCF     		ldmia	r7!, {r0, r1, r2, r3}
 3355 0120 604E     		ldr	r6, .L327+12
 3356              	.LBE185:
 863:app/toolhead.c ****         s_home_ctx.state = HOME_STATE_ERROR;
 3357              		.loc 1 863 8 view .LVU946
 3358 0122 94F810C0 		ldrb	ip, [r4, #16]	@ zero_extendqisi2
 3359              	.LBB186:
 859:app/toolhead.c ****     }
 3360              		.loc 1 859 22 view .LVU947
 3361 0126 0FC6     		stmia	r6!, {r0, r1, r2, r3}
 3362 0128 97E80F00 		ldm	r7, {r0, r1, r2, r3}
 3363 012c 86E80F00 		stm	r6, {r0, r1, r2, r3}
 3364              	.LVL298:
 859:app/toolhead.c ****     }
 3365              		.loc 1 859 22 view .LVU948
 3366              	.LBE186:
 863:app/toolhead.c ****         s_home_ctx.state = HOME_STATE_ERROR;
 3367              		.loc 1 863 5 is_stmt 1 view .LVU949
 863:app/toolhead.c ****         s_home_ctx.state = HOME_STATE_ERROR;
 3368              		.loc 1 863 8 is_stmt 0 view .LVU950
 3369 0130 BCF1000F 		cmp	ip, #0
 3370 0134 00F0A280 		beq	.L320
 881:app/toolhead.c ****     s_home_ctx.triggered = 0;
 3371              		.loc 1 881 5 is_stmt 1 view .LVU951
 881:app/toolhead.c ****     s_home_ctx.triggered = 0;
 3372              		.loc 1 881 22 is_stmt 0 view .LVU952
 3373 0138 0223     		movs	r3, #2
 3374 013a 2370     		strb	r3, [r4]
 882:app/toolhead.c ****     
 3375              		.loc 1 882 5 is_stmt 1 view .LVU953
 882:app/toolhead.c ****     
 3376              		.loc 1 882 26 is_stmt 0 view .LVU954
 3377 013c 0023     		movs	r3, #0
 3378 013e 2374     		strb	r3, [r4, #16]
 884:app/toolhead.c ****     coord_copy(&retract_target, &s_commanded_pos);
 3379              		.loc 1 884 5 is_stmt 1 view .LVU955
 885:app/toolhead.c ****     
 3380              		.loc 1 885 5 view .LVU956
 3381              	.LVL299:
 3382              	.LBB187:
 3383              	.LBI187:
ARM GAS  /tmp/ccLyNHPk.s 			page 90


 214:app/toolhead.c **** {
 3384              		.loc 1 214 1 view .LVU957
 3385              	.LBB188:
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 3386              		.loc 1 216 5 view .LVU958
 216:app/toolhead.c ****     p_dst->y = p_src->y;
 3387              		.loc 1 216 14 is_stmt 0 view .LVU959
 3388 0140 DBE90023 		ldrd	r2, [fp]
 3389 0144 CDE91223 		strd	r2, [sp, #72]
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 3390              		.loc 1 217 5 is_stmt 1 view .LVU960
 217:app/toolhead.c ****     p_dst->z = p_src->z;
 3391              		.loc 1 217 14 is_stmt 0 view .LVU961
 3392 0148 DBE90223 		ldrd	r2, [fp, #8]
 3393 014c CDE91423 		strd	r2, [sp, #80]
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 3394              		.loc 1 218 5 is_stmt 1 view .LVU962
 218:app/toolhead.c ****     p_dst->e = p_src->e;
 3395              		.loc 1 218 14 is_stmt 0 view .LVU963
 3396 0150 DBE90423 		ldrd	r2, [fp, #16]
 3397 0154 CDE91623 		strd	r2, [sp, #88]
 219:app/toolhead.c **** }
 3398              		.loc 1 219 5 is_stmt 1 view .LVU964
 219:app/toolhead.c **** }
 3399              		.loc 1 219 14 is_stmt 0 view .LVU965
 3400 0158 DBE90623 		ldrd	r2, [fp, #24]
 3401 015c CDE91823 		strd	r2, [sp, #96]
 3402              	.LVL300:
 219:app/toolhead.c **** }
 3403              		.loc 1 219 14 view .LVU966
 3404              	.LBE188:
 3405              	.LBE187:
 887:app/toolhead.c ****         retract_target.x = HOMING_RETRACT;
 3406              		.loc 1 887 5 is_stmt 1 view .LVU967
 887:app/toolhead.c ****         retract_target.x = HOMING_RETRACT;
 3407              		.loc 1 887 8 is_stmt 0 view .LVU968
 3408 0160 009B     		ldr	r3, [sp]
 3409 0162 1BB1     		cbz	r3, .L242
 888:app/toolhead.c ****     }
 3410              		.loc 1 888 9 is_stmt 1 view .LVU969
 888:app/toolhead.c ****     }
 3411              		.loc 1 888 26 is_stmt 0 view .LVU970
 3412 0164 534B     		ldr	r3, .L327+28
 3413 0166 0022     		movs	r2, #0
 3414 0168 CDE91223 		strd	r2, [sp, #72]
 3415              	.L242:
 890:app/toolhead.c ****         retract_target.y = HOMING_RETRACT;
 3416              		.loc 1 890 5 is_stmt 1 view .LVU971
 890:app/toolhead.c ****         retract_target.y = HOMING_RETRACT;
 3417              		.loc 1 890 8 is_stmt 0 view .LVU972
 3418 016c 1DB1     		cbz	r5, .L243
 891:app/toolhead.c ****     }
 3419              		.loc 1 891 9 is_stmt 1 view .LVU973
 891:app/toolhead.c ****     }
 3420              		.loc 1 891 26 is_stmt 0 view .LVU974
 3421 016e 514B     		ldr	r3, .L327+28
 3422 0170 0022     		movs	r2, #0
ARM GAS  /tmp/ccLyNHPk.s 			page 91


 3423 0172 CDE91423 		strd	r2, [sp, #80]
 3424              	.L243:
 893:app/toolhead.c ****         retract_target.z = HOMING_RETRACT;
 3425              		.loc 1 893 5 is_stmt 1 view .LVU975
 893:app/toolhead.c ****         retract_target.z = HOMING_RETRACT;
 3426              		.loc 1 893 8 is_stmt 0 view .LVU976
 3427 0176 019B     		ldr	r3, [sp, #4]
 3428 0178 1BB1     		cbz	r3, .L244
 894:app/toolhead.c ****     }
 3429              		.loc 1 894 9 is_stmt 1 view .LVU977
 894:app/toolhead.c ****     }
 3430              		.loc 1 894 26 is_stmt 0 view .LVU978
 3431 017a 4E4B     		ldr	r3, .L327+28
 3432 017c 0022     		movs	r2, #0
 3433 017e CDE91623 		strd	r2, [sp, #88]
 3434              	.L244:
 898:app/toolhead.c ****     coord_clear(&zero_pos);
 3435              		.loc 1 898 5 is_stmt 1 view .LVU979
 899:app/toolhead.c ****     if (axes_mask & AXIS_X_MASK) {
 3436              		.loc 1 899 5 view .LVU980
 3437              	.LVL301:
 204:app/toolhead.c ****     p_pos->y = 0.0;
 3438              		.loc 1 204 5 view .LVU981
 205:app/toolhead.c ****     p_pos->z = 0.0;
 3439              		.loc 1 205 5 view .LVU982
 206:app/toolhead.c ****     p_pos->e = 0.0;
 3440              		.loc 1 206 5 view .LVU983
 207:app/toolhead.c **** }
 3441              		.loc 1 207 5 view .LVU984
 900:app/toolhead.c ****         s_commanded_pos.x = 0.0;
 3442              		.loc 1 900 5 view .LVU985
 900:app/toolhead.c ****         s_commanded_pos.x = 0.0;
 3443              		.loc 1 900 8 is_stmt 0 view .LVU986
 3444 0182 009B     		ldr	r3, [sp]
 3445 0184 1BB1     		cbz	r3, .L245
 901:app/toolhead.c ****         s_current_pos.x = 0.0;
 3446              		.loc 1 901 9 is_stmt 1 view .LVU987
 901:app/toolhead.c ****         s_current_pos.x = 0.0;
 3447              		.loc 1 901 27 is_stmt 0 view .LVU988
 3448 0186 0022     		movs	r2, #0
 3449 0188 0023     		movs	r3, #0
 3450 018a CBE90023 		strd	r2, [fp]
 902:app/toolhead.c ****     }
 3451              		.loc 1 902 9 is_stmt 1 view .LVU989
 3452              	.L245:
 904:app/toolhead.c ****         s_commanded_pos.y = 0.0;
 3453              		.loc 1 904 5 view .LVU990
 904:app/toolhead.c ****         s_commanded_pos.y = 0.0;
 3454              		.loc 1 904 8 is_stmt 0 view .LVU991
 3455 018e 1DB1     		cbz	r5, .L246
 905:app/toolhead.c ****         s_current_pos.y = 0.0;
 3456              		.loc 1 905 9 is_stmt 1 view .LVU992
 905:app/toolhead.c ****         s_current_pos.y = 0.0;
 3457              		.loc 1 905 27 is_stmt 0 view .LVU993
 3458 0190 0022     		movs	r2, #0
 3459 0192 0023     		movs	r3, #0
 3460 0194 CBE90223 		strd	r2, [fp, #8]
ARM GAS  /tmp/ccLyNHPk.s 			page 92


 906:app/toolhead.c ****     }
 3461              		.loc 1 906 9 is_stmt 1 view .LVU994
 3462              	.L246:
 908:app/toolhead.c ****         s_commanded_pos.z = 0.0;
 3463              		.loc 1 908 5 view .LVU995
 908:app/toolhead.c ****         s_commanded_pos.z = 0.0;
 3464              		.loc 1 908 8 is_stmt 0 view .LVU996
 3465 0198 019B     		ldr	r3, [sp, #4]
 3466 019a 1BB1     		cbz	r3, .L247
 909:app/toolhead.c ****         s_current_pos.z = 0.0;
 3467              		.loc 1 909 9 is_stmt 1 view .LVU997
 909:app/toolhead.c ****         s_current_pos.z = 0.0;
 3468              		.loc 1 909 27 is_stmt 0 view .LVU998
 3469 019c 0022     		movs	r2, #0
 3470 019e 0023     		movs	r3, #0
 3471 01a0 CBE90423 		strd	r2, [fp, #16]
 910:app/toolhead.c ****     }
 3472              		.loc 1 910 9 is_stmt 1 view .LVU999
 3473              	.L247:
 914:app/toolhead.c ****     toolhead_flush();
 3474              		.loc 1 914 5 view .LVU1000
 3475 01a4 B2EE040A 		vmov.f32	s0, #1.0e+1
 3476 01a8 12A8     		add	r0, sp, #72
 3477 01aa FFF7FEFF 		bl	toolhead_move
 3478              	.LVL302:
 915:app/toolhead.c ****     toolhead_wait_moves();
 3479              		.loc 1 915 5 view .LVU1001
 3480 01ae FFF7FEFF 		bl	toolhead_flush
 3481              	.LVL303:
 916:app/toolhead.c ****     
 3482              		.loc 1 916 5 view .LVU1002
 3483 01b2 FFF7FEFF 		bl	toolhead_wait_moves
 3484              	.LVL304:
 919:app/toolhead.c ****         endstop_home_end(ENDSTOP_X);
 3485              		.loc 1 919 5 view .LVU1003
 919:app/toolhead.c ****         endstop_home_end(ENDSTOP_X);
 3486              		.loc 1 919 8 is_stmt 0 view .LVU1004
 3487 01b6 009B     		ldr	r3, [sp]
 3488 01b8 002B     		cmp	r3, #0
 3489 01ba 35D1     		bne	.L321
 922:app/toolhead.c ****         endstop_home_end(ENDSTOP_Y);
 3490              		.loc 1 922 5 is_stmt 1 view .LVU1005
 922:app/toolhead.c ****         endstop_home_end(ENDSTOP_Y);
 3491              		.loc 1 922 8 is_stmt 0 view .LVU1006
 3492 01bc 002D     		cmp	r5, #0
 3493 01be 38D1     		bne	.L322
 3494              	.L249:
 925:app/toolhead.c ****         endstop_home_end(ENDSTOP_Z);
 3495              		.loc 1 925 5 is_stmt 1 view .LVU1007
 925:app/toolhead.c ****         endstop_home_end(ENDSTOP_Z);
 3496              		.loc 1 925 8 is_stmt 0 view .LVU1008
 3497 01c0 019B     		ldr	r3, [sp, #4]
 3498 01c2 002B     		cmp	r3, #0
 3499 01c4 3BD1     		bne	.L323
 3500              	.L250:
 929:app/toolhead.c ****     
 3501              		.loc 1 929 5 is_stmt 1 view .LVU1009
ARM GAS  /tmp/ccLyNHPk.s 			page 93


 929:app/toolhead.c ****     
 3502              		.loc 1 929 22 is_stmt 0 view .LVU1010
 3503 01c6 0423     		movs	r3, #4
 3504 01c8 2370     		strb	r3, [r4]
 931:app/toolhead.c **** }
 3505              		.loc 1 931 5 is_stmt 1 view .LVU1011
 931:app/toolhead.c **** }
 3506              		.loc 1 931 12 is_stmt 0 view .LVU1012
 3507 01ca 0020     		movs	r0, #0
 3508              	.LVL305:
 3509              	.L215:
 932:app/toolhead.c **** 
 3510              		.loc 1 932 1 view .LVU1013
 3511 01cc 1BB0     		add	sp, sp, #108
 3512              		.cfi_remember_state
 3513              		.cfi_def_cfa_offset 36
 3514              		@ sp needed
 3515 01ce BDE8F08F 		pop	{r4, r5, r6, r7, r8, r9, r10, fp, pc}
 3516              	.LVL306:
 3517              	.L317:
 3518              		.cfi_restore_state
 835:app/toolhead.c ****                 s_home_ctx.triggered = 1;
 3519              		.loc 1 835 13 is_stmt 1 view .LVU1014
 835:app/toolhead.c ****                 s_home_ctx.triggered = 1;
 3520              		.loc 1 835 17 is_stmt 0 view .LVU1015
 3521 01d2 0020     		movs	r0, #0
 3522 01d4 FFF7FEFF 		bl	endstop_is_triggered
 3523              	.LVL307:
 835:app/toolhead.c ****                 s_home_ctx.triggered = 1;
 3524              		.loc 1 835 16 view .LVU1016
 3525 01d8 0028     		cmp	r0, #0
 3526 01da 89D0     		beq	.L229
 836:app/toolhead.c ****             }
 3527              		.loc 1 836 17 is_stmt 1 view .LVU1017
 836:app/toolhead.c ****             }
 3528              		.loc 1 836 38 is_stmt 0 view .LVU1018
 3529 01dc 4FF00103 		mov	r3, #1
 3530 01e0 2374     		strb	r3, [r4, #16]
 839:app/toolhead.c ****             if (endstop_is_triggered(ENDSTOP_Y)) {
 3531              		.loc 1 839 9 is_stmt 1 view .LVU1019
 839:app/toolhead.c ****             if (endstop_is_triggered(ENDSTOP_Y)) {
 3532              		.loc 1 839 12 is_stmt 0 view .LVU1020
 3533 01e2 002D     		cmp	r5, #0
 3534 01e4 86D0     		beq	.L232
 3535              	.L318:
 840:app/toolhead.c ****                 s_home_ctx.triggered = 1;
 3536              		.loc 1 840 13 is_stmt 1 view .LVU1021
 840:app/toolhead.c ****                 s_home_ctx.triggered = 1;
 3537              		.loc 1 840 17 is_stmt 0 view .LVU1022
 3538 01e6 0120     		movs	r0, #1
 3539 01e8 FFF7FEFF 		bl	endstop_is_triggered
 3540              	.LVL308:
 840:app/toolhead.c ****                 s_home_ctx.triggered = 1;
 3541              		.loc 1 840 16 view .LVU1023
 3542 01ec 0028     		cmp	r0, #0
 3543 01ee 81D0     		beq	.L232
 841:app/toolhead.c ****             }
ARM GAS  /tmp/ccLyNHPk.s 			page 94


 3544              		.loc 1 841 17 is_stmt 1 view .LVU1024
 841:app/toolhead.c ****             }
 3545              		.loc 1 841 38 is_stmt 0 view .LVU1025
 3546 01f0 4FF00103 		mov	r3, #1
 3547 01f4 2374     		strb	r3, [r4, #16]
 844:app/toolhead.c ****             if (endstop_is_triggered(ENDSTOP_Z)) {
 3548              		.loc 1 844 9 is_stmt 1 view .LVU1026
 844:app/toolhead.c ****             if (endstop_is_triggered(ENDSTOP_Z)) {
 3549              		.loc 1 844 12 is_stmt 0 view .LVU1027
 3550 01f6 019B     		ldr	r3, [sp, #4]
 3551 01f8 002B     		cmp	r3, #0
 3552 01fa 3FF47FAF 		beq	.L235
 3553              	.L319:
 845:app/toolhead.c ****                 s_home_ctx.triggered = 1;
 3554              		.loc 1 845 13 is_stmt 1 view .LVU1028
 845:app/toolhead.c ****                 s_home_ctx.triggered = 1;
 3555              		.loc 1 845 17 is_stmt 0 view .LVU1029
 3556 01fe 0220     		movs	r0, #2
 3557 0200 FFF7FEFF 		bl	endstop_is_triggered
 3558              	.LVL309:
 845:app/toolhead.c ****                 s_home_ctx.triggered = 1;
 3559              		.loc 1 845 16 view .LVU1030
 3560 0204 0028     		cmp	r0, #0
 3561 0206 3FF479AF 		beq	.L235
 846:app/toolhead.c ****             }
 3562              		.loc 1 846 17 is_stmt 1 view .LVU1031
 846:app/toolhead.c ****             }
 3563              		.loc 1 846 38 is_stmt 0 view .LVU1032
 3564 020a 4FF00103 		mov	r3, #1
 3565 020e 2374     		strb	r3, [r4, #16]
 3566 0210 74E7     		b	.L235
 3567              	.LVL310:
 3568              	.L219:
 807:app/toolhead.c ****     }
 3569              		.loc 1 807 9 is_stmt 1 view .LVU1033
 807:app/toolhead.c ****     }
 3570              		.loc 1 807 34 is_stmt 0 view .LVU1034
 3571 0212 D6E90089 		ldrd	r8, [r6]
 807:app/toolhead.c ****     }
 3572              		.loc 1 807 38 view .LVU1035
 3573 0216 244B     		ldr	r3, .L327+16
 3574 0218 0022     		movs	r2, #0
 3575 021a 4046     		mov	r0, r8
 3576 021c 4946     		mov	r1, r9
 3577 021e FFF7FEFF 		bl	__aeabi_dsub
 3578              	.LVL311:
 807:app/toolhead.c ****     }
 3579              		.loc 1 807 23 view .LVU1036
 3580 0222 CDE90201 		strd	r0, [sp, #8]
 3581 0226 24E7     		b	.L220
 3582              	.LVL312:
 3583              	.L321:
 920:app/toolhead.c ****     }
 3584              		.loc 1 920 9 is_stmt 1 view .LVU1037
 3585 0228 0020     		movs	r0, #0
 3586 022a FFF7FEFF 		bl	endstop_home_end
 3587              	.LVL313:
ARM GAS  /tmp/ccLyNHPk.s 			page 95


 922:app/toolhead.c ****         endstop_home_end(ENDSTOP_Y);
 3588              		.loc 1 922 5 view .LVU1038
 922:app/toolhead.c ****         endstop_home_end(ENDSTOP_Y);
 3589              		.loc 1 922 8 is_stmt 0 view .LVU1039
 3590 022e 002D     		cmp	r5, #0
 3591 0230 C6D0     		beq	.L249
 3592              	.L322:
 923:app/toolhead.c ****     }
 3593              		.loc 1 923 9 is_stmt 1 view .LVU1040
 3594 0232 0120     		movs	r0, #1
 3595 0234 FFF7FEFF 		bl	endstop_home_end
 3596              	.LVL314:
 925:app/toolhead.c ****         endstop_home_end(ENDSTOP_Z);
 3597              		.loc 1 925 5 view .LVU1041
 925:app/toolhead.c ****         endstop_home_end(ENDSTOP_Z);
 3598              		.loc 1 925 8 is_stmt 0 view .LVU1042
 3599 0238 019B     		ldr	r3, [sp, #4]
 3600 023a 002B     		cmp	r3, #0
 3601 023c C3D0     		beq	.L250
 3602              	.L323:
 926:app/toolhead.c ****     }
 3603              		.loc 1 926 9 is_stmt 1 view .LVU1043
 3604 023e 0220     		movs	r0, #2
 3605 0240 FFF7FEFF 		bl	endstop_home_end
 3606              	.LVL315:
 3607 0244 BFE7     		b	.L250
 3608              	.LVL316:
 3609              	.L316:
 791:app/toolhead.c ****         endstop_home_start(ENDSTOP_Z);
 3610              		.loc 1 791 9 view .LVU1044
 3611 0246 1C49     		ldr	r1, .L327+32
 3612 0248 0022     		movs	r2, #0
 3613 024a 0220     		movs	r0, #2
 3614 024c FFF7FEFF 		bl	endstop_set_callback
 3615              	.LVL317:
 792:app/toolhead.c ****     }
 3616              		.loc 1 792 9 view .LVU1045
 3617 0250 0220     		movs	r0, #2
 3618 0252 FFF7FEFF 		bl	endstop_home_start
 3619              	.LVL318:
 3620 0256 E7E6     		b	.L218
 3621              	.L315:
 787:app/toolhead.c ****         endstop_home_start(ENDSTOP_Y);
 3622              		.loc 1 787 9 view .LVU1046
 3623 0258 1749     		ldr	r1, .L327+32
 3624 025a 0120     		movs	r0, #1
 3625 025c 0022     		movs	r2, #0
 3626 025e FFF7FEFF 		bl	endstop_set_callback
 3627              	.LVL319:
 788:app/toolhead.c ****     }
 3628              		.loc 1 788 9 view .LVU1047
 3629 0262 0120     		movs	r0, #1
 3630 0264 FFF7FEFF 		bl	endstop_home_start
 3631              	.LVL320:
 3632 0268 D9E6     		b	.L217
 3633              	.L314:
 783:app/toolhead.c ****         endstop_home_start(ENDSTOP_X);
ARM GAS  /tmp/ccLyNHPk.s 			page 96


 3634              		.loc 1 783 9 view .LVU1048
 3635 026a 0022     		movs	r2, #0
 3636 026c 1046     		mov	r0, r2
 3637 026e 1249     		ldr	r1, .L327+32
 3638 0270 FFF7FEFF 		bl	endstop_set_callback
 3639              	.LVL321:
 784:app/toolhead.c ****     }
 3640              		.loc 1 784 9 view .LVU1049
 3641 0274 0020     		movs	r0, #0
 3642 0276 FFF7FEFF 		bl	endstop_home_start
 3643              	.LVL322:
 3644 027a CCE6     		b	.L216
 3645              	.LVL323:
 3646              	.L320:
 864:app/toolhead.c ****         
 3647              		.loc 1 864 9 view .LVU1050
 864:app/toolhead.c ****         
 3648              		.loc 1 864 26 is_stmt 0 view .LVU1051
 3649 027c 0523     		movs	r3, #5
 3650 027e 2370     		strb	r3, [r4]
 867:app/toolhead.c ****             endstop_home_end(ENDSTOP_X);
 3651              		.loc 1 867 9 is_stmt 1 view .LVU1052
 867:app/toolhead.c ****             endstop_home_end(ENDSTOP_X);
 3652              		.loc 1 867 12 is_stmt 0 view .LVU1053
 3653 0280 009B     		ldr	r3, [sp]
 3654 0282 2BB9     		cbnz	r3, .L324
 3655              	.L239:
 870:app/toolhead.c ****             endstop_home_end(ENDSTOP_Y);
 3656              		.loc 1 870 9 is_stmt 1 view .LVU1054
 870:app/toolhead.c ****             endstop_home_end(ENDSTOP_Y);
 3657              		.loc 1 870 12 is_stmt 0 view .LVU1055
 3658 0284 25BB     		cbnz	r5, .L325
 3659              	.L240:
 873:app/toolhead.c ****             endstop_home_end(ENDSTOP_Z);
 3660              		.loc 1 873 9 is_stmt 1 view .LVU1056
 873:app/toolhead.c ****             endstop_home_end(ENDSTOP_Z);
 3661              		.loc 1 873 12 is_stmt 0 view .LVU1057
 3662 0286 019B     		ldr	r3, [sp, #4]
 3663 0288 E3B9     		cbnz	r3, .L326
 877:app/toolhead.c ****     }
 3664              		.loc 1 877 16 view .LVU1058
 3665 028a 6FF00400 		mvn	r0, #4
 3666 028e 9DE7     		b	.L215
 3667              	.L324:
 868:app/toolhead.c ****         }
 3668              		.loc 1 868 13 is_stmt 1 view .LVU1059
 3669 0290 6046     		mov	r0, ip
 3670 0292 FFF7FEFF 		bl	endstop_home_end
 3671              	.LVL324:
 3672 0296 F5E7     		b	.L239
 3673              	.L328:
 3674              		.align	3
 3675              	.L327:
 3676 0298 00000000 		.word	0
 3677 029c 65CDCDC1 		.word	-1043477147
 3678 02a0 00000000 		.word	.LANCHOR7
 3679 02a4 00000000 		.word	.LANCHOR9
ARM GAS  /tmp/ccLyNHPk.s 			page 97


 3680 02a8 00002440 		.word	1076101120
 3681 02ac 08000000 		.word	.LANCHOR9+8
 3682 02b0 00003E40 		.word	1077805056
 3683 02b4 00001440 		.word	1075052544
 3684 02b8 00000000 		.word	home_endstop_callback
 3685 02bc 00000000 		.word	.LANCHOR5
 3686 02c0 00000000 		.word	.LANCHOR13
 3687              	.L326:
 874:app/toolhead.c ****         }
 3688              		.loc 1 874 13 view .LVU1060
 3689 02c4 0220     		movs	r0, #2
 3690 02c6 FFF7FEFF 		bl	endstop_home_end
 3691              	.LVL325:
 877:app/toolhead.c ****     }
 3692              		.loc 1 877 16 is_stmt 0 view .LVU1061
 3693 02ca 6FF00400 		mvn	r0, #4
 3694 02ce 7DE7     		b	.L215
 3695              	.L325:
 871:app/toolhead.c ****         }
 3696              		.loc 1 871 13 is_stmt 1 view .LVU1062
 3697 02d0 0120     		movs	r0, #1
 3698 02d2 FFF7FEFF 		bl	endstop_home_end
 3699              	.LVL326:
 3700 02d6 D6E7     		b	.L240
 3701              		.cfi_endproc
 3702              	.LFE22:
 3704              		.section	.text.toolhead_has_moves,"ax",%progbits
 3705              		.align	1
 3706              		.p2align 2,,3
 3707              		.global	toolhead_has_moves
 3708              		.syntax unified
 3709              		.thumb
 3710              		.thumb_func
 3711              		.fpu fpv4-sp-d16
 3713              	toolhead_has_moves:
 3714              	.LFB25:
 979:app/toolhead.c **** 
 980:app/toolhead.c **** int
 981:app/toolhead.c **** toolhead_has_moves(void)
 982:app/toolhead.c **** {
 3715              		.loc 1 982 1 view -0
 3716              		.cfi_startproc
 3717              		@ args = 0, pretend = 0, frame = 0
 3718              		@ frame_needed = 0, uses_anonymous_args = 0
 983:app/toolhead.c ****     /* 检查前瞻队列 */
 984:app/toolhead.c ****     if (s_lookahead_count > 0) {
 3719              		.loc 1 984 5 view .LVU1064
 982:app/toolhead.c ****     /* 检查前瞻队列 */
 3720              		.loc 1 982 1 is_stmt 0 view .LVU1065
 3721 0000 08B5     		push	{r3, lr}
 3722              		.cfi_def_cfa_offset 8
 3723              		.cfi_offset 3, -8
 3724              		.cfi_offset 14, -4
 3725              		.loc 1 984 27 view .LVU1066
 3726 0002 074B     		ldr	r3, .L334
 3727              		.loc 1 984 8 view .LVU1067
 3728 0004 1B68     		ldr	r3, [r3]
ARM GAS  /tmp/ccLyNHPk.s 			page 98


 3729 0006 002B     		cmp	r3, #0
 3730 0008 08DC     		bgt	.L331
 985:app/toolhead.c ****         return 1;
 986:app/toolhead.c ****     }
 987:app/toolhead.c ****     
 988:app/toolhead.c ****     /* 检查 trapq */
 989:app/toolhead.c ****     if (s_p_trapq != NULL && trapq_has_moves(s_p_trapq)) {
 3731              		.loc 1 989 5 is_stmt 1 view .LVU1068
 3732              		.loc 1 989 19 is_stmt 0 view .LVU1069
 3733 000a 064B     		ldr	r3, .L334+4
 3734 000c 1868     		ldr	r0, [r3]
 3735              		.loc 1 989 8 view .LVU1070
 3736 000e 20B1     		cbz	r0, .L329
 3737              		.loc 1 989 30 discriminator 1 view .LVU1071
 3738 0010 FFF7FEFF 		bl	trapq_has_moves
 3739              	.LVL327:
 3740              		.loc 1 989 27 discriminator 1 view .LVU1072
 3741 0014 0038     		subs	r0, r0, #0
 3742 0016 18BF     		it	ne
 3743 0018 0120     		movne	r0, #1
 3744              	.L329:
 990:app/toolhead.c ****         return 1;
 991:app/toolhead.c ****     }
 992:app/toolhead.c ****     
 993:app/toolhead.c ****     return 0;
 994:app/toolhead.c **** }
 3745              		.loc 1 994 1 view .LVU1073
 3746 001a 08BD     		pop	{r3, pc}
 3747              	.L331:
 985:app/toolhead.c ****         return 1;
 3748              		.loc 1 985 16 view .LVU1074
 3749 001c 0120     		movs	r0, #1
 3750              		.loc 1 994 1 view .LVU1075
 3751 001e 08BD     		pop	{r3, pc}
 3752              	.L335:
 3753              		.align	2
 3754              	.L334:
 3755 0020 00000000 		.word	.LANCHOR0
 3756 0024 00000000 		.word	.LANCHOR6
 3757              		.cfi_endproc
 3758              	.LFE25:
 3760              		.section	.text.toolhead_get_trapq,"ax",%progbits
 3761              		.align	1
 3762              		.p2align 2,,3
 3763              		.global	toolhead_get_trapq
 3764              		.syntax unified
 3765              		.thumb
 3766              		.thumb_func
 3767              		.fpu fpv4-sp-d16
 3769              	toolhead_get_trapq:
 3770              	.LFB26:
 995:app/toolhead.c **** 
 996:app/toolhead.c **** struct trapq *
 997:app/toolhead.c **** toolhead_get_trapq(void)
 998:app/toolhead.c **** {
 3771              		.loc 1 998 1 is_stmt 1 view -0
 3772              		.cfi_startproc
ARM GAS  /tmp/ccLyNHPk.s 			page 99


 3773              		@ args = 0, pretend = 0, frame = 0
 3774              		@ frame_needed = 0, uses_anonymous_args = 0
 3775              		@ link register save eliminated.
 999:app/toolhead.c ****     return s_p_trapq;
 3776              		.loc 1 999 5 view .LVU1077
 3777              		.loc 1 999 12 is_stmt 0 view .LVU1078
 3778 0000 014B     		ldr	r3, .L337
1000:app/toolhead.c **** }
 3779              		.loc 1 1000 1 view .LVU1079
 3780 0002 1868     		ldr	r0, [r3]
 3781 0004 7047     		bx	lr
 3782              	.L338:
 3783 0006 00BF     		.align	2
 3784              	.L337:
 3785 0008 00000000 		.word	.LANCHOR6
 3786              		.cfi_endproc
 3787              	.LFE26:
 3789              		.section	.text.toolhead_get_print_time,"ax",%progbits
 3790              		.align	1
 3791              		.p2align 2,,3
 3792              		.global	toolhead_get_print_time
 3793              		.syntax unified
 3794              		.thumb
 3795              		.thumb_func
 3796              		.fpu fpv4-sp-d16
 3798              	toolhead_get_print_time:
 3799              	.LFB27:
1001:app/toolhead.c **** 
1002:app/toolhead.c **** double
1003:app/toolhead.c **** toolhead_get_print_time(void)
1004:app/toolhead.c **** {
 3800              		.loc 1 1004 1 is_stmt 1 view -0
 3801              		.cfi_startproc
 3802              		@ args = 0, pretend = 0, frame = 0
 3803              		@ frame_needed = 0, uses_anonymous_args = 0
 3804              		@ link register save eliminated.
1005:app/toolhead.c ****     return s_print_time;
 3805              		.loc 1 1005 5 view .LVU1081
 3806              		.loc 1 1005 12 is_stmt 0 view .LVU1082
 3807 0000 014B     		ldr	r3, .L340
1006:app/toolhead.c **** }
 3808              		.loc 1 1006 1 view .LVU1083
 3809 0002 93ED000B 		vldr.64	d0, [r3]
 3810 0006 7047     		bx	lr
 3811              	.L341:
 3812              		.align	2
 3813              	.L340:
 3814 0008 00000000 		.word	.LANCHOR5
 3815              		.cfi_endproc
 3816              	.LFE27:
 3818              		.section	.text.toolhead_get_config,"ax",%progbits
 3819              		.align	1
 3820              		.p2align 2,,3
 3821              		.global	toolhead_get_config
 3822              		.syntax unified
 3823              		.thumb
 3824              		.thumb_func
ARM GAS  /tmp/ccLyNHPk.s 			page 100


 3825              		.fpu fpv4-sp-d16
 3827              	toolhead_get_config:
 3828              	.LVL328:
 3829              	.LFB28:
1007:app/toolhead.c **** 
1008:app/toolhead.c **** int
1009:app/toolhead.c **** toolhead_get_config(toolhead_config_t *p_config)
1010:app/toolhead.c **** {
 3830              		.loc 1 1010 1 is_stmt 1 view -0
 3831              		.cfi_startproc
 3832              		@ args = 0, pretend = 0, frame = 0
 3833              		@ frame_needed = 0, uses_anonymous_args = 0
 3834              		@ link register save eliminated.
1011:app/toolhead.c ****     /* 参数检查 */
1012:app/toolhead.c ****     if (p_config == NULL) {
 3835              		.loc 1 1012 5 view .LVU1085
 3836              		.loc 1 1012 8 is_stmt 0 view .LVU1086
 3837 0000 78B1     		cbz	r0, .L344
1010:app/toolhead.c ****     /* 参数检查 */
 3838              		.loc 1 1010 1 view .LVU1087
 3839 0002 10B4     		push	{r4}
 3840              		.cfi_def_cfa_offset 4
 3841              		.cfi_offset 4, -4
1013:app/toolhead.c ****         return TOOLHEAD_ERR_NULL;
1014:app/toolhead.c ****     }
1015:app/toolhead.c ****     
1016:app/toolhead.c ****     /* 复制配置 */
1017:app/toolhead.c ****     memcpy(p_config, &s_config, sizeof(toolhead_config_t));
 3842              		.loc 1 1017 5 view .LVU1088
 3843 0004 084C     		ldr	r4, .L349
 3844 0006 8446     		mov	ip, r0
 3845              		.loc 1 1017 5 is_stmt 1 view .LVU1089
 3846 0008 0FCC     		ldmia	r4!, {r0, r1, r2, r3}
 3847              	.LVL329:
 3848              		.loc 1 1017 5 is_stmt 0 view .LVU1090
 3849 000a CCF80000 		str	r0, [ip]	@ unaligned
 3850 000e CCF80410 		str	r1, [ip, #4]	@ unaligned
 3851 0012 CCF80820 		str	r2, [ip, #8]	@ unaligned
 3852 0016 CCF80C30 		str	r3, [ip, #12]	@ unaligned
1018:app/toolhead.c ****     
1019:app/toolhead.c ****     return TOOLHEAD_OK;
 3853              		.loc 1 1019 5 is_stmt 1 view .LVU1091
 3854              		.loc 1 1019 12 is_stmt 0 view .LVU1092
 3855 001a 0020     		movs	r0, #0
1020:app/toolhead.c **** }
 3856              		.loc 1 1020 1 view .LVU1093
 3857 001c 5DF8044B 		ldr	r4, [sp], #4
 3858              		.cfi_restore 4
 3859              		.cfi_def_cfa_offset 0
 3860 0020 7047     		bx	lr
 3861              	.LVL330:
 3862              	.L344:
1013:app/toolhead.c ****         return TOOLHEAD_ERR_NULL;
 3863              		.loc 1 1013 16 view .LVU1094
 3864 0022 4FF0FF30 		mov	r0, #-1
 3865              	.LVL331:
 3866              		.loc 1 1020 1 view .LVU1095
ARM GAS  /tmp/ccLyNHPk.s 			page 101


 3867 0026 7047     		bx	lr
 3868              	.L350:
 3869              		.align	2
 3870              	.L349:
 3871 0028 00000000 		.word	.LANCHOR4
 3872              		.cfi_endproc
 3873              	.LFE28:
 3875              		.section	.text.toolhead_set_config,"ax",%progbits
 3876              		.align	1
 3877              		.p2align 2,,3
 3878              		.global	toolhead_set_config
 3879              		.syntax unified
 3880              		.thumb
 3881              		.thumb_func
 3882              		.fpu fpv4-sp-d16
 3884              	toolhead_set_config:
 3885              	.LVL332:
 3886              	.LFB29:
1021:app/toolhead.c **** 
1022:app/toolhead.c **** int
1023:app/toolhead.c **** toolhead_set_config(const toolhead_config_t *p_config)
1024:app/toolhead.c **** {
 3887              		.loc 1 1024 1 is_stmt 1 view -0
 3888              		.cfi_startproc
 3889              		@ args = 0, pretend = 0, frame = 0
 3890              		@ frame_needed = 0, uses_anonymous_args = 0
 3891              		@ link register save eliminated.
1025:app/toolhead.c ****     /* 参数检查 */
1026:app/toolhead.c ****     if (p_config == NULL) {
 3892              		.loc 1 1026 5 view .LVU1097
 3893              		.loc 1 1026 8 is_stmt 0 view .LVU1098
 3894 0000 58B1     		cbz	r0, .L353
1024:app/toolhead.c ****     /* 参数检查 */
 3895              		.loc 1 1024 1 view .LVU1099
 3896 0002 10B4     		push	{r4}
 3897              		.cfi_def_cfa_offset 4
 3898              		.cfi_offset 4, -4
 3899 0004 0346     		mov	r3, r0
1027:app/toolhead.c ****         return TOOLHEAD_ERR_NULL;
1028:app/toolhead.c ****     }
1029:app/toolhead.c ****     
1030:app/toolhead.c ****     /* 复制配置 */
1031:app/toolhead.c ****     memcpy(&s_config, p_config, sizeof(toolhead_config_t));
 3900              		.loc 1 1031 5 is_stmt 1 view .LVU1100
 3901 0006 064C     		ldr	r4, .L358
 3902 0008 0068     		ldr	r0, [r0]	@ unaligned
 3903              	.LVL333:
 3904              		.loc 1 1031 5 is_stmt 0 view .LVU1101
 3905 000a 5968     		ldr	r1, [r3, #4]	@ unaligned
 3906 000c 9A68     		ldr	r2, [r3, #8]	@ unaligned
 3907 000e DB68     		ldr	r3, [r3, #12]	@ unaligned
 3908              	.LVL334:
 3909              		.loc 1 1031 5 view .LVU1102
 3910 0010 0FC4     		stmia	r4!, {r0, r1, r2, r3}
1032:app/toolhead.c ****     
1033:app/toolhead.c ****     return TOOLHEAD_OK;
 3911              		.loc 1 1033 5 is_stmt 1 view .LVU1103
ARM GAS  /tmp/ccLyNHPk.s 			page 102


 3912              		.loc 1 1033 12 is_stmt 0 view .LVU1104
 3913 0012 0020     		movs	r0, #0
1034:app/toolhead.c **** }
 3914              		.loc 1 1034 1 view .LVU1105
 3915 0014 5DF8044B 		ldr	r4, [sp], #4
 3916              		.cfi_restore 4
 3917              		.cfi_def_cfa_offset 0
 3918 0018 7047     		bx	lr
 3919              	.LVL335:
 3920              	.L353:
1027:app/toolhead.c ****         return TOOLHEAD_ERR_NULL;
 3921              		.loc 1 1027 16 view .LVU1106
 3922 001a 4FF0FF30 		mov	r0, #-1
 3923              	.LVL336:
 3924              		.loc 1 1034 1 view .LVU1107
 3925 001e 7047     		bx	lr
 3926              	.L359:
 3927              		.align	2
 3928              	.L358:
 3929 0020 00000000 		.word	.LANCHOR4
 3930              		.cfi_endproc
 3931              	.LFE29:
 3933              		.section	.text.toolhead_set_move_complete_callback,"ax",%progbits
 3934              		.align	1
 3935              		.p2align 2,,3
 3936              		.global	toolhead_set_move_complete_callback
 3937              		.syntax unified
 3938              		.thumb
 3939              		.thumb_func
 3940              		.fpu fpv4-sp-d16
 3942              	toolhead_set_move_complete_callback:
 3943              	.LVL337:
 3944              	.LFB30:
1035:app/toolhead.c **** 
1036:app/toolhead.c **** void
1037:app/toolhead.c **** toolhead_set_move_complete_callback(toolhead_callback_fn_t callback, void *arg)
1038:app/toolhead.c **** {
 3945              		.loc 1 1038 1 is_stmt 1 view -0
 3946              		.cfi_startproc
 3947              		@ args = 0, pretend = 0, frame = 0
 3948              		@ frame_needed = 0, uses_anonymous_args = 0
 3949              		@ link register save eliminated.
1039:app/toolhead.c ****     s_move_complete_cb = callback;
 3950              		.loc 1 1039 5 view .LVU1109
 3951              		.loc 1 1039 24 is_stmt 0 view .LVU1110
 3952 0000 024A     		ldr	r2, .L361
1040:app/toolhead.c ****     s_move_complete_arg = arg;
 3953              		.loc 1 1040 25 view .LVU1111
 3954 0002 034B     		ldr	r3, .L361+4
1039:app/toolhead.c ****     s_move_complete_cb = callback;
 3955              		.loc 1 1039 24 view .LVU1112
 3956 0004 1060     		str	r0, [r2]
 3957              		.loc 1 1040 5 is_stmt 1 view .LVU1113
 3958              		.loc 1 1040 25 is_stmt 0 view .LVU1114
 3959 0006 1960     		str	r1, [r3]
1041:app/toolhead.c **** }
 3960              		.loc 1 1041 1 view .LVU1115
ARM GAS  /tmp/ccLyNHPk.s 			page 103


 3961 0008 7047     		bx	lr
 3962              	.L362:
 3963 000a 00BF     		.align	2
 3964              	.L361:
 3965 000c 00000000 		.word	.LANCHOR14
 3966 0010 00000000 		.word	.LANCHOR15
 3967              		.cfi_endproc
 3968              	.LFE30:
 3970              		.section	.bss.s_commanded_pos,"aw",%nobits
 3971              		.align	3
 3972              		.set	.LANCHOR13,. + 0
 3975              	s_commanded_pos:
 3976 0000 00000000 		.space	32
 3976      00000000 
 3976      00000000 
 3976      00000000 
 3976      00000000 
 3977              		.section	.bss.s_config,"aw",%nobits
 3978              		.align	2
 3979              		.set	.LANCHOR4,. + 0
 3982              	s_config:
 3983 0000 00000000 		.space	16
 3983      00000000 
 3983      00000000 
 3983      00000000 
 3984              		.section	.bss.s_home_ctx,"aw",%nobits
 3985              		.align	3
 3986              		.set	.LANCHOR7,. + 0
 3989              	s_home_ctx:
 3990 0000 00000000 		.space	24
 3990      00000000 
 3990      00000000 
 3990      00000000 
 3990      00000000 
 3991              		.section	.bss.s_initialized,"aw",%nobits
 3992              		.set	.LANCHOR8,. + 0
 3995              	s_initialized:
 3996 0000 00       		.space	1
 3997              		.section	.bss.s_lookahead,"aw",%nobits
 3998              		.align	3
 3999              		.set	.LANCHOR2,. + 0
 4002              	s_lookahead:
 4003 0000 00000000 		.space	2176
 4003      00000000 
 4003      00000000 
 4003      00000000 
 4003      00000000 
 4004              		.section	.bss.s_lookahead_count,"aw",%nobits
 4005              		.align	2
 4006              		.set	.LANCHOR0,. + 0
 4009              	s_lookahead_count:
 4010 0000 00000000 		.space	4
 4011              		.section	.bss.s_lookahead_head,"aw",%nobits
 4012              		.align	2
 4013              		.set	.LANCHOR3,. + 0
 4016              	s_lookahead_head:
 4017 0000 00000000 		.space	4
ARM GAS  /tmp/ccLyNHPk.s 			page 104


 4018              		.section	.bss.s_lookahead_tail,"aw",%nobits
 4019              		.align	2
 4020              		.set	.LANCHOR1,. + 0
 4023              	s_lookahead_tail:
 4024 0000 00000000 		.space	4
 4025              		.section	.bss.s_max_pos,"aw",%nobits
 4026              		.align	3
 4027              		.set	.LANCHOR10,. + 0
 4030              	s_max_pos:
 4031 0000 00000000 		.space	32
 4031      00000000 
 4031      00000000 
 4031      00000000 
 4031      00000000 
 4032              		.section	.bss.s_min_pos,"aw",%nobits
 4033              		.align	3
 4034              		.set	.LANCHOR9,. + 0
 4037              	s_min_pos:
 4038 0000 00000000 		.space	32
 4038      00000000 
 4038      00000000 
 4038      00000000 
 4038      00000000 
 4039              		.section	.bss.s_move_complete_arg,"aw",%nobits
 4040              		.align	2
 4041              		.set	.LANCHOR15,. + 0
 4044              	s_move_complete_arg:
 4045 0000 00000000 		.space	4
 4046              		.section	.bss.s_move_complete_cb,"aw",%nobits
 4047              		.align	2
 4048              		.set	.LANCHOR14,. + 0
 4051              	s_move_complete_cb:
 4052 0000 00000000 		.space	4
 4053              		.section	.bss.s_p_trapq,"aw",%nobits
 4054              		.align	2
 4055              		.set	.LANCHOR6,. + 0
 4058              	s_p_trapq:
 4059 0000 00000000 		.space	4
 4060              		.section	.bss.s_print_time,"aw",%nobits
 4061              		.align	3
 4062              		.set	.LANCHOR5,. + 0
 4065              	s_print_time:
 4066 0000 00000000 		.space	8
 4066      00000000 
 4067              		.section	.bss.s_steppers,"aw",%nobits
 4068              		.align	2
 4069              		.set	.LANCHOR12,. + 0
 4072              	s_steppers:
 4073 0000 00000000 		.space	16
 4073      00000000 
 4073      00000000 
 4073      00000000 
 4074              		.section	.bss.s_steps_per_mm,"aw",%nobits
 4075              		.align	3
 4076              		.set	.LANCHOR11,. + 0
 4079              	s_steps_per_mm:
 4080 0000 00000000 		.space	32
ARM GAS  /tmp/ccLyNHPk.s 			page 105


 4080      00000000 
 4080      00000000 
 4080      00000000 
 4080      00000000 
 4081              		.text
 4082              	.Letext0:
 4083              		.file 2 "./chelper/list.h"
 4084              		.file 3 "./chelper/trapq.h"
 4085              		.file 4 "app/toolhead.h"
 4086              		.file 5 "/usr/lib/gcc/arm-none-eabi/10.3.1/include/stdint.h"
 4087              		.file 6 "./chelper/itersolve.h"
 4088              		.file 7 "./src/stepper.h"
 4089              		.file 8 "./src/endstop.h"
 4090              		.file 9 "./src/sched.h"
 4091              		.file 10 "/usr/include/newlib/math.h"
 4092              		.file 11 "<built-in>"
ARM GAS  /tmp/ccLyNHPk.s 			page 106


DEFINED SYMBOLS
                            *ABS*:0000000000000000 toolhead.c
     /tmp/ccLyNHPk.s:18     .text.lookahead_push:0000000000000000 $t
     /tmp/ccLyNHPk.s:26     .text.lookahead_push:0000000000000000 lookahead_push
     /tmp/ccLyNHPk.s:99     .text.lookahead_push:0000000000000044 $d
     /tmp/ccLyNHPk.s:106    .text.lookahead_pop:0000000000000000 $t
     /tmp/ccLyNHPk.s:113    .text.lookahead_pop:0000000000000000 lookahead_pop
     /tmp/ccLyNHPk.s:181    .text.lookahead_pop:0000000000000040 $d
     /tmp/ccLyNHPk.s:195    .text.lookahead_process:0000000000000000 $t
     /tmp/ccLyNHPk.s:202    .text.lookahead_process:0000000000000000 lookahead_process
     /tmp/ccLyNHPk.s:604    .text.lookahead_process:0000000000000238 $d
     /tmp/ccLyNHPk.s:621    .text.lookahead_process:0000000000000260 $t
     /tmp/ccLyNHPk.s:895    .text.lookahead_process:00000000000003b8 $d
     /tmp/ccLyNHPk.s:905    .text.calc_trapezoidal_profile:0000000000000000 $t
     /tmp/ccLyNHPk.s:912    .text.calc_trapezoidal_profile:0000000000000000 calc_trapezoidal_profile
     /tmp/ccLyNHPk.s:1306   .text.calc_trapezoidal_profile:000000000000021c $d
     /tmp/ccLyNHPk.s:1312   .text.lookahead_flush:0000000000000000 $t
     /tmp/ccLyNHPk.s:1319   .text.lookahead_flush:0000000000000000 lookahead_flush
     /tmp/ccLyNHPk.s:1444   .text.lookahead_flush:00000000000000bc $d
     /tmp/ccLyNHPk.s:1451   .text.home_endstop_callback:0000000000000000 $t
     /tmp/ccLyNHPk.s:1458   .text.home_endstop_callback:0000000000000000 home_endstop_callback
     /tmp/ccLyNHPk.s:1492   .text.home_endstop_callback:0000000000000018 $d
     /tmp/ccLyNHPk.s:1497   .text.toolhead_init:0000000000000000 $t
     /tmp/ccLyNHPk.s:1505   .text.toolhead_init:0000000000000000 toolhead_init
     /tmp/ccLyNHPk.s:1746   .text.toolhead_init:00000000000000f8 $d
     /tmp/ccLyNHPk.s:1776   .text.toolhead_get_position:0000000000000000 $t
     /tmp/ccLyNHPk.s:1784   .text.toolhead_get_position:0000000000000000 toolhead_get_position
     /tmp/ccLyNHPk.s:1847   .text.toolhead_get_position:0000000000000030 $d
     /tmp/ccLyNHPk.s:1852   .text.toolhead_set_position:0000000000000000 $t
     /tmp/ccLyNHPk.s:1860   .text.toolhead_set_position:0000000000000000 toolhead_set_position
     /tmp/ccLyNHPk.s:2084   .text.toolhead_set_position:00000000000000a4 $d
     /tmp/ccLyNHPk.s:2091   .text.toolhead_move:0000000000000000 $t
     /tmp/ccLyNHPk.s:2099   .text.toolhead_move:0000000000000000 toolhead_move
     /tmp/ccLyNHPk.s:2597   .text.toolhead_move:0000000000000270 $d
     /tmp/ccLyNHPk.s:2614   .text.toolhead_move:000000000000029c $t
     /tmp/ccLyNHPk.s:2797   .text.toolhead_move:0000000000000388 $d
     /tmp/ccLyNHPk.s:2803   .text.toolhead_wait_moves:0000000000000000 $t
     /tmp/ccLyNHPk.s:2811   .text.toolhead_wait_moves:0000000000000000 toolhead_wait_moves
     /tmp/ccLyNHPk.s:2968   .text.toolhead_wait_moves:0000000000000088 $d
     /tmp/ccLyNHPk.s:2976   .text.toolhead_flush:0000000000000000 $t
     /tmp/ccLyNHPk.s:2984   .text.toolhead_flush:0000000000000000 toolhead_flush
     /tmp/ccLyNHPk.s:3096   .text.toolhead_flush:0000000000000064 $d
     /tmp/ccLyNHPk.s:3104   .text.toolhead_home:0000000000000000 $t
     /tmp/ccLyNHPk.s:3112   .text.toolhead_home:0000000000000000 toolhead_home
     /tmp/ccLyNHPk.s:3676   .text.toolhead_home:0000000000000298 $d
     /tmp/ccLyNHPk.s:3689   .text.toolhead_home:00000000000002c4 $t
     /tmp/ccLyNHPk.s:3705   .text.toolhead_has_moves:0000000000000000 $t
     /tmp/ccLyNHPk.s:3713   .text.toolhead_has_moves:0000000000000000 toolhead_has_moves
     /tmp/ccLyNHPk.s:3755   .text.toolhead_has_moves:0000000000000020 $d
     /tmp/ccLyNHPk.s:3761   .text.toolhead_get_trapq:0000000000000000 $t
     /tmp/ccLyNHPk.s:3769   .text.toolhead_get_trapq:0000000000000000 toolhead_get_trapq
     /tmp/ccLyNHPk.s:3785   .text.toolhead_get_trapq:0000000000000008 $d
     /tmp/ccLyNHPk.s:3790   .text.toolhead_get_print_time:0000000000000000 $t
     /tmp/ccLyNHPk.s:3798   .text.toolhead_get_print_time:0000000000000000 toolhead_get_print_time
     /tmp/ccLyNHPk.s:3814   .text.toolhead_get_print_time:0000000000000008 $d
     /tmp/ccLyNHPk.s:3819   .text.toolhead_get_config:0000000000000000 $t
     /tmp/ccLyNHPk.s:3827   .text.toolhead_get_config:0000000000000000 toolhead_get_config
ARM GAS  /tmp/ccLyNHPk.s 			page 107


     /tmp/ccLyNHPk.s:3871   .text.toolhead_get_config:0000000000000028 $d
     /tmp/ccLyNHPk.s:3876   .text.toolhead_set_config:0000000000000000 $t
     /tmp/ccLyNHPk.s:3884   .text.toolhead_set_config:0000000000000000 toolhead_set_config
     /tmp/ccLyNHPk.s:3929   .text.toolhead_set_config:0000000000000020 $d
     /tmp/ccLyNHPk.s:3934   .text.toolhead_set_move_complete_callback:0000000000000000 $t
     /tmp/ccLyNHPk.s:3942   .text.toolhead_set_move_complete_callback:0000000000000000 toolhead_set_move_complete_callback
     /tmp/ccLyNHPk.s:3965   .text.toolhead_set_move_complete_callback:000000000000000c $d
     /tmp/ccLyNHPk.s:3971   .bss.s_commanded_pos:0000000000000000 $d
     /tmp/ccLyNHPk.s:3975   .bss.s_commanded_pos:0000000000000000 s_commanded_pos
     /tmp/ccLyNHPk.s:3978   .bss.s_config:0000000000000000 $d
     /tmp/ccLyNHPk.s:3982   .bss.s_config:0000000000000000 s_config
     /tmp/ccLyNHPk.s:3985   .bss.s_home_ctx:0000000000000000 $d
     /tmp/ccLyNHPk.s:3989   .bss.s_home_ctx:0000000000000000 s_home_ctx
     /tmp/ccLyNHPk.s:3995   .bss.s_initialized:0000000000000000 s_initialized
     /tmp/ccLyNHPk.s:3996   .bss.s_initialized:0000000000000000 $d
     /tmp/ccLyNHPk.s:3998   .bss.s_lookahead:0000000000000000 $d
     /tmp/ccLyNHPk.s:4002   .bss.s_lookahead:0000000000000000 s_lookahead
     /tmp/ccLyNHPk.s:4005   .bss.s_lookahead_count:0000000000000000 $d
     /tmp/ccLyNHPk.s:4009   .bss.s_lookahead_count:0000000000000000 s_lookahead_count
     /tmp/ccLyNHPk.s:4012   .bss.s_lookahead_head:0000000000000000 $d
     /tmp/ccLyNHPk.s:4016   .bss.s_lookahead_head:0000000000000000 s_lookahead_head
     /tmp/ccLyNHPk.s:4019   .bss.s_lookahead_tail:0000000000000000 $d
     /tmp/ccLyNHPk.s:4023   .bss.s_lookahead_tail:0000000000000000 s_lookahead_tail
     /tmp/ccLyNHPk.s:4026   .bss.s_max_pos:0000000000000000 $d
     /tmp/ccLyNHPk.s:4030   .bss.s_max_pos:0000000000000000 s_max_pos
     /tmp/ccLyNHPk.s:4033   .bss.s_min_pos:0000000000000000 $d
     /tmp/ccLyNHPk.s:4037   .bss.s_min_pos:0000000000000000 s_min_pos
     /tmp/ccLyNHPk.s:4040   .bss.s_move_complete_arg:0000000000000000 $d
     /tmp/ccLyNHPk.s:4044   .bss.s_move_complete_arg:0000000000000000 s_move_complete_arg
     /tmp/ccLyNHPk.s:4047   .bss.s_move_complete_cb:0000000000000000 $d
     /tmp/ccLyNHPk.s:4051   .bss.s_move_complete_cb:0000000000000000 s_move_complete_cb
     /tmp/ccLyNHPk.s:4054   .bss.s_p_trapq:0000000000000000 $d
     /tmp/ccLyNHPk.s:4058   .bss.s_p_trapq:0000000000000000 s_p_trapq
     /tmp/ccLyNHPk.s:4061   .bss.s_print_time:0000000000000000 $d
     /tmp/ccLyNHPk.s:4065   .bss.s_print_time:0000000000000000 s_print_time
     /tmp/ccLyNHPk.s:4068   .bss.s_steppers:0000000000000000 $d
     /tmp/ccLyNHPk.s:4072   .bss.s_steppers:0000000000000000 s_steppers
     /tmp/ccLyNHPk.s:4075   .bss.s_steps_per_mm:0000000000000000 $d
     /tmp/ccLyNHPk.s:4079   .bss.s_steps_per_mm:0000000000000000 s_steps_per_mm

UNDEFINED SYMBOLS
memcpy
__aeabi_f2d
__aeabi_dadd
__aeabi_dmul
__aeabi_dcmplt
__aeabi_dcmpgt
__aeabi_dsub
__aeabi_ddiv
sqrt
cartesian_calc_direction
trapq_append
stepper_stop
trapq_pool_init
itersolve_pool_init
trapq_alloc
itersolve_alloc
ARM GAS  /tmp/ccLyNHPk.s 			page 108


cartesian_stepper_setup
itersolve_set_trapq
itersolve_set_position
itersolve_generate_steps
stepper_is_moving
sched_main
trapq_finalize_moves
trapq_free_moves
stepper_stop_all
endstop_is_triggered
endstop_home_end
endstop_set_callback
endstop_home_start
trapq_has_moves
