ARM GAS  /tmp/cc7lly76.s 			page 1


   1              		.cpu cortex-m4
   2              		.eabi_attribute 27, 1
   3              		.eabi_attribute 28, 1
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 2
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"stm32f4.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text.system_init,"ax",%progbits
  18              		.align	1
  19              		.p2align 2,,3
  20              		.global	system_init
  21              		.arch armv7e-m
  22              		.syntax unified
  23              		.thumb
  24              		.thumb_func
  25              		.fpu fpv4-sp-d16
  27              	system_init:
  28              	.LFB9:
  29              		.file 1 "src/stm32/stm32f4.c"
   1:src/stm32/stm32f4.c **** /**
   2:src/stm32/stm32f4.c ****  * @file    stm32f4.c
   3:src/stm32/stm32f4.c ****  * @brief   STM32F407 chip initialization
   4:src/stm32/stm32f4.c ****  * 
   5:src/stm32/stm32f4.c ****  * System clock configuration and chip initialization for STM32F407.
   6:src/stm32/stm32f4.c ****  * Configures PLL for 168 MHz system clock from 8 MHz HSE.
   7:src/stm32/stm32f4.c ****  * Follows Klipper coding style (C99, snake_case).
   8:src/stm32/stm32f4.c ****  */
   9:src/stm32/stm32f4.c **** 
  10:src/stm32/stm32f4.c **** #include "internal.h"
  11:src/stm32/stm32f4.c **** #include "gpio.h"
  12:src/stm32/stm32f4.c **** #include "board/irq.h"
  13:src/stm32/stm32f4.c **** 
  14:src/stm32/stm32f4.c **** /* ========== RCC Register Definitions ========== */
  15:src/stm32/stm32f4.c **** 
  16:src/stm32/stm32f4.c **** #define RCC_BASE                0x40023800
  17:src/stm32/stm32f4.c **** 
  18:src/stm32/stm32f4.c **** /* RCC registers */
  19:src/stm32/stm32f4.c **** #define RCC_CR                  (*(volatile uint32_t *)(RCC_BASE + 0x00))
  20:src/stm32/stm32f4.c **** #define RCC_PLLCFGR             (*(volatile uint32_t *)(RCC_BASE + 0x04))
  21:src/stm32/stm32f4.c **** #define RCC_CFGR                (*(volatile uint32_t *)(RCC_BASE + 0x08))
  22:src/stm32/stm32f4.c **** #define RCC_CIR                 (*(volatile uint32_t *)(RCC_BASE + 0x0C))
  23:src/stm32/stm32f4.c **** #define RCC_AHB1RSTR            (*(volatile uint32_t *)(RCC_BASE + 0x10))
  24:src/stm32/stm32f4.c **** #define RCC_AHB2RSTR            (*(volatile uint32_t *)(RCC_BASE + 0x14))
  25:src/stm32/stm32f4.c **** #define RCC_AHB3RSTR            (*(volatile uint32_t *)(RCC_BASE + 0x18))
  26:src/stm32/stm32f4.c **** #define RCC_APB1RSTR            (*(volatile uint32_t *)(RCC_BASE + 0x20))
  27:src/stm32/stm32f4.c **** #define RCC_APB2RSTR            (*(volatile uint32_t *)(RCC_BASE + 0x24))
  28:src/stm32/stm32f4.c **** #define RCC_AHB1ENR             (*(volatile uint32_t *)(RCC_BASE + 0x30))
  29:src/stm32/stm32f4.c **** #define RCC_AHB2ENR             (*(volatile uint32_t *)(RCC_BASE + 0x34))
ARM GAS  /tmp/cc7lly76.s 			page 2


  30:src/stm32/stm32f4.c **** #define RCC_AHB3ENR             (*(volatile uint32_t *)(RCC_BASE + 0x38))
  31:src/stm32/stm32f4.c **** #define RCC_APB1ENR             (*(volatile uint32_t *)(RCC_BASE + 0x40))
  32:src/stm32/stm32f4.c **** #define RCC_APB2ENR             (*(volatile uint32_t *)(RCC_BASE + 0x44))
  33:src/stm32/stm32f4.c **** 
  34:src/stm32/stm32f4.c **** /* RCC_CR bits */
  35:src/stm32/stm32f4.c **** #define RCC_CR_HSION            (1 << 0)
  36:src/stm32/stm32f4.c **** #define RCC_CR_HSIRDY           (1 << 1)
  37:src/stm32/stm32f4.c **** #define RCC_CR_HSEON            (1 << 16)
  38:src/stm32/stm32f4.c **** #define RCC_CR_HSERDY           (1 << 17)
  39:src/stm32/stm32f4.c **** #define RCC_CR_HSEBYP           (1 << 18)
  40:src/stm32/stm32f4.c **** #define RCC_CR_CSSON            (1 << 19)
  41:src/stm32/stm32f4.c **** #define RCC_CR_PLLON            (1 << 24)
  42:src/stm32/stm32f4.c **** #define RCC_CR_PLLRDY           (1 << 25)
  43:src/stm32/stm32f4.c **** 
  44:src/stm32/stm32f4.c **** /* RCC_CFGR bits */
  45:src/stm32/stm32f4.c **** #define RCC_CFGR_SW_HSI         (0 << 0)
  46:src/stm32/stm32f4.c **** #define RCC_CFGR_SW_HSE         (1 << 0)
  47:src/stm32/stm32f4.c **** #define RCC_CFGR_SW_PLL         (2 << 0)
  48:src/stm32/stm32f4.c **** #define RCC_CFGR_SW_MASK        (3 << 0)
  49:src/stm32/stm32f4.c **** #define RCC_CFGR_SWS_HSI        (0 << 2)
  50:src/stm32/stm32f4.c **** #define RCC_CFGR_SWS_HSE        (1 << 2)
  51:src/stm32/stm32f4.c **** #define RCC_CFGR_SWS_PLL        (2 << 2)
  52:src/stm32/stm32f4.c **** #define RCC_CFGR_SWS_MASK       (3 << 2)
  53:src/stm32/stm32f4.c **** #define RCC_CFGR_HPRE_DIV1      (0 << 4)
  54:src/stm32/stm32f4.c **** #define RCC_CFGR_PPRE1_DIV4     (5 << 10)   /* APB1 = HCLK/4 = 42 MHz */
  55:src/stm32/stm32f4.c **** #define RCC_CFGR_PPRE2_DIV2     (4 << 13)   /* APB2 = HCLK/2 = 84 MHz */
  56:src/stm32/stm32f4.c **** 
  57:src/stm32/stm32f4.c **** /* ========== Flash Register Definitions ========== */
  58:src/stm32/stm32f4.c **** 
  59:src/stm32/stm32f4.c **** #define FLASH_BASE              0x40023C00
  60:src/stm32/stm32f4.c **** #define FLASH_ACR               (*(volatile uint32_t *)(FLASH_BASE + 0x00))
  61:src/stm32/stm32f4.c **** 
  62:src/stm32/stm32f4.c **** /* FLASH_ACR bits */
  63:src/stm32/stm32f4.c **** #define FLASH_ACR_LATENCY_5WS   (5 << 0)    /* 5 wait states for 168 MHz */
  64:src/stm32/stm32f4.c **** #define FLASH_ACR_PRFTEN        (1 << 8)    /* Prefetch enable */
  65:src/stm32/stm32f4.c **** #define FLASH_ACR_ICEN          (1 << 9)    /* Instruction cache enable */
  66:src/stm32/stm32f4.c **** #define FLASH_ACR_DCEN          (1 << 10)   /* Data cache enable */
  67:src/stm32/stm32f4.c **** 
  68:src/stm32/stm32f4.c **** /* ========== PWR Register Definitions ========== */
  69:src/stm32/stm32f4.c **** 
  70:src/stm32/stm32f4.c **** #define PWR_BASE                0x40007000
  71:src/stm32/stm32f4.c **** #define PWR_CR                  (*(volatile uint32_t *)(PWR_BASE + 0x00))
  72:src/stm32/stm32f4.c **** #define PWR_CSR                 (*(volatile uint32_t *)(PWR_BASE + 0x04))
  73:src/stm32/stm32f4.c **** 
  74:src/stm32/stm32f4.c **** /* PWR_CR bits */
  75:src/stm32/stm32f4.c **** #define PWR_CR_VOS              (1 << 14)   /* Voltage scaling output selection */
  76:src/stm32/stm32f4.c **** 
  77:src/stm32/stm32f4.c **** /* ========== SysTick Definitions ========== */
  78:src/stm32/stm32f4.c **** 
  79:src/stm32/stm32f4.c **** /* SysTick register access macros (use addresses from board/irq.h) */
  80:src/stm32/stm32f4.c **** #define SYSTICK_CSR_REG         (*(volatile uint32_t *)0xE000E010)
  81:src/stm32/stm32f4.c **** #define SYSTICK_RVR_REG         (*(volatile uint32_t *)0xE000E014)
  82:src/stm32/stm32f4.c **** #define SYSTICK_CVR_REG         (*(volatile uint32_t *)0xE000E018)
  83:src/stm32/stm32f4.c **** 
  84:src/stm32/stm32f4.c **** #define SYSTICK_CSR_ENABLE      (1 << 0)
  85:src/stm32/stm32f4.c **** #define SYSTICK_CSR_TICKINT     (1 << 1)
  86:src/stm32/stm32f4.c **** #define SYSTICK_CSR_CLKSOURCE   (1 << 2)
ARM GAS  /tmp/cc7lly76.s 			page 3


  87:src/stm32/stm32f4.c **** 
  88:src/stm32/stm32f4.c **** /* ========== Private Variables ========== */
  89:src/stm32/stm32f4.c **** 
  90:src/stm32/stm32f4.c **** /* System tick counter (incremented every 1ms) */
  91:src/stm32/stm32f4.c **** static volatile uint32_t systick_count = 0;
  92:src/stm32/stm32f4.c **** 
  93:src/stm32/stm32f4.c **** /* ========== Private Functions ========== */
  94:src/stm32/stm32f4.c **** 
  95:src/stm32/stm32f4.c **** /**
  96:src/stm32/stm32f4.c ****  * @brief   Configure PLL for 168 MHz from 8 MHz HSE
  97:src/stm32/stm32f4.c ****  * 
  98:src/stm32/stm32f4.c ****  * PLL configuration:
  99:src/stm32/stm32f4.c ****  * - PLLM = 8 (VCO input = 8 MHz / 8 = 1 MHz)
 100:src/stm32/stm32f4.c ****  * - PLLN = 336 (VCO output = 1 MHz * 336 = 336 MHz)
 101:src/stm32/stm32f4.c ****  * - PLLP = 2 (System clock = 336 MHz / 2 = 168 MHz)
 102:src/stm32/stm32f4.c ****  * - PLLQ = 7 (USB clock = 336 MHz / 7 = 48 MHz)
 103:src/stm32/stm32f4.c ****  */
 104:src/stm32/stm32f4.c **** static void
 105:src/stm32/stm32f4.c **** clock_setup_pll(void)
 106:src/stm32/stm32f4.c **** {
 107:src/stm32/stm32f4.c ****     /* Enable HSE */
 108:src/stm32/stm32f4.c ****     RCC_CR |= RCC_CR_HSEON;
 109:src/stm32/stm32f4.c ****     
 110:src/stm32/stm32f4.c ****     /* Wait for HSE ready */
 111:src/stm32/stm32f4.c ****     while (!(RCC_CR & RCC_CR_HSERDY)) {
 112:src/stm32/stm32f4.c ****         /* Wait */
 113:src/stm32/stm32f4.c ****     }
 114:src/stm32/stm32f4.c ****     
 115:src/stm32/stm32f4.c ****     /* Enable power interface clock */
 116:src/stm32/stm32f4.c ****     RCC_APB1ENR |= (1 << 28);   /* PWREN */
 117:src/stm32/stm32f4.c ****     
 118:src/stm32/stm32f4.c ****     /* Set voltage scaling to Scale 1 (required for 168 MHz) */
 119:src/stm32/stm32f4.c ****     PWR_CR |= PWR_CR_VOS;
 120:src/stm32/stm32f4.c ****     
 121:src/stm32/stm32f4.c ****     /* Configure Flash latency */
 122:src/stm32/stm32f4.c ****     FLASH_ACR = FLASH_ACR_LATENCY_5WS 
 123:src/stm32/stm32f4.c ****               | FLASH_ACR_PRFTEN 
 124:src/stm32/stm32f4.c ****               | FLASH_ACR_ICEN 
 125:src/stm32/stm32f4.c ****               | FLASH_ACR_DCEN;
 126:src/stm32/stm32f4.c ****     
 127:src/stm32/stm32f4.c ****     /* Configure PLL */
 128:src/stm32/stm32f4.c ****     /* PLLM=8, PLLN=336, PLLP=2, PLLQ=7, PLLSRC=HSE */
 129:src/stm32/stm32f4.c ****     RCC_PLLCFGR = (8 << 0)      /* PLLM */
 130:src/stm32/stm32f4.c ****                 | (336 << 6)    /* PLLN */
 131:src/stm32/stm32f4.c ****                 | (0 << 16)     /* PLLP = 2 (00) */
 132:src/stm32/stm32f4.c ****                 | (1 << 22)     /* PLLSRC = HSE */
 133:src/stm32/stm32f4.c ****                 | (7 << 24);    /* PLLQ */
 134:src/stm32/stm32f4.c ****     
 135:src/stm32/stm32f4.c ****     /* Enable PLL */
 136:src/stm32/stm32f4.c ****     RCC_CR |= RCC_CR_PLLON;
 137:src/stm32/stm32f4.c ****     
 138:src/stm32/stm32f4.c ****     /* Wait for PLL ready */
 139:src/stm32/stm32f4.c ****     while (!(RCC_CR & RCC_CR_PLLRDY)) {
 140:src/stm32/stm32f4.c ****         /* Wait */
 141:src/stm32/stm32f4.c ****     }
 142:src/stm32/stm32f4.c ****     
 143:src/stm32/stm32f4.c ****     /* Configure bus clocks */
ARM GAS  /tmp/cc7lly76.s 			page 4


 144:src/stm32/stm32f4.c ****     /* HCLK = SYSCLK, APB1 = HCLK/4, APB2 = HCLK/2 */
 145:src/stm32/stm32f4.c ****     RCC_CFGR = RCC_CFGR_HPRE_DIV1 
 146:src/stm32/stm32f4.c ****              | RCC_CFGR_PPRE1_DIV4 
 147:src/stm32/stm32f4.c ****              | RCC_CFGR_PPRE2_DIV2;
 148:src/stm32/stm32f4.c ****     
 149:src/stm32/stm32f4.c ****     /* Switch to PLL as system clock */
 150:src/stm32/stm32f4.c ****     RCC_CFGR = (RCC_CFGR & ~RCC_CFGR_SW_MASK) | RCC_CFGR_SW_PLL;
 151:src/stm32/stm32f4.c ****     
 152:src/stm32/stm32f4.c ****     /* Wait for PLL as system clock */
 153:src/stm32/stm32f4.c ****     while ((RCC_CFGR & RCC_CFGR_SWS_MASK) != RCC_CFGR_SWS_PLL) {
 154:src/stm32/stm32f4.c ****         /* Wait */
 155:src/stm32/stm32f4.c ****     }
 156:src/stm32/stm32f4.c **** }
 157:src/stm32/stm32f4.c **** 
 158:src/stm32/stm32f4.c **** /**
 159:src/stm32/stm32f4.c ****  * @brief   Configure SysTick for 1ms interrupt
 160:src/stm32/stm32f4.c ****  */
 161:src/stm32/stm32f4.c **** static void
 162:src/stm32/stm32f4.c **** systick_setup(void)
 163:src/stm32/stm32f4.c **** {
 164:src/stm32/stm32f4.c ****     /* Configure SysTick for 1ms interrupt */
 165:src/stm32/stm32f4.c ****     /* Reload value = (168 MHz / 1000) - 1 = 167999 */
 166:src/stm32/stm32f4.c ****     SYSTICK_RVR_REG = (CONFIG_CLOCK_FREQ / 1000) - 1;
 167:src/stm32/stm32f4.c ****     SYSTICK_CVR_REG = 0;
 168:src/stm32/stm32f4.c ****     SYSTICK_CSR_REG = SYSTICK_CSR_ENABLE 
 169:src/stm32/stm32f4.c ****                     | SYSTICK_CSR_TICKINT 
 170:src/stm32/stm32f4.c ****                     | SYSTICK_CSR_CLKSOURCE;
 171:src/stm32/stm32f4.c **** }
 172:src/stm32/stm32f4.c **** 
 173:src/stm32/stm32f4.c **** /* ========== Public Functions ========== */
 174:src/stm32/stm32f4.c **** 
 175:src/stm32/stm32f4.c **** /**
 176:src/stm32/stm32f4.c ****  * @brief   System initialization
 177:src/stm32/stm32f4.c ****  * 
 178:src/stm32/stm32f4.c ****  * Configures system clock to 168 MHz and initializes peripherals.
 179:src/stm32/stm32f4.c ****  */
 180:src/stm32/stm32f4.c **** void
 181:src/stm32/stm32f4.c **** system_init(void)
 182:src/stm32/stm32f4.c **** {
  30              		.loc 1 182 1 view -0
  31              		.cfi_startproc
  32              		@ args = 0, pretend = 0, frame = 0
  33              		@ frame_needed = 0, uses_anonymous_args = 0
  34              		@ link register save eliminated.
 183:src/stm32/stm32f4.c ****     /* Configure PLL for 168 MHz */
 184:src/stm32/stm32f4.c ****     clock_setup_pll();
  35              		.loc 1 184 5 view .LVU1
  36              	.LBB8:
  37              	.LBI8:
 105:src/stm32/stm32f4.c **** {
  38              		.loc 1 105 1 view .LVU2
  39              	.LBB9:
 108:src/stm32/stm32f4.c ****     
  40              		.loc 1 108 5 view .LVU3
 108:src/stm32/stm32f4.c ****     
  41              		.loc 1 108 12 is_stmt 0 view .LVU4
  42 0000 244A     		ldr	r2, .L12
ARM GAS  /tmp/cc7lly76.s 			page 5


  43 0002 D2F80038 		ldr	r3, [r2, #2048]
  44 0006 43F48033 		orr	r3, r3, #65536
  45              	.LBE9:
  46              	.LBE8:
 182:src/stm32/stm32f4.c ****     /* Configure PLL for 168 MHz */
  47              		.loc 1 182 1 view .LVU5
  48 000a 10B4     		push	{r4}
  49              		.cfi_def_cfa_offset 4
  50              		.cfi_offset 4, -4
  51              	.LBB11:
  52              	.LBB10:
 108:src/stm32/stm32f4.c ****     
  53              		.loc 1 108 12 view .LVU6
  54 000c C2F80038 		str	r3, [r2, #2048]
 111:src/stm32/stm32f4.c ****         /* Wait */
  55              		.loc 1 111 5 is_stmt 1 view .LVU7
  56              	.L2:
 113:src/stm32/stm32f4.c ****     
  57              		.loc 1 113 5 view .LVU8
 111:src/stm32/stm32f4.c ****         /* Wait */
  58              		.loc 1 111 11 view .LVU9
 111:src/stm32/stm32f4.c ****         /* Wait */
  59              		.loc 1 111 14 is_stmt 0 view .LVU10
  60 0010 D2F80038 		ldr	r3, [r2, #2048]
 111:src/stm32/stm32f4.c ****         /* Wait */
  61              		.loc 1 111 11 view .LVU11
  62 0014 9903     		lsls	r1, r3, #14
  63 0016 FBD5     		bpl	.L2
 116:src/stm32/stm32f4.c ****     
  64              		.loc 1 116 5 is_stmt 1 view .LVU12
 116:src/stm32/stm32f4.c ****     
  65              		.loc 1 116 17 is_stmt 0 view .LVU13
  66 0018 D2F84038 		ldr	r3, [r2, #2112]
 119:src/stm32/stm32f4.c ****     
  67              		.loc 1 119 12 view .LVU14
  68 001c 1E49     		ldr	r1, .L12+4
 129:src/stm32/stm32f4.c ****                 | (336 << 6)    /* PLLN */
  69              		.loc 1 129 17 view .LVU15
  70 001e 1F48     		ldr	r0, .L12+8
 116:src/stm32/stm32f4.c ****     
  71              		.loc 1 116 17 view .LVU16
  72 0020 43F08053 		orr	r3, r3, #268435456
  73 0024 C2F84038 		str	r3, [r2, #2112]
 119:src/stm32/stm32f4.c ****     
  74              		.loc 1 119 5 is_stmt 1 view .LVU17
 119:src/stm32/stm32f4.c ****     
  75              		.loc 1 119 12 is_stmt 0 view .LVU18
  76 0028 0B68     		ldr	r3, [r1]
 122:src/stm32/stm32f4.c ****               | FLASH_ACR_PRFTEN 
  77              		.loc 1 122 15 view .LVU19
  78 002a 40F20574 		movw	r4, #1797
 119:src/stm32/stm32f4.c ****     
  79              		.loc 1 119 12 view .LVU20
  80 002e 43F48043 		orr	r3, r3, #16384
  81 0032 0B60     		str	r3, [r1]
 122:src/stm32/stm32f4.c ****               | FLASH_ACR_PRFTEN 
  82              		.loc 1 122 5 is_stmt 1 view .LVU21
ARM GAS  /tmp/cc7lly76.s 			page 6


 122:src/stm32/stm32f4.c ****               | FLASH_ACR_PRFTEN 
  83              		.loc 1 122 15 is_stmt 0 view .LVU22
  84 0034 C2F8004C 		str	r4, [r2, #3072]
 129:src/stm32/stm32f4.c ****                 | (336 << 6)    /* PLLN */
  85              		.loc 1 129 5 is_stmt 1 view .LVU23
 129:src/stm32/stm32f4.c ****                 | (336 << 6)    /* PLLN */
  86              		.loc 1 129 17 is_stmt 0 view .LVU24
  87 0038 C2F80408 		str	r0, [r2, #2052]
 136:src/stm32/stm32f4.c ****     
  88              		.loc 1 136 5 is_stmt 1 view .LVU25
 136:src/stm32/stm32f4.c ****     
  89              		.loc 1 136 12 is_stmt 0 view .LVU26
  90 003c D2F80038 		ldr	r3, [r2, #2048]
  91 0040 43F08073 		orr	r3, r3, #16777216
 139:src/stm32/stm32f4.c ****         /* Wait */
  92              		.loc 1 139 14 view .LVU27
  93 0044 01F5E031 		add	r1, r1, #114688
 136:src/stm32/stm32f4.c ****     
  94              		.loc 1 136 12 view .LVU28
  95 0048 C2F80038 		str	r3, [r2, #2048]
 139:src/stm32/stm32f4.c ****         /* Wait */
  96              		.loc 1 139 5 is_stmt 1 view .LVU29
  97              	.L3:
 141:src/stm32/stm32f4.c ****     
  98              		.loc 1 141 5 view .LVU30
 139:src/stm32/stm32f4.c ****         /* Wait */
  99              		.loc 1 139 11 view .LVU31
 139:src/stm32/stm32f4.c ****         /* Wait */
 100              		.loc 1 139 14 is_stmt 0 view .LVU32
 101 004c D1F80038 		ldr	r3, [r1, #2048]
 139:src/stm32/stm32f4.c ****         /* Wait */
 102              		.loc 1 139 11 view .LVU33
 103 0050 9B01     		lsls	r3, r3, #6
 104 0052 FBD5     		bpl	.L3
 145:src/stm32/stm32f4.c ****              | RCC_CFGR_PPRE1_DIV4 
 105              		.loc 1 145 5 is_stmt 1 view .LVU34
 145:src/stm32/stm32f4.c ****              | RCC_CFGR_PPRE1_DIV4 
 106              		.loc 1 145 14 is_stmt 0 view .LVU35
 107 0054 4FF41443 		mov	r3, #37888
 108 0058 C1F80838 		str	r3, [r1, #2056]
 150:src/stm32/stm32f4.c ****     
 109              		.loc 1 150 5 is_stmt 1 view .LVU36
 150:src/stm32/stm32f4.c ****     
 110              		.loc 1 150 17 is_stmt 0 view .LVU37
 111 005c D1F80838 		ldr	r3, [r1, #2056]
 153:src/stm32/stm32f4.c ****         /* Wait */
 112              		.loc 1 153 13 view .LVU38
 113 0060 0C4A     		ldr	r2, .L12
 150:src/stm32/stm32f4.c ****     
 114              		.loc 1 150 26 view .LVU39
 115 0062 23F00303 		bic	r3, r3, #3
 150:src/stm32/stm32f4.c ****     
 116              		.loc 1 150 47 view .LVU40
 117 0066 43F00203 		orr	r3, r3, #2
 150:src/stm32/stm32f4.c ****     
 118              		.loc 1 150 14 view .LVU41
 119 006a C1F80838 		str	r3, [r1, #2056]
ARM GAS  /tmp/cc7lly76.s 			page 7


 153:src/stm32/stm32f4.c ****         /* Wait */
 120              		.loc 1 153 5 is_stmt 1 view .LVU42
 121              	.L4:
 155:src/stm32/stm32f4.c **** }
 122              		.loc 1 155 5 view .LVU43
 153:src/stm32/stm32f4.c ****         /* Wait */
 123              		.loc 1 153 11 view .LVU44
 153:src/stm32/stm32f4.c ****         /* Wait */
 124              		.loc 1 153 13 is_stmt 0 view .LVU45
 125 006e D2F80838 		ldr	r3, [r2, #2056]
 153:src/stm32/stm32f4.c ****         /* Wait */
 126              		.loc 1 153 22 view .LVU46
 127 0072 03F00C03 		and	r3, r3, #12
 153:src/stm32/stm32f4.c ****         /* Wait */
 128              		.loc 1 153 11 view .LVU47
 129 0076 082B     		cmp	r3, #8
 130 0078 F9D1     		bne	.L4
 131              	.LBE10:
 132              	.LBE11:
 185:src/stm32/stm32f4.c ****     
 186:src/stm32/stm32f4.c ****     /* Configure SysTick */
 187:src/stm32/stm32f4.c ****     systick_setup();
 133              		.loc 1 187 5 is_stmt 1 view .LVU48
 134              	.LBB12:
 135              	.LBI12:
 162:src/stm32/stm32f4.c **** {
 136              		.loc 1 162 1 view .LVU49
 137              	.LBB13:
 166:src/stm32/stm32f4.c ****     SYSTICK_CVR_REG = 0;
 138              		.loc 1 166 5 view .LVU50
 166:src/stm32/stm32f4.c ****     SYSTICK_CVR_REG = 0;
 139              		.loc 1 166 21 is_stmt 0 view .LVU51
 140 007a 4FF0E023 		mov	r3, #-536813568
 141 007e 0848     		ldr	r0, .L12+12
 142 0080 5861     		str	r0, [r3, #20]
 167:src/stm32/stm32f4.c ****     SYSTICK_CSR_REG = SYSTICK_CSR_ENABLE 
 143              		.loc 1 167 5 is_stmt 1 view .LVU52
 167:src/stm32/stm32f4.c ****     SYSTICK_CSR_REG = SYSTICK_CSR_ENABLE 
 144              		.loc 1 167 21 is_stmt 0 view .LVU53
 145 0082 0021     		movs	r1, #0
 168:src/stm32/stm32f4.c ****                     | SYSTICK_CSR_TICKINT 
 146              		.loc 1 168 21 view .LVU54
 147 0084 0722     		movs	r2, #7
 167:src/stm32/stm32f4.c ****     SYSTICK_CSR_REG = SYSTICK_CSR_ENABLE 
 148              		.loc 1 167 21 view .LVU55
 149 0086 9961     		str	r1, [r3, #24]
 168:src/stm32/stm32f4.c ****                     | SYSTICK_CSR_TICKINT 
 150              		.loc 1 168 5 is_stmt 1 view .LVU56
 151              	.LBE13:
 152              	.LBE12:
 188:src/stm32/stm32f4.c ****     
 189:src/stm32/stm32f4.c ****     /* Initialize GPIO */
 190:src/stm32/stm32f4.c ****     gpio_init();
 191:src/stm32/stm32f4.c **** }
 153              		.loc 1 191 1 is_stmt 0 view .LVU57
 154 0088 5DF8044B 		ldr	r4, [sp], #4
 155              		.cfi_restore 4
ARM GAS  /tmp/cc7lly76.s 			page 8


 156              		.cfi_def_cfa_offset 0
 157              	.LBB15:
 158              	.LBB14:
 168:src/stm32/stm32f4.c ****                     | SYSTICK_CSR_TICKINT 
 159              		.loc 1 168 21 view .LVU58
 160 008c 1A61     		str	r2, [r3, #16]
 161              	.LBE14:
 162              	.LBE15:
 190:src/stm32/stm32f4.c **** }
 163              		.loc 1 190 5 is_stmt 1 view .LVU59
 164 008e FFF7FEBF 		b	gpio_init
 165              	.LVL0:
 166              	.L13:
 167 0092 00BF     		.align	2
 168              	.L12:
 169 0094 00300240 		.word	1073885184
 170 0098 00700040 		.word	1073770496
 171 009c 08544007 		.word	121656328
 172 00a0 3F900200 		.word	167999
 173              		.cfi_endproc
 174              	.LFE9:
 176              		.section	.text.get_pclock_frequency,"ax",%progbits
 177              		.align	1
 178              		.p2align 2,,3
 179              		.global	get_pclock_frequency
 180              		.syntax unified
 181              		.thumb
 182              		.thumb_func
 183              		.fpu fpv4-sp-d16
 185              	get_pclock_frequency:
 186              	.LVL1:
 187              	.LFB10:
 192:src/stm32/stm32f4.c **** 
 193:src/stm32/stm32f4.c **** /**
 194:src/stm32/stm32f4.c ****  * @brief   Get peripheral clock frequency
 195:src/stm32/stm32f4.c ****  * @param   periph_base     Peripheral base address
 196:src/stm32/stm32f4.c ****  * @return  Clock frequency in Hz
 197:src/stm32/stm32f4.c ****  */
 198:src/stm32/stm32f4.c **** uint32_t
 199:src/stm32/stm32f4.c **** get_pclock_frequency(uint32_t periph_base)
 200:src/stm32/stm32f4.c **** {
 188              		.loc 1 200 1 view -0
 189              		.cfi_startproc
 190              		@ args = 0, pretend = 0, frame = 0
 191              		@ frame_needed = 0, uses_anonymous_args = 0
 192              		@ link register save eliminated.
 201:src/stm32/stm32f4.c ****     /* APB1 peripherals (0x40000000 - 0x4000FFFF) */
 202:src/stm32/stm32f4.c ****     if (periph_base >= 0x40000000 && periph_base < 0x40010000) {
 193              		.loc 1 202 5 view .LVU61
 194              		.loc 1 202 35 is_stmt 0 view .LVU62
 195 0000 00F14043 		add	r3, r0, #-1073741824
 196              		.loc 1 202 8 view .LVU63
 197 0004 B3F5803F 		cmp	r3, #65536
 198 0008 0BD3     		bcc	.L16
 203:src/stm32/stm32f4.c ****         return APB1_FREQ;
 204:src/stm32/stm32f4.c ****     }
 205:src/stm32/stm32f4.c ****     
ARM GAS  /tmp/cc7lly76.s 			page 9


 206:src/stm32/stm32f4.c ****     /* APB2 peripherals (0x40010000 - 0x4001FFFF) */
 207:src/stm32/stm32f4.c ****     if (periph_base >= 0x40010000 && periph_base < 0x40020000) {
 199              		.loc 1 207 5 is_stmt 1 view .LVU64
 208:src/stm32/stm32f4.c ****         return APB2_FREQ;
 200              		.loc 1 208 16 is_stmt 0 view .LVU65
 201 000a 074A     		ldr	r2, .L18
 202 000c 0749     		ldr	r1, .L18+4
 207:src/stm32/stm32f4.c ****         return APB2_FREQ;
 203              		.loc 1 207 35 view .LVU66
 204 000e 00F13F43 		add	r3, r0, #-1090519040
 205 0012 03F57F03 		add	r3, r3, #16711680
 206              		.loc 1 208 16 view .LVU67
 207 0016 B3F5803F 		cmp	r3, #65536
 208 001a 2CBF     		ite	cs
 209 001c 1046     		movcs	r0, r2
 210 001e 0846     		movcc	r0, r1
 211              	.LVL2:
 212              		.loc 1 208 16 view .LVU68
 213 0020 7047     		bx	lr
 214              	.LVL3:
 215              	.L16:
 203:src/stm32/stm32f4.c ****         return APB1_FREQ;
 216              		.loc 1 203 16 view .LVU69
 217 0022 0348     		ldr	r0, .L18+8
 218              	.LVL4:
 209:src/stm32/stm32f4.c ****     }
 210:src/stm32/stm32f4.c ****     
 211:src/stm32/stm32f4.c ****     /* AHB peripherals */
 212:src/stm32/stm32f4.c ****     return CONFIG_CLOCK_FREQ;
 213:src/stm32/stm32f4.c **** }
 219              		.loc 1 213 1 view .LVU70
 220 0024 7047     		bx	lr
 221              	.L19:
 222 0026 00BF     		.align	2
 223              	.L18:
 224 0028 007A030A 		.word	168000000
 225 002c 00BD0105 		.word	84000000
 226 0030 80DE8002 		.word	42000000
 227              		.cfi_endproc
 228              	.LFE10:
 230              		.section	.text.enable_pclock,"ax",%progbits
 231              		.align	1
 232              		.p2align 2,,3
 233              		.global	enable_pclock
 234              		.syntax unified
 235              		.thumb
 236              		.thumb_func
 237              		.fpu fpv4-sp-d16
 239              	enable_pclock:
 240              	.LVL5:
 241              	.LFB11:
 214:src/stm32/stm32f4.c **** 
 215:src/stm32/stm32f4.c **** /**
 216:src/stm32/stm32f4.c ****  * @brief   Enable peripheral clock
 217:src/stm32/stm32f4.c ****  * @param   periph_base     Peripheral base address
 218:src/stm32/stm32f4.c ****  */
 219:src/stm32/stm32f4.c **** void
ARM GAS  /tmp/cc7lly76.s 			page 10


 220:src/stm32/stm32f4.c **** enable_pclock(uint32_t periph_base)
 221:src/stm32/stm32f4.c **** {
 242              		.loc 1 221 1 is_stmt 1 view -0
 243              		.cfi_startproc
 244              		@ args = 0, pretend = 0, frame = 0
 245              		@ frame_needed = 0, uses_anonymous_args = 0
 246              		@ link register save eliminated.
 222:src/stm32/stm32f4.c ****     /* GPIO ports (AHB1) */
 223:src/stm32/stm32f4.c ****     if (periph_base >= GPIOA_BASE && periph_base <= GPIOI_BASE) {
 247              		.loc 1 223 5 view .LVU72
 248              		.loc 1 223 35 is_stmt 0 view .LVU73
 249 0000 00F13F43 		add	r3, r0, #-1090519040
 250 0004 03F57E03 		add	r3, r3, #16646144
 251              		.loc 1 223 8 view .LVU74
 252 0008 B3F5005F 		cmp	r3, #8192
 253 000c 15D9     		bls	.L29
 224:src/stm32/stm32f4.c ****         uint32_t port = (periph_base - GPIOA_BASE) / 0x400;
 225:src/stm32/stm32f4.c ****         RCC_AHB1ENR |= (1 << port);
 226:src/stm32/stm32f4.c ****         return;
 227:src/stm32/stm32f4.c ****     }
 228:src/stm32/stm32f4.c ****     
 229:src/stm32/stm32f4.c ****     /* USART1 (APB2) */
 230:src/stm32/stm32f4.c ****     if (periph_base == USART1_BASE) {
 254              		.loc 1 230 5 is_stmt 1 view .LVU75
 255              		.loc 1 230 8 is_stmt 0 view .LVU76
 256 000e 2C4B     		ldr	r3, .L37
 257 0010 9842     		cmp	r0, r3
 258 0012 25D0     		beq	.L30
 231:src/stm32/stm32f4.c ****         RCC_APB2ENR |= (1 << 4);
 232:src/stm32/stm32f4.c ****         return;
 233:src/stm32/stm32f4.c ****     }
 234:src/stm32/stm32f4.c ****     
 235:src/stm32/stm32f4.c ****     /* USART2 (APB1) */
 236:src/stm32/stm32f4.c ****     if (periph_base == USART2_BASE) {
 259              		.loc 1 236 5 is_stmt 1 view .LVU77
 260              		.loc 1 236 8 is_stmt 0 view .LVU78
 261 0014 2B4B     		ldr	r3, .L37+4
 262 0016 9842     		cmp	r0, r3
 263 0018 1AD0     		beq	.L31
 237:src/stm32/stm32f4.c ****         RCC_APB1ENR |= (1 << 17);
 238:src/stm32/stm32f4.c ****         return;
 239:src/stm32/stm32f4.c ****     }
 240:src/stm32/stm32f4.c ****     
 241:src/stm32/stm32f4.c ****     /* USART3 (APB1) */
 242:src/stm32/stm32f4.c ****     if (periph_base == USART3_BASE) {
 264              		.loc 1 242 5 is_stmt 1 view .LVU79
 265              		.loc 1 242 8 is_stmt 0 view .LVU80
 266 001a 2B4B     		ldr	r3, .L37+8
 267 001c 9842     		cmp	r0, r3
 268 001e 27D0     		beq	.L32
 243:src/stm32/stm32f4.c ****         RCC_APB1ENR |= (1 << 18);
 244:src/stm32/stm32f4.c ****         return;
 245:src/stm32/stm32f4.c ****     }
 246:src/stm32/stm32f4.c ****     
 247:src/stm32/stm32f4.c ****     /* TIM2 (APB1) */
 248:src/stm32/stm32f4.c ****     if (periph_base == TIM2_BASE) {
 269              		.loc 1 248 5 is_stmt 1 view .LVU81
ARM GAS  /tmp/cc7lly76.s 			page 11


 270              		.loc 1 248 8 is_stmt 0 view .LVU82
 271 0020 B0F1804F 		cmp	r0, #1073741824
 272 0024 2CD0     		beq	.L33
 249:src/stm32/stm32f4.c ****         RCC_APB1ENR |= (1 << 0);
 250:src/stm32/stm32f4.c ****         return;
 251:src/stm32/stm32f4.c ****     }
 252:src/stm32/stm32f4.c ****     
 253:src/stm32/stm32f4.c ****     /* TIM3 (APB1) */
 254:src/stm32/stm32f4.c ****     if (periph_base == TIM3_BASE) {
 273              		.loc 1 254 5 is_stmt 1 view .LVU83
 274              		.loc 1 254 8 is_stmt 0 view .LVU84
 275 0026 294B     		ldr	r3, .L37+12
 276 0028 9842     		cmp	r0, r3
 277 002a 31D0     		beq	.L34
 255:src/stm32/stm32f4.c ****         RCC_APB1ENR |= (1 << 1);
 256:src/stm32/stm32f4.c ****         return;
 257:src/stm32/stm32f4.c ****     }
 258:src/stm32/stm32f4.c ****     
 259:src/stm32/stm32f4.c ****     /* TIM4 (APB1) */
 260:src/stm32/stm32f4.c ****     if (periph_base == TIM4_BASE) {
 278              		.loc 1 260 5 is_stmt 1 view .LVU85
 279              		.loc 1 260 8 is_stmt 0 view .LVU86
 280 002c 284B     		ldr	r3, .L37+16
 281 002e 9842     		cmp	r0, r3
 282 0030 36D0     		beq	.L35
 261:src/stm32/stm32f4.c ****         RCC_APB1ENR |= (1 << 2);
 262:src/stm32/stm32f4.c ****         return;
 263:src/stm32/stm32f4.c ****     }
 264:src/stm32/stm32f4.c ****     
 265:src/stm32/stm32f4.c ****     /* ADC1 (APB2) */
 266:src/stm32/stm32f4.c ****     if (periph_base == 0x40012000) {
 283              		.loc 1 266 5 is_stmt 1 view .LVU87
 284              		.loc 1 266 8 is_stmt 0 view .LVU88
 285 0032 284B     		ldr	r3, .L37+20
 286 0034 9842     		cmp	r0, r3
 287 0036 3BD0     		beq	.L36
 288              	.L20:
 267:src/stm32/stm32f4.c ****         RCC_APB2ENR |= (1 << 8);
 268:src/stm32/stm32f4.c ****         return;
 269:src/stm32/stm32f4.c ****     }
 270:src/stm32/stm32f4.c **** }
 289              		.loc 1 270 1 view .LVU89
 290 0038 7047     		bx	lr
 291              	.L29:
 292              	.LBB16:
 224:src/stm32/stm32f4.c ****         RCC_AHB1ENR |= (1 << port);
 293              		.loc 1 224 9 is_stmt 1 view .LVU90
 294              	.LVL6:
 225:src/stm32/stm32f4.c ****         return;
 295              		.loc 1 225 9 view .LVU91
 225:src/stm32/stm32f4.c ****         return;
 296              		.loc 1 225 21 is_stmt 0 view .LVU92
 297 003a 2749     		ldr	r1, .L37+24
 224:src/stm32/stm32f4.c ****         RCC_AHB1ENR |= (1 << port);
 298              		.loc 1 224 18 view .LVU93
 299 003c 9B0A     		lsrs	r3, r3, #10
 300              	.LVL7:
ARM GAS  /tmp/cc7lly76.s 			page 12


 225:src/stm32/stm32f4.c ****         return;
 301              		.loc 1 225 21 view .LVU94
 302 003e D1F83008 		ldr	r0, [r1, #2096]
 303              	.LVL8:
 225:src/stm32/stm32f4.c ****         return;
 304              		.loc 1 225 27 view .LVU95
 305 0042 0122     		movs	r2, #1
 306 0044 02FA03F3 		lsl	r3, r2, r3
 307              	.LVL9:
 225:src/stm32/stm32f4.c ****         return;
 308              		.loc 1 225 21 view .LVU96
 309 0048 0343     		orrs	r3, r3, r0
 310 004a C1F83038 		str	r3, [r1, #2096]
 226:src/stm32/stm32f4.c ****     }
 311              		.loc 1 226 9 is_stmt 1 view .LVU97
 312 004e 7047     		bx	lr
 313              	.LVL10:
 314              	.L31:
 226:src/stm32/stm32f4.c ****     }
 315              		.loc 1 226 9 is_stmt 0 view .LVU98
 316              	.LBE16:
 237:src/stm32/stm32f4.c ****         return;
 317              		.loc 1 237 9 is_stmt 1 view .LVU99
 237:src/stm32/stm32f4.c ****         return;
 318              		.loc 1 237 21 is_stmt 0 view .LVU100
 319 0050 214A     		ldr	r2, .L37+24
 320 0052 D2F84038 		ldr	r3, [r2, #2112]
 321 0056 43F40033 		orr	r3, r3, #131072
 322 005a C2F84038 		str	r3, [r2, #2112]
 238:src/stm32/stm32f4.c ****     }
 323              		.loc 1 238 9 is_stmt 1 view .LVU101
 324 005e 7047     		bx	lr
 325              	.L30:
 231:src/stm32/stm32f4.c ****         return;
 326              		.loc 1 231 9 view .LVU102
 231:src/stm32/stm32f4.c ****         return;
 327              		.loc 1 231 21 is_stmt 0 view .LVU103
 328 0060 1D4A     		ldr	r2, .L37+24
 329 0062 D2F84438 		ldr	r3, [r2, #2116]
 330 0066 43F01003 		orr	r3, r3, #16
 331 006a C2F84438 		str	r3, [r2, #2116]
 232:src/stm32/stm32f4.c ****     }
 332              		.loc 1 232 9 is_stmt 1 view .LVU104
 333 006e 7047     		bx	lr
 334              	.L32:
 243:src/stm32/stm32f4.c ****         return;
 335              		.loc 1 243 9 view .LVU105
 243:src/stm32/stm32f4.c ****         return;
 336              		.loc 1 243 21 is_stmt 0 view .LVU106
 337 0070 194A     		ldr	r2, .L37+24
 338 0072 D2F84038 		ldr	r3, [r2, #2112]
 339 0076 43F48023 		orr	r3, r3, #262144
 340 007a C2F84038 		str	r3, [r2, #2112]
 244:src/stm32/stm32f4.c ****     }
 341              		.loc 1 244 9 is_stmt 1 view .LVU107
 342 007e 7047     		bx	lr
 343              	.L33:
ARM GAS  /tmp/cc7lly76.s 			page 13


 249:src/stm32/stm32f4.c ****         return;
 344              		.loc 1 249 9 view .LVU108
 249:src/stm32/stm32f4.c ****         return;
 345              		.loc 1 249 21 is_stmt 0 view .LVU109
 346 0080 154A     		ldr	r2, .L37+24
 347 0082 D2F84038 		ldr	r3, [r2, #2112]
 348 0086 43F00103 		orr	r3, r3, #1
 349 008a C2F84038 		str	r3, [r2, #2112]
 250:src/stm32/stm32f4.c ****     }
 350              		.loc 1 250 9 is_stmt 1 view .LVU110
 351 008e 7047     		bx	lr
 352              	.L34:
 255:src/stm32/stm32f4.c ****         return;
 353              		.loc 1 255 9 view .LVU111
 255:src/stm32/stm32f4.c ****         return;
 354              		.loc 1 255 21 is_stmt 0 view .LVU112
 355 0090 114A     		ldr	r2, .L37+24
 356 0092 D2F84038 		ldr	r3, [r2, #2112]
 357 0096 43F00203 		orr	r3, r3, #2
 358 009a C2F84038 		str	r3, [r2, #2112]
 256:src/stm32/stm32f4.c ****     }
 359              		.loc 1 256 9 is_stmt 1 view .LVU113
 360 009e 7047     		bx	lr
 361              	.L35:
 261:src/stm32/stm32f4.c ****         return;
 362              		.loc 1 261 9 view .LVU114
 261:src/stm32/stm32f4.c ****         return;
 363              		.loc 1 261 21 is_stmt 0 view .LVU115
 364 00a0 0D4A     		ldr	r2, .L37+24
 365 00a2 D2F84038 		ldr	r3, [r2, #2112]
 366 00a6 43F00403 		orr	r3, r3, #4
 367 00aa C2F84038 		str	r3, [r2, #2112]
 262:src/stm32/stm32f4.c ****     }
 368              		.loc 1 262 9 is_stmt 1 view .LVU116
 369 00ae 7047     		bx	lr
 370              	.L36:
 267:src/stm32/stm32f4.c ****         return;
 371              		.loc 1 267 9 view .LVU117
 267:src/stm32/stm32f4.c ****         return;
 372              		.loc 1 267 21 is_stmt 0 view .LVU118
 373 00b0 094A     		ldr	r2, .L37+24
 374 00b2 D2F84438 		ldr	r3, [r2, #2116]
 375 00b6 43F48073 		orr	r3, r3, #256
 376 00ba C2F84438 		str	r3, [r2, #2116]
 268:src/stm32/stm32f4.c ****     }
 377              		.loc 1 268 9 is_stmt 1 view .LVU119
 378 00be BBE7     		b	.L20
 379              	.L38:
 380              		.align	2
 381              	.L37:
 382 00c0 00100140 		.word	1073811456
 383 00c4 00440040 		.word	1073759232
 384 00c8 00480040 		.word	1073760256
 385 00cc 00040040 		.word	1073742848
 386 00d0 00080040 		.word	1073743872
 387 00d4 00200140 		.word	1073815552
 388 00d8 00300240 		.word	1073885184
ARM GAS  /tmp/cc7lly76.s 			page 14


 389              		.cfi_endproc
 390              	.LFE11:
 392              		.section	.text.is_enabled_pclock,"ax",%progbits
 393              		.align	1
 394              		.p2align 2,,3
 395              		.global	is_enabled_pclock
 396              		.syntax unified
 397              		.thumb
 398              		.thumb_func
 399              		.fpu fpv4-sp-d16
 401              	is_enabled_pclock:
 402              	.LVL11:
 403              	.LFB12:
 271:src/stm32/stm32f4.c **** 
 272:src/stm32/stm32f4.c **** /**
 273:src/stm32/stm32f4.c ****  * @brief   Check if peripheral clock is enabled
 274:src/stm32/stm32f4.c ****  * @param   periph_base     Peripheral base address
 275:src/stm32/stm32f4.c ****  * @return  1 if enabled, 0 otherwise
 276:src/stm32/stm32f4.c ****  */
 277:src/stm32/stm32f4.c **** int
 278:src/stm32/stm32f4.c **** is_enabled_pclock(uint32_t periph_base)
 279:src/stm32/stm32f4.c **** {
 404              		.loc 1 279 1 view -0
 405              		.cfi_startproc
 406              		@ args = 0, pretend = 0, frame = 0
 407              		@ frame_needed = 0, uses_anonymous_args = 0
 408              		@ link register save eliminated.
 280:src/stm32/stm32f4.c ****     /* GPIO ports (AHB1) */
 281:src/stm32/stm32f4.c ****     if (periph_base >= GPIOA_BASE && periph_base <= GPIOI_BASE) {
 409              		.loc 1 281 5 view .LVU121
 410              		.loc 1 281 35 is_stmt 0 view .LVU122
 411 0000 00F13F43 		add	r3, r0, #-1090519040
 412 0004 03F57E03 		add	r3, r3, #16646144
 413              		.loc 1 281 8 view .LVU123
 414 0008 B3F5005F 		cmp	r3, #8192
 415 000c 0DD9     		bls	.L44
 282:src/stm32/stm32f4.c ****         uint32_t port = (periph_base - GPIOA_BASE) / 0x400;
 283:src/stm32/stm32f4.c ****         return (RCC_AHB1ENR >> port) & 1;
 284:src/stm32/stm32f4.c ****     }
 285:src/stm32/stm32f4.c ****     
 286:src/stm32/stm32f4.c ****     /* USART1 (APB2) */
 287:src/stm32/stm32f4.c ****     if (periph_base == USART1_BASE) {
 416              		.loc 1 287 5 is_stmt 1 view .LVU124
 417              		.loc 1 287 8 is_stmt 0 view .LVU125
 418 000e 0F4B     		ldr	r3, .L46
 419 0010 9842     		cmp	r0, r3
 420 0012 13D0     		beq	.L45
 288:src/stm32/stm32f4.c ****         return (RCC_APB2ENR >> 4) & 1;
 289:src/stm32/stm32f4.c ****     }
 290:src/stm32/stm32f4.c ****     
 291:src/stm32/stm32f4.c ****     /* USART2 (APB1) */
 292:src/stm32/stm32f4.c ****     if (periph_base == USART2_BASE) {
 421              		.loc 1 292 5 is_stmt 1 view .LVU126
 293:src/stm32/stm32f4.c ****         return (RCC_APB1ENR >> 17) & 1;
 422              		.loc 1 293 9 view .LVU127
 292:src/stm32/stm32f4.c ****         return (RCC_APB1ENR >> 17) & 1;
 423              		.loc 1 292 8 is_stmt 0 view .LVU128
ARM GAS  /tmp/cc7lly76.s 			page 15


 424 0014 0E4B     		ldr	r3, .L46+4
 425 0016 9842     		cmp	r0, r3
 426              		.loc 1 293 17 view .LVU129
 427 0018 03BF     		ittte	eq
 428 001a 03F5F633 		addeq	r3, r3, #125952
 429 001e D3F84008 		ldreq	r0, [r3, #2112]
 430              	.LVL12:
 431              		.loc 1 293 36 view .LVU130
 432 0022 C0F34040 		ubfxeq	r0, r0, #17, #1
 294:src/stm32/stm32f4.c ****     }
 295:src/stm32/stm32f4.c ****     
 296:src/stm32/stm32f4.c ****     return 0;
 433              		.loc 1 296 12 view .LVU131
 434 0026 0020     		movne	r0, #0
 297:src/stm32/stm32f4.c **** }
 435              		.loc 1 297 1 view .LVU132
 436 0028 7047     		bx	lr
 437              	.LVL13:
 438              	.L44:
 439              	.LBB17:
 282:src/stm32/stm32f4.c ****         return (RCC_AHB1ENR >> port) & 1;
 440              		.loc 1 282 9 is_stmt 1 view .LVU133
 283:src/stm32/stm32f4.c ****     }
 441              		.loc 1 283 9 view .LVU134
 283:src/stm32/stm32f4.c ****     }
 442              		.loc 1 283 17 is_stmt 0 view .LVU135
 443 002a 0A4A     		ldr	r2, .L46+8
 444 002c D2F83008 		ldr	r0, [r2, #2096]
 445              	.LVL14:
 282:src/stm32/stm32f4.c ****         return (RCC_AHB1ENR >> port) & 1;
 446              		.loc 1 282 18 view .LVU136
 447 0030 9B0A     		lsrs	r3, r3, #10
 448              	.LVL15:
 283:src/stm32/stm32f4.c ****     }
 449              		.loc 1 283 29 view .LVU137
 450 0032 20FA03F3 		lsr	r3, r0, r3
 451              	.LVL16:
 283:src/stm32/stm32f4.c ****     }
 452              		.loc 1 283 38 view .LVU138
 453 0036 03F00100 		and	r0, r3, #1
 454 003a 7047     		bx	lr
 455              	.LVL17:
 456              	.L45:
 283:src/stm32/stm32f4.c ****     }
 457              		.loc 1 283 38 view .LVU139
 458              	.LBE17:
 288:src/stm32/stm32f4.c ****     }
 459              		.loc 1 288 9 is_stmt 1 view .LVU140
 288:src/stm32/stm32f4.c ****     }
 460              		.loc 1 288 17 is_stmt 0 view .LVU141
 461 003c 03F59033 		add	r3, r3, #73728
 462 0040 D3F84408 		ldr	r0, [r3, #2116]
 463              	.LVL18:
 288:src/stm32/stm32f4.c ****     }
 464              		.loc 1 288 35 view .LVU142
 465 0044 C0F30010 		ubfx	r0, r0, #4, #1
 466 0048 7047     		bx	lr
ARM GAS  /tmp/cc7lly76.s 			page 16


 467              	.L47:
 468 004a 00BF     		.align	2
 469              	.L46:
 470 004c 00100140 		.word	1073811456
 471 0050 00440040 		.word	1073759232
 472 0054 00300240 		.word	1073885184
 473              		.cfi_endproc
 474              	.LFE12:
 476              		.section	.text.timer_get_clock,"ax",%progbits
 477              		.align	1
 478              		.p2align 2,,3
 479              		.global	timer_get_clock
 480              		.syntax unified
 481              		.thumb
 482              		.thumb_func
 483              		.fpu fpv4-sp-d16
 485              	timer_get_clock:
 486              	.LFB13:
 298:src/stm32/stm32f4.c **** 
 299:src/stm32/stm32f4.c **** /**
 300:src/stm32/stm32f4.c ****  * @brief   Get timer clock frequency
 301:src/stm32/stm32f4.c ****  * @return  Timer clock frequency in Hz
 302:src/stm32/stm32f4.c ****  */
 303:src/stm32/stm32f4.c **** uint32_t
 304:src/stm32/stm32f4.c **** timer_get_clock(void)
 305:src/stm32/stm32f4.c **** {
 487              		.loc 1 305 1 is_stmt 1 view -0
 488              		.cfi_startproc
 489              		@ args = 0, pretend = 0, frame = 0
 490              		@ frame_needed = 0, uses_anonymous_args = 0
 491              		@ link register save eliminated.
 306:src/stm32/stm32f4.c ****     /* APB1 timer clock = APB1 * 2 = 84 MHz */
 307:src/stm32/stm32f4.c ****     return APB1_FREQ * 2;
 492              		.loc 1 307 5 view .LVU144
 308:src/stm32/stm32f4.c **** }
 493              		.loc 1 308 1 is_stmt 0 view .LVU145
 494 0000 0048     		ldr	r0, .L49
 495 0002 7047     		bx	lr
 496              	.L50:
 497              		.align	2
 498              	.L49:
 499 0004 00BD0105 		.word	84000000
 500              		.cfi_endproc
 501              	.LFE13:
 503              		.section	.text.udelay,"ax",%progbits
 504              		.align	1
 505              		.p2align 2,,3
 506              		.global	udelay
 507              		.syntax unified
 508              		.thumb
 509              		.thumb_func
 510              		.fpu fpv4-sp-d16
 512              	udelay:
 513              	.LVL19:
 514              	.LFB14:
 309:src/stm32/stm32f4.c **** 
 310:src/stm32/stm32f4.c **** /**
ARM GAS  /tmp/cc7lly76.s 			page 17


 311:src/stm32/stm32f4.c ****  * @brief   Microsecond delay
 312:src/stm32/stm32f4.c ****  * @param   us      Delay in microseconds
 313:src/stm32/stm32f4.c ****  */
 314:src/stm32/stm32f4.c **** void
 315:src/stm32/stm32f4.c **** udelay(uint32_t us)
 316:src/stm32/stm32f4.c **** {
 515              		.loc 1 316 1 is_stmt 1 view -0
 516              		.cfi_startproc
 517              		@ args = 0, pretend = 0, frame = 0
 518              		@ frame_needed = 0, uses_anonymous_args = 0
 519              		@ link register save eliminated.
 317:src/stm32/stm32f4.c ****     /* Simple busy-wait delay */
 318:src/stm32/stm32f4.c ****     /* At 168 MHz, ~168 cycles per microsecond */
 319:src/stm32/stm32f4.c ****     uint32_t cycles = us * (CONFIG_CLOCK_FREQ / 1000000);
 520              		.loc 1 319 5 view .LVU147
 521              		.loc 1 319 14 is_stmt 0 view .LVU148
 522 0000 A823     		movs	r3, #168
 523 0002 03FB00F0 		mul	r0, r3, r0
 524              	.LVL20:
 320:src/stm32/stm32f4.c ****     while (cycles--) {
 525              		.loc 1 320 5 is_stmt 1 view .LVU149
 526              		.loc 1 320 11 view .LVU150
 527              		.loc 1 320 18 is_stmt 0 view .LVU151
 528 0006 431E     		subs	r3, r0, #1
 529              	.LVL21:
 530              		.loc 1 320 11 view .LVU152
 531 0008 10B1     		cbz	r0, .L51
 532              	.LVL22:
 533              	.L53:
 321:src/stm32/stm32f4.c ****         __asm__ __volatile__("nop");
 534              		.loc 1 321 9 is_stmt 1 view .LVU153
 535              		.syntax unified
 536              	@ 321 "src/stm32/stm32f4.c" 1
 537 000a 00BF     		nop
 538              	@ 0 "" 2
 320:src/stm32/stm32f4.c ****     while (cycles--) {
 539              		.loc 1 320 11 view .LVU154
 540              		.thumb
 541              		.syntax unified
 542 000c 013B     		subs	r3, r3, #1
 543              	.LVL23:
 320:src/stm32/stm32f4.c ****     while (cycles--) {
 544              		.loc 1 320 11 is_stmt 0 view .LVU155
 545 000e FCD2     		bcs	.L53
 546              	.LVL24:
 547              	.L51:
 322:src/stm32/stm32f4.c ****     }
 323:src/stm32/stm32f4.c **** }
 548              		.loc 1 323 1 view .LVU156
 549 0010 7047     		bx	lr
 550              		.cfi_endproc
 551              	.LFE14:
 553 0012 00BF     		.section	.text.systick_get,"ax",%progbits
 554              		.align	1
 555              		.p2align 2,,3
 556              		.global	systick_get
 557              		.syntax unified
ARM GAS  /tmp/cc7lly76.s 			page 18


 558              		.thumb
 559              		.thumb_func
 560              		.fpu fpv4-sp-d16
 562              	systick_get:
 563              	.LFB15:
 324:src/stm32/stm32f4.c **** 
 325:src/stm32/stm32f4.c **** /**
 326:src/stm32/stm32f4.c ****  * @brief   Get system tick count (milliseconds)
 327:src/stm32/stm32f4.c ****  * @return  Tick count
 328:src/stm32/stm32f4.c ****  */
 329:src/stm32/stm32f4.c **** uint32_t
 330:src/stm32/stm32f4.c **** systick_get(void)
 331:src/stm32/stm32f4.c **** {
 564              		.loc 1 331 1 is_stmt 1 view -0
 565              		.cfi_startproc
 566              		@ args = 0, pretend = 0, frame = 0
 567              		@ frame_needed = 0, uses_anonymous_args = 0
 568              		@ link register save eliminated.
 332:src/stm32/stm32f4.c ****     return systick_count;
 569              		.loc 1 332 5 view .LVU158
 570              		.loc 1 332 12 is_stmt 0 view .LVU159
 571 0000 014B     		ldr	r3, .L59
 572 0002 1868     		ldr	r0, [r3]
 333:src/stm32/stm32f4.c **** }
 573              		.loc 1 333 1 view .LVU160
 574 0004 7047     		bx	lr
 575              	.L60:
 576 0006 00BF     		.align	2
 577              	.L59:
 578 0008 00000000 		.word	.LANCHOR0
 579              		.cfi_endproc
 580              	.LFE15:
 582              		.section	.text.SysTick_Handler,"ax",%progbits
 583              		.align	1
 584              		.p2align 2,,3
 585              		.global	SysTick_Handler
 586              		.syntax unified
 587              		.thumb
 588              		.thumb_func
 589              		.fpu fpv4-sp-d16
 591              	SysTick_Handler:
 592              	.LFB16:
 334:src/stm32/stm32f4.c **** 
 335:src/stm32/stm32f4.c **** /**
 336:src/stm32/stm32f4.c ****  * @brief   SysTick interrupt handler
 337:src/stm32/stm32f4.c ****  */
 338:src/stm32/stm32f4.c **** void
 339:src/stm32/stm32f4.c **** SysTick_Handler(void)
 340:src/stm32/stm32f4.c **** {
 593              		.loc 1 340 1 is_stmt 1 view -0
 594              		.cfi_startproc
 595              		@ args = 0, pretend = 0, frame = 0
 596              		@ frame_needed = 0, uses_anonymous_args = 0
 597              		@ link register save eliminated.
 341:src/stm32/stm32f4.c ****     systick_count++;
 598              		.loc 1 341 5 view .LVU162
 599              		.loc 1 341 18 is_stmt 0 view .LVU163
ARM GAS  /tmp/cc7lly76.s 			page 19


 600 0000 024A     		ldr	r2, .L62
 601 0002 1368     		ldr	r3, [r2]
 602 0004 0133     		adds	r3, r3, #1
 603 0006 1360     		str	r3, [r2]
 342:src/stm32/stm32f4.c **** }
 604              		.loc 1 342 1 view .LVU164
 605 0008 7047     		bx	lr
 606              	.L63:
 607 000a 00BF     		.align	2
 608              	.L62:
 609 000c 00000000 		.word	.LANCHOR0
 610              		.cfi_endproc
 611              	.LFE16:
 613              		.section	.text.timer_read_time,"ax",%progbits
 614              		.align	1
 615              		.p2align 2,,3
 616              		.global	timer_read_time
 617              		.syntax unified
 618              		.thumb
 619              		.thumb_func
 620              		.fpu fpv4-sp-d16
 622              	timer_read_time:
 623              	.LFB17:
 343:src/stm32/stm32f4.c **** 
 344:src/stm32/stm32f4.c **** /**
 345:src/stm32/stm32f4.c ****  * @brief   Get high-resolution timer value (microseconds)
 346:src/stm32/stm32f4.c ****  * @return  Timer value in microseconds
 347:src/stm32/stm32f4.c ****  */
 348:src/stm32/stm32f4.c **** uint32_t
 349:src/stm32/stm32f4.c **** timer_read_time(void)
 350:src/stm32/stm32f4.c **** {
 624              		.loc 1 350 1 is_stmt 1 view -0
 625              		.cfi_startproc
 626              		@ args = 0, pretend = 0, frame = 0
 627              		@ frame_needed = 0, uses_anonymous_args = 0
 628              		@ link register save eliminated.
 351:src/stm32/stm32f4.c ****     /* Use SysTick current value for sub-millisecond resolution */
 352:src/stm32/stm32f4.c ****     uint32_t ms = systick_count;
 629              		.loc 1 352 5 view .LVU166
 630              		.loc 1 352 14 is_stmt 0 view .LVU167
 631 0000 094B     		ldr	r3, .L65
 353:src/stm32/stm32f4.c ****     uint32_t ticks = SYSTICK_RVR_REG - SYSTICK_CVR_REG;
 632              		.loc 1 353 22 view .LVU168
 633 0002 4FF0E021 		mov	r1, #-536813568
 352:src/stm32/stm32f4.c ****     uint32_t ticks = SYSTICK_RVR_REG - SYSTICK_CVR_REG;
 634              		.loc 1 352 14 view .LVU169
 635 0006 1868     		ldr	r0, [r3]
 636              	.LVL25:
 637              		.loc 1 353 5 is_stmt 1 view .LVU170
 638              		.loc 1 353 22 is_stmt 0 view .LVU171
 639 0008 4B69     		ldr	r3, [r1, #20]
 640              		.loc 1 353 40 view .LVU172
 641 000a 8969     		ldr	r1, [r1, #24]
 642              	.LVL26:
 354:src/stm32/stm32f4.c ****     uint32_t us = (ticks * 1000) / (CONFIG_CLOCK_FREQ / 1000);
 643              		.loc 1 354 5 is_stmt 1 view .LVU173
 355:src/stm32/stm32f4.c ****     return (ms * 1000) + us;
ARM GAS  /tmp/cc7lly76.s 			page 20


 644              		.loc 1 355 5 view .LVU174
 354:src/stm32/stm32f4.c ****     uint32_t us = (ticks * 1000) / (CONFIG_CLOCK_FREQ / 1000);
 645              		.loc 1 354 26 is_stmt 0 view .LVU175
 646 000c 4FF47A72 		mov	r2, #1000
 353:src/stm32/stm32f4.c ****     uint32_t us = (ticks * 1000) / (CONFIG_CLOCK_FREQ / 1000);
 647              		.loc 1 353 14 view .LVU176
 648 0010 5B1A     		subs	r3, r3, r1
 649              	.LVL27:
 354:src/stm32/stm32f4.c ****     uint32_t us = (ticks * 1000) / (CONFIG_CLOCK_FREQ / 1000);
 650              		.loc 1 354 14 view .LVU177
 651 0012 0649     		ldr	r1, .L65+4
 354:src/stm32/stm32f4.c ****     uint32_t us = (ticks * 1000) / (CONFIG_CLOCK_FREQ / 1000);
 652              		.loc 1 354 26 view .LVU178
 653 0014 02FB03F3 		mul	r3, r2, r3
 654              	.LVL28:
 655              		.loc 1 355 16 view .LVU179
 656 0018 02FB00F0 		mul	r0, r2, r0
 657              	.LVL29:
 354:src/stm32/stm32f4.c ****     uint32_t us = (ticks * 1000) / (CONFIG_CLOCK_FREQ / 1000);
 658              		.loc 1 354 14 view .LVU180
 659 001c A1FB0323 		umull	r2, r3, r1, r3
 356:src/stm32/stm32f4.c **** }
 660              		.loc 1 356 1 view .LVU181
 661 0020 00EBD330 		add	r0, r0, r3, lsr #15
 662 0024 7047     		bx	lr
 663              	.L66:
 664 0026 00BF     		.align	2
 665              	.L65:
 666 0028 00000000 		.word	.LANCHOR0
 667 002c 09A4EE31 		.word	837723145
 668              		.cfi_endproc
 669              	.LFE17:
 671              		.section	.text.timer_is_before,"ax",%progbits
 672              		.align	1
 673              		.p2align 2,,3
 674              		.global	timer_is_before
 675              		.syntax unified
 676              		.thumb
 677              		.thumb_func
 678              		.fpu fpv4-sp-d16
 680              	timer_is_before:
 681              	.LVL30:
 682              	.LFB18:
 357:src/stm32/stm32f4.c **** 
 358:src/stm32/stm32f4.c **** /**
 359:src/stm32/stm32f4.c ****  * @brief   Check if timer value has passed
 360:src/stm32/stm32f4.c ****  * @param   time    Timer value to check
 361:src/stm32/stm32f4.c ****  * @return  1 if passed, 0 otherwise
 362:src/stm32/stm32f4.c ****  */
 363:src/stm32/stm32f4.c **** int
 364:src/stm32/stm32f4.c **** timer_is_before(uint32_t time1, uint32_t time2)
 365:src/stm32/stm32f4.c **** {
 683              		.loc 1 365 1 is_stmt 1 view -0
 684              		.cfi_startproc
 685              		@ args = 0, pretend = 0, frame = 0
 686              		@ frame_needed = 0, uses_anonymous_args = 0
 687              		@ link register save eliminated.
ARM GAS  /tmp/cc7lly76.s 			page 21


 366:src/stm32/stm32f4.c ****     return (int32_t)(time1 - time2) < 0;
 688              		.loc 1 366 5 view .LVU183
 689              		.loc 1 366 28 is_stmt 0 view .LVU184
 690 0000 401A     		subs	r0, r0, r1
 691              	.LVL31:
 367:src/stm32/stm32f4.c **** }
 692              		.loc 1 367 1 view .LVU185
 693 0002 C00F     		lsrs	r0, r0, #31
 694 0004 7047     		bx	lr
 695              		.cfi_endproc
 696              	.LFE18:
 698 0006 00BF     		.section	.bss.systick_count,"aw",%nobits
 699              		.align	2
 700              		.set	.LANCHOR0,. + 0
 703              	systick_count:
 704 0000 00000000 		.space	4
 705              		.text
 706              	.Letext0:
 707              		.file 2 "/usr/lib/gcc/arm-none-eabi/10.3.1/include/stdint.h"
 708              		.file 3 "src/stm32/gpio.h"
ARM GAS  /tmp/cc7lly76.s 			page 22


DEFINED SYMBOLS
                            *ABS*:0000000000000000 stm32f4.c
     /tmp/cc7lly76.s:18     .text.system_init:0000000000000000 $t
     /tmp/cc7lly76.s:27     .text.system_init:0000000000000000 system_init
     /tmp/cc7lly76.s:169    .text.system_init:0000000000000094 $d
     /tmp/cc7lly76.s:177    .text.get_pclock_frequency:0000000000000000 $t
     /tmp/cc7lly76.s:185    .text.get_pclock_frequency:0000000000000000 get_pclock_frequency
     /tmp/cc7lly76.s:224    .text.get_pclock_frequency:0000000000000028 $d
     /tmp/cc7lly76.s:231    .text.enable_pclock:0000000000000000 $t
     /tmp/cc7lly76.s:239    .text.enable_pclock:0000000000000000 enable_pclock
     /tmp/cc7lly76.s:382    .text.enable_pclock:00000000000000c0 $d
     /tmp/cc7lly76.s:393    .text.is_enabled_pclock:0000000000000000 $t
     /tmp/cc7lly76.s:401    .text.is_enabled_pclock:0000000000000000 is_enabled_pclock
     /tmp/cc7lly76.s:470    .text.is_enabled_pclock:000000000000004c $d
     /tmp/cc7lly76.s:477    .text.timer_get_clock:0000000000000000 $t
     /tmp/cc7lly76.s:485    .text.timer_get_clock:0000000000000000 timer_get_clock
     /tmp/cc7lly76.s:499    .text.timer_get_clock:0000000000000004 $d
     /tmp/cc7lly76.s:504    .text.udelay:0000000000000000 $t
     /tmp/cc7lly76.s:512    .text.udelay:0000000000000000 udelay
     /tmp/cc7lly76.s:554    .text.systick_get:0000000000000000 $t
     /tmp/cc7lly76.s:562    .text.systick_get:0000000000000000 systick_get
     /tmp/cc7lly76.s:578    .text.systick_get:0000000000000008 $d
     /tmp/cc7lly76.s:583    .text.SysTick_Handler:0000000000000000 $t
     /tmp/cc7lly76.s:591    .text.SysTick_Handler:0000000000000000 SysTick_Handler
     /tmp/cc7lly76.s:609    .text.SysTick_Handler:000000000000000c $d
     /tmp/cc7lly76.s:614    .text.timer_read_time:0000000000000000 $t
     /tmp/cc7lly76.s:622    .text.timer_read_time:0000000000000000 timer_read_time
     /tmp/cc7lly76.s:666    .text.timer_read_time:0000000000000028 $d
     /tmp/cc7lly76.s:672    .text.timer_is_before:0000000000000000 $t
     /tmp/cc7lly76.s:680    .text.timer_is_before:0000000000000000 timer_is_before
     /tmp/cc7lly76.s:699    .bss.systick_count:0000000000000000 $d
     /tmp/cc7lly76.s:703    .bss.systick_count:0000000000000000 systick_count

UNDEFINED SYMBOLS
gpio_init
