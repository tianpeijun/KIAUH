ARM GAS  /tmp/ccWwtxPM.s 			page 1


   1              		.cpu cortex-m4
   2              		.eabi_attribute 27, 1
   3              		.eabi_attribute 28, 1
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 2
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"serial.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text.serial_irq_handler,"ax",%progbits
  18              		.align	1
  19              		.p2align 2,,3
  20              		.global	serial_irq_handler
  21              		.arch armv7e-m
  22              		.syntax unified
  23              		.thumb
  24              		.thumb_func
  25              		.fpu fpv4-sp-d16
  27              	serial_irq_handler:
  28              	.LFB16:
  29              		.file 1 "src/stm32/serial.c"
   1:src/stm32/serial.c **** /**
   2:src/stm32/serial.c ****  * @file    serial.c
   3:src/stm32/serial.c ****  * @brief   STM32F407 USART serial driver implementation
   4:src/stm32/serial.c ****  * 
   5:src/stm32/serial.c ****  * USART configuration and communication for STM32F407.
   6:src/stm32/serial.c ****  * Supports interrupt-driven receive with ring buffer.
   7:src/stm32/serial.c ****  * Provides line-buffered input for G-code parsing.
   8:src/stm32/serial.c ****  * Follows Klipper coding style (C99, snake_case).
   9:src/stm32/serial.c ****  */
  10:src/stm32/serial.c **** 
  11:src/stm32/serial.c **** #include "serial.h"
  12:src/stm32/serial.c **** #include "gpio.h"
  13:src/stm32/serial.c **** #include "internal.h"
  14:src/stm32/serial.c **** #include "board/irq.h"
  15:src/stm32/serial.c **** #include <stdarg.h>
  16:src/stm32/serial.c **** 
  17:src/stm32/serial.c **** /* ========== USART Register Definitions ========== */
  18:src/stm32/serial.c **** 
  19:src/stm32/serial.c **** /* USART register structure */
  20:src/stm32/serial.c **** typedef struct {
  21:src/stm32/serial.c ****     volatile uint32_t SR;       /* Status register */
  22:src/stm32/serial.c ****     volatile uint32_t DR;       /* Data register */
  23:src/stm32/serial.c ****     volatile uint32_t BRR;      /* Baud rate register */
  24:src/stm32/serial.c ****     volatile uint32_t CR1;      /* Control register 1 */
  25:src/stm32/serial.c ****     volatile uint32_t CR2;      /* Control register 2 */
  26:src/stm32/serial.c ****     volatile uint32_t CR3;      /* Control register 3 */
  27:src/stm32/serial.c ****     volatile uint32_t GTPR;     /* Guard time and prescaler register */
  28:src/stm32/serial.c **** } usart_regs_t;
  29:src/stm32/serial.c **** 
ARM GAS  /tmp/ccWwtxPM.s 			page 2


  30:src/stm32/serial.c **** /* USART base addresses */
  31:src/stm32/serial.c **** #define USART1                  ((usart_regs_t *)USART1_BASE)
  32:src/stm32/serial.c **** #define USART2                  ((usart_regs_t *)USART2_BASE)
  33:src/stm32/serial.c **** #define USART3                  ((usart_regs_t *)USART3_BASE)
  34:src/stm32/serial.c **** 
  35:src/stm32/serial.c **** /* RCC registers for clock enable */
  36:src/stm32/serial.c **** #define RCC_BASE                0x40023800
  37:src/stm32/serial.c **** #define RCC_APB1ENR             (*(volatile uint32_t *)(RCC_BASE + 0x40))
  38:src/stm32/serial.c **** #define RCC_APB2ENR             (*(volatile uint32_t *)(RCC_BASE + 0x44))
  39:src/stm32/serial.c **** 
  40:src/stm32/serial.c **** /* ========== USART Status Register (SR) Bits ========== */
  41:src/stm32/serial.c **** 
  42:src/stm32/serial.c **** #define USART_SR_PE             (1 << 0)    /* Parity error */
  43:src/stm32/serial.c **** #define USART_SR_FE             (1 << 1)    /* Framing error */
  44:src/stm32/serial.c **** #define USART_SR_NF             (1 << 2)    /* Noise detected flag */
  45:src/stm32/serial.c **** #define USART_SR_ORE            (1 << 3)    /* Overrun error */
  46:src/stm32/serial.c **** #define USART_SR_IDLE           (1 << 4)    /* IDLE line detected */
  47:src/stm32/serial.c **** #define USART_SR_RXNE           (1 << 5)    /* Read data register not empty */
  48:src/stm32/serial.c **** #define USART_SR_TC             (1 << 6)    /* Transmission complete */
  49:src/stm32/serial.c **** #define USART_SR_TXE            (1 << 7)    /* Transmit data register empty */
  50:src/stm32/serial.c **** #define USART_SR_LBD            (1 << 8)    /* LIN break detection flag */
  51:src/stm32/serial.c **** #define USART_SR_CTS            (1 << 9)    /* CTS flag */
  52:src/stm32/serial.c **** 
  53:src/stm32/serial.c **** /* ========== USART Control Register 1 (CR1) Bits ========== */
  54:src/stm32/serial.c **** 
  55:src/stm32/serial.c **** #define USART_CR1_SBK           (1 << 0)    /* Send break */
  56:src/stm32/serial.c **** #define USART_CR1_RWU           (1 << 1)    /* Receiver wakeup */
  57:src/stm32/serial.c **** #define USART_CR1_RE            (1 << 2)    /* Receiver enable */
  58:src/stm32/serial.c **** #define USART_CR1_TE            (1 << 3)    /* Transmitter enable */
  59:src/stm32/serial.c **** #define USART_CR1_IDLEIE        (1 << 4)    /* IDLE interrupt enable */
  60:src/stm32/serial.c **** #define USART_CR1_RXNEIE        (1 << 5)    /* RXNE interrupt enable */
  61:src/stm32/serial.c **** #define USART_CR1_TCIE          (1 << 6)    /* Transmission complete interrupt enable */
  62:src/stm32/serial.c **** #define USART_CR1_TXEIE         (1 << 7)    /* TXE interrupt enable */
  63:src/stm32/serial.c **** #define USART_CR1_PEIE          (1 << 8)    /* PE interrupt enable */
  64:src/stm32/serial.c **** #define USART_CR1_PS            (1 << 9)    /* Parity selection */
  65:src/stm32/serial.c **** #define USART_CR1_PCE           (1 << 10)   /* Parity control enable */
  66:src/stm32/serial.c **** #define USART_CR1_WAKE          (1 << 11)   /* Wakeup method */
  67:src/stm32/serial.c **** #define USART_CR1_M             (1 << 12)   /* Word length */
  68:src/stm32/serial.c **** #define USART_CR1_UE            (1 << 13)   /* USART enable */
  69:src/stm32/serial.c **** #define USART_CR1_OVER8         (1 << 15)   /* Oversampling mode */
  70:src/stm32/serial.c **** 
  71:src/stm32/serial.c **** /* ========== USART Control Register 2 (CR2) Bits ========== */
  72:src/stm32/serial.c **** 
  73:src/stm32/serial.c **** #define USART_CR2_STOP_1        (0 << 12)   /* 1 stop bit */
  74:src/stm32/serial.c **** #define USART_CR2_STOP_0_5      (1 << 12)   /* 0.5 stop bits */
  75:src/stm32/serial.c **** #define USART_CR2_STOP_2        (2 << 12)   /* 2 stop bits */
  76:src/stm32/serial.c **** #define USART_CR2_STOP_1_5      (3 << 12)   /* 1.5 stop bits */
  77:src/stm32/serial.c **** #define USART_CR2_STOP_MASK     (3 << 12)
  78:src/stm32/serial.c **** 
  79:src/stm32/serial.c **** /* ========== USART Control Register 3 (CR3) Bits ========== */
  80:src/stm32/serial.c **** 
  81:src/stm32/serial.c **** #define USART_CR3_EIE           (1 << 0)    /* Error interrupt enable */
  82:src/stm32/serial.c **** #define USART_CR3_IREN          (1 << 1)    /* IrDA mode enable */
  83:src/stm32/serial.c **** #define USART_CR3_IRLP          (1 << 2)    /* IrDA low-power */
  84:src/stm32/serial.c **** #define USART_CR3_HDSEL         (1 << 3)    /* Half-duplex selection */
  85:src/stm32/serial.c **** #define USART_CR3_NACK          (1 << 4)    /* Smartcard NACK enable */
  86:src/stm32/serial.c **** #define USART_CR3_SCEN          (1 << 5)    /* Smartcard mode enable */
ARM GAS  /tmp/ccWwtxPM.s 			page 3


  87:src/stm32/serial.c **** #define USART_CR3_DMAR          (1 << 6)    /* DMA enable receiver */
  88:src/stm32/serial.c **** #define USART_CR3_DMAT          (1 << 7)    /* DMA enable transmitter */
  89:src/stm32/serial.c **** #define USART_CR3_RTSE          (1 << 8)    /* RTS enable */
  90:src/stm32/serial.c **** #define USART_CR3_CTSE          (1 << 9)    /* CTS enable */
  91:src/stm32/serial.c **** #define USART_CR3_CTSIE         (1 << 10)   /* CTS interrupt enable */
  92:src/stm32/serial.c **** #define USART_CR3_ONEBIT        (1 << 11)   /* One sample bit method enable */
  93:src/stm32/serial.c **** 
  94:src/stm32/serial.c **** /* ========== Ring Buffer Structure ========== */
  95:src/stm32/serial.c **** 
  96:src/stm32/serial.c **** typedef struct {
  97:src/stm32/serial.c ****     volatile uint8_t buffer[SERIAL_RX_BUFFER_SIZE];
  98:src/stm32/serial.c ****     volatile size_t head;       /* Write index */
  99:src/stm32/serial.c ****     volatile size_t tail;       /* Read index */
 100:src/stm32/serial.c ****     volatile size_t count;      /* Number of bytes in buffer */
 101:src/stm32/serial.c **** } ring_buffer_t;
 102:src/stm32/serial.c **** 
 103:src/stm32/serial.c **** /* ========== Private Variables ========== */
 104:src/stm32/serial.c **** 
 105:src/stm32/serial.c **** /* Active USART port */
 106:src/stm32/serial.c **** static usart_regs_t *s_usart = USART1;
 107:src/stm32/serial.c **** static uint8_t s_usart_irq = IRQ_USART1;
 108:src/stm32/serial.c **** 
 109:src/stm32/serial.c **** /* Receive ring buffer */
 110:src/stm32/serial.c **** static ring_buffer_t s_rx_buffer;
 111:src/stm32/serial.c **** 
 112:src/stm32/serial.c **** /* Transmit ring buffer */
 113:src/stm32/serial.c **** static ring_buffer_t s_tx_buffer;
 114:src/stm32/serial.c **** 
 115:src/stm32/serial.c **** /* Line buffer for G-code parsing */
 116:src/stm32/serial.c **** static char s_line_buffer[SERIAL_LINE_BUFFER_SIZE];
 117:src/stm32/serial.c **** static volatile size_t s_line_len = 0;
 118:src/stm32/serial.c **** static volatile uint8_t s_line_ready = 0;
 119:src/stm32/serial.c **** 
 120:src/stm32/serial.c **** /* Initialization flag */
 121:src/stm32/serial.c **** static uint8_t s_initialized = 0;
 122:src/stm32/serial.c **** 
 123:src/stm32/serial.c **** /* ========== Private Functions ========== */
 124:src/stm32/serial.c **** 
 125:src/stm32/serial.c **** /**
 126:src/stm32/serial.c ****  * @brief   Initialize ring buffer
 127:src/stm32/serial.c ****  */
 128:src/stm32/serial.c **** static void
 129:src/stm32/serial.c **** ring_buffer_init(ring_buffer_t *rb)
 130:src/stm32/serial.c **** {
 131:src/stm32/serial.c ****     rb->head = 0;
 132:src/stm32/serial.c ****     rb->tail = 0;
 133:src/stm32/serial.c ****     rb->count = 0;
 134:src/stm32/serial.c **** }
 135:src/stm32/serial.c **** 
 136:src/stm32/serial.c **** /**
 137:src/stm32/serial.c ****  * @brief   Put byte into ring buffer
 138:src/stm32/serial.c ****  * @retval  0 on success, -1 if buffer full
 139:src/stm32/serial.c ****  */
 140:src/stm32/serial.c **** static int
 141:src/stm32/serial.c **** ring_buffer_put(ring_buffer_t *rb, uint8_t byte)
 142:src/stm32/serial.c **** {
 143:src/stm32/serial.c ****     if (rb->count >= SERIAL_RX_BUFFER_SIZE) {
ARM GAS  /tmp/ccWwtxPM.s 			page 4


 144:src/stm32/serial.c ****         return -1;  /* Buffer full */
 145:src/stm32/serial.c ****     }
 146:src/stm32/serial.c ****     
 147:src/stm32/serial.c ****     rb->buffer[rb->head] = byte;
 148:src/stm32/serial.c ****     rb->head = (rb->head + 1) % SERIAL_RX_BUFFER_SIZE;
 149:src/stm32/serial.c ****     rb->count++;
 150:src/stm32/serial.c ****     
 151:src/stm32/serial.c ****     return 0;
 152:src/stm32/serial.c **** }
 153:src/stm32/serial.c **** 
 154:src/stm32/serial.c **** /**
 155:src/stm32/serial.c ****  * @brief   Get byte from ring buffer
 156:src/stm32/serial.c ****  * @retval  0 on success, -1 if buffer empty
 157:src/stm32/serial.c ****  */
 158:src/stm32/serial.c **** static int
 159:src/stm32/serial.c **** ring_buffer_get(ring_buffer_t *rb, uint8_t *byte)
 160:src/stm32/serial.c **** {
 161:src/stm32/serial.c ****     if (rb->count == 0) {
 162:src/stm32/serial.c ****         return -1;  /* Buffer empty */
 163:src/stm32/serial.c ****     }
 164:src/stm32/serial.c ****     
 165:src/stm32/serial.c ****     *byte = rb->buffer[rb->tail];
 166:src/stm32/serial.c ****     rb->tail = (rb->tail + 1) % SERIAL_RX_BUFFER_SIZE;
 167:src/stm32/serial.c ****     rb->count--;
 168:src/stm32/serial.c ****     
 169:src/stm32/serial.c ****     return 0;
 170:src/stm32/serial.c **** }
 171:src/stm32/serial.c **** 
 172:src/stm32/serial.c **** /**
 173:src/stm32/serial.c ****  * @brief   Get USART peripheral clock frequency
 174:src/stm32/serial.c ****  */
 175:src/stm32/serial.c **** static uint32_t
 176:src/stm32/serial.c **** get_usart_clock(usart_regs_t *usart)
 177:src/stm32/serial.c **** {
 178:src/stm32/serial.c ****     /* USART1 and USART6 are on APB2 (84 MHz) */
 179:src/stm32/serial.c ****     /* USART2, USART3, UART4, UART5 are on APB1 (42 MHz) */
 180:src/stm32/serial.c ****     if (usart == USART1) {
 181:src/stm32/serial.c ****         return APB2_FREQ;
 182:src/stm32/serial.c ****     } else {
 183:src/stm32/serial.c ****         return APB1_FREQ;
 184:src/stm32/serial.c ****     }
 185:src/stm32/serial.c **** }
 186:src/stm32/serial.c **** 
 187:src/stm32/serial.c **** /**
 188:src/stm32/serial.c ****  * @brief   Calculate BRR value for baud rate
 189:src/stm32/serial.c ****  */
 190:src/stm32/serial.c **** static uint32_t
 191:src/stm32/serial.c **** calculate_brr(usart_regs_t *usart, uint32_t baud)
 192:src/stm32/serial.c **** {
 193:src/stm32/serial.c ****     uint32_t pclk = get_usart_clock(usart);
 194:src/stm32/serial.c ****     
 195:src/stm32/serial.c ****     /* BRR = fck / (16 * baud) for oversampling by 16 */
 196:src/stm32/serial.c ****     /* Using fixed-point: BRR = (fck * 100) / (16 * baud) / 100 */
 197:src/stm32/serial.c ****     /* Simplified: BRR = fck / baud, then divide mantissa and fraction */
 198:src/stm32/serial.c ****     
 199:src/stm32/serial.c ****     uint32_t div = (pclk + (baud / 2)) / baud;
 200:src/stm32/serial.c ****     
ARM GAS  /tmp/ccWwtxPM.s 			page 5


 201:src/stm32/serial.c ****     return div;
 202:src/stm32/serial.c **** }
 203:src/stm32/serial.c **** 
 204:src/stm32/serial.c **** /**
 205:src/stm32/serial.c ****  * @brief   Configure GPIO pins for USART
 206:src/stm32/serial.c ****  */
 207:src/stm32/serial.c **** static void
 208:src/stm32/serial.c **** configure_gpio_pins(serial_port_t port)
 209:src/stm32/serial.c **** {
 210:src/stm32/serial.c ****     uint8_t tx_gpio, rx_gpio;
 211:src/stm32/serial.c ****     
 212:src/stm32/serial.c ****     switch (port) {
 213:src/stm32/serial.c ****         case SERIAL_USART1:
 214:src/stm32/serial.c ****             tx_gpio = GPIO_PA9;
 215:src/stm32/serial.c ****             rx_gpio = GPIO_PA10;
 216:src/stm32/serial.c ****             break;
 217:src/stm32/serial.c ****         case SERIAL_USART2:
 218:src/stm32/serial.c ****             tx_gpio = GPIO_PA2;
 219:src/stm32/serial.c ****             rx_gpio = GPIO_PA3;
 220:src/stm32/serial.c ****             break;
 221:src/stm32/serial.c ****         case SERIAL_USART3:
 222:src/stm32/serial.c ****             tx_gpio = GPIO_PB10;
 223:src/stm32/serial.c ****             rx_gpio = GPIO_PB11;
 224:src/stm32/serial.c ****             break;
 225:src/stm32/serial.c ****         default:
 226:src/stm32/serial.c ****             return;
 227:src/stm32/serial.c ****     }
 228:src/stm32/serial.c ****     
 229:src/stm32/serial.c ****     /* Configure TX pin as alternate function push-pull */
 230:src/stm32/serial.c ****     gpio_config_t tx_config = {
 231:src/stm32/serial.c ****         .mode = GPIO_MODE_AF,
 232:src/stm32/serial.c ****         .otype = GPIO_OTYPE_PP,
 233:src/stm32/serial.c ****         .speed = GPIO_SPEED_HIGH,
 234:src/stm32/serial.c ****         .pupd = GPIO_PUPD_UP,
 235:src/stm32/serial.c ****         .af = GPIO_AF_USART1     /* AF7 for USART1-3 */
 236:src/stm32/serial.c ****     };
 237:src/stm32/serial.c ****     gpio_configure(tx_gpio, &tx_config);
 238:src/stm32/serial.c ****     
 239:src/stm32/serial.c ****     /* Configure RX pin as alternate function with pull-up */
 240:src/stm32/serial.c ****     gpio_config_t rx_config = {
 241:src/stm32/serial.c ****         .mode = GPIO_MODE_AF,
 242:src/stm32/serial.c ****         .otype = GPIO_OTYPE_PP,
 243:src/stm32/serial.c ****         .speed = GPIO_SPEED_HIGH,
 244:src/stm32/serial.c ****         .pupd = GPIO_PUPD_UP,
 245:src/stm32/serial.c ****         .af = GPIO_AF_USART1     /* AF7 for USART1-3 */
 246:src/stm32/serial.c ****     };
 247:src/stm32/serial.c ****     gpio_configure(rx_gpio, &rx_config);
 248:src/stm32/serial.c **** }
 249:src/stm32/serial.c **** 
 250:src/stm32/serial.c **** /**
 251:src/stm32/serial.c ****  * @brief   Enable USART clock
 252:src/stm32/serial.c ****  */
 253:src/stm32/serial.c **** static void
 254:src/stm32/serial.c **** enable_usart_clock(serial_port_t port)
 255:src/stm32/serial.c **** {
 256:src/stm32/serial.c ****     switch (port) {
 257:src/stm32/serial.c ****         case SERIAL_USART1:
ARM GAS  /tmp/ccWwtxPM.s 			page 6


 258:src/stm32/serial.c ****             RCC_APB2ENR |= (1 << 4);    /* USART1EN */
 259:src/stm32/serial.c ****             break;
 260:src/stm32/serial.c ****         case SERIAL_USART2:
 261:src/stm32/serial.c ****             RCC_APB1ENR |= (1 << 17);   /* USART2EN */
 262:src/stm32/serial.c ****             break;
 263:src/stm32/serial.c ****         case SERIAL_USART3:
 264:src/stm32/serial.c ****             RCC_APB1ENR |= (1 << 18);   /* USART3EN */
 265:src/stm32/serial.c ****             break;
 266:src/stm32/serial.c ****         default:
 267:src/stm32/serial.c ****             break;
 268:src/stm32/serial.c ****     }
 269:src/stm32/serial.c ****     
 270:src/stm32/serial.c ****     /* Small delay for clock to stabilize */
 271:src/stm32/serial.c ****     for (volatile int i = 0; i < 100; i++) {
 272:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 273:src/stm32/serial.c ****     }
 274:src/stm32/serial.c **** }
 275:src/stm32/serial.c **** 
 276:src/stm32/serial.c **** /**
 277:src/stm32/serial.c ****  * @brief   Get USART registers and IRQ number
 278:src/stm32/serial.c ****  */
 279:src/stm32/serial.c **** static void
 280:src/stm32/serial.c **** get_usart_info(serial_port_t port, usart_regs_t **usart, uint8_t *irq)
 281:src/stm32/serial.c **** {
 282:src/stm32/serial.c ****     switch (port) {
 283:src/stm32/serial.c ****         case SERIAL_USART1:
 284:src/stm32/serial.c ****             *usart = USART1;
 285:src/stm32/serial.c ****             *irq = IRQ_USART1;
 286:src/stm32/serial.c ****             break;
 287:src/stm32/serial.c ****         case SERIAL_USART2:
 288:src/stm32/serial.c ****             *usart = USART2;
 289:src/stm32/serial.c ****             *irq = IRQ_USART2;
 290:src/stm32/serial.c ****             break;
 291:src/stm32/serial.c ****         case SERIAL_USART3:
 292:src/stm32/serial.c ****             *usart = USART3;
 293:src/stm32/serial.c ****             *irq = IRQ_USART3;
 294:src/stm32/serial.c ****             break;
 295:src/stm32/serial.c ****         default:
 296:src/stm32/serial.c ****             *usart = USART1;
 297:src/stm32/serial.c ****             *irq = IRQ_USART1;
 298:src/stm32/serial.c ****             break;
 299:src/stm32/serial.c ****     }
 300:src/stm32/serial.c **** }
 301:src/stm32/serial.c **** 
 302:src/stm32/serial.c **** /**
 303:src/stm32/serial.c ****  * @brief   Process received byte (called from ISR)
 304:src/stm32/serial.c ****  */
 305:src/stm32/serial.c **** static void
 306:src/stm32/serial.c **** process_rx_byte(uint8_t byte)
 307:src/stm32/serial.c **** {
 308:src/stm32/serial.c ****     /* Add to ring buffer */
 309:src/stm32/serial.c ****     ring_buffer_put(&s_rx_buffer, byte);
 310:src/stm32/serial.c ****     
 311:src/stm32/serial.c ****     /* Line buffer processing for G-code */
 312:src/stm32/serial.c ****     if (!s_line_ready) {
 313:src/stm32/serial.c ****         if (byte == '\n' || byte == '\r') {
 314:src/stm32/serial.c ****             /* Line complete */
ARM GAS  /tmp/ccWwtxPM.s 			page 7


 315:src/stm32/serial.c ****             if (s_line_len > 0) {
 316:src/stm32/serial.c ****                 s_line_buffer[s_line_len] = '\0';
 317:src/stm32/serial.c ****                 s_line_ready = 1;
 318:src/stm32/serial.c ****             }
 319:src/stm32/serial.c ****         } else if (byte == '\b' || byte == 0x7F) {
 320:src/stm32/serial.c ****             /* Backspace - remove last character */
 321:src/stm32/serial.c ****             if (s_line_len > 0) {
 322:src/stm32/serial.c ****                 s_line_len--;
 323:src/stm32/serial.c ****             }
 324:src/stm32/serial.c ****         } else if (s_line_len < SERIAL_LINE_BUFFER_SIZE - 1) {
 325:src/stm32/serial.c ****             /* Add character to line buffer */
 326:src/stm32/serial.c ****             s_line_buffer[s_line_len++] = (char)byte;
 327:src/stm32/serial.c ****         }
 328:src/stm32/serial.c ****     }
 329:src/stm32/serial.c **** }
 330:src/stm32/serial.c **** 
 331:src/stm32/serial.c **** /* ========== Interrupt Handler ========== */
 332:src/stm32/serial.c **** 
 333:src/stm32/serial.c **** /**
 334:src/stm32/serial.c ****  * @brief   USART interrupt handler
 335:src/stm32/serial.c ****  * 
 336:src/stm32/serial.c ****  * Handles receive and transmit interrupts.
 337:src/stm32/serial.c ****  * This function should be called from the USART ISR vector.
 338:src/stm32/serial.c ****  */
 339:src/stm32/serial.c **** void
 340:src/stm32/serial.c **** serial_irq_handler(void)
 341:src/stm32/serial.c **** {
  30              		.loc 1 341 1 view -0
  31              		.cfi_startproc
  32              		@ args = 0, pretend = 0, frame = 0
  33              		@ frame_needed = 0, uses_anonymous_args = 0
  34              		@ link register save eliminated.
 342:src/stm32/serial.c ****     uint32_t sr = s_usart->SR;
  35              		.loc 1 342 5 view .LVU1
  36              		.loc 1 342 26 is_stmt 0 view .LVU2
  37 0000 374B     		ldr	r3, .L38
  38 0002 1A68     		ldr	r2, [r3]
  39              		.loc 1 342 14 view .LVU3
  40 0004 1368     		ldr	r3, [r2]
  41              	.LVL0:
 343:src/stm32/serial.c ****     
 344:src/stm32/serial.c ****     /* Receive data available */
 345:src/stm32/serial.c ****     if (sr & USART_SR_RXNE) {
  42              		.loc 1 345 5 is_stmt 1 view .LVU4
 341:src/stm32/serial.c ****     uint32_t sr = s_usart->SR;
  43              		.loc 1 341 1 is_stmt 0 view .LVU5
  44 0006 10B4     		push	{r4}
  45              		.cfi_def_cfa_offset 4
  46              		.cfi_offset 4, -4
  47              		.loc 1 345 8 view .LVU6
  48 0008 9C06     		lsls	r4, r3, #26
  49 000a 1FD4     		bmi	.L36
  50              	.L3:
 346:src/stm32/serial.c ****         uint8_t byte = (uint8_t)(s_usart->DR & 0xFF);
 347:src/stm32/serial.c ****         process_rx_byte(byte);
 348:src/stm32/serial.c ****     }
 349:src/stm32/serial.c ****     
ARM GAS  /tmp/ccWwtxPM.s 			page 8


 350:src/stm32/serial.c ****     /* Transmit data register empty */
 351:src/stm32/serial.c ****     if ((sr & USART_SR_TXE) && (s_usart->CR1 & USART_CR1_TXEIE)) {
  51              		.loc 1 351 5 is_stmt 1 view .LVU7
  52              		.loc 1 351 8 is_stmt 0 view .LVU8
  53 000c 1806     		lsls	r0, r3, #24
  54 000e 17D5     		bpl	.L10
  55              		.loc 1 351 40 discriminator 1 view .LVU9
  56 0010 D168     		ldr	r1, [r2, #12]
  57              		.loc 1 351 29 discriminator 1 view .LVU10
  58 0012 0906     		lsls	r1, r1, #24
  59 0014 14D5     		bpl	.L10
  60              	.LBB46:
 352:src/stm32/serial.c ****         uint8_t byte;
  61              		.loc 1 352 9 is_stmt 1 view .LVU11
 353:src/stm32/serial.c ****         if (ring_buffer_get(&s_tx_buffer, &byte) == 0) {
  62              		.loc 1 353 9 view .LVU12
  63              	.LVL1:
  64              	.LBB47:
  65              	.LBI47:
 159:src/stm32/serial.c **** {
  66              		.loc 1 159 1 view .LVU13
  67              	.LBB48:
 161:src/stm32/serial.c ****         return -1;  /* Buffer empty */
  68              		.loc 1 161 5 view .LVU14
 161:src/stm32/serial.c ****         return -1;  /* Buffer empty */
  69              		.loc 1 161 11 is_stmt 0 view .LVU15
  70 0016 3349     		ldr	r1, .L38+4
  71 0018 D1F80801 		ldr	r0, [r1, #264]
 161:src/stm32/serial.c ****         return -1;  /* Buffer empty */
  72              		.loc 1 161 8 view .LVU16
  73 001c 0028     		cmp	r0, #0
  74 001e 5AD0     		beq	.L37
 165:src/stm32/serial.c ****     rb->tail = (rb->tail + 1) % SERIAL_RX_BUFFER_SIZE;
  75              		.loc 1 165 5 is_stmt 1 view .LVU17
 165:src/stm32/serial.c ****     rb->tail = (rb->tail + 1) % SERIAL_RX_BUFFER_SIZE;
  76              		.loc 1 165 26 is_stmt 0 view .LVU18
  77 0020 D1F80401 		ldr	r0, [r1, #260]
 165:src/stm32/serial.c ****     rb->tail = (rb->tail + 1) % SERIAL_RX_BUFFER_SIZE;
  78              		.loc 1 165 23 view .LVU19
  79 0024 0C5C     		ldrb	r4, [r1, r0]	@ zero_extendqisi2
 166:src/stm32/serial.c ****     rb->count--;
  80              		.loc 1 166 19 view .LVU20
  81 0026 D1F80401 		ldr	r0, [r1, #260]
 166:src/stm32/serial.c ****     rb->count--;
  82              		.loc 1 166 26 view .LVU21
  83 002a 0130     		adds	r0, r0, #1
 166:src/stm32/serial.c ****     rb->count--;
  84              		.loc 1 166 31 view .LVU22
  85 002c C0B2     		uxtb	r0, r0
 166:src/stm32/serial.c ****     rb->count--;
  86              		.loc 1 166 14 view .LVU23
  87 002e C1F80401 		str	r0, [r1, #260]
 167:src/stm32/serial.c ****     
  88              		.loc 1 167 7 view .LVU24
  89 0032 D1F80801 		ldr	r0, [r1, #264]
 165:src/stm32/serial.c ****     rb->tail = (rb->tail + 1) % SERIAL_RX_BUFFER_SIZE;
  90              		.loc 1 165 23 view .LVU25
ARM GAS  /tmp/ccWwtxPM.s 			page 9


  91 0036 E4B2     		uxtb	r4, r4
  92              	.LVL2:
 166:src/stm32/serial.c ****     rb->count--;
  93              		.loc 1 166 5 is_stmt 1 view .LVU26
 167:src/stm32/serial.c ****     
  94              		.loc 1 167 5 view .LVU27
 167:src/stm32/serial.c ****     
  95              		.loc 1 167 14 is_stmt 0 view .LVU28
  96 0038 0138     		subs	r0, r0, #1
  97 003a C1F80801 		str	r0, [r1, #264]
 169:src/stm32/serial.c **** }
  98              		.loc 1 169 5 is_stmt 1 view .LVU29
  99              	.LVL3:
 169:src/stm32/serial.c **** }
 100              		.loc 1 169 5 is_stmt 0 view .LVU30
 101              	.LBE48:
 102              	.LBE47:
 354:src/stm32/serial.c ****             s_usart->DR = byte;
 103              		.loc 1 354 13 is_stmt 1 view .LVU31
 104              		.loc 1 354 25 is_stmt 0 view .LVU32
 105 003e 5460     		str	r4, [r2, #4]
 106              	.LVL4:
 107              	.L10:
 108              		.loc 1 354 25 view .LVU33
 109              	.LBE46:
 355:src/stm32/serial.c ****         } else {
 356:src/stm32/serial.c ****             /* No more data to send, disable TXE interrupt */
 357:src/stm32/serial.c ****             s_usart->CR1 &= ~USART_CR1_TXEIE;
 358:src/stm32/serial.c ****         }
 359:src/stm32/serial.c ****     }
 360:src/stm32/serial.c ****     
 361:src/stm32/serial.c ****     /* Handle errors by reading SR and DR to clear flags */
 362:src/stm32/serial.c ****     if (sr & (USART_SR_ORE | USART_SR_FE | USART_SR_NF | USART_SR_PE)) {
 110              		.loc 1 362 5 is_stmt 1 view .LVU34
 111              		.loc 1 362 8 is_stmt 0 view .LVU35
 112 0040 1B07     		lsls	r3, r3, #28
 113              	.LVL5:
 363:src/stm32/serial.c ****         (void)s_usart->DR;  /* Clear error flags by reading DR */
 114              		.loc 1 363 9 is_stmt 1 view .LVU36
 115 0042 18BF     		it	ne
 116 0044 5368     		ldrne	r3, [r2, #4]
 364:src/stm32/serial.c ****     }
 365:src/stm32/serial.c **** }
 117              		.loc 1 365 1 is_stmt 0 view .LVU37
 118 0046 5DF8044B 		ldr	r4, [sp], #4
 119              		.cfi_remember_state
 120              		.cfi_restore 4
 121              		.cfi_def_cfa_offset 0
 122 004a 7047     		bx	lr
 123              	.LVL6:
 124              	.L36:
 125              		.cfi_restore_state
 126              	.LBB49:
 346:src/stm32/serial.c ****         process_rx_byte(byte);
 127              		.loc 1 346 9 is_stmt 1 view .LVU38
 128              	.LBB50:
 129              	.LBB51:
ARM GAS  /tmp/ccWwtxPM.s 			page 10


 130              	.LBB52:
 131              	.LBB53:
 143:src/stm32/serial.c ****         return -1;  /* Buffer full */
 132              		.loc 1 143 11 is_stmt 0 view .LVU39
 133 004c 2649     		ldr	r1, .L38+8
 134              	.LBE53:
 135              	.LBE52:
 136              	.LBE51:
 137              	.LBE50:
 346:src/stm32/serial.c ****         process_rx_byte(byte);
 138              		.loc 1 346 41 view .LVU40
 139 004e 5468     		ldr	r4, [r2, #4]
 140              	.LBB60:
 141              	.LBB58:
 142              	.LBB56:
 143              	.LBB54:
 143:src/stm32/serial.c ****         return -1;  /* Buffer full */
 144              		.loc 1 143 11 view .LVU41
 145 0050 D1F80801 		ldr	r0, [r1, #264]
 143:src/stm32/serial.c ****         return -1;  /* Buffer full */
 146              		.loc 1 143 8 view .LVU42
 147 0054 FF28     		cmp	r0, #255
 148              	.LBE54:
 149              	.LBE56:
 150              	.LBE58:
 151              	.LBE60:
 346:src/stm32/serial.c ****         process_rx_byte(byte);
 152              		.loc 1 346 17 view .LVU43
 153 0056 5FFA84FC 		uxtb	ip, r4
 154              	.LVL7:
 347:src/stm32/serial.c ****     }
 155              		.loc 1 347 9 is_stmt 1 view .LVU44
 156              	.LBB61:
 157              	.LBI50:
 306:src/stm32/serial.c **** {
 158              		.loc 1 306 1 view .LVU45
 159              	.LBB59:
 309:src/stm32/serial.c ****     
 160              		.loc 1 309 5 view .LVU46
 161              	.LBB57:
 162              	.LBI52:
 141:src/stm32/serial.c **** {
 163              		.loc 1 141 1 view .LVU47
 164              	.LBB55:
 143:src/stm32/serial.c ****         return -1;  /* Buffer full */
 165              		.loc 1 143 5 view .LVU48
 143:src/stm32/serial.c ****         return -1;  /* Buffer full */
 166              		.loc 1 143 8 is_stmt 0 view .LVU49
 167 005a 0ED8     		bhi	.L4
 147:src/stm32/serial.c ****     rb->head = (rb->head + 1) % SERIAL_RX_BUFFER_SIZE;
 168              		.loc 1 147 5 is_stmt 1 view .LVU50
 147:src/stm32/serial.c ****     rb->head = (rb->head + 1) % SERIAL_RX_BUFFER_SIZE;
 169              		.loc 1 147 18 is_stmt 0 view .LVU51
 170 005c D1F80001 		ldr	r0, [r1, #256]
 147:src/stm32/serial.c ****     rb->head = (rb->head + 1) % SERIAL_RX_BUFFER_SIZE;
 171              		.loc 1 147 26 view .LVU52
 172 0060 01F800C0 		strb	ip, [r1, r0]
ARM GAS  /tmp/ccWwtxPM.s 			page 11


 148:src/stm32/serial.c ****     rb->count++;
 173              		.loc 1 148 5 is_stmt 1 view .LVU53
 148:src/stm32/serial.c ****     rb->count++;
 174              		.loc 1 148 19 is_stmt 0 view .LVU54
 175 0064 D1F80001 		ldr	r0, [r1, #256]
 148:src/stm32/serial.c ****     rb->count++;
 176              		.loc 1 148 26 view .LVU55
 177 0068 0130     		adds	r0, r0, #1
 148:src/stm32/serial.c ****     rb->count++;
 178              		.loc 1 148 31 view .LVU56
 179 006a C0B2     		uxtb	r0, r0
 148:src/stm32/serial.c ****     rb->count++;
 180              		.loc 1 148 14 view .LVU57
 181 006c C1F80001 		str	r0, [r1, #256]
 149:src/stm32/serial.c ****     
 182              		.loc 1 149 5 is_stmt 1 view .LVU58
 149:src/stm32/serial.c ****     
 183              		.loc 1 149 7 is_stmt 0 view .LVU59
 184 0070 D1F80801 		ldr	r0, [r1, #264]
 149:src/stm32/serial.c ****     
 185              		.loc 1 149 14 view .LVU60
 186 0074 0130     		adds	r0, r0, #1
 187 0076 C1F80801 		str	r0, [r1, #264]
 151:src/stm32/serial.c **** }
 188              		.loc 1 151 5 is_stmt 1 view .LVU61
 189              	.L4:
 190              	.LVL8:
 151:src/stm32/serial.c **** }
 191              		.loc 1 151 5 is_stmt 0 view .LVU62
 192              	.LBE55:
 193              	.LBE57:
 312:src/stm32/serial.c ****         if (byte == '\n' || byte == '\r') {
 194              		.loc 1 312 5 is_stmt 1 view .LVU63
 312:src/stm32/serial.c ****         if (byte == '\n' || byte == '\r') {
 195              		.loc 1 312 9 is_stmt 0 view .LVU64
 196 007a 1C49     		ldr	r1, .L38+12
 197 007c 0878     		ldrb	r0, [r1]	@ zero_extendqisi2
 312:src/stm32/serial.c ****         if (byte == '\n' || byte == '\r') {
 198              		.loc 1 312 8 view .LVU65
 199 007e 0028     		cmp	r0, #0
 200 0080 C4D1     		bne	.L3
 313:src/stm32/serial.c ****             /* Line complete */
 201              		.loc 1 313 9 is_stmt 1 view .LVU66
 313:src/stm32/serial.c ****             /* Line complete */
 202              		.loc 1 313 12 is_stmt 0 view .LVU67
 203 0082 BCF10A0F 		cmp	ip, #10
 204 0086 13D0     		beq	.L6
 313:src/stm32/serial.c ****             /* Line complete */
 205              		.loc 1 313 26 view .LVU68
 206 0088 BCF10D0F 		cmp	ip, #13
 207 008c 10D0     		beq	.L6
 319:src/stm32/serial.c ****             /* Backspace - remove last character */
 208              		.loc 1 319 16 is_stmt 1 view .LVU69
 321:src/stm32/serial.c ****                 s_line_len--;
 209              		.loc 1 321 28 is_stmt 0 view .LVU70
 210 008e 1849     		ldr	r1, .L38+16
 319:src/stm32/serial.c ****             /* Backspace - remove last character */
ARM GAS  /tmp/ccWwtxPM.s 			page 12


 211              		.loc 1 319 19 view .LVU71
 212 0090 BCF1080F 		cmp	ip, #8
 321:src/stm32/serial.c ****                 s_line_len--;
 213              		.loc 1 321 28 view .LVU72
 214 0094 0868     		ldr	r0, [r1]
 319:src/stm32/serial.c ****             /* Backspace - remove last character */
 215              		.loc 1 319 19 view .LVU73
 216 0096 18D0     		beq	.L8
 319:src/stm32/serial.c ****             /* Backspace - remove last character */
 217              		.loc 1 319 33 view .LVU74
 218 0098 BCF17F0F 		cmp	ip, #127
 219 009c 15D0     		beq	.L8
 324:src/stm32/serial.c ****             /* Add character to line buffer */
 220              		.loc 1 324 16 is_stmt 1 view .LVU75
 324:src/stm32/serial.c ****             /* Add character to line buffer */
 221              		.loc 1 324 19 is_stmt 0 view .LVU76
 222 009e 7E28     		cmp	r0, #126
 223 00a0 B4D8     		bhi	.L3
 326:src/stm32/serial.c ****         }
 224              		.loc 1 326 13 is_stmt 1 view .LVU77
 326:src/stm32/serial.c ****         }
 225              		.loc 1 326 37 is_stmt 0 view .LVU78
 226 00a2 0868     		ldr	r0, [r1]
 326:src/stm32/serial.c ****         }
 227              		.loc 1 326 41 view .LVU79
 228 00a4 134C     		ldr	r4, .L38+20
 229 00a6 04F800C0 		strb	ip, [r4, r0]
 326:src/stm32/serial.c ****         }
 230              		.loc 1 326 37 view .LVU80
 231 00aa 0130     		adds	r0, r0, #1
 232 00ac 0860     		str	r0, [r1]
 233 00ae ADE7     		b	.L3
 234              	.L6:
 315:src/stm32/serial.c ****                 s_line_buffer[s_line_len] = '\0';
 235              		.loc 1 315 13 is_stmt 1 view .LVU81
 315:src/stm32/serial.c ****                 s_line_buffer[s_line_len] = '\0';
 236              		.loc 1 315 28 is_stmt 0 view .LVU82
 237 00b0 0F48     		ldr	r0, .L38+16
 238 00b2 0468     		ldr	r4, [r0]
 315:src/stm32/serial.c ****                 s_line_buffer[s_line_len] = '\0';
 239              		.loc 1 315 16 view .LVU83
 240 00b4 002C     		cmp	r4, #0
 241 00b6 A9D0     		beq	.L3
 316:src/stm32/serial.c ****                 s_line_ready = 1;
 242              		.loc 1 316 17 is_stmt 1 view .LVU84
 316:src/stm32/serial.c ****                 s_line_ready = 1;
 243              		.loc 1 316 30 is_stmt 0 view .LVU85
 244 00b8 0068     		ldr	r0, [r0]
 316:src/stm32/serial.c ****                 s_line_ready = 1;
 245              		.loc 1 316 43 view .LVU86
 246 00ba 0E4C     		ldr	r4, .L38+20
 247 00bc 4FF0000C 		mov	ip, #0
 248              	.LVL9:
 316:src/stm32/serial.c ****                 s_line_ready = 1;
 249              		.loc 1 316 43 view .LVU87
 250 00c0 04F800C0 		strb	ip, [r4, r0]
 317:src/stm32/serial.c ****             }
ARM GAS  /tmp/ccWwtxPM.s 			page 13


 251              		.loc 1 317 17 is_stmt 1 view .LVU88
 317:src/stm32/serial.c ****             }
 252              		.loc 1 317 30 is_stmt 0 view .LVU89
 253 00c4 0120     		movs	r0, #1
 254 00c6 0870     		strb	r0, [r1]
 255 00c8 A0E7     		b	.L3
 256              	.LVL10:
 257              	.L8:
 321:src/stm32/serial.c ****                 s_line_len--;
 258              		.loc 1 321 13 is_stmt 1 view .LVU90
 321:src/stm32/serial.c ****                 s_line_len--;
 259              		.loc 1 321 16 is_stmt 0 view .LVU91
 260 00ca 0028     		cmp	r0, #0
 261 00cc 9ED0     		beq	.L3
 322:src/stm32/serial.c ****             }
 262              		.loc 1 322 17 is_stmt 1 view .LVU92
 322:src/stm32/serial.c ****             }
 263              		.loc 1 322 27 is_stmt 0 view .LVU93
 264 00ce 0868     		ldr	r0, [r1]
 265 00d0 0138     		subs	r0, r0, #1
 266 00d2 0860     		str	r0, [r1]
 267 00d4 9AE7     		b	.L3
 268              	.LVL11:
 269              	.L37:
 322:src/stm32/serial.c ****             }
 270              		.loc 1 322 27 view .LVU94
 271              	.LBE59:
 272              	.LBE61:
 273              	.LBE49:
 274              	.LBB62:
 357:src/stm32/serial.c ****         }
 275              		.loc 1 357 13 is_stmt 1 view .LVU95
 357:src/stm32/serial.c ****         }
 276              		.loc 1 357 26 is_stmt 0 view .LVU96
 277 00d6 D168     		ldr	r1, [r2, #12]
 278 00d8 21F08001 		bic	r1, r1, #128
 279 00dc D160     		str	r1, [r2, #12]
 280 00de AFE7     		b	.L10
 281              	.L39:
 282              		.align	2
 283              	.L38:
 284 00e0 00000000 		.word	.LANCHOR0
 285 00e4 00000000 		.word	.LANCHOR5
 286 00e8 00000000 		.word	.LANCHOR1
 287 00ec 00000000 		.word	.LANCHOR2
 288 00f0 00000000 		.word	.LANCHOR3
 289 00f4 00000000 		.word	.LANCHOR4
 290              	.LBE62:
 291              		.cfi_endproc
 292              	.LFE16:
 294              		.section	.text.USART1_IRQHandler,"ax",%progbits
 295              		.align	1
 296              		.p2align 2,,3
 297              		.weak	USART1_IRQHandler
 298              		.syntax unified
 299              		.thumb
 300              		.thumb_func
ARM GAS  /tmp/ccWwtxPM.s 			page 14


 301              		.fpu fpv4-sp-d16
 303              	USART1_IRQHandler:
 304              	.LFB17:
 366:src/stm32/serial.c **** 
 367:src/stm32/serial.c **** /* USART1 ISR - weak symbol, can be overridden */
 368:src/stm32/serial.c **** void __attribute__((weak))
 369:src/stm32/serial.c **** USART1_IRQHandler(void)
 370:src/stm32/serial.c **** {
 305              		.loc 1 370 1 is_stmt 1 view -0
 306              		.cfi_startproc
 307              		@ args = 0, pretend = 0, frame = 0
 308              		@ frame_needed = 0, uses_anonymous_args = 0
 309              		@ link register save eliminated.
 371:src/stm32/serial.c ****     if (s_usart == USART1) {
 310              		.loc 1 371 5 view .LVU98
 311              		.loc 1 371 17 is_stmt 0 view .LVU99
 312 0000 034A     		ldr	r2, .L43
 313              		.loc 1 371 8 view .LVU100
 314 0002 044B     		ldr	r3, .L43+4
 315 0004 1268     		ldr	r2, [r2]
 316 0006 9A42     		cmp	r2, r3
 317 0008 00D0     		beq	.L42
 372:src/stm32/serial.c ****         serial_irq_handler();
 373:src/stm32/serial.c ****     }
 374:src/stm32/serial.c **** }
 318              		.loc 1 374 1 view .LVU101
 319 000a 7047     		bx	lr
 320              	.L42:
 372:src/stm32/serial.c ****         serial_irq_handler();
 321              		.loc 1 372 9 is_stmt 1 view .LVU102
 322 000c FFF7FEBF 		b	serial_irq_handler
 323              	.LVL12:
 324              	.L44:
 325              		.align	2
 326              	.L43:
 327 0010 00000000 		.word	.LANCHOR0
 328 0014 00100140 		.word	1073811456
 329              		.cfi_endproc
 330              	.LFE17:
 332              		.section	.text.USART2_IRQHandler,"ax",%progbits
 333              		.align	1
 334              		.p2align 2,,3
 335              		.weak	USART2_IRQHandler
 336              		.syntax unified
 337              		.thumb
 338              		.thumb_func
 339              		.fpu fpv4-sp-d16
 341              	USART2_IRQHandler:
 342              	.LFB18:
 375:src/stm32/serial.c **** 
 376:src/stm32/serial.c **** /* USART2 ISR - weak symbol, can be overridden */
 377:src/stm32/serial.c **** void __attribute__((weak))
 378:src/stm32/serial.c **** USART2_IRQHandler(void)
 379:src/stm32/serial.c **** {
 343              		.loc 1 379 1 view -0
 344              		.cfi_startproc
 345              		@ args = 0, pretend = 0, frame = 0
ARM GAS  /tmp/ccWwtxPM.s 			page 15


 346              		@ frame_needed = 0, uses_anonymous_args = 0
 347              		@ link register save eliminated.
 380:src/stm32/serial.c ****     if (s_usart == USART2) {
 348              		.loc 1 380 5 view .LVU104
 349              		.loc 1 380 17 is_stmt 0 view .LVU105
 350 0000 034A     		ldr	r2, .L48
 351              		.loc 1 380 8 view .LVU106
 352 0002 044B     		ldr	r3, .L48+4
 353 0004 1268     		ldr	r2, [r2]
 354 0006 9A42     		cmp	r2, r3
 355 0008 00D0     		beq	.L47
 381:src/stm32/serial.c ****         serial_irq_handler();
 382:src/stm32/serial.c ****     }
 383:src/stm32/serial.c **** }
 356              		.loc 1 383 1 view .LVU107
 357 000a 7047     		bx	lr
 358              	.L47:
 381:src/stm32/serial.c ****         serial_irq_handler();
 359              		.loc 1 381 9 is_stmt 1 view .LVU108
 360 000c FFF7FEBF 		b	serial_irq_handler
 361              	.LVL13:
 362              	.L49:
 363              		.align	2
 364              	.L48:
 365 0010 00000000 		.word	.LANCHOR0
 366 0014 00440040 		.word	1073759232
 367              		.cfi_endproc
 368              	.LFE18:
 370              		.section	.text.USART3_IRQHandler,"ax",%progbits
 371              		.align	1
 372              		.p2align 2,,3
 373              		.weak	USART3_IRQHandler
 374              		.syntax unified
 375              		.thumb
 376              		.thumb_func
 377              		.fpu fpv4-sp-d16
 379              	USART3_IRQHandler:
 380              	.LFB19:
 384:src/stm32/serial.c **** 
 385:src/stm32/serial.c **** /* USART3 ISR - weak symbol, can be overridden */
 386:src/stm32/serial.c **** void __attribute__((weak))
 387:src/stm32/serial.c **** USART3_IRQHandler(void)
 388:src/stm32/serial.c **** {
 381              		.loc 1 388 1 view -0
 382              		.cfi_startproc
 383              		@ args = 0, pretend = 0, frame = 0
 384              		@ frame_needed = 0, uses_anonymous_args = 0
 385              		@ link register save eliminated.
 389:src/stm32/serial.c ****     if (s_usart == USART3) {
 386              		.loc 1 389 5 view .LVU110
 387              		.loc 1 389 17 is_stmt 0 view .LVU111
 388 0000 034A     		ldr	r2, .L53
 389              		.loc 1 389 8 view .LVU112
 390 0002 044B     		ldr	r3, .L53+4
 391 0004 1268     		ldr	r2, [r2]
 392 0006 9A42     		cmp	r2, r3
 393 0008 00D0     		beq	.L52
ARM GAS  /tmp/ccWwtxPM.s 			page 16


 390:src/stm32/serial.c ****         serial_irq_handler();
 391:src/stm32/serial.c ****     }
 392:src/stm32/serial.c **** }
 394              		.loc 1 392 1 view .LVU113
 395 000a 7047     		bx	lr
 396              	.L52:
 390:src/stm32/serial.c ****         serial_irq_handler();
 397              		.loc 1 390 9 is_stmt 1 view .LVU114
 398 000c FFF7FEBF 		b	serial_irq_handler
 399              	.LVL14:
 400              	.L54:
 401              		.align	2
 402              	.L53:
 403 0010 00000000 		.word	.LANCHOR0
 404 0014 00480040 		.word	1073760256
 405              		.cfi_endproc
 406              	.LFE19:
 408              		.section	.text.serial_init_config,"ax",%progbits
 409              		.align	1
 410              		.p2align 2,,3
 411              		.global	serial_init_config
 412              		.syntax unified
 413              		.thumb
 414              		.thumb_func
 415              		.fpu fpv4-sp-d16
 417              	serial_init_config:
 418              	.LVL15:
 419              	.LFB21:
 393:src/stm32/serial.c **** 
 394:src/stm32/serial.c **** /* ========== Public Functions ========== */
 395:src/stm32/serial.c **** 
 396:src/stm32/serial.c **** /**
 397:src/stm32/serial.c ****  * @brief   Initialize serial subsystem with default settings
 398:src/stm32/serial.c ****  */
 399:src/stm32/serial.c **** void
 400:src/stm32/serial.c **** serial_init(void)
 401:src/stm32/serial.c **** {
 402:src/stm32/serial.c ****     serial_config_t config = {
 403:src/stm32/serial.c ****         .port = SERIAL_USART1,
 404:src/stm32/serial.c ****         .baud = SERIAL_BAUD_DEFAULT
 405:src/stm32/serial.c ****     };
 406:src/stm32/serial.c ****     serial_init_config(&config);
 407:src/stm32/serial.c **** }
 408:src/stm32/serial.c **** 
 409:src/stm32/serial.c **** /**
 410:src/stm32/serial.c ****  * @brief   Initialize serial with configuration
 411:src/stm32/serial.c ****  */
 412:src/stm32/serial.c **** int
 413:src/stm32/serial.c **** serial_init_config(const serial_config_t *config)
 414:src/stm32/serial.c **** {
 420              		.loc 1 414 1 view -0
 421              		.cfi_startproc
 422              		@ args = 0, pretend = 0, frame = 24
 423              		@ frame_needed = 0, uses_anonymous_args = 0
 415:src/stm32/serial.c ****     if (config == NULL) {
 424              		.loc 1 415 5 view .LVU116
 425              		.loc 1 415 8 is_stmt 0 view .LVU117
ARM GAS  /tmp/ccWwtxPM.s 			page 17


 426 0000 0028     		cmp	r0, #0
 427 0002 00F0A280 		beq	.L70
 414:src/stm32/serial.c ****     if (config == NULL) {
 428              		.loc 1 414 1 view .LVU118
 429 0006 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 430              		.cfi_def_cfa_offset 24
 431              		.cfi_offset 4, -24
 432              		.cfi_offset 5, -20
 433              		.cfi_offset 6, -16
 434              		.cfi_offset 7, -12
 435              		.cfi_offset 8, -8
 436              		.cfi_offset 14, -4
 416:src/stm32/serial.c ****         return -1;
 417:src/stm32/serial.c ****     }
 418:src/stm32/serial.c ****     
 419:src/stm32/serial.c ****     if (config->port >= SERIAL_COUNT) {
 437              		.loc 1 419 8 view .LVU119
 438 000a 0378     		ldrb	r3, [r0]	@ zero_extendqisi2
 439 000c 022B     		cmp	r3, #2
 414:src/stm32/serial.c ****     if (config == NULL) {
 440              		.loc 1 414 1 view .LVU120
 441 000e 86B0     		sub	sp, sp, #24
 442              		.cfi_def_cfa_offset 48
 443 0010 0446     		mov	r4, r0
 444              		.loc 1 419 5 is_stmt 1 view .LVU121
 445              		.loc 1 419 8 is_stmt 0 view .LVU122
 446 0012 00F29780 		bhi	.L71
 420:src/stm32/serial.c ****         return -2;
 421:src/stm32/serial.c ****     }
 422:src/stm32/serial.c ****     
 423:src/stm32/serial.c ****     /* Initialize GPIO subsystem if not already done */
 424:src/stm32/serial.c ****     gpio_init();
 447              		.loc 1 424 5 is_stmt 1 view .LVU123
 448 0016 FFF7FEFF 		bl	gpio_init
 449              	.LVL16:
 425:src/stm32/serial.c ****     
 426:src/stm32/serial.c ****     /* Initialize buffers */
 427:src/stm32/serial.c ****     ring_buffer_init(&s_rx_buffer);
 450              		.loc 1 427 5 view .LVU124
 451              	.LBB78:
 452              	.LBI78:
 129:src/stm32/serial.c **** {
 453              		.loc 1 129 1 view .LVU125
 454              	.LBB79:
 131:src/stm32/serial.c ****     rb->tail = 0;
 455              		.loc 1 131 5 view .LVU126
 131:src/stm32/serial.c ****     rb->tail = 0;
 456              		.loc 1 131 14 is_stmt 0 view .LVU127
 457 001a 4D4A     		ldr	r2, .L79
 458              	.LBE79:
 459              	.LBE78:
 428:src/stm32/serial.c ****     ring_buffer_init(&s_tx_buffer);
 429:src/stm32/serial.c ****     s_line_len = 0;
 460              		.loc 1 429 16 view .LVU128
 461 001c 4D48     		ldr	r0, .L79+4
 430:src/stm32/serial.c ****     s_line_ready = 0;
 462              		.loc 1 430 18 view .LVU129
ARM GAS  /tmp/ccWwtxPM.s 			page 18


 463 001e 4E49     		ldr	r1, .L79+8
 464              	.LBB81:
 465              	.LBB82:
 284:src/stm32/serial.c ****             *irq = IRQ_USART1;
 466              		.loc 1 284 20 view .LVU130
 467 0020 4E4E     		ldr	r6, .L79+12
 285:src/stm32/serial.c ****             break;
 468              		.loc 1 285 18 view .LVU131
 469 0022 4F4D     		ldr	r5, .L79+16
 470              	.LBE82:
 471              	.LBE81:
 472              	.LBB86:
 473              	.LBB80:
 131:src/stm32/serial.c ****     rb->tail = 0;
 474              		.loc 1 131 14 view .LVU132
 475 0024 0023     		movs	r3, #0
 476 0026 C2F80031 		str	r3, [r2, #256]
 132:src/stm32/serial.c ****     rb->count = 0;
 477              		.loc 1 132 5 is_stmt 1 view .LVU133
 132:src/stm32/serial.c ****     rb->count = 0;
 478              		.loc 1 132 14 is_stmt 0 view .LVU134
 479 002a C2F80431 		str	r3, [r2, #260]
 133:src/stm32/serial.c **** }
 480              		.loc 1 133 5 is_stmt 1 view .LVU135
 133:src/stm32/serial.c **** }
 481              		.loc 1 133 15 is_stmt 0 view .LVU136
 482 002e C2F80831 		str	r3, [r2, #264]
 483              	.LVL17:
 133:src/stm32/serial.c **** }
 484              		.loc 1 133 15 view .LVU137
 485              	.LBE80:
 486              	.LBE86:
 428:src/stm32/serial.c ****     s_line_len = 0;
 487              		.loc 1 428 5 is_stmt 1 view .LVU138
 488              	.LBB87:
 489              	.LBI87:
 129:src/stm32/serial.c **** {
 490              		.loc 1 129 1 view .LVU139
 491              	.LBB88:
 131:src/stm32/serial.c ****     rb->tail = 0;
 492              		.loc 1 131 5 view .LVU140
 131:src/stm32/serial.c ****     rb->tail = 0;
 493              		.loc 1 131 14 is_stmt 0 view .LVU141
 494 0032 4C4A     		ldr	r2, .L79+20
 495 0034 C2F80031 		str	r3, [r2, #256]
 132:src/stm32/serial.c ****     rb->count = 0;
 496              		.loc 1 132 5 is_stmt 1 view .LVU142
 132:src/stm32/serial.c ****     rb->count = 0;
 497              		.loc 1 132 14 is_stmt 0 view .LVU143
 498 0038 C2F80431 		str	r3, [r2, #260]
 133:src/stm32/serial.c **** }
 499              		.loc 1 133 5 is_stmt 1 view .LVU144
 133:src/stm32/serial.c **** }
 500              		.loc 1 133 15 is_stmt 0 view .LVU145
 501 003c C2F80831 		str	r3, [r2, #264]
 502              	.LVL18:
 133:src/stm32/serial.c **** }
ARM GAS  /tmp/ccWwtxPM.s 			page 19


 503              		.loc 1 133 15 view .LVU146
 504              	.LBE88:
 505              	.LBE87:
 429:src/stm32/serial.c ****     s_line_ready = 0;
 506              		.loc 1 429 5 is_stmt 1 view .LVU147
 431:src/stm32/serial.c ****     
 432:src/stm32/serial.c ****     /* Get USART info */
 433:src/stm32/serial.c ****     get_usart_info(config->port, &s_usart, &s_usart_irq);
 507              		.loc 1 433 5 is_stmt 0 view .LVU148
 508 0040 2278     		ldrb	r2, [r4]	@ zero_extendqisi2
 429:src/stm32/serial.c ****     s_line_ready = 0;
 509              		.loc 1 429 16 view .LVU149
 510 0042 0360     		str	r3, [r0]
 430:src/stm32/serial.c ****     
 511              		.loc 1 430 5 is_stmt 1 view .LVU150
 512              	.LBB89:
 513              	.LBB83:
 282:src/stm32/serial.c ****         case SERIAL_USART1:
 514              		.loc 1 282 5 is_stmt 0 view .LVU151
 515 0044 012A     		cmp	r2, #1
 516              	.LBE83:
 517              	.LBE89:
 430:src/stm32/serial.c ****     
 518              		.loc 1 430 18 view .LVU152
 519 0046 0B70     		strb	r3, [r1]
 520              		.loc 1 433 5 is_stmt 1 view .LVU153
 521              	.LVL19:
 522              	.LBB90:
 523              	.LBI81:
 280:src/stm32/serial.c **** {
 524              		.loc 1 280 1 view .LVU154
 525              	.LBB84:
 282:src/stm32/serial.c ****         case SERIAL_USART1:
 526              		.loc 1 282 5 view .LVU155
 527 0048 77D0     		beq	.L57
 528 004a 022A     		cmp	r2, #2
 529 004c 70D0     		beq	.L58
 284:src/stm32/serial.c ****             *irq = IRQ_USART1;
 530              		.loc 1 284 13 view .LVU156
 284:src/stm32/serial.c ****             *irq = IRQ_USART1;
 531              		.loc 1 284 20 is_stmt 0 view .LVU157
 532 004e 464A     		ldr	r2, .L79+24
 533              	.LVL20:
 284:src/stm32/serial.c ****             *irq = IRQ_USART1;
 534              		.loc 1 284 20 view .LVU158
 535 0050 3260     		str	r2, [r6]
 536              	.LVL21:
 285:src/stm32/serial.c ****             break;
 537              		.loc 1 285 13 is_stmt 1 view .LVU159
 285:src/stm32/serial.c ****             break;
 538              		.loc 1 285 18 is_stmt 0 view .LVU160
 539 0052 2523     		movs	r3, #37
 540 0054 2B70     		strb	r3, [r5]
 286:src/stm32/serial.c ****         case SERIAL_USART2:
 541              		.loc 1 286 13 is_stmt 1 view .LVU161
 542              	.L59:
 543              	.LVL22:
ARM GAS  /tmp/ccWwtxPM.s 			page 20


 286:src/stm32/serial.c ****         case SERIAL_USART2:
 544              		.loc 1 286 13 is_stmt 0 view .LVU162
 545              	.LBE84:
 546              	.LBE90:
 434:src/stm32/serial.c ****     
 435:src/stm32/serial.c ****     /* Enable USART clock */
 436:src/stm32/serial.c ****     enable_usart_clock(config->port);
 547              		.loc 1 436 5 is_stmt 1 view .LVU163
 548 0056 2378     		ldrb	r3, [r4]	@ zero_extendqisi2
 549              	.LVL23:
 550              	.LBB91:
 551              	.LBI91:
 254:src/stm32/serial.c **** {
 552              		.loc 1 254 1 view .LVU164
 553              	.LBB92:
 256:src/stm32/serial.c ****         case SERIAL_USART1:
 554              		.loc 1 256 5 view .LVU165
 555 0058 012B     		cmp	r3, #1
 556 005a 61D0     		beq	.L60
 557 005c 022B     		cmp	r3, #2
 558 005e 57D0     		beq	.L61
 559 0060 002B     		cmp	r3, #0
 560 0062 31D0     		beq	.L78
 271:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 561              		.loc 1 271 5 view .LVU166
 562              	.LBB93:
 271:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 563              		.loc 1 271 10 view .LVU167
 271:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 564              		.loc 1 271 23 is_stmt 0 view .LVU168
 565 0064 0023     		movs	r3, #0
 566              	.LVL24:
 271:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 567              		.loc 1 271 23 view .LVU169
 568 0066 0193     		str	r3, [sp, #4]
 271:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 569              		.loc 1 271 30 is_stmt 1 view .LVU170
 271:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 570              		.loc 1 271 32 is_stmt 0 view .LVU171
 571 0068 019B     		ldr	r3, [sp, #4]
 271:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 572              		.loc 1 271 5 view .LVU172
 573 006a 632B     		cmp	r3, #99
 574 006c 09DC     		bgt	.L66
 575              	.LVL25:
 576              	.L65:
 272:src/stm32/serial.c ****     }
 577              		.loc 1 272 9 is_stmt 1 view .LVU173
 578              		.syntax unified
 579              	@ 272 "src/stm32/serial.c" 1
 580 006e 00BF     		nop
 581              	@ 0 "" 2
 271:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 582              		.loc 1 271 39 view .LVU174
 271:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 583              		.loc 1 271 40 is_stmt 0 view .LVU175
 584              		.thumb
ARM GAS  /tmp/ccWwtxPM.s 			page 21


 585              		.syntax unified
 586 0070 019B     		ldr	r3, [sp, #4]
 587 0072 0133     		adds	r3, r3, #1
 588 0074 0193     		str	r3, [sp, #4]
 271:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 589              		.loc 1 271 30 is_stmt 1 view .LVU176
 271:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 590              		.loc 1 271 32 is_stmt 0 view .LVU177
 591 0076 019B     		ldr	r3, [sp, #4]
 271:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 592              		.loc 1 271 5 view .LVU178
 593 0078 632B     		cmp	r3, #99
 594 007a F8DD     		ble	.L65
 595              	.LBE93:
 596              	.LBE92:
 597              	.LBE91:
 437:src/stm32/serial.c ****     
 438:src/stm32/serial.c ****     /* Configure GPIO pins */
 439:src/stm32/serial.c ****     configure_gpio_pins(config->port);
 598              		.loc 1 439 5 view .LVU179
 599 007c 2378     		ldrb	r3, [r4]	@ zero_extendqisi2
 600              		.loc 1 439 5 is_stmt 1 view .LVU180
 601              	.LVL26:
 602              	.LBB97:
 603              	.LBI97:
 208:src/stm32/serial.c **** {
 604              		.loc 1 208 1 view .LVU181
 605              	.LBB98:
 210:src/stm32/serial.c ****     
 606              		.loc 1 210 5 view .LVU182
 212:src/stm32/serial.c ****         case SERIAL_USART1:
 607              		.loc 1 212 5 view .LVU183
 608 007e 022B     		cmp	r3, #2
 609 0080 2ED9     		bls	.L69
 610              	.LVL27:
 611              	.L66:
 212:src/stm32/serial.c ****         case SERIAL_USART1:
 612              		.loc 1 212 5 is_stmt 0 view .LVU184
 613              	.LBE98:
 614              	.LBE97:
 440:src/stm32/serial.c ****     
 441:src/stm32/serial.c ****     /* Disable USART during configuration */
 442:src/stm32/serial.c ****     s_usart->CR1 = 0;
 615              		.loc 1 442 5 is_stmt 1 view .LVU185
 616              		.loc 1 442 12 is_stmt 0 view .LVU186
 617 0082 3368     		ldr	r3, [r6]
 618              	.LBB100:
 619              	.LBB101:
 620              	.LBB102:
 621              	.LBB103:
 183:src/stm32/serial.c ****     }
 622              		.loc 1 183 16 view .LVU187
 623 0084 3948     		ldr	r0, .L79+28
 180:src/stm32/serial.c ****         return APB2_FREQ;
 624              		.loc 1 180 8 view .LVU188
 625 0086 384E     		ldr	r6, .L79+24
 183:src/stm32/serial.c ****     }
ARM GAS  /tmp/ccWwtxPM.s 			page 22


 626              		.loc 1 183 16 view .LVU189
 627 0088 394A     		ldr	r2, .L79+32
 628              	.LBE103:
 629              	.LBE102:
 630              	.LBE101:
 631              	.LBE100:
 443:src/stm32/serial.c ****     s_usart->CR2 = 0;
 444:src/stm32/serial.c ****     s_usart->CR3 = 0;
 445:src/stm32/serial.c ****     
 446:src/stm32/serial.c ****     /* Configure baud rate */
 447:src/stm32/serial.c ****     s_usart->BRR = calculate_brr(s_usart, config->baud);
 632              		.loc 1 447 20 view .LVU190
 633 008a 6168     		ldr	r1, [r4, #4]
 634              	.LBB111:
 635              	.LBB108:
 636              	.LBB106:
 637              	.LBB104:
 183:src/stm32/serial.c ****     }
 638              		.loc 1 183 16 view .LVU191
 639 008c B342     		cmp	r3, r6
 640 008e 18BF     		it	ne
 641 0090 0246     		movne	r2, r0
 642              	.LBE104:
 643              	.LBE106:
 644              	.LBE108:
 645              	.LBE111:
 442:src/stm32/serial.c ****     s_usart->CR2 = 0;
 646              		.loc 1 442 18 view .LVU192
 647 0092 0024     		movs	r4, #0
 648              	.LVL28:
 649              	.LBB112:
 650              	.LBB109:
 199:src/stm32/serial.c ****     
 651              		.loc 1 199 26 view .LVU193
 652 0094 02EB5102 		add	r2, r2, r1, lsr #1
 199:src/stm32/serial.c ****     
 653              		.loc 1 199 14 view .LVU194
 654 0098 B2FBF1F2 		udiv	r2, r2, r1
 655              	.LBE109:
 656              	.LBE112:
 448:src/stm32/serial.c ****     
 449:src/stm32/serial.c ****     /* Configure: 8 data bits, no parity, 1 stop bit */
 450:src/stm32/serial.c ****     s_usart->CR2 = USART_CR2_STOP_1;
 451:src/stm32/serial.c ****     
 452:src/stm32/serial.c ****     /* Enable USART, TX, RX, and RXNE interrupt */
 453:src/stm32/serial.c ****     s_usart->CR1 = USART_CR1_UE | USART_CR1_TE | USART_CR1_RE | USART_CR1_RXNEIE;
 657              		.loc 1 453 18 view .LVU195
 658 009c 42F22C01 		movw	r1, #8236
 442:src/stm32/serial.c ****     s_usart->CR2 = 0;
 659              		.loc 1 442 18 view .LVU196
 660 00a0 DC60     		str	r4, [r3, #12]
 443:src/stm32/serial.c ****     s_usart->CR3 = 0;
 661              		.loc 1 443 5 is_stmt 1 view .LVU197
 454:src/stm32/serial.c ****     
 455:src/stm32/serial.c ****     /* Enable NVIC interrupt */
 456:src/stm32/serial.c ****     nvic_set_priority(s_usart_irq, 64);  /* Medium priority */
 662              		.loc 1 456 5 is_stmt 0 view .LVU198
ARM GAS  /tmp/ccWwtxPM.s 			page 23


 663 00a2 2878     		ldrb	r0, [r5]	@ zero_extendqisi2
 443:src/stm32/serial.c ****     s_usart->CR3 = 0;
 664              		.loc 1 443 18 view .LVU199
 665 00a4 1C61     		str	r4, [r3, #16]
 444:src/stm32/serial.c ****     
 666              		.loc 1 444 5 is_stmt 1 view .LVU200
 444:src/stm32/serial.c ****     
 667              		.loc 1 444 18 is_stmt 0 view .LVU201
 668 00a6 5C61     		str	r4, [r3, #20]
 447:src/stm32/serial.c ****     
 669              		.loc 1 447 5 is_stmt 1 view .LVU202
 670              	.LVL29:
 671              	.LBB113:
 672              	.LBI100:
 191:src/stm32/serial.c **** {
 673              		.loc 1 191 1 view .LVU203
 674              	.LBB110:
 193:src/stm32/serial.c ****     
 675              		.loc 1 193 5 view .LVU204
 676              	.LBB107:
 677              	.LBI102:
 176:src/stm32/serial.c **** {
 678              		.loc 1 176 1 view .LVU205
 679              	.LBB105:
 180:src/stm32/serial.c ****         return APB2_FREQ;
 680              		.loc 1 180 5 view .LVU206
 180:src/stm32/serial.c ****         return APB2_FREQ;
 681              		.loc 1 180 5 is_stmt 0 view .LVU207
 682              	.LBE105:
 683              	.LBE107:
 199:src/stm32/serial.c ****     
 684              		.loc 1 199 5 is_stmt 1 view .LVU208
 201:src/stm32/serial.c **** }
 685              		.loc 1 201 5 view .LVU209
 201:src/stm32/serial.c **** }
 686              		.loc 1 201 5 is_stmt 0 view .LVU210
 687              	.LBE110:
 688              	.LBE113:
 447:src/stm32/serial.c ****     
 689              		.loc 1 447 18 view .LVU211
 690 00a8 9A60     		str	r2, [r3, #8]
 450:src/stm32/serial.c ****     
 691              		.loc 1 450 5 is_stmt 1 view .LVU212
 450:src/stm32/serial.c ****     
 692              		.loc 1 450 18 is_stmt 0 view .LVU213
 693 00aa 1C61     		str	r4, [r3, #16]
 453:src/stm32/serial.c ****     
 694              		.loc 1 453 5 is_stmt 1 view .LVU214
 453:src/stm32/serial.c ****     
 695              		.loc 1 453 18 is_stmt 0 view .LVU215
 696 00ac D960     		str	r1, [r3, #12]
 697              		.loc 1 456 5 is_stmt 1 view .LVU216
 698 00ae 4021     		movs	r1, #64
 699 00b0 FFF7FEFF 		bl	nvic_set_priority
 700              	.LVL30:
 457:src/stm32/serial.c ****     nvic_enable_irq(s_usart_irq);
 701              		.loc 1 457 5 view .LVU217
ARM GAS  /tmp/ccWwtxPM.s 			page 24


 702 00b4 2878     		ldrb	r0, [r5]	@ zero_extendqisi2
 703 00b6 FFF7FEFF 		bl	nvic_enable_irq
 704              	.LVL31:
 458:src/stm32/serial.c ****     
 459:src/stm32/serial.c ****     s_initialized = 1;
 705              		.loc 1 459 5 view .LVU218
 706              		.loc 1 459 19 is_stmt 0 view .LVU219
 707 00ba 2E4B     		ldr	r3, .L79+36
 708 00bc 0122     		movs	r2, #1
 709 00be 1A70     		strb	r2, [r3]
 460:src/stm32/serial.c ****     
 461:src/stm32/serial.c ****     return 0;
 710              		.loc 1 461 5 is_stmt 1 view .LVU220
 711              		.loc 1 461 12 is_stmt 0 view .LVU221
 712 00c0 2046     		mov	r0, r4
 713              	.L55:
 462:src/stm32/serial.c **** }
 714              		.loc 1 462 1 view .LVU222
 715 00c2 06B0     		add	sp, sp, #24
 716              		.cfi_remember_state
 717              		.cfi_def_cfa_offset 24
 718              		@ sp needed
 719 00c4 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 720              	.LVL32:
 721              	.L78:
 722              		.cfi_restore_state
 723              	.LBB114:
 724              	.LBB95:
 258:src/stm32/serial.c ****             break;
 725              		.loc 1 258 13 is_stmt 1 view .LVU223
 258:src/stm32/serial.c ****             break;
 726              		.loc 1 258 25 is_stmt 0 view .LVU224
 727 00c8 2B49     		ldr	r1, .L79+40
 728 00ca D1F84428 		ldr	r2, [r1, #2116]
 729 00ce 42F01002 		orr	r2, r2, #16
 730 00d2 C1F84428 		str	r2, [r1, #2116]
 259:src/stm32/serial.c ****         case SERIAL_USART2:
 731              		.loc 1 259 13 is_stmt 1 view .LVU225
 732              	.L63:
 271:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 733              		.loc 1 271 5 view .LVU226
 734              	.LBB94:
 271:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 735              		.loc 1 271 10 view .LVU227
 271:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 736              		.loc 1 271 23 is_stmt 0 view .LVU228
 737 00d6 0022     		movs	r2, #0
 738 00d8 0192     		str	r2, [sp, #4]
 271:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 739              		.loc 1 271 30 is_stmt 1 view .LVU229
 271:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 740              		.loc 1 271 32 is_stmt 0 view .LVU230
 741 00da 019A     		ldr	r2, [sp, #4]
 271:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 742              		.loc 1 271 5 view .LVU231
 743 00dc 632A     		cmp	r2, #99
 744 00de C6DD     		ble	.L65
ARM GAS  /tmp/ccWwtxPM.s 			page 25


 745              	.LVL33:
 746              	.L69:
 271:src/stm32/serial.c ****         __asm__ __volatile__("nop");
 747              		.loc 1 271 5 view .LVU232
 748              	.LBE94:
 749              	.LBE95:
 750              	.LBE114:
 751              	.LBB115:
 752              	.LBB99:
 230:src/stm32/serial.c ****         .mode = GPIO_MODE_AF,
 753              		.loc 1 230 19 view .LVU233
 754 00e0 264F     		ldr	r7, .L79+44
 755 00e2 2749     		ldr	r1, .L79+48
 756 00e4 274A     		ldr	r2, .L79+52
 757 00e6 11F80380 		ldrb	r8, [r1, r3]	@ zero_extendqisi2
 758              	.LVL34:
 230:src/stm32/serial.c ****         .mode = GPIO_MODE_AF,
 759              		.loc 1 230 5 is_stmt 1 view .LVU234
 230:src/stm32/serial.c ****         .mode = GPIO_MODE_AF,
 760              		.loc 1 230 19 is_stmt 0 view .LVU235
 761 00ea 97E80300 		ldm	r7, {r0, r1}
 762 00ee 0290     		str	r0, [sp, #8]
 763 00f0 8DF80C10 		strb	r1, [sp, #12]
 237:src/stm32/serial.c ****     
 764              		.loc 1 237 5 is_stmt 1 view .LVU236
 765 00f4 D05C     		ldrb	r0, [r2, r3]	@ zero_extendqisi2
 766 00f6 02A9     		add	r1, sp, #8
 767 00f8 FFF7FEFF 		bl	gpio_configure
 768              	.LVL35:
 240:src/stm32/serial.c ****         .mode = GPIO_MODE_AF,
 769              		.loc 1 240 5 view .LVU237
 240:src/stm32/serial.c ****         .mode = GPIO_MODE_AF,
 770              		.loc 1 240 19 is_stmt 0 view .LVU238
 771 00fc 97E80300 		ldm	r7, {r0, r1}
 772 0100 0490     		str	r0, [sp, #16]
 773 0102 8DF81410 		strb	r1, [sp, #20]
 247:src/stm32/serial.c **** }
 774              		.loc 1 247 5 is_stmt 1 view .LVU239
 775 0106 4046     		mov	r0, r8
 776 0108 04A9     		add	r1, sp, #16
 777 010a FFF7FEFF 		bl	gpio_configure
 778              	.LVL36:
 779 010e B8E7     		b	.L66
 780              	.LVL37:
 781              	.L61:
 247:src/stm32/serial.c **** }
 782              		.loc 1 247 5 is_stmt 0 view .LVU240
 783              	.LBE99:
 784              	.LBE115:
 785              	.LBB116:
 786              	.LBB96:
 264:src/stm32/serial.c ****             break;
 787              		.loc 1 264 13 is_stmt 1 view .LVU241
 264:src/stm32/serial.c ****             break;
 788              		.loc 1 264 25 is_stmt 0 view .LVU242
 789 0110 1949     		ldr	r1, .L79+40
 790 0112 D1F84028 		ldr	r2, [r1, #2112]
ARM GAS  /tmp/ccWwtxPM.s 			page 26


 791 0116 42F48022 		orr	r2, r2, #262144
 792 011a C1F84028 		str	r2, [r1, #2112]
 265:src/stm32/serial.c ****         default:
 793              		.loc 1 265 13 is_stmt 1 view .LVU243
 794 011e DAE7     		b	.L63
 795              	.L60:
 261:src/stm32/serial.c ****             break;
 796              		.loc 1 261 13 view .LVU244
 261:src/stm32/serial.c ****             break;
 797              		.loc 1 261 25 is_stmt 0 view .LVU245
 798 0120 1549     		ldr	r1, .L79+40
 799 0122 D1F84028 		ldr	r2, [r1, #2112]
 800 0126 42F40032 		orr	r2, r2, #131072
 801 012a C1F84028 		str	r2, [r1, #2112]
 262:src/stm32/serial.c ****         case SERIAL_USART3:
 802              		.loc 1 262 13 is_stmt 1 view .LVU246
 803 012e D2E7     		b	.L63
 804              	.LVL38:
 805              	.L58:
 262:src/stm32/serial.c ****         case SERIAL_USART3:
 806              		.loc 1 262 13 is_stmt 0 view .LVU247
 807              	.LBE96:
 808              	.LBE116:
 809              	.LBB117:
 810              	.LBB85:
 292:src/stm32/serial.c ****             *irq = IRQ_USART3;
 811              		.loc 1 292 13 is_stmt 1 view .LVU248
 292:src/stm32/serial.c ****             *irq = IRQ_USART3;
 812              		.loc 1 292 20 is_stmt 0 view .LVU249
 813 0130 154A     		ldr	r2, .L79+56
 814              	.LVL39:
 292:src/stm32/serial.c ****             *irq = IRQ_USART3;
 815              		.loc 1 292 20 view .LVU250
 816 0132 3260     		str	r2, [r6]
 817              	.LVL40:
 293:src/stm32/serial.c ****             break;
 818              		.loc 1 293 13 is_stmt 1 view .LVU251
 293:src/stm32/serial.c ****             break;
 819              		.loc 1 293 18 is_stmt 0 view .LVU252
 820 0134 2723     		movs	r3, #39
 821 0136 2B70     		strb	r3, [r5]
 294:src/stm32/serial.c ****         default:
 822              		.loc 1 294 13 is_stmt 1 view .LVU253
 823 0138 8DE7     		b	.L59
 824              	.LVL41:
 825              	.L57:
 288:src/stm32/serial.c ****             *irq = IRQ_USART2;
 826              		.loc 1 288 13 view .LVU254
 288:src/stm32/serial.c ****             *irq = IRQ_USART2;
 827              		.loc 1 288 20 is_stmt 0 view .LVU255
 828 013a 144A     		ldr	r2, .L79+60
 829              	.LVL42:
 288:src/stm32/serial.c ****             *irq = IRQ_USART2;
 830              		.loc 1 288 20 view .LVU256
 831 013c 3260     		str	r2, [r6]
 832              	.LVL43:
 289:src/stm32/serial.c ****             break;
ARM GAS  /tmp/ccWwtxPM.s 			page 27


 833              		.loc 1 289 13 is_stmt 1 view .LVU257
 289:src/stm32/serial.c ****             break;
 834              		.loc 1 289 18 is_stmt 0 view .LVU258
 835 013e 2623     		movs	r3, #38
 836 0140 2B70     		strb	r3, [r5]
 290:src/stm32/serial.c ****         case SERIAL_USART3:
 837              		.loc 1 290 13 is_stmt 1 view .LVU259
 838 0142 88E7     		b	.L59
 839              	.LVL44:
 840              	.L71:
 290:src/stm32/serial.c ****         case SERIAL_USART3:
 841              		.loc 1 290 13 is_stmt 0 view .LVU260
 842              	.LBE85:
 843              	.LBE117:
 420:src/stm32/serial.c ****     }
 844              		.loc 1 420 16 view .LVU261
 845 0144 6FF00100 		mvn	r0, #1
 846              	.LVL45:
 420:src/stm32/serial.c ****     }
 847              		.loc 1 420 16 view .LVU262
 848 0148 BBE7     		b	.L55
 849              	.LVL46:
 850              	.L70:
 851              		.cfi_def_cfa_offset 0
 852              		.cfi_restore 4
 853              		.cfi_restore 5
 854              		.cfi_restore 6
 855              		.cfi_restore 7
 856              		.cfi_restore 8
 857              		.cfi_restore 14
 416:src/stm32/serial.c ****     }
 858              		.loc 1 416 16 view .LVU263
 859 014a 4FF0FF30 		mov	r0, #-1
 860              	.LVL47:
 861              		.loc 1 462 1 view .LVU264
 862 014e 7047     		bx	lr
 863              	.L80:
 864              		.align	2
 865              	.L79:
 866 0150 00000000 		.word	.LANCHOR1
 867 0154 00000000 		.word	.LANCHOR3
 868 0158 00000000 		.word	.LANCHOR2
 869 015c 00000000 		.word	.LANCHOR0
 870 0160 00000000 		.word	.LANCHOR6
 871 0164 00000000 		.word	.LANCHOR5
 872 0168 00100140 		.word	1073811456
 873 016c 80DE8002 		.word	42000000
 874 0170 00BD0105 		.word	84000000
 875 0174 00000000 		.word	.LANCHOR10
 876 0178 00300240 		.word	1073885184
 877 017c 00000000 		.word	.LANCHOR9
 878 0180 00000000 		.word	.LANCHOR8
 879 0184 00000000 		.word	.LANCHOR7
 880 0188 00480040 		.word	1073760256
 881 018c 00440040 		.word	1073759232
 882              		.cfi_endproc
 883              	.LFE21:
ARM GAS  /tmp/ccWwtxPM.s 			page 28


 885              		.section	.text.serial_init,"ax",%progbits
 886              		.align	1
 887              		.p2align 2,,3
 888              		.global	serial_init
 889              		.syntax unified
 890              		.thumb
 891              		.thumb_func
 892              		.fpu fpv4-sp-d16
 894              	serial_init:
 895              	.LFB20:
 401:src/stm32/serial.c ****     serial_config_t config = {
 896              		.loc 1 401 1 is_stmt 1 view -0
 897              		.cfi_startproc
 898              		@ args = 0, pretend = 0, frame = 8
 899              		@ frame_needed = 0, uses_anonymous_args = 0
 402:src/stm32/serial.c ****         .port = SERIAL_USART1,
 900              		.loc 1 402 5 view .LVU266
 401:src/stm32/serial.c ****     serial_config_t config = {
 901              		.loc 1 401 1 is_stmt 0 view .LVU267
 902 0000 00B5     		push	{lr}
 903              		.cfi_def_cfa_offset 4
 904              		.cfi_offset 14, -4
 905 0002 83B0     		sub	sp, sp, #12
 906              		.cfi_def_cfa_offset 16
 402:src/stm32/serial.c ****         .port = SERIAL_USART1,
 907              		.loc 1 402 21 view .LVU268
 908 0004 0022     		movs	r2, #0
 909 0006 4FF4E133 		mov	r3, #115200
 406:src/stm32/serial.c **** }
 910              		.loc 1 406 5 view .LVU269
 911 000a 6846     		mov	r0, sp
 402:src/stm32/serial.c ****         .port = SERIAL_USART1,
 912              		.loc 1 402 21 view .LVU270
 913 000c 8DF80020 		strb	r2, [sp]
 914 0010 0193     		str	r3, [sp, #4]
 406:src/stm32/serial.c **** }
 915              		.loc 1 406 5 is_stmt 1 view .LVU271
 916 0012 FFF7FEFF 		bl	serial_init_config
 917              	.LVL48:
 407:src/stm32/serial.c **** 
 918              		.loc 1 407 1 is_stmt 0 view .LVU272
 919 0016 03B0     		add	sp, sp, #12
 920              		.cfi_def_cfa_offset 4
 921              		@ sp needed
 922 0018 5DF804FB 		ldr	pc, [sp], #4
 923              		.cfi_endproc
 924              	.LFE20:
 926              		.section	.text.serial_write,"ax",%progbits
 927              		.align	1
 928              		.p2align 2,,3
 929              		.global	serial_write
 930              		.syntax unified
 931              		.thumb
 932              		.thumb_func
 933              		.fpu fpv4-sp-d16
 935              	serial_write:
 936              	.LVL49:
ARM GAS  /tmp/ccWwtxPM.s 			page 29


 937              	.LFB22:
 463:src/stm32/serial.c **** 
 464:src/stm32/serial.c **** /**
 465:src/stm32/serial.c ****  * @brief   Write data to serial port
 466:src/stm32/serial.c ****  */
 467:src/stm32/serial.c **** int
 468:src/stm32/serial.c **** serial_write(const uint8_t *data, size_t len)
 469:src/stm32/serial.c **** {
 938              		.loc 1 469 1 is_stmt 1 view -0
 939              		.cfi_startproc
 940              		@ args = 0, pretend = 0, frame = 0
 941              		@ frame_needed = 0, uses_anonymous_args = 0
 470:src/stm32/serial.c ****     if (data == NULL || len == 0) {
 942              		.loc 1 470 5 view .LVU274
 943              		.loc 1 470 8 is_stmt 0 view .LVU275
 944 0000 F0B1     		cbz	r0, .L90
 945              		.loc 1 470 22 discriminator 1 view .LVU276
 946 0002 E9B1     		cbz	r1, .L90
 471:src/stm32/serial.c ****         return -1;
 472:src/stm32/serial.c ****     }
 473:src/stm32/serial.c ****     
 474:src/stm32/serial.c ****     if (!s_initialized) {
 947              		.loc 1 474 5 is_stmt 1 view .LVU277
 948              		.loc 1 474 9 is_stmt 0 view .LVU278
 949 0004 114B     		ldr	r3, .L100
 950              		.loc 1 474 8 view .LVU279
 951 0006 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 952 0008 EBB1     		cbz	r3, .L98
 953              	.LBB122:
 954              	.LBB123:
 955              	.LBB124:
 956              	.LBB125:
 475:src/stm32/serial.c ****         return -2;
 476:src/stm32/serial.c ****     }
 477:src/stm32/serial.c ****     
 478:src/stm32/serial.c ****     size_t written = 0;
 479:src/stm32/serial.c ****     
 480:src/stm32/serial.c ****     for (size_t i = 0; i < len; i++) {
 481:src/stm32/serial.c ****         /* Wait for TXE (transmit data register empty) */
 482:src/stm32/serial.c ****         uint32_t timeout = 100000;
 483:src/stm32/serial.c ****         while (!(s_usart->SR & USART_SR_TXE)) {
 957              		.loc 1 483 25 view .LVU280
 958 000a 114B     		ldr	r3, .L100+4
 959              	.LBE125:
 960              	.LBE124:
 961              	.LBE123:
 962              	.LBE122:
 469:src/stm32/serial.c ****     if (data == NULL || len == 0) {
 963              		.loc 1 469 1 view .LVU281
 964 000c 00B5     		push	{lr}
 965              		.cfi_def_cfa_offset 4
 966              		.cfi_offset 14, -4
 967 000e 00F1FF3E 		add	lr, r0, #-1
 968              	.LBB134:
 969              	.LBB132:
 970              	.LBB129:
 971              	.LBB126:
ARM GAS  /tmp/ccWwtxPM.s 			page 30


 972              		.loc 1 483 25 view .LVU282
 973 0012 1868     		ldr	r0, [r3]
 974              	.LVL50:
 975              		.loc 1 483 25 view .LVU283
 976              	.LBE126:
 977              	.LBE129:
 478:src/stm32/serial.c ****     
 978              		.loc 1 478 12 view .LVU284
 979 0014 4FF0000C 		mov	ip, #0
 980              	.LVL51:
 981              	.L88:
 478:src/stm32/serial.c ****     
 982              		.loc 1 478 12 view .LVU285
 983 0018 0E4B     		ldr	r3, .L100+8
 984 001a 01E0     		b	.L86
 985              	.LVL52:
 986              	.L87:
 987              	.LBB130:
 988              	.LBB127:
 484:src/stm32/serial.c ****             if (--timeout == 0) {
 989              		.loc 1 484 16 view .LVU286
 990 001c 013B     		subs	r3, r3, #1
 991              	.LVL53:
 992              		.loc 1 484 16 view .LVU287
 993 001e 0CD0     		beq	.L99
 994              	.LVL54:
 995              	.L86:
 996              		.loc 1 484 13 is_stmt 1 view .LVU288
 483:src/stm32/serial.c ****             if (--timeout == 0) {
 997              		.loc 1 483 15 view .LVU289
 483:src/stm32/serial.c ****             if (--timeout == 0) {
 998              		.loc 1 483 25 is_stmt 0 view .LVU290
 999 0020 0268     		ldr	r2, [r0]
 483:src/stm32/serial.c ****             if (--timeout == 0) {
 1000              		.loc 1 483 15 view .LVU291
 1001 0022 1206     		lsls	r2, r2, #24
 1002 0024 FAD5     		bpl	.L87
 485:src/stm32/serial.c ****                 return (int)written;  /* Timeout */
 486:src/stm32/serial.c ****             }
 487:src/stm32/serial.c ****         }
 488:src/stm32/serial.c ****         
 489:src/stm32/serial.c ****         /* Write byte directly to data register */
 490:src/stm32/serial.c ****         s_usart->DR = data[i];
 1003              		.loc 1 490 9 is_stmt 1 view .LVU292
 491:src/stm32/serial.c ****         written++;
 1004              		.loc 1 491 16 is_stmt 0 view .LVU293
 1005 0026 0CF1010C 		add	ip, ip, #1
 1006              	.LVL55:
 490:src/stm32/serial.c ****         written++;
 1007              		.loc 1 490 27 view .LVU294
 1008 002a 1EF8013F 		ldrb	r3, [lr, #1]!	@ zero_extendqisi2
 1009              	.LVL56:
 490:src/stm32/serial.c ****         written++;
 1010              		.loc 1 490 21 view .LVU295
 1011 002e 4360     		str	r3, [r0, #4]
 1012              		.loc 1 491 9 is_stmt 1 view .LVU296
 1013              	.LVL57:
ARM GAS  /tmp/ccWwtxPM.s 			page 31


 1014              		.loc 1 491 9 is_stmt 0 view .LVU297
 1015              	.LBE127:
 480:src/stm32/serial.c ****         /* Wait for TXE (transmit data register empty) */
 1016              		.loc 1 480 33 is_stmt 1 view .LVU298
 480:src/stm32/serial.c ****         /* Wait for TXE (transmit data register empty) */
 1017              		.loc 1 480 24 view .LVU299
 480:src/stm32/serial.c ****         /* Wait for TXE (transmit data register empty) */
 1018              		.loc 1 480 5 is_stmt 0 view .LVU300
 1019 0030 6145     		cmp	r1, ip
 1020 0032 F1D1     		bne	.L88
 1021              	.LBE130:
 492:src/stm32/serial.c ****     }
 493:src/stm32/serial.c ****     
 494:src/stm32/serial.c ****     return (int)written;
 1022              		.loc 1 494 5 is_stmt 1 view .LVU301
 1023              		.loc 1 494 12 is_stmt 0 view .LVU302
 1024 0034 0846     		mov	r0, r1
 1025              	.LBE132:
 1026              	.LBE134:
 495:src/stm32/serial.c **** }
 1027              		.loc 1 495 1 view .LVU303
 1028 0036 5DF804FB 		ldr	pc, [sp], #4
 1029              	.LVL58:
 1030              	.L99:
 1031              	.LBB135:
 1032              	.LBB133:
 1033              	.LBB131:
 1034              	.LBB128:
 485:src/stm32/serial.c ****             }
 1035              		.loc 1 485 17 is_stmt 1 view .LVU304
 485:src/stm32/serial.c ****             }
 1036              		.loc 1 485 24 is_stmt 0 view .LVU305
 1037 003a 6046     		mov	r0, ip
 1038              	.LBE128:
 1039              	.LBE131:
 1040              	.LBE133:
 1041              	.LBE135:
 1042              		.loc 1 495 1 view .LVU306
 1043 003c 5DF804FB 		ldr	pc, [sp], #4
 1044              	.LVL59:
 1045              	.L90:
 1046              		.cfi_def_cfa_offset 0
 1047              		.cfi_restore 14
 471:src/stm32/serial.c ****     }
 1048              		.loc 1 471 16 view .LVU307
 1049 0040 4FF0FF30 		mov	r0, #-1
 1050              	.LVL60:
 471:src/stm32/serial.c ****     }
 1051              		.loc 1 471 16 view .LVU308
 1052 0044 7047     		bx	lr
 1053              	.LVL61:
 1054              	.L98:
 475:src/stm32/serial.c ****     }
 1055              		.loc 1 475 16 view .LVU309
 1056 0046 6FF00100 		mvn	r0, #1
 1057              	.LVL62:
 1058              		.loc 1 495 1 view .LVU310
ARM GAS  /tmp/ccWwtxPM.s 			page 32


 1059 004a 7047     		bx	lr
 1060              	.L101:
 1061              		.align	2
 1062              	.L100:
 1063 004c 00000000 		.word	.LANCHOR10
 1064 0050 00000000 		.word	.LANCHOR0
 1065 0054 A0860100 		.word	100000
 1066              		.cfi_endproc
 1067              	.LFE22:
 1069              		.section	.text.serial_putc,"ax",%progbits
 1070              		.align	1
 1071              		.p2align 2,,3
 1072              		.global	serial_putc
 1073              		.syntax unified
 1074              		.thumb
 1075              		.thumb_func
 1076              		.fpu fpv4-sp-d16
 1078              	serial_putc:
 1079              	.LVL63:
 1080              	.LFB23:
 496:src/stm32/serial.c **** 
 497:src/stm32/serial.c **** /**
 498:src/stm32/serial.c ****  * @brief   Write a single byte to serial port
 499:src/stm32/serial.c ****  */
 500:src/stm32/serial.c **** int
 501:src/stm32/serial.c **** serial_putc(uint8_t byte)
 502:src/stm32/serial.c **** {
 1081              		.loc 1 502 1 is_stmt 1 view -0
 1082              		.cfi_startproc
 1083              		@ args = 0, pretend = 0, frame = 0
 1084              		@ frame_needed = 0, uses_anonymous_args = 0
 1085              		@ link register save eliminated.
 503:src/stm32/serial.c ****     return serial_write(&byte, 1) == 1 ? 0 : -1;
 1086              		.loc 1 503 5 view .LVU312
 1087              	.LBB142:
 1088              	.LBI142:
 468:src/stm32/serial.c **** {
 1089              		.loc 1 468 1 view .LVU313
 1090              	.LBB143:
 470:src/stm32/serial.c ****         return -1;
 1091              		.loc 1 470 5 view .LVU314
 474:src/stm32/serial.c ****         return -2;
 1092              		.loc 1 474 5 view .LVU315
 474:src/stm32/serial.c ****         return -2;
 1093              		.loc 1 474 9 is_stmt 0 view .LVU316
 1094 0000 084B     		ldr	r3, .L109
 474:src/stm32/serial.c ****         return -2;
 1095              		.loc 1 474 8 view .LVU317
 1096 0002 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1097 0004 5BB1     		cbz	r3, .L107
 1098              	.LBB144:
 1099              	.LBB145:
 1100              	.LBB146:
 1101              	.LBB147:
 483:src/stm32/serial.c ****             if (--timeout == 0) {
 1102              		.loc 1 483 25 view .LVU318
 1103 0006 084A     		ldr	r2, .L109+4
ARM GAS  /tmp/ccWwtxPM.s 			page 33


 1104 0008 084B     		ldr	r3, .L109+8
 1105 000a 1168     		ldr	r1, [r2]
 1106 000c 01E0     		b	.L104
 1107              	.LVL64:
 1108              	.L105:
 484:src/stm32/serial.c ****                 return (int)written;  /* Timeout */
 1109              		.loc 1 484 16 view .LVU319
 1110 000e 013B     		subs	r3, r3, #1
 1111              	.LVL65:
 484:src/stm32/serial.c ****                 return (int)written;  /* Timeout */
 1112              		.loc 1 484 16 view .LVU320
 1113 0010 05D0     		beq	.L107
 1114              	.LVL66:
 1115              	.L104:
 484:src/stm32/serial.c ****                 return (int)written;  /* Timeout */
 1116              		.loc 1 484 13 is_stmt 1 view .LVU321
 483:src/stm32/serial.c ****             if (--timeout == 0) {
 1117              		.loc 1 483 15 view .LVU322
 483:src/stm32/serial.c ****             if (--timeout == 0) {
 1118              		.loc 1 483 25 is_stmt 0 view .LVU323
 1119 0012 0A68     		ldr	r2, [r1]
 483:src/stm32/serial.c ****             if (--timeout == 0) {
 1120              		.loc 1 483 15 view .LVU324
 1121 0014 1206     		lsls	r2, r2, #24
 1122 0016 FAD5     		bpl	.L105
 490:src/stm32/serial.c ****         written++;
 1123              		.loc 1 490 9 is_stmt 1 view .LVU325
 490:src/stm32/serial.c ****         written++;
 1124              		.loc 1 490 21 is_stmt 0 view .LVU326
 1125 0018 4860     		str	r0, [r1, #4]
 491:src/stm32/serial.c ****     }
 1126              		.loc 1 491 9 is_stmt 1 view .LVU327
 1127              	.LVL67:
 491:src/stm32/serial.c ****     }
 1128              		.loc 1 491 9 is_stmt 0 view .LVU328
 1129              	.LBE147:
 480:src/stm32/serial.c ****         /* Wait for TXE (transmit data register empty) */
 1130              		.loc 1 480 33 is_stmt 1 view .LVU329
 480:src/stm32/serial.c ****         /* Wait for TXE (transmit data register empty) */
 1131              		.loc 1 480 24 view .LVU330
 1132              	.LBE146:
 494:src/stm32/serial.c **** }
 1133              		.loc 1 494 5 view .LVU331
 494:src/stm32/serial.c **** }
 1134              		.loc 1 494 5 is_stmt 0 view .LVU332
 1135              	.LBE145:
 1136              	.LBE144:
 1137              	.LBE143:
 1138              	.LBE142:
 1139              		.loc 1 503 44 view .LVU333
 1140 001a 0020     		movs	r0, #0
 1141              	.LVL68:
 1142              		.loc 1 503 44 view .LVU334
 1143 001c 7047     		bx	lr
 1144              	.LVL69:
 1145              	.L107:
 1146              		.loc 1 503 44 view .LVU335
ARM GAS  /tmp/ccWwtxPM.s 			page 34


 1147 001e 4FF0FF30 		mov	r0, #-1
 1148              	.LVL70:
 504:src/stm32/serial.c **** }
 1149              		.loc 1 504 1 view .LVU336
 1150 0022 7047     		bx	lr
 1151              	.L110:
 1152              		.align	2
 1153              	.L109:
 1154 0024 00000000 		.word	.LANCHOR10
 1155 0028 00000000 		.word	.LANCHOR0
 1156 002c A0860100 		.word	100000
 1157              		.cfi_endproc
 1158              	.LFE23:
 1160              		.section	.text.print_uint,"ax",%progbits
 1161              		.align	1
 1162              		.p2align 2,,3
 1163              		.syntax unified
 1164              		.thumb
 1165              		.thumb_func
 1166              		.fpu fpv4-sp-d16
 1168              	print_uint:
 1169              	.LVL71:
 1170              	.LFB35:
 505:src/stm32/serial.c **** 
 506:src/stm32/serial.c **** /**
 507:src/stm32/serial.c ****  * @brief   Write a null-terminated string to serial port
 508:src/stm32/serial.c ****  */
 509:src/stm32/serial.c **** int
 510:src/stm32/serial.c **** serial_puts(const char *str)
 511:src/stm32/serial.c **** {
 512:src/stm32/serial.c ****     if (str == NULL) {
 513:src/stm32/serial.c ****         return -1;
 514:src/stm32/serial.c ****     }
 515:src/stm32/serial.c ****     
 516:src/stm32/serial.c ****     size_t len = 0;
 517:src/stm32/serial.c ****     while (str[len] != '\0') {
 518:src/stm32/serial.c ****         len++;
 519:src/stm32/serial.c ****     }
 520:src/stm32/serial.c ****     
 521:src/stm32/serial.c ****     return serial_write((const uint8_t *)str, len);
 522:src/stm32/serial.c **** }
 523:src/stm32/serial.c **** 
 524:src/stm32/serial.c **** /**
 525:src/stm32/serial.c ****  * @brief   Read data from serial port
 526:src/stm32/serial.c ****  */
 527:src/stm32/serial.c **** int
 528:src/stm32/serial.c **** serial_read(uint8_t *data, size_t len)
 529:src/stm32/serial.c **** {
 530:src/stm32/serial.c ****     if (data == NULL || len == 0) {
 531:src/stm32/serial.c ****         return -1;
 532:src/stm32/serial.c ****     }
 533:src/stm32/serial.c ****     
 534:src/stm32/serial.c ****     if (!s_initialized) {
 535:src/stm32/serial.c ****         return -2;
 536:src/stm32/serial.c ****     }
 537:src/stm32/serial.c ****     
 538:src/stm32/serial.c ****     size_t read_count = 0;
ARM GAS  /tmp/ccWwtxPM.s 			page 35


 539:src/stm32/serial.c ****     uint32_t irqflag = irq_disable();
 540:src/stm32/serial.c ****     
 541:src/stm32/serial.c ****     while (read_count < len) {
 542:src/stm32/serial.c ****         uint8_t byte;
 543:src/stm32/serial.c ****         if (ring_buffer_get(&s_rx_buffer, &byte) == 0) {
 544:src/stm32/serial.c ****             data[read_count++] = byte;
 545:src/stm32/serial.c ****         } else {
 546:src/stm32/serial.c ****             break;  /* No more data */
 547:src/stm32/serial.c ****         }
 548:src/stm32/serial.c ****     }
 549:src/stm32/serial.c ****     
 550:src/stm32/serial.c ****     irq_restore(irqflag);
 551:src/stm32/serial.c ****     
 552:src/stm32/serial.c ****     return (int)read_count;
 553:src/stm32/serial.c **** }
 554:src/stm32/serial.c **** 
 555:src/stm32/serial.c **** /**
 556:src/stm32/serial.c ****  * @brief   Read a single byte from serial port
 557:src/stm32/serial.c ****  */
 558:src/stm32/serial.c **** int
 559:src/stm32/serial.c **** serial_getc(uint8_t *byte)
 560:src/stm32/serial.c **** {
 561:src/stm32/serial.c ****     if (byte == NULL) {
 562:src/stm32/serial.c ****         return -1;
 563:src/stm32/serial.c ****     }
 564:src/stm32/serial.c ****     
 565:src/stm32/serial.c ****     return serial_read(byte, 1) == 1 ? 0 : -1;
 566:src/stm32/serial.c **** }
 567:src/stm32/serial.c **** 
 568:src/stm32/serial.c **** /**
 569:src/stm32/serial.c ****  * @brief   Read a complete line from serial port
 570:src/stm32/serial.c ****  */
 571:src/stm32/serial.c **** int
 572:src/stm32/serial.c **** serial_readline(char *line, size_t maxlen)
 573:src/stm32/serial.c **** {
 574:src/stm32/serial.c ****     if (line == NULL || maxlen == 0) {
 575:src/stm32/serial.c ****         return -1;
 576:src/stm32/serial.c ****     }
 577:src/stm32/serial.c ****     
 578:src/stm32/serial.c ****     if (!s_initialized) {
 579:src/stm32/serial.c ****         return -2;
 580:src/stm32/serial.c ****     }
 581:src/stm32/serial.c ****     
 582:src/stm32/serial.c ****     if (!s_line_ready) {
 583:src/stm32/serial.c ****         return 0;  /* No complete line available */
 584:src/stm32/serial.c ****     }
 585:src/stm32/serial.c ****     
 586:src/stm32/serial.c ****     uint32_t irqflag = irq_disable();
 587:src/stm32/serial.c ****     
 588:src/stm32/serial.c ****     /* Copy line to output buffer */
 589:src/stm32/serial.c ****     size_t copy_len = s_line_len;
 590:src/stm32/serial.c ****     if (copy_len >= maxlen) {
 591:src/stm32/serial.c ****         copy_len = maxlen - 1;
 592:src/stm32/serial.c ****     }
 593:src/stm32/serial.c ****     
 594:src/stm32/serial.c ****     for (size_t i = 0; i < copy_len; i++) {
 595:src/stm32/serial.c ****         line[i] = s_line_buffer[i];
ARM GAS  /tmp/ccWwtxPM.s 			page 36


 596:src/stm32/serial.c ****     }
 597:src/stm32/serial.c ****     line[copy_len] = '\0';
 598:src/stm32/serial.c ****     
 599:src/stm32/serial.c ****     /* Reset line buffer */
 600:src/stm32/serial.c ****     s_line_len = 0;
 601:src/stm32/serial.c ****     s_line_ready = 0;
 602:src/stm32/serial.c ****     
 603:src/stm32/serial.c ****     irq_restore(irqflag);
 604:src/stm32/serial.c ****     
 605:src/stm32/serial.c ****     return (int)copy_len;
 606:src/stm32/serial.c **** }
 607:src/stm32/serial.c **** 
 608:src/stm32/serial.c **** /**
 609:src/stm32/serial.c ****  * @brief   Check if a complete line is available
 610:src/stm32/serial.c ****  */
 611:src/stm32/serial.c **** int
 612:src/stm32/serial.c **** serial_line_available(void)
 613:src/stm32/serial.c **** {
 614:src/stm32/serial.c ****     return s_line_ready ? 1 : 0;
 615:src/stm32/serial.c **** }
 616:src/stm32/serial.c **** 
 617:src/stm32/serial.c **** /**
 618:src/stm32/serial.c ****  * @brief   Get number of bytes available in receive buffer
 619:src/stm32/serial.c ****  */
 620:src/stm32/serial.c **** size_t
 621:src/stm32/serial.c **** serial_rx_available(void)
 622:src/stm32/serial.c **** {
 623:src/stm32/serial.c ****     return s_rx_buffer.count;
 624:src/stm32/serial.c **** }
 625:src/stm32/serial.c **** 
 626:src/stm32/serial.c **** /**
 627:src/stm32/serial.c ****  * @brief   Get free space in transmit buffer
 628:src/stm32/serial.c ****  */
 629:src/stm32/serial.c **** size_t
 630:src/stm32/serial.c **** serial_tx_free(void)
 631:src/stm32/serial.c **** {
 632:src/stm32/serial.c ****     return SERIAL_TX_BUFFER_SIZE - s_tx_buffer.count;
 633:src/stm32/serial.c **** }
 634:src/stm32/serial.c **** 
 635:src/stm32/serial.c **** /**
 636:src/stm32/serial.c ****  * @brief   Flush transmit buffer
 637:src/stm32/serial.c ****  */
 638:src/stm32/serial.c **** void
 639:src/stm32/serial.c **** serial_flush(void)
 640:src/stm32/serial.c **** {
 641:src/stm32/serial.c ****     if (!s_initialized) {
 642:src/stm32/serial.c ****         return;
 643:src/stm32/serial.c ****     }
 644:src/stm32/serial.c ****     
 645:src/stm32/serial.c ****     /* Wait for transmission complete */
 646:src/stm32/serial.c ****     uint32_t timeout = 1000000;
 647:src/stm32/serial.c ****     while (!(s_usart->SR & USART_SR_TC)) {
 648:src/stm32/serial.c ****         if (--timeout == 0) {
 649:src/stm32/serial.c ****             break;
 650:src/stm32/serial.c ****         }
 651:src/stm32/serial.c ****     }
 652:src/stm32/serial.c **** }
ARM GAS  /tmp/ccWwtxPM.s 			page 37


 653:src/stm32/serial.c **** 
 654:src/stm32/serial.c **** /**
 655:src/stm32/serial.c ****  * @brief   Clear receive buffer
 656:src/stm32/serial.c ****  */
 657:src/stm32/serial.c **** void
 658:src/stm32/serial.c **** serial_rx_clear(void)
 659:src/stm32/serial.c **** {
 660:src/stm32/serial.c ****     uint32_t irqflag = irq_disable();
 661:src/stm32/serial.c ****     ring_buffer_init(&s_rx_buffer);
 662:src/stm32/serial.c ****     s_line_len = 0;
 663:src/stm32/serial.c ****     s_line_ready = 0;
 664:src/stm32/serial.c ****     irq_restore(irqflag);
 665:src/stm32/serial.c **** }
 666:src/stm32/serial.c **** 
 667:src/stm32/serial.c **** /**
 668:src/stm32/serial.c ****  * @brief   Enable serial receive interrupt
 669:src/stm32/serial.c ****  */
 670:src/stm32/serial.c **** void
 671:src/stm32/serial.c **** serial_rx_enable(void)
 672:src/stm32/serial.c **** {
 673:src/stm32/serial.c ****     if (s_initialized) {
 674:src/stm32/serial.c ****         s_usart->CR1 |= USART_CR1_RXNEIE;
 675:src/stm32/serial.c ****     }
 676:src/stm32/serial.c **** }
 677:src/stm32/serial.c **** 
 678:src/stm32/serial.c **** /**
 679:src/stm32/serial.c ****  * @brief   Disable serial receive interrupt
 680:src/stm32/serial.c ****  */
 681:src/stm32/serial.c **** void
 682:src/stm32/serial.c **** serial_rx_disable(void)
 683:src/stm32/serial.c **** {
 684:src/stm32/serial.c ****     if (s_initialized) {
 685:src/stm32/serial.c ****         s_usart->CR1 &= ~USART_CR1_RXNEIE;
 686:src/stm32/serial.c ****     }
 687:src/stm32/serial.c **** }
 688:src/stm32/serial.c **** 
 689:src/stm32/serial.c **** /* ========== Debug Output Functions ========== */
 690:src/stm32/serial.c **** 
 691:src/stm32/serial.c **** /**
 692:src/stm32/serial.c ****  * @brief   Print unsigned integer
 693:src/stm32/serial.c ****  */
 694:src/stm32/serial.c **** static int
 695:src/stm32/serial.c **** print_uint(uint32_t val, int base, int width, char pad)
 696:src/stm32/serial.c **** {
 1171              		.loc 1 696 1 is_stmt 1 view -0
 1172              		.cfi_startproc
 1173              		@ args = 0, pretend = 0, frame = 16
 1174              		@ frame_needed = 0, uses_anonymous_args = 0
 697:src/stm32/serial.c ****     char buf[12];
 1175              		.loc 1 697 5 view .LVU338
 698:src/stm32/serial.c ****     int len = 0;
 1176              		.loc 1 698 5 view .LVU339
 699:src/stm32/serial.c ****     int count = 0;
 1177              		.loc 1 699 5 view .LVU340
 700:src/stm32/serial.c ****     
 701:src/stm32/serial.c ****     if (val == 0) {
 1178              		.loc 1 701 5 view .LVU341
ARM GAS  /tmp/ccWwtxPM.s 			page 38


 696:src/stm32/serial.c ****     char buf[12];
 1179              		.loc 1 696 1 is_stmt 0 view .LVU342
 1180 0000 2DE9F043 		push	{r4, r5, r6, r7, r8, r9, lr}
 1181              		.cfi_def_cfa_offset 28
 1182              		.cfi_offset 4, -28
 1183              		.cfi_offset 5, -24
 1184              		.cfi_offset 6, -20
 1185              		.cfi_offset 7, -16
 1186              		.cfi_offset 8, -12
 1187              		.cfi_offset 9, -8
 1188              		.cfi_offset 14, -4
 1189 0004 9046     		mov	r8, r2
 1190 0006 85B0     		sub	sp, sp, #20
 1191              		.cfi_def_cfa_offset 48
 696:src/stm32/serial.c ****     char buf[12];
 1192              		.loc 1 696 1 view .LVU343
 1193 0008 1F46     		mov	r7, r3
 1194              		.loc 1 701 8 view .LVU344
 1195 000a 10BB     		cbnz	r0, .L112
 702:src/stm32/serial.c ****         buf[len++] = '0';
 1196              		.loc 1 702 9 is_stmt 1 view .LVU345
 1197              	.LVL72:
 1198              		.loc 1 702 20 is_stmt 0 view .LVU346
 1199 000c 4FF03009 		mov	r9, #48
 703:src/stm32/serial.c ****     } else {
 704:src/stm32/serial.c ****         while (val > 0) {
 705:src/stm32/serial.c ****             int digit = val % base;
 706:src/stm32/serial.c ****             if (digit < 10) {
 707:src/stm32/serial.c ****                 buf[len++] = '0' + digit;
 708:src/stm32/serial.c ****             } else {
 709:src/stm32/serial.c ****                 buf[len++] = 'a' + digit - 10;
 710:src/stm32/serial.c ****             }
 711:src/stm32/serial.c ****             val /= base;
 712:src/stm32/serial.c ****         }
 713:src/stm32/serial.c ****     }
 714:src/stm32/serial.c ****     
 715:src/stm32/serial.c ****     /* Padding */
 716:src/stm32/serial.c ****     while (len < width) {
 1200              		.loc 1 716 11 view .LVU347
 1201 0010 012A     		cmp	r2, #1
 702:src/stm32/serial.c ****         buf[len++] = '0';
 1202              		.loc 1 702 20 view .LVU348
 1203 0012 8DF80490 		strb	r9, [sp, #4]
 1204              		.loc 1 716 11 is_stmt 1 view .LVU349
 1205 0016 46DD     		ble	.L131
 702:src/stm32/serial.c ****         buf[len++] = '0';
 1206              		.loc 1 702 16 is_stmt 0 view .LVU350
 1207 0018 0125     		movs	r5, #1
 1208 001a 01AE     		add	r6, sp, #4
 1209              	.LVL73:
 1210              	.L113:
 702:src/stm32/serial.c ****         buf[len++] = '0';
 1211              		.loc 1 702 16 view .LVU351
 1212 001c 4446     		mov	r4, r8
 1213              	.LVL74:
 1214              	.L119:
 717:src/stm32/serial.c ****         serial_putc(pad);
ARM GAS  /tmp/ccWwtxPM.s 			page 39


 1215              		.loc 1 717 9 is_stmt 1 view .LVU352
 1216 001e 3846     		mov	r0, r7
 718:src/stm32/serial.c ****         count++;
 719:src/stm32/serial.c ****         width--;
 1217              		.loc 1 719 14 is_stmt 0 view .LVU353
 1218 0020 013C     		subs	r4, r4, #1
 1219              	.LVL75:
 717:src/stm32/serial.c ****         serial_putc(pad);
 1220              		.loc 1 717 9 view .LVU354
 1221 0022 FFF7FEFF 		bl	serial_putc
 1222              	.LVL76:
 718:src/stm32/serial.c ****         count++;
 1223              		.loc 1 718 9 is_stmt 1 view .LVU355
 1224              		.loc 1 719 9 view .LVU356
 716:src/stm32/serial.c ****         serial_putc(pad);
 1225              		.loc 1 716 11 view .LVU357
 1226 0026 A542     		cmp	r5, r4
 1227 0028 F9DB     		blt	.L119
 718:src/stm32/serial.c ****         count++;
 1228              		.loc 1 718 14 is_stmt 0 view .LVU358
 1229 002a A8EB0507 		sub	r7, r8, r5
 1230 002e A845     		cmp	r8, r5
 1231 0030 D8BF     		it	le
 1232 0032 0127     		movle	r7, #1
 1233              	.LVL77:
 1234              	.L120:
 720:src/stm32/serial.c ****     }
 721:src/stm32/serial.c ****     
 722:src/stm32/serial.c ****     /* Print in reverse order */
 723:src/stm32/serial.c ****     while (len > 0) {
 1235              		.loc 1 723 11 is_stmt 1 view .LVU359
 1236 0034 013D     		subs	r5, r5, #1
 1237              	.LVL78:
 1238              		.loc 1 723 11 is_stmt 0 view .LVU360
 1239 0036 7419     		adds	r4, r6, r5
 1240 0038 01E0     		b	.L124
 1241              	.LVL79:
 1242              	.L132:
 724:src/stm32/serial.c ****         serial_putc(buf[--len]);
 1243              		.loc 1 724 24 view .LVU361
 1244 003a 14F8019D 		ldrb	r9, [r4, #-1]!	@ zero_extendqisi2
 1245              	.LVL80:
 1246              	.L124:
 1247              		.loc 1 724 9 is_stmt 1 view .LVU362
 1248              		.loc 1 724 9 is_stmt 0 view .LVU363
 1249 003e 4846     		mov	r0, r9
 1250 0040 FFF7FEFF 		bl	serial_putc
 1251              	.LVL81:
 725:src/stm32/serial.c ****         count++;
 1252              		.loc 1 725 9 is_stmt 1 view .LVU364
 723:src/stm32/serial.c ****         serial_putc(buf[--len]);
 1253              		.loc 1 723 11 view .LVU365
 1254 0044 A642     		cmp	r6, r4
 1255 0046 F8D1     		bne	.L132
 1256 0048 781C     		adds	r0, r7, #1
 1257              		.loc 1 725 14 is_stmt 0 view .LVU366
 1258 004a 2844     		add	r0, r0, r5
ARM GAS  /tmp/ccWwtxPM.s 			page 40


 726:src/stm32/serial.c ****     }
 727:src/stm32/serial.c ****     
 728:src/stm32/serial.c ****     return count;
 1259              		.loc 1 728 5 is_stmt 1 view .LVU367
 1260              	.LVL82:
 1261              	.L111:
 729:src/stm32/serial.c **** }
 1262              		.loc 1 729 1 is_stmt 0 view .LVU368
 1263 004c 05B0     		add	sp, sp, #20
 1264              		.cfi_remember_state
 1265              		.cfi_def_cfa_offset 28
 1266              		@ sp needed
 1267 004e BDE8F083 		pop	{r4, r5, r6, r7, r8, r9, pc}
 1268              	.LVL83:
 1269              	.L112:
 1270              		.cfi_restore_state
 1271              		.loc 1 729 1 view .LVU369
 1272 0052 01AE     		add	r6, sp, #4
 1273 0054 3446     		mov	r4, r6
 1274              	.LBB148:
 705:src/stm32/serial.c ****             if (digit < 10) {
 1275              		.loc 1 705 29 view .LVU370
 1276 0056 0123     		movs	r3, #1
 1277              	.LVL84:
 705:src/stm32/serial.c ****             if (digit < 10) {
 1278              		.loc 1 705 29 view .LVU371
 1279 0058 09E0     		b	.L117
 1280              	.LVL85:
 1281              	.L134:
 707:src/stm32/serial.c ****             } else {
 1282              		.loc 1 707 34 view .LVU372
 1283 005a 5FFA8EFC 		uxtb	ip, lr
 1284              	.LVL86:
 707:src/stm32/serial.c ****             } else {
 1285              		.loc 1 707 34 view .LVU373
 1286              	.LBE148:
 704:src/stm32/serial.c ****             int digit = val % base;
 1287              		.loc 1 704 15 view .LVU374
 1288 005e 8142     		cmp	r1, r0
 1289              	.LBB149:
 707:src/stm32/serial.c ****             } else {
 1290              		.loc 1 707 24 view .LVU375
 1291 0060 1D46     		mov	r5, r3
 1292              	.LVL87:
 707:src/stm32/serial.c ****             } else {
 1293              		.loc 1 707 24 view .LVU376
 1294 0062 04F801CB 		strb	ip, [r4], #1
 711:src/stm32/serial.c ****         }
 1295              		.loc 1 711 13 is_stmt 1 view .LVU377
 1296              	.LVL88:
 711:src/stm32/serial.c ****         }
 1297              		.loc 1 711 13 is_stmt 0 view .LVU378
 1298              	.LBE149:
 704:src/stm32/serial.c ****             int digit = val % base;
 1299              		.loc 1 704 15 is_stmt 1 view .LVU379
 1300 0066 03F10103 		add	r3, r3, #1
 1301 006a 14D8     		bhi	.L133
ARM GAS  /tmp/ccWwtxPM.s 			page 41


 1302              	.L126:
 1303              	.LBB150:
 711:src/stm32/serial.c ****         }
 1304              		.loc 1 711 17 is_stmt 0 view .LVU380
 1305 006c 1046     		mov	r0, r2
 1306              	.LVL89:
 1307              	.L117:
 705:src/stm32/serial.c ****             if (digit < 10) {
 1308              		.loc 1 705 13 is_stmt 1 view .LVU381
 707:src/stm32/serial.c ****             } else {
 1309              		.loc 1 707 17 view .LVU382
 709:src/stm32/serial.c ****             }
 1310              		.loc 1 709 17 view .LVU383
 705:src/stm32/serial.c ****             if (digit < 10) {
 1311              		.loc 1 705 29 is_stmt 0 view .LVU384
 1312 006e B0FBF1F2 		udiv	r2, r0, r1
 1313 0072 01FB120C 		mls	ip, r1, r2, r0
 1314              	.LVL90:
 706:src/stm32/serial.c ****                 buf[len++] = '0' + digit;
 1315              		.loc 1 706 13 is_stmt 1 view .LVU385
 706:src/stm32/serial.c ****                 buf[len++] = '0' + digit;
 1316              		.loc 1 706 16 is_stmt 0 view .LVU386
 1317 0076 BCF1090F 		cmp	ip, #9
 707:src/stm32/serial.c ****             } else {
 1318              		.loc 1 707 34 view .LVU387
 1319 007a 0CF1300E 		add	lr, ip, #48
 706:src/stm32/serial.c ****                 buf[len++] = '0' + digit;
 1320              		.loc 1 706 16 view .LVU388
 1321 007e ECD9     		bls	.L134
 709:src/stm32/serial.c ****             }
 1322              		.loc 1 709 42 view .LVU389
 1323 0080 0CF1570C 		add	ip, ip, #87
 1324              	.LVL91:
 709:src/stm32/serial.c ****             }
 1325              		.loc 1 709 42 view .LVU390
 1326 0084 5FFA8CFC 		uxtb	ip, ip
 1327              	.LVL92:
 709:src/stm32/serial.c ****             }
 1328              		.loc 1 709 42 view .LVU391
 1329              	.LBE150:
 704:src/stm32/serial.c ****             int digit = val % base;
 1330              		.loc 1 704 15 view .LVU392
 1331 0088 8142     		cmp	r1, r0
 1332              	.LBB151:
 709:src/stm32/serial.c ****             }
 1333              		.loc 1 709 24 view .LVU393
 1334 008a 1D46     		mov	r5, r3
 1335              	.LVL93:
 709:src/stm32/serial.c ****             }
 1336              		.loc 1 709 24 view .LVU394
 1337 008c 04F801CB 		strb	ip, [r4], #1
 711:src/stm32/serial.c ****         }
 1338              		.loc 1 711 13 is_stmt 1 view .LVU395
 1339              	.LVL94:
 711:src/stm32/serial.c ****         }
 1340              		.loc 1 711 13 is_stmt 0 view .LVU396
 1341              	.LBE151:
ARM GAS  /tmp/ccWwtxPM.s 			page 42


 704:src/stm32/serial.c ****             int digit = val % base;
 1342              		.loc 1 704 15 is_stmt 1 view .LVU397
 1343 0090 03F10103 		add	r3, r3, #1
 1344              	.LVL95:
 704:src/stm32/serial.c ****             int digit = val % base;
 1345              		.loc 1 704 15 is_stmt 0 view .LVU398
 1346 0094 EAD9     		bls	.L126
 1347              	.L133:
 716:src/stm32/serial.c ****         serial_putc(pad);
 1348              		.loc 1 716 11 is_stmt 1 view .LVU399
 1349 0096 4545     		cmp	r5, r8
 1350 0098 0ADA     		bge	.L122
 724:src/stm32/serial.c ****         count++;
 1351              		.loc 1 724 24 is_stmt 0 view .LVU400
 1352 009a 05F11003 		add	r3, r5, #16
 1353 009e 6B44     		add	r3, sp, r3
 1354 00a0 13F80D9C 		ldrb	r9, [r3, #-13]	@ zero_extendqisi2
 1355 00a4 BAE7     		b	.L113
 1356              	.LVL96:
 1357              	.L131:
 723:src/stm32/serial.c ****         serial_putc(buf[--len]);
 1358              		.loc 1 723 11 is_stmt 1 view .LVU401
 724:src/stm32/serial.c ****         count++;
 1359              		.loc 1 724 9 view .LVU402
 724:src/stm32/serial.c ****         count++;
 1360              		.loc 1 724 9 is_stmt 0 view .LVU403
 1361 00a6 4846     		mov	r0, r9
 1362              	.LVL97:
 724:src/stm32/serial.c ****         count++;
 1363              		.loc 1 724 9 view .LVU404
 1364 00a8 FFF7FEFF 		bl	serial_putc
 1365              	.LVL98:
 725:src/stm32/serial.c ****     }
 1366              		.loc 1 725 9 is_stmt 1 view .LVU405
 723:src/stm32/serial.c ****         serial_putc(buf[--len]);
 1367              		.loc 1 723 11 view .LVU406
 725:src/stm32/serial.c ****     }
 1368              		.loc 1 725 14 is_stmt 0 view .LVU407
 1369 00ac 0120     		movs	r0, #1
 1370 00ae CDE7     		b	.L111
 1371              	.LVL99:
 1372              	.L122:
 724:src/stm32/serial.c ****         count++;
 1373              		.loc 1 724 24 view .LVU408
 1374 00b0 05F11003 		add	r3, r5, #16
 1375 00b4 6B44     		add	r3, sp, r3
 1376 00b6 0027     		movs	r7, #0
 1377 00b8 13F80D9C 		ldrb	r9, [r3, #-13]	@ zero_extendqisi2
 1378 00bc BAE7     		b	.L120
 1379              		.cfi_endproc
 1380              	.LFE35:
 1382 00be 00BF     		.section	.text.serial_puts,"ax",%progbits
 1383              		.align	1
 1384              		.p2align 2,,3
 1385              		.global	serial_puts
 1386              		.syntax unified
 1387              		.thumb
ARM GAS  /tmp/ccWwtxPM.s 			page 43


 1388              		.thumb_func
 1389              		.fpu fpv4-sp-d16
 1391              	serial_puts:
 1392              	.LVL100:
 1393              	.LFB24:
 511:src/stm32/serial.c ****     if (str == NULL) {
 1394              		.loc 1 511 1 is_stmt 1 view -0
 1395              		.cfi_startproc
 1396              		@ args = 0, pretend = 0, frame = 0
 1397              		@ frame_needed = 0, uses_anonymous_args = 0
 1398              		@ link register save eliminated.
 512:src/stm32/serial.c ****         return -1;
 1399              		.loc 1 512 5 view .LVU410
 512:src/stm32/serial.c ****         return -1;
 1400              		.loc 1 512 8 is_stmt 0 view .LVU411
 1401 0000 60B1     		cbz	r0, .L136
 1402              	.LVL101:
 517:src/stm32/serial.c ****         len++;
 1403              		.loc 1 517 11 is_stmt 1 view .LVU412
 1404 0002 0178     		ldrb	r1, [r0]	@ zero_extendqisi2
 1405 0004 41B1     		cbz	r1, .L137
 1406 0006 0346     		mov	r3, r0
 1407 0008 C0F1010C 		rsb	ip, r0, #1
 1408              	.LVL102:
 1409              	.L138:
 518:src/stm32/serial.c ****     }
 1410              		.loc 1 518 9 view .LVU413
 1411 000c 0CEB0301 		add	r1, ip, r3
 1412              	.LVL103:
 517:src/stm32/serial.c ****         len++;
 1413              		.loc 1 517 11 view .LVU414
 1414 0010 13F8012F 		ldrb	r2, [r3, #1]!	@ zero_extendqisi2
 1415 0014 002A     		cmp	r2, #0
 1416 0016 F9D1     		bne	.L138
 1417              	.LVL104:
 1418              	.L137:
 521:src/stm32/serial.c **** }
 1419              		.loc 1 521 5 view .LVU415
 521:src/stm32/serial.c **** }
 1420              		.loc 1 521 12 is_stmt 0 view .LVU416
 1421 0018 FFF7FEBF 		b	serial_write
 1422              	.LVL105:
 1423              	.L136:
 522:src/stm32/serial.c **** 
 1424              		.loc 1 522 1 view .LVU417
 1425 001c 4FF0FF30 		mov	r0, #-1
 1426              	.LVL106:
 522:src/stm32/serial.c **** 
 1427              		.loc 1 522 1 view .LVU418
 1428 0020 7047     		bx	lr
 1429              		.cfi_endproc
 1430              	.LFE24:
 1432 0022 00BF     		.section	.text.serial_read,"ax",%progbits
 1433              		.align	1
 1434              		.p2align 2,,3
 1435              		.global	serial_read
 1436              		.syntax unified
ARM GAS  /tmp/ccWwtxPM.s 			page 44


 1437              		.thumb
 1438              		.thumb_func
 1439              		.fpu fpv4-sp-d16
 1441              	serial_read:
 1442              	.LVL107:
 1443              	.LFB25:
 529:src/stm32/serial.c ****     if (data == NULL || len == 0) {
 1444              		.loc 1 529 1 is_stmt 1 view -0
 1445              		.cfi_startproc
 1446              		@ args = 0, pretend = 0, frame = 0
 1447              		@ frame_needed = 0, uses_anonymous_args = 0
 530:src/stm32/serial.c ****         return -1;
 1448              		.loc 1 530 5 view .LVU420
 530:src/stm32/serial.c ****         return -1;
 1449              		.loc 1 530 8 is_stmt 0 view .LVU421
 1450 0000 60B3     		cbz	r0, .L146
 530:src/stm32/serial.c ****         return -1;
 1451              		.loc 1 530 22 discriminator 1 view .LVU422
 1452 0002 59B3     		cbz	r1, .L146
 534:src/stm32/serial.c ****         return -2;
 1453              		.loc 1 534 5 is_stmt 1 view .LVU423
 534:src/stm32/serial.c ****         return -2;
 1454              		.loc 1 534 9 is_stmt 0 view .LVU424
 1455 0004 184B     		ldr	r3, .L154
 534:src/stm32/serial.c ****         return -2;
 1456              		.loc 1 534 8 view .LVU425
 1457 0006 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1458 0008 5BB3     		cbz	r3, .L147
 538:src/stm32/serial.c ****     uint32_t irqflag = irq_disable();
 1459              		.loc 1 538 5 is_stmt 1 view .LVU426
 1460              	.LVL108:
 539:src/stm32/serial.c ****     
 1461              		.loc 1 539 5 view .LVU427
 1462              	.LBB159:
 1463              	.LBI159:
 1464              		.file 2 "./board/irq.h"
   1:./board/irq.h **** /**
   2:./board/irq.h ****  * @file    irq.h
   3:./board/irq.h ****  * @brief   Interrupt management interface
   4:./board/irq.h ****  * 
   5:./board/irq.h ****  * Provides interrupt enable/disable functions and critical section
   6:./board/irq.h ****  * management for STM32F407.
   7:./board/irq.h ****  */
   8:./board/irq.h **** 
   9:./board/irq.h **** #ifndef BOARD_IRQ_H
  10:./board/irq.h **** #define BOARD_IRQ_H
  11:./board/irq.h **** 
  12:./board/irq.h **** #include <stdint.h>
  13:./board/irq.h **** 
  14:./board/irq.h **** /* ========== Interrupt Control ========== */
  15:./board/irq.h **** 
  16:./board/irq.h **** /**
  17:./board/irq.h ****  * @brief   Disable all interrupts
  18:./board/irq.h ****  * @return  Previous interrupt state (for restore)
  19:./board/irq.h ****  */
  20:./board/irq.h **** static inline uint32_t irq_disable(void)
 1465              		.loc 2 20 24 view .LVU428
ARM GAS  /tmp/ccWwtxPM.s 			page 45


 1466              	.LBB160:
  21:./board/irq.h **** {
  22:./board/irq.h ****     uint32_t primask;
 1467              		.loc 2 22 5 view .LVU429
  23:./board/irq.h ****     __asm__ __volatile__(
 1468              		.loc 2 23 5 view .LVU430
 1469              	.LBE160:
 1470              	.LBE159:
 529:src/stm32/serial.c ****     if (data == NULL || len == 0) {
 1471              		.loc 1 529 1 is_stmt 0 view .LVU431
 1472 000a 30B5     		push	{r4, r5, lr}
 1473              		.cfi_def_cfa_offset 12
 1474              		.cfi_offset 4, -12
 1475              		.cfi_offset 5, -8
 1476              		.cfi_offset 14, -4
 1477              	.LBB162:
 1478              	.LBB161:
 1479              		.loc 2 23 5 view .LVU432
 1480              		.syntax unified
 1481              	@ 23 "./board/irq.h" 1
 1482 000c EFF31085 		mrs r5, primask
 1483 0010 72B6     	cpsid i
 1484              	
 1485              	@ 0 "" 2
 1486              	.LVL109:
  24:./board/irq.h ****         "mrs %0, primask\n"
  25:./board/irq.h ****         "cpsid i\n"
  26:./board/irq.h ****         : "=r" (primask)
  27:./board/irq.h ****         :
  28:./board/irq.h ****         : "memory"
  29:./board/irq.h ****     );
  30:./board/irq.h ****     return primask;
 1487              		.loc 2 30 5 is_stmt 1 view .LVU433
 1488              		.loc 2 30 5 is_stmt 0 view .LVU434
 1489              		.thumb
 1490              		.syntax unified
 1491              	.LBE161:
 1492              	.LBE162:
 541:src/stm32/serial.c ****         uint8_t byte;
 1493              		.loc 1 541 5 is_stmt 1 view .LVU435
 541:src/stm32/serial.c ****         uint8_t byte;
 1494              		.loc 1 541 11 view .LVU436
 1495 0012 164B     		ldr	r3, .L154+4
 1496 0014 00F1FF3E 		add	lr, r0, #-1
 538:src/stm32/serial.c ****     uint32_t irqflag = irq_disable();
 1497              		.loc 1 538 12 is_stmt 0 view .LVU437
 1498 0018 4FF0000C 		mov	ip, #0
 1499              	.LVL110:
 1500              	.L144:
 1501              	.LBB163:
 542:src/stm32/serial.c ****         if (ring_buffer_get(&s_rx_buffer, &byte) == 0) {
 1502              		.loc 1 542 9 is_stmt 1 view .LVU438
 543:src/stm32/serial.c ****             data[read_count++] = byte;
 1503              		.loc 1 543 9 view .LVU439
 1504              	.LBB164:
 1505              	.LBI164:
 159:src/stm32/serial.c **** {
ARM GAS  /tmp/ccWwtxPM.s 			page 46


 1506              		.loc 1 159 1 view .LVU440
 1507              	.LBB165:
 161:src/stm32/serial.c ****         return -1;  /* Buffer empty */
 1508              		.loc 1 161 5 view .LVU441
 165:src/stm32/serial.c ****     rb->tail = (rb->tail + 1) % SERIAL_RX_BUFFER_SIZE;
 1509              		.loc 1 165 5 view .LVU442
 161:src/stm32/serial.c ****         return -1;  /* Buffer empty */
 1510              		.loc 1 161 11 is_stmt 0 view .LVU443
 1511 001c D3F80821 		ldr	r2, [r3, #264]
 161:src/stm32/serial.c ****         return -1;  /* Buffer empty */
 1512              		.loc 1 161 8 view .LVU444
 1513 0020 BAB1     		cbz	r2, .L148
 165:src/stm32/serial.c ****     rb->tail = (rb->tail + 1) % SERIAL_RX_BUFFER_SIZE;
 1514              		.loc 1 165 26 view .LVU445
 1515 0022 D3F80421 		ldr	r2, [r3, #260]
 165:src/stm32/serial.c ****     rb->tail = (rb->tail + 1) % SERIAL_RX_BUFFER_SIZE;
 1516              		.loc 1 165 23 view .LVU446
 1517 0026 9C5C     		ldrb	r4, [r3, r2]	@ zero_extendqisi2
 1518              	.LVL111:
 166:src/stm32/serial.c ****     rb->count--;
 1519              		.loc 1 166 5 is_stmt 1 view .LVU447
 166:src/stm32/serial.c ****     rb->count--;
 1520              		.loc 1 166 19 is_stmt 0 view .LVU448
 1521 0028 D3F80421 		ldr	r2, [r3, #260]
 166:src/stm32/serial.c ****     rb->count--;
 1522              		.loc 1 166 26 view .LVU449
 1523 002c 0132     		adds	r2, r2, #1
 166:src/stm32/serial.c ****     rb->count--;
 1524              		.loc 1 166 31 view .LVU450
 1525 002e D2B2     		uxtb	r2, r2
 166:src/stm32/serial.c ****     rb->count--;
 1526              		.loc 1 166 14 view .LVU451
 1527 0030 C3F80421 		str	r2, [r3, #260]
 167:src/stm32/serial.c ****     
 1528              		.loc 1 167 5 is_stmt 1 view .LVU452
 167:src/stm32/serial.c ****     
 1529              		.loc 1 167 7 is_stmt 0 view .LVU453
 1530 0034 D3F80821 		ldr	r2, [r3, #264]
 1531              	.LBE165:
 1532              	.LBE164:
 544:src/stm32/serial.c ****         } else {
 1533              		.loc 1 544 28 view .LVU454
 1534 0038 0CF1010C 		add	ip, ip, #1
 1535              	.LVL112:
 1536              	.LBB169:
 1537              	.LBB166:
 167:src/stm32/serial.c ****     
 1538              		.loc 1 167 14 view .LVU455
 1539 003c 013A     		subs	r2, r2, #1
 1540              	.LBE166:
 1541              	.LBE169:
 1542              	.LBE163:
 541:src/stm32/serial.c ****         uint8_t byte;
 1543              		.loc 1 541 11 view .LVU456
 1544 003e 6145     		cmp	r1, ip
 1545              	.LBB172:
 1546              	.LBB170:
ARM GAS  /tmp/ccWwtxPM.s 			page 47


 1547              	.LBB167:
 167:src/stm32/serial.c ****     
 1548              		.loc 1 167 14 view .LVU457
 1549 0040 C3F80821 		str	r2, [r3, #264]
 169:src/stm32/serial.c **** }
 1550              		.loc 1 169 5 is_stmt 1 view .LVU458
 1551              	.LVL113:
 169:src/stm32/serial.c **** }
 1552              		.loc 1 169 5 is_stmt 0 view .LVU459
 1553              	.LBE167:
 1554              	.LBE170:
 544:src/stm32/serial.c ****         } else {
 1555              		.loc 1 544 13 is_stmt 1 view .LVU460
 544:src/stm32/serial.c ****         } else {
 1556              		.loc 1 544 32 is_stmt 0 view .LVU461
 1557 0044 0EF8014F 		strb	r4, [lr, #1]!
 1558              	.LVL114:
 544:src/stm32/serial.c ****         } else {
 1559              		.loc 1 544 32 view .LVU462
 1560              	.LBE172:
 541:src/stm32/serial.c ****         uint8_t byte;
 1561              		.loc 1 541 11 is_stmt 1 view .LVU463
 1562 0048 E8D1     		bne	.L144
 550:src/stm32/serial.c ****     
 1563              		.loc 1 550 5 view .LVU464
 1564              	.LVL115:
 1565              	.LBB173:
 1566              	.LBI173:
  31:./board/irq.h **** }
  32:./board/irq.h **** 
  33:./board/irq.h **** /**
  34:./board/irq.h ****  * @brief   Enable all interrupts
  35:./board/irq.h ****  */
  36:./board/irq.h **** static inline void irq_enable(void)
  37:./board/irq.h **** {
  38:./board/irq.h ****     __asm__ __volatile__("cpsie i" ::: "memory");
  39:./board/irq.h **** }
  40:./board/irq.h **** 
  41:./board/irq.h **** /**
  42:./board/irq.h ****  * @brief   Restore interrupt state
  43:./board/irq.h ****  * @param   flag    Previous interrupt state from irq_disable()
  44:./board/irq.h ****  */
  45:./board/irq.h **** static inline void irq_restore(uint32_t flag)
 1567              		.loc 2 45 20 view .LVU465
 1568              	.LBB174:
  46:./board/irq.h **** {
  47:./board/irq.h ****     __asm__ __volatile__(
 1569              		.loc 2 47 5 view .LVU466
 1570              		.syntax unified
 1571              	@ 47 "./board/irq.h" 1
 1572 004a 85F31088 		msr primask, r5
 1573              	
 1574              	@ 0 "" 2
 1575              	.LVL116:
 1576              		.loc 2 47 5 is_stmt 0 view .LVU467
 1577              		.thumb
 1578              		.syntax unified
ARM GAS  /tmp/ccWwtxPM.s 			page 48


 1579              	.LBE174:
 1580              	.LBE173:
 552:src/stm32/serial.c **** }
 1581              		.loc 1 552 5 is_stmt 1 view .LVU468
 552:src/stm32/serial.c **** }
 1582              		.loc 1 552 12 is_stmt 0 view .LVU469
 1583 004e 0846     		mov	r0, r1
 1584              	.LVL117:
 553:src/stm32/serial.c **** 
 1585              		.loc 1 553 1 view .LVU470
 1586 0050 30BD     		pop	{r4, r5, pc}
 1587              	.LVL118:
 1588              	.L148:
 1589              	.LBB176:
 1590              	.LBB171:
 1591              	.LBB168:
 553:src/stm32/serial.c **** 
 1592              		.loc 1 553 1 view .LVU471
 1593 0052 6146     		mov	r1, ip
 1594              	.LVL119:
 553:src/stm32/serial.c **** 
 1595              		.loc 1 553 1 view .LVU472
 1596              	.LBE168:
 1597              	.LBE171:
 1598              	.LBE176:
 550:src/stm32/serial.c ****     
 1599              		.loc 1 550 5 is_stmt 1 view .LVU473
 1600              	.LBB177:
  45:./board/irq.h **** {
 1601              		.loc 2 45 20 view .LVU474
 1602              	.LBB175:
 1603              		.loc 2 47 5 view .LVU475
 1604              		.syntax unified
 1605              	@ 47 "./board/irq.h" 1
 1606 0054 85F31088 		msr primask, r5
 1607              	
 1608              	@ 0 "" 2
 1609              	.LVL120:
 1610              		.loc 2 47 5 is_stmt 0 view .LVU476
 1611              		.thumb
 1612              		.syntax unified
 1613              	.LBE175:
 1614              	.LBE177:
 552:src/stm32/serial.c **** }
 1615              		.loc 1 552 5 is_stmt 1 view .LVU477
 552:src/stm32/serial.c **** }
 1616              		.loc 1 552 12 is_stmt 0 view .LVU478
 1617 0058 0846     		mov	r0, r1
 1618              	.LVL121:
 553:src/stm32/serial.c **** 
 1619              		.loc 1 553 1 view .LVU479
 1620 005a 30BD     		pop	{r4, r5, pc}
 1621              	.LVL122:
 1622              	.L146:
 1623              		.cfi_def_cfa_offset 0
 1624              		.cfi_restore 4
 1625              		.cfi_restore 5
ARM GAS  /tmp/ccWwtxPM.s 			page 49


 1626              		.cfi_restore 14
 531:src/stm32/serial.c ****     }
 1627              		.loc 1 531 16 view .LVU480
 1628 005c 4FF0FF30 		mov	r0, #-1
 1629              	.LVL123:
 531:src/stm32/serial.c ****     }
 1630              		.loc 1 531 16 view .LVU481
 1631 0060 7047     		bx	lr
 1632              	.LVL124:
 1633              	.L147:
 535:src/stm32/serial.c ****     }
 1634              		.loc 1 535 16 view .LVU482
 1635 0062 6FF00100 		mvn	r0, #1
 1636              	.LVL125:
 553:src/stm32/serial.c **** 
 1637              		.loc 1 553 1 view .LVU483
 1638 0066 7047     		bx	lr
 1639              	.L155:
 1640              		.align	2
 1641              	.L154:
 1642 0068 00000000 		.word	.LANCHOR10
 1643 006c 00000000 		.word	.LANCHOR1
 1644              		.cfi_endproc
 1645              	.LFE25:
 1647              		.section	.text.serial_getc,"ax",%progbits
 1648              		.align	1
 1649              		.p2align 2,,3
 1650              		.global	serial_getc
 1651              		.syntax unified
 1652              		.thumb
 1653              		.thumb_func
 1654              		.fpu fpv4-sp-d16
 1656              	serial_getc:
 1657              	.LVL126:
 1658              	.LFB26:
 560:src/stm32/serial.c ****     if (byte == NULL) {
 1659              		.loc 1 560 1 is_stmt 1 view -0
 1660              		.cfi_startproc
 1661              		@ args = 0, pretend = 0, frame = 0
 1662              		@ frame_needed = 0, uses_anonymous_args = 0
 561:src/stm32/serial.c ****         return -1;
 1663              		.loc 1 561 5 view .LVU485
 561:src/stm32/serial.c ****         return -1;
 1664              		.loc 1 561 8 is_stmt 0 view .LVU486
 1665 0000 00B3     		cbz	r0, .L160
 565:src/stm32/serial.c **** }
 1666              		.loc 1 565 5 is_stmt 1 view .LVU487
 1667              	.LVL127:
 1668              	.LBB187:
 1669              	.LBI187:
 528:src/stm32/serial.c **** {
 1670              		.loc 1 528 1 view .LVU488
 1671              	.LBB188:
 530:src/stm32/serial.c ****         return -1;
 1672              		.loc 1 530 5 view .LVU489
 534:src/stm32/serial.c ****         return -2;
 1673              		.loc 1 534 5 view .LVU490
ARM GAS  /tmp/ccWwtxPM.s 			page 50


 534:src/stm32/serial.c ****         return -2;
 1674              		.loc 1 534 9 is_stmt 0 view .LVU491
 1675 0002 144B     		ldr	r3, .L166
 534:src/stm32/serial.c ****         return -2;
 1676              		.loc 1 534 8 view .LVU492
 1677 0004 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1678 0006 EBB1     		cbz	r3, .L160
 538:src/stm32/serial.c ****     uint32_t irqflag = irq_disable();
 1679              		.loc 1 538 5 is_stmt 1 view .LVU493
 1680              	.LVL128:
 539:src/stm32/serial.c ****     
 1681              		.loc 1 539 5 view .LVU494
 1682              	.LBB189:
 1683              	.LBI189:
  20:./board/irq.h **** {
 1684              		.loc 2 20 24 view .LVU495
 1685              	.LBB190:
  22:./board/irq.h ****     __asm__ __volatile__(
 1686              		.loc 2 22 5 view .LVU496
  23:./board/irq.h ****         "mrs %0, primask\n"
 1687              		.loc 2 23 5 view .LVU497
 1688              	.LBE190:
 1689              	.LBE189:
 1690              	.LBE188:
 1691              	.LBE187:
 560:src/stm32/serial.c ****     if (byte == NULL) {
 1692              		.loc 1 560 1 is_stmt 0 view .LVU498
 1693 0008 00B5     		push	{lr}
 1694              		.cfi_def_cfa_offset 4
 1695              		.cfi_offset 14, -4
 1696              	.LBB204:
 1697              	.LBB202:
 1698              	.LBB192:
 1699              	.LBB191:
  23:./board/irq.h ****         "mrs %0, primask\n"
 1700              		.loc 2 23 5 view .LVU499
 1701              		.syntax unified
 1702              	@ 23 "./board/irq.h" 1
 1703 000a EFF3108E 		mrs lr, primask
 1704 000e 72B6     	cpsid i
 1705              	
 1706              	@ 0 "" 2
 1707              	.LVL129:
  30:./board/irq.h **** }
 1708              		.loc 2 30 5 is_stmt 1 view .LVU500
  30:./board/irq.h **** }
 1709              		.loc 2 30 5 is_stmt 0 view .LVU501
 1710              		.thumb
 1711              		.syntax unified
 1712              	.LBE191:
 1713              	.LBE192:
 541:src/stm32/serial.c ****         uint8_t byte;
 1714              		.loc 1 541 5 is_stmt 1 view .LVU502
 541:src/stm32/serial.c ****         uint8_t byte;
 1715              		.loc 1 541 11 view .LVU503
 1716              	.LBB193:
 542:src/stm32/serial.c ****         if (ring_buffer_get(&s_rx_buffer, &byte) == 0) {
ARM GAS  /tmp/ccWwtxPM.s 			page 51


 1717              		.loc 1 542 9 view .LVU504
 543:src/stm32/serial.c ****             data[read_count++] = byte;
 1718              		.loc 1 543 9 view .LVU505
 1719              	.LBB194:
 1720              	.LBI194:
 159:src/stm32/serial.c **** {
 1721              		.loc 1 159 1 view .LVU506
 1722              	.LBB195:
 161:src/stm32/serial.c ****         return -1;  /* Buffer empty */
 1723              		.loc 1 161 5 view .LVU507
 161:src/stm32/serial.c ****         return -1;  /* Buffer empty */
 1724              		.loc 1 161 11 is_stmt 0 view .LVU508
 1725 0010 114B     		ldr	r3, .L166+4
 1726 0012 D3F80821 		ldr	r2, [r3, #264]
 161:src/stm32/serial.c ****         return -1;  /* Buffer empty */
 1727              		.loc 1 161 8 view .LVU509
 1728 0016 CAB1     		cbz	r2, .L161
 165:src/stm32/serial.c ****     rb->tail = (rb->tail + 1) % SERIAL_RX_BUFFER_SIZE;
 1729              		.loc 1 165 5 is_stmt 1 view .LVU510
 165:src/stm32/serial.c ****     rb->tail = (rb->tail + 1) % SERIAL_RX_BUFFER_SIZE;
 1730              		.loc 1 165 26 is_stmt 0 view .LVU511
 1731 0018 D3F80421 		ldr	r2, [r3, #260]
 165:src/stm32/serial.c ****     rb->tail = (rb->tail + 1) % SERIAL_RX_BUFFER_SIZE;
 1732              		.loc 1 165 23 view .LVU512
 1733 001c 995C     		ldrb	r1, [r3, r2]	@ zero_extendqisi2
 1734              	.LVL130:
 166:src/stm32/serial.c ****     rb->count--;
 1735              		.loc 1 166 5 is_stmt 1 view .LVU513
 166:src/stm32/serial.c ****     rb->count--;
 1736              		.loc 1 166 19 is_stmt 0 view .LVU514
 1737 001e D3F80421 		ldr	r2, [r3, #260]
 166:src/stm32/serial.c ****     rb->count--;
 1738              		.loc 1 166 26 view .LVU515
 1739 0022 0132     		adds	r2, r2, #1
 166:src/stm32/serial.c ****     rb->count--;
 1740              		.loc 1 166 31 view .LVU516
 1741 0024 D2B2     		uxtb	r2, r2
 166:src/stm32/serial.c ****     rb->count--;
 1742              		.loc 1 166 14 view .LVU517
 1743 0026 C3F80421 		str	r2, [r3, #260]
 167:src/stm32/serial.c ****     
 1744              		.loc 1 167 5 is_stmt 1 view .LVU518
 167:src/stm32/serial.c ****     
 1745              		.loc 1 167 7 is_stmt 0 view .LVU519
 1746 002a D3F80821 		ldr	r2, [r3, #264]
 167:src/stm32/serial.c ****     
 1747              		.loc 1 167 14 view .LVU520
 1748 002e 013A     		subs	r2, r2, #1
 1749 0030 C3F80821 		str	r2, [r3, #264]
 169:src/stm32/serial.c **** }
 1750              		.loc 1 169 5 is_stmt 1 view .LVU521
 1751              	.LVL131:
 169:src/stm32/serial.c **** }
 1752              		.loc 1 169 5 is_stmt 0 view .LVU522
 1753              	.LBE195:
 1754              	.LBE194:
 544:src/stm32/serial.c ****         } else {
ARM GAS  /tmp/ccWwtxPM.s 			page 52


 1755              		.loc 1 544 13 is_stmt 1 view .LVU523
 544:src/stm32/serial.c ****         } else {
 1756              		.loc 1 544 13 is_stmt 0 view .LVU524
 1757              	.LBE193:
 1758 0034 4FF0000C 		mov	ip, #0
 1759              	.LBB198:
 544:src/stm32/serial.c ****         } else {
 1760              		.loc 1 544 32 view .LVU525
 1761 0038 0170     		strb	r1, [r0]
 1762              	.LVL132:
 544:src/stm32/serial.c ****         } else {
 1763              		.loc 1 544 32 view .LVU526
 1764              	.LBE198:
 541:src/stm32/serial.c ****         uint8_t byte;
 1765              		.loc 1 541 11 is_stmt 1 view .LVU527
 1766              	.L158:
 550:src/stm32/serial.c ****     
 1767              		.loc 1 550 5 view .LVU528
 1768              	.LBB199:
 1769              	.LBI199:
  45:./board/irq.h **** {
 1770              		.loc 2 45 20 view .LVU529
 1771              	.LBB200:
 1772              		.loc 2 47 5 view .LVU530
 1773              		.syntax unified
 1774              	@ 47 "./board/irq.h" 1
 1775 003a 8EF31088 		msr primask, lr
 1776              	
 1777              	@ 0 "" 2
 1778              	.LVL133:
 1779              		.loc 2 47 5 is_stmt 0 view .LVU531
 1780              		.thumb
 1781              		.syntax unified
 1782              	.LBE200:
 1783              	.LBE199:
 552:src/stm32/serial.c **** }
 1784              		.loc 1 552 5 is_stmt 1 view .LVU532
 552:src/stm32/serial.c **** }
 1785              		.loc 1 552 5 is_stmt 0 view .LVU533
 1786              	.LBE202:
 1787              	.LBE204:
 566:src/stm32/serial.c **** 
 1788              		.loc 1 566 1 view .LVU534
 1789 003e 6046     		mov	r0, ip
 1790              	.LVL134:
 566:src/stm32/serial.c **** 
 1791              		.loc 1 566 1 view .LVU535
 1792 0040 5DF804FB 		ldr	pc, [sp], #4
 1793              	.LVL135:
 1794              	.L160:
 1795              		.cfi_def_cfa_offset 0
 1796              		.cfi_restore 14
 562:src/stm32/serial.c ****     }
 1797              		.loc 1 562 16 view .LVU536
 1798 0044 4FF0FF3C 		mov	ip, #-1
 566:src/stm32/serial.c **** 
 1799              		.loc 1 566 1 view .LVU537
ARM GAS  /tmp/ccWwtxPM.s 			page 53


 1800 0048 6046     		mov	r0, ip
 1801              	.LVL136:
 566:src/stm32/serial.c **** 
 1802              		.loc 1 566 1 view .LVU538
 1803 004a 7047     		bx	lr
 1804              	.LVL137:
 1805              	.L161:
 1806              		.cfi_def_cfa_offset 4
 1807              		.cfi_offset 14, -4
 1808              	.LBB205:
 1809              	.LBB203:
 1810              	.LBB201:
 1811              	.LBB197:
 1812              	.LBB196:
 566:src/stm32/serial.c **** 
 1813              		.loc 1 566 1 view .LVU539
 1814 004c 4FF0FF3C 		mov	ip, #-1
 1815 0050 F3E7     		b	.L158
 1816              	.L167:
 1817 0052 00BF     		.align	2
 1818              	.L166:
 1819 0054 00000000 		.word	.LANCHOR10
 1820 0058 00000000 		.word	.LANCHOR1
 1821              	.LBE196:
 1822              	.LBE197:
 1823              	.LBE201:
 1824              	.LBE203:
 1825              	.LBE205:
 1826              		.cfi_endproc
 1827              	.LFE26:
 1829              		.section	.text.serial_readline,"ax",%progbits
 1830              		.align	1
 1831              		.p2align 2,,3
 1832              		.global	serial_readline
 1833              		.syntax unified
 1834              		.thumb
 1835              		.thumb_func
 1836              		.fpu fpv4-sp-d16
 1838              	serial_readline:
 1839              	.LVL138:
 1840              	.LFB27:
 573:src/stm32/serial.c ****     if (line == NULL || maxlen == 0) {
 1841              		.loc 1 573 1 is_stmt 1 view -0
 1842              		.cfi_startproc
 1843              		@ args = 0, pretend = 0, frame = 0
 1844              		@ frame_needed = 0, uses_anonymous_args = 0
 574:src/stm32/serial.c ****         return -1;
 1845              		.loc 1 574 5 view .LVU541
 574:src/stm32/serial.c ****         return -1;
 1846              		.loc 1 574 8 is_stmt 0 view .LVU542
 1847 0000 18B3     		cbz	r0, .L173
 574:src/stm32/serial.c ****         return -1;
 1848              		.loc 1 574 22 discriminator 1 view .LVU543
 1849 0002 11B3     		cbz	r1, .L173
 578:src/stm32/serial.c ****         return -2;
 1850              		.loc 1 578 5 is_stmt 1 view .LVU544
 578:src/stm32/serial.c ****         return -2;
ARM GAS  /tmp/ccWwtxPM.s 			page 54


 1851              		.loc 1 578 9 is_stmt 0 view .LVU545
 1852 0004 144A     		ldr	r2, .L183
 578:src/stm32/serial.c ****         return -2;
 1853              		.loc 1 578 8 view .LVU546
 1854 0006 1278     		ldrb	r2, [r2]	@ zero_extendqisi2
 1855 0008 12B3     		cbz	r2, .L174
 582:src/stm32/serial.c ****         return 0;  /* No complete line available */
 1856              		.loc 1 582 5 is_stmt 1 view .LVU547
 573:src/stm32/serial.c ****     if (line == NULL || maxlen == 0) {
 1857              		.loc 1 573 1 is_stmt 0 view .LVU548
 1858 000a F8B5     		push	{r3, r4, r5, r6, r7, lr}
 1859              		.cfi_def_cfa_offset 24
 1860              		.cfi_offset 3, -24
 1861              		.cfi_offset 4, -20
 1862              		.cfi_offset 5, -16
 1863              		.cfi_offset 6, -12
 1864              		.cfi_offset 7, -8
 1865              		.cfi_offset 14, -4
 582:src/stm32/serial.c ****         return 0;  /* No complete line available */
 1866              		.loc 1 582 9 view .LVU549
 1867 000c 134D     		ldr	r5, .L183+4
 1868 000e 2A78     		ldrb	r2, [r5]	@ zero_extendqisi2
 582:src/stm32/serial.c ****         return 0;  /* No complete line available */
 1869              		.loc 1 582 8 view .LVU550
 1870 0010 02F0FF04 		and	r4, r2, #255
 1871 0014 BAB1     		cbz	r2, .L175
 1872 0016 0346     		mov	r3, r0
 586:src/stm32/serial.c ****     
 1873              		.loc 1 586 5 is_stmt 1 view .LVU551
 1874              	.LBB206:
 1875              	.LBI206:
  20:./board/irq.h **** {
 1876              		.loc 2 20 24 view .LVU552
 1877              	.LBB207:
  22:./board/irq.h ****     __asm__ __volatile__(
 1878              		.loc 2 22 5 view .LVU553
  23:./board/irq.h ****         "mrs %0, primask\n"
 1879              		.loc 2 23 5 view .LVU554
 1880              		.syntax unified
 1881              	@ 23 "./board/irq.h" 1
 1882 0018 EFF31087 		mrs r7, primask
 1883 001c 72B6     	cpsid i
 1884              	
 1885              	@ 0 "" 2
 1886              	.LVL139:
  30:./board/irq.h **** }
 1887              		.loc 2 30 5 view .LVU555
  30:./board/irq.h **** }
 1888              		.loc 2 30 5 is_stmt 0 view .LVU556
 1889              		.thumb
 1890              		.syntax unified
 1891              	.LBE207:
 1892              	.LBE206:
 589:src/stm32/serial.c ****     if (copy_len >= maxlen) {
 1893              		.loc 1 589 5 is_stmt 1 view .LVU557
 589:src/stm32/serial.c ****     if (copy_len >= maxlen) {
 1894              		.loc 1 589 12 is_stmt 0 view .LVU558
ARM GAS  /tmp/ccWwtxPM.s 			page 55


 1895 001e 104E     		ldr	r6, .L183+8
 1896 0020 3468     		ldr	r4, [r6]
 1897              	.LVL140:
 590:src/stm32/serial.c ****         copy_len = maxlen - 1;
 1898              		.loc 1 590 5 is_stmt 1 view .LVU559
 590:src/stm32/serial.c ****         copy_len = maxlen - 1;
 1899              		.loc 1 590 8 is_stmt 0 view .LVU560
 1900 0022 A142     		cmp	r1, r4
 591:src/stm32/serial.c ****     }
 1901              		.loc 1 591 9 is_stmt 1 view .LVU561
 591:src/stm32/serial.c ****     }
 1902              		.loc 1 591 18 is_stmt 0 view .LVU562
 1903 0024 98BF     		it	ls
 1904 0026 01F1FF34 		addls	r4, r1, #-1
 1905              	.LVL141:
 594:src/stm32/serial.c ****         line[i] = s_line_buffer[i];
 1906              		.loc 1 594 5 is_stmt 1 view .LVU563
 1907              	.LBB208:
 594:src/stm32/serial.c ****         line[i] = s_line_buffer[i];
 1908              		.loc 1 594 10 view .LVU564
 594:src/stm32/serial.c ****         line[i] = s_line_buffer[i];
 1909              		.loc 1 594 24 view .LVU565
 594:src/stm32/serial.c ****         line[i] = s_line_buffer[i];
 1910              		.loc 1 594 5 is_stmt 0 view .LVU566
 1911 002a 24B1     		cbz	r4, .L171
 595:src/stm32/serial.c ****     }
 1912              		.loc 1 595 17 view .LVU567
 1913 002c 0D49     		ldr	r1, .L183+12
 1914              	.LVL142:
 595:src/stm32/serial.c ****     }
 1915              		.loc 1 595 17 view .LVU568
 1916 002e 2246     		mov	r2, r4
 1917 0030 FFF7FEFF 		bl	memcpy
 1918              	.LVL143:
 595:src/stm32/serial.c ****     }
 1919              		.loc 1 595 17 view .LVU569
 1920 0034 0346     		mov	r3, r0
 1921              	.L171:
 1922              	.LVL144:
 595:src/stm32/serial.c ****     }
 1923              		.loc 1 595 17 view .LVU570
 1924              	.LBE208:
 597:src/stm32/serial.c ****     
 1925              		.loc 1 597 5 is_stmt 1 view .LVU571
 597:src/stm32/serial.c ****     
 1926              		.loc 1 597 20 is_stmt 0 view .LVU572
 1927 0036 0022     		movs	r2, #0
 600:src/stm32/serial.c ****     s_line_ready = 0;
 1928              		.loc 1 600 16 view .LVU573
 1929 0038 3260     		str	r2, [r6]
 597:src/stm32/serial.c ****     
 1930              		.loc 1 597 20 view .LVU574
 1931 003a 1A55     		strb	r2, [r3, r4]
 600:src/stm32/serial.c ****     s_line_ready = 0;
 1932              		.loc 1 600 5 is_stmt 1 view .LVU575
 601:src/stm32/serial.c ****     
 1933              		.loc 1 601 5 view .LVU576
ARM GAS  /tmp/ccWwtxPM.s 			page 56


 601:src/stm32/serial.c ****     
 1934              		.loc 1 601 18 is_stmt 0 view .LVU577
 1935 003c 2A70     		strb	r2, [r5]
 603:src/stm32/serial.c ****     
 1936              		.loc 1 603 5 is_stmt 1 view .LVU578
 1937              	.LVL145:
 1938              	.LBB209:
 1939              	.LBI209:
  45:./board/irq.h **** {
 1940              		.loc 2 45 20 view .LVU579
 1941              	.LBB210:
 1942              		.loc 2 47 5 view .LVU580
 1943              		.syntax unified
 1944              	@ 47 "./board/irq.h" 1
 1945 003e 87F31088 		msr primask, r7
 1946              	
 1947              	@ 0 "" 2
 1948              	.LVL146:
 1949              		.loc 2 47 5 is_stmt 0 view .LVU581
 1950              		.thumb
 1951              		.syntax unified
 1952              	.LBE210:
 1953              	.LBE209:
 605:src/stm32/serial.c **** }
 1954              		.loc 1 605 5 is_stmt 1 view .LVU582
 605:src/stm32/serial.c **** }
 1955              		.loc 1 605 12 is_stmt 0 view .LVU583
 1956 0042 2046     		mov	r0, r4
 606:src/stm32/serial.c **** 
 1957              		.loc 1 606 1 view .LVU584
 1958 0044 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 1959              	.LVL147:
 1960              	.L175:
 583:src/stm32/serial.c ****     }
 1961              		.loc 1 583 16 view .LVU585
 1962 0046 2046     		mov	r0, r4
 1963              	.LVL148:
 606:src/stm32/serial.c **** 
 1964              		.loc 1 606 1 view .LVU586
 1965 0048 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 1966              	.LVL149:
 1967              	.L173:
 1968              		.cfi_def_cfa_offset 0
 1969              		.cfi_restore 3
 1970              		.cfi_restore 4
 1971              		.cfi_restore 5
 1972              		.cfi_restore 6
 1973              		.cfi_restore 7
 1974              		.cfi_restore 14
 575:src/stm32/serial.c ****     }
 1975              		.loc 1 575 16 view .LVU587
 1976 004a 4FF0FF30 		mov	r0, #-1
 1977              	.LVL150:
 575:src/stm32/serial.c ****     }
 1978              		.loc 1 575 16 view .LVU588
 1979 004e 7047     		bx	lr
 1980              	.LVL151:
ARM GAS  /tmp/ccWwtxPM.s 			page 57


 1981              	.L174:
 579:src/stm32/serial.c ****     }
 1982              		.loc 1 579 16 view .LVU589
 1983 0050 6FF00100 		mvn	r0, #1
 1984              	.LVL152:
 606:src/stm32/serial.c **** 
 1985              		.loc 1 606 1 view .LVU590
 1986 0054 7047     		bx	lr
 1987              	.L184:
 1988 0056 00BF     		.align	2
 1989              	.L183:
 1990 0058 00000000 		.word	.LANCHOR10
 1991 005c 00000000 		.word	.LANCHOR2
 1992 0060 00000000 		.word	.LANCHOR3
 1993 0064 00000000 		.word	.LANCHOR4
 1994              		.cfi_endproc
 1995              	.LFE27:
 1997              		.section	.text.serial_line_available,"ax",%progbits
 1998              		.align	1
 1999              		.p2align 2,,3
 2000              		.global	serial_line_available
 2001              		.syntax unified
 2002              		.thumb
 2003              		.thumb_func
 2004              		.fpu fpv4-sp-d16
 2006              	serial_line_available:
 2007              	.LFB28:
 613:src/stm32/serial.c ****     return s_line_ready ? 1 : 0;
 2008              		.loc 1 613 1 is_stmt 1 view -0
 2009              		.cfi_startproc
 2010              		@ args = 0, pretend = 0, frame = 0
 2011              		@ frame_needed = 0, uses_anonymous_args = 0
 2012              		@ link register save eliminated.
 614:src/stm32/serial.c **** }
 2013              		.loc 1 614 5 view .LVU592
 614:src/stm32/serial.c **** }
 2014              		.loc 1 614 29 is_stmt 0 view .LVU593
 2015 0000 024B     		ldr	r3, .L186
 2016 0002 1878     		ldrb	r0, [r3]	@ zero_extendqisi2
 615:src/stm32/serial.c **** 
 2017              		.loc 1 615 1 view .LVU594
 2018 0004 0038     		subs	r0, r0, #0
 2019 0006 18BF     		it	ne
 2020 0008 0120     		movne	r0, #1
 2021 000a 7047     		bx	lr
 2022              	.L187:
 2023              		.align	2
 2024              	.L186:
 2025 000c 00000000 		.word	.LANCHOR2
 2026              		.cfi_endproc
 2027              	.LFE28:
 2029              		.section	.text.serial_rx_available,"ax",%progbits
 2030              		.align	1
 2031              		.p2align 2,,3
 2032              		.global	serial_rx_available
 2033              		.syntax unified
 2034              		.thumb
ARM GAS  /tmp/ccWwtxPM.s 			page 58


 2035              		.thumb_func
 2036              		.fpu fpv4-sp-d16
 2038              	serial_rx_available:
 2039              	.LFB29:
 622:src/stm32/serial.c ****     return s_rx_buffer.count;
 2040              		.loc 1 622 1 is_stmt 1 view -0
 2041              		.cfi_startproc
 2042              		@ args = 0, pretend = 0, frame = 0
 2043              		@ frame_needed = 0, uses_anonymous_args = 0
 2044              		@ link register save eliminated.
 623:src/stm32/serial.c **** }
 2045              		.loc 1 623 5 view .LVU596
 623:src/stm32/serial.c **** }
 2046              		.loc 1 623 23 is_stmt 0 view .LVU597
 2047 0000 014B     		ldr	r3, .L189
 2048 0002 D3F80801 		ldr	r0, [r3, #264]
 624:src/stm32/serial.c **** 
 2049              		.loc 1 624 1 view .LVU598
 2050 0006 7047     		bx	lr
 2051              	.L190:
 2052              		.align	2
 2053              	.L189:
 2054 0008 00000000 		.word	.LANCHOR1
 2055              		.cfi_endproc
 2056              	.LFE29:
 2058              		.section	.text.serial_tx_free,"ax",%progbits
 2059              		.align	1
 2060              		.p2align 2,,3
 2061              		.global	serial_tx_free
 2062              		.syntax unified
 2063              		.thumb
 2064              		.thumb_func
 2065              		.fpu fpv4-sp-d16
 2067              	serial_tx_free:
 2068              	.LFB30:
 631:src/stm32/serial.c ****     return SERIAL_TX_BUFFER_SIZE - s_tx_buffer.count;
 2069              		.loc 1 631 1 is_stmt 1 view -0
 2070              		.cfi_startproc
 2071              		@ args = 0, pretend = 0, frame = 0
 2072              		@ frame_needed = 0, uses_anonymous_args = 0
 2073              		@ link register save eliminated.
 632:src/stm32/serial.c **** }
 2074              		.loc 1 632 5 view .LVU600
 632:src/stm32/serial.c **** }
 2075              		.loc 1 632 47 is_stmt 0 view .LVU601
 2076 0000 024B     		ldr	r3, .L192
 2077 0002 D3F80801 		ldr	r0, [r3, #264]
 633:src/stm32/serial.c **** 
 2078              		.loc 1 633 1 view .LVU602
 2079 0006 C0F58070 		rsb	r0, r0, #256
 2080 000a 7047     		bx	lr
 2081              	.L193:
 2082              		.align	2
 2083              	.L192:
 2084 000c 00000000 		.word	.LANCHOR5
 2085              		.cfi_endproc
 2086              	.LFE30:
ARM GAS  /tmp/ccWwtxPM.s 			page 59


 2088              		.section	.text.serial_flush,"ax",%progbits
 2089              		.align	1
 2090              		.p2align 2,,3
 2091              		.global	serial_flush
 2092              		.syntax unified
 2093              		.thumb
 2094              		.thumb_func
 2095              		.fpu fpv4-sp-d16
 2097              	serial_flush:
 2098              	.LFB31:
 640:src/stm32/serial.c ****     if (!s_initialized) {
 2099              		.loc 1 640 1 is_stmt 1 view -0
 2100              		.cfi_startproc
 2101              		@ args = 0, pretend = 0, frame = 0
 2102              		@ frame_needed = 0, uses_anonymous_args = 0
 2103              		@ link register save eliminated.
 641:src/stm32/serial.c ****         return;
 2104              		.loc 1 641 5 view .LVU604
 641:src/stm32/serial.c ****         return;
 2105              		.loc 1 641 9 is_stmt 0 view .LVU605
 2106 0000 064B     		ldr	r3, .L205
 641:src/stm32/serial.c ****         return;
 2107              		.loc 1 641 8 view .LVU606
 2108 0002 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 2109 0004 43B1     		cbz	r3, .L194
 647:src/stm32/serial.c ****         if (--timeout == 0) {
 2110              		.loc 1 647 21 view .LVU607
 2111 0006 064A     		ldr	r2, .L205+4
 2112 0008 064B     		ldr	r3, .L205+8
 2113 000a 1168     		ldr	r1, [r2]
 2114 000c 01E0     		b	.L196
 2115              	.LVL153:
 2116              	.L197:
 648:src/stm32/serial.c ****             break;
 2117              		.loc 1 648 12 view .LVU608
 2118 000e 013B     		subs	r3, r3, #1
 2119              	.LVL154:
 648:src/stm32/serial.c ****             break;
 2120              		.loc 1 648 12 view .LVU609
 2121 0010 02D0     		beq	.L194
 2122              	.LVL155:
 2123              	.L196:
 648:src/stm32/serial.c ****             break;
 2124              		.loc 1 648 9 is_stmt 1 view .LVU610
 647:src/stm32/serial.c ****         if (--timeout == 0) {
 2125              		.loc 1 647 11 view .LVU611
 647:src/stm32/serial.c ****         if (--timeout == 0) {
 2126              		.loc 1 647 21 is_stmt 0 view .LVU612
 2127 0012 0A68     		ldr	r2, [r1]
 647:src/stm32/serial.c ****         if (--timeout == 0) {
 2128              		.loc 1 647 11 view .LVU613
 2129 0014 5206     		lsls	r2, r2, #25
 2130 0016 FAD5     		bpl	.L197
 2131              	.LVL156:
 2132              	.L194:
 652:src/stm32/serial.c **** 
 2133              		.loc 1 652 1 view .LVU614
ARM GAS  /tmp/ccWwtxPM.s 			page 60


 2134 0018 7047     		bx	lr
 2135              	.L206:
 2136 001a 00BF     		.align	2
 2137              	.L205:
 2138 001c 00000000 		.word	.LANCHOR10
 2139 0020 00000000 		.word	.LANCHOR0
 2140 0024 40420F00 		.word	1000000
 2141              		.cfi_endproc
 2142              	.LFE31:
 2144              		.section	.text.serial_rx_clear,"ax",%progbits
 2145              		.align	1
 2146              		.p2align 2,,3
 2147              		.global	serial_rx_clear
 2148              		.syntax unified
 2149              		.thumb
 2150              		.thumb_func
 2151              		.fpu fpv4-sp-d16
 2153              	serial_rx_clear:
 2154              	.LFB32:
 659:src/stm32/serial.c ****     uint32_t irqflag = irq_disable();
 2155              		.loc 1 659 1 is_stmt 1 view -0
 2156              		.cfi_startproc
 2157              		@ args = 0, pretend = 0, frame = 0
 2158              		@ frame_needed = 0, uses_anonymous_args = 0
 2159              		@ link register save eliminated.
 660:src/stm32/serial.c ****     ring_buffer_init(&s_rx_buffer);
 2160              		.loc 1 660 5 view .LVU616
 2161              	.LBB211:
 2162              	.LBI211:
  20:./board/irq.h **** {
 2163              		.loc 2 20 24 view .LVU617
 2164              	.LBB212:
  22:./board/irq.h ****     __asm__ __volatile__(
 2165              		.loc 2 22 5 view .LVU618
  23:./board/irq.h ****         "mrs %0, primask\n"
 2166              		.loc 2 23 5 view .LVU619
 2167              	.LBE212:
 2168              	.LBE211:
 659:src/stm32/serial.c ****     uint32_t irqflag = irq_disable();
 2169              		.loc 1 659 1 is_stmt 0 view .LVU620
 2170 0000 10B4     		push	{r4}
 2171              		.cfi_def_cfa_offset 4
 2172              		.cfi_offset 4, -4
 2173              	.LBB214:
 2174              	.LBB213:
  23:./board/irq.h ****         "mrs %0, primask\n"
 2175              		.loc 2 23 5 view .LVU621
 2176              		.syntax unified
 2177              	@ 23 "./board/irq.h" 1
 2178 0002 EFF31081 		mrs r1, primask
 2179 0006 72B6     	cpsid i
 2180              	
 2181              	@ 0 "" 2
 2182              	.LVL157:
  30:./board/irq.h **** }
 2183              		.loc 2 30 5 is_stmt 1 view .LVU622
  30:./board/irq.h **** }
ARM GAS  /tmp/ccWwtxPM.s 			page 61


 2184              		.loc 2 30 5 is_stmt 0 view .LVU623
 2185              		.thumb
 2186              		.syntax unified
 2187              	.LBE213:
 2188              	.LBE214:
 661:src/stm32/serial.c ****     s_line_len = 0;
 2189              		.loc 1 661 5 is_stmt 1 view .LVU624
 2190              	.LBB215:
 2191              	.LBI215:
 129:src/stm32/serial.c **** {
 2192              		.loc 1 129 1 view .LVU625
 2193              	.LBB216:
 131:src/stm32/serial.c ****     rb->tail = 0;
 2194              		.loc 1 131 5 view .LVU626
 131:src/stm32/serial.c ****     rb->tail = 0;
 2195              		.loc 1 131 14 is_stmt 0 view .LVU627
 2196 0008 084A     		ldr	r2, .L209
 2197              	.LBE216:
 2198              	.LBE215:
 662:src/stm32/serial.c ****     s_line_ready = 0;
 2199              		.loc 1 662 16 view .LVU628
 2200 000a 094C     		ldr	r4, .L209+4
 663:src/stm32/serial.c ****     irq_restore(irqflag);
 2201              		.loc 1 663 18 view .LVU629
 2202 000c 0948     		ldr	r0, .L209+8
 2203              	.LBB218:
 2204              	.LBB217:
 131:src/stm32/serial.c ****     rb->tail = 0;
 2205              		.loc 1 131 14 view .LVU630
 2206 000e 0023     		movs	r3, #0
 2207 0010 C2F80031 		str	r3, [r2, #256]
 132:src/stm32/serial.c ****     rb->count = 0;
 2208              		.loc 1 132 5 is_stmt 1 view .LVU631
 132:src/stm32/serial.c ****     rb->count = 0;
 2209              		.loc 1 132 14 is_stmt 0 view .LVU632
 2210 0014 C2F80431 		str	r3, [r2, #260]
 133:src/stm32/serial.c **** }
 2211              		.loc 1 133 5 is_stmt 1 view .LVU633
 133:src/stm32/serial.c **** }
 2212              		.loc 1 133 15 is_stmt 0 view .LVU634
 2213 0018 C2F80831 		str	r3, [r2, #264]
 2214              	.LVL158:
 133:src/stm32/serial.c **** }
 2215              		.loc 1 133 15 view .LVU635
 2216              	.LBE217:
 2217              	.LBE218:
 662:src/stm32/serial.c ****     s_line_ready = 0;
 2218              		.loc 1 662 5 is_stmt 1 view .LVU636
 662:src/stm32/serial.c ****     s_line_ready = 0;
 2219              		.loc 1 662 16 is_stmt 0 view .LVU637
 2220 001c 2360     		str	r3, [r4]
 663:src/stm32/serial.c ****     irq_restore(irqflag);
 2221              		.loc 1 663 5 is_stmt 1 view .LVU638
 663:src/stm32/serial.c ****     irq_restore(irqflag);
 2222              		.loc 1 663 18 is_stmt 0 view .LVU639
 2223 001e 0370     		strb	r3, [r0]
 664:src/stm32/serial.c **** }
ARM GAS  /tmp/ccWwtxPM.s 			page 62


 2224              		.loc 1 664 5 is_stmt 1 view .LVU640
 2225              	.LVL159:
 2226              	.LBB219:
 2227              	.LBI219:
  45:./board/irq.h **** {
 2228              		.loc 2 45 20 view .LVU641
 2229              	.LBB220:
 2230              		.loc 2 47 5 view .LVU642
 2231              		.syntax unified
 2232              	@ 47 "./board/irq.h" 1
 2233 0020 81F31088 		msr primask, r1
 2234              	
 2235              	@ 0 "" 2
 2236              	.LVL160:
 2237              		.loc 2 47 5 is_stmt 0 view .LVU643
 2238              		.thumb
 2239              		.syntax unified
 2240              	.LBE220:
 2241              	.LBE219:
 665:src/stm32/serial.c **** 
 2242              		.loc 1 665 1 view .LVU644
 2243 0024 5DF8044B 		ldr	r4, [sp], #4
 2244              		.cfi_restore 4
 2245              		.cfi_def_cfa_offset 0
 2246 0028 7047     		bx	lr
 2247              	.L210:
 2248 002a 00BF     		.align	2
 2249              	.L209:
 2250 002c 00000000 		.word	.LANCHOR1
 2251 0030 00000000 		.word	.LANCHOR3
 2252 0034 00000000 		.word	.LANCHOR2
 2253              		.cfi_endproc
 2254              	.LFE32:
 2256              		.section	.text.serial_rx_enable,"ax",%progbits
 2257              		.align	1
 2258              		.p2align 2,,3
 2259              		.global	serial_rx_enable
 2260              		.syntax unified
 2261              		.thumb
 2262              		.thumb_func
 2263              		.fpu fpv4-sp-d16
 2265              	serial_rx_enable:
 2266              	.LFB33:
 672:src/stm32/serial.c ****     if (s_initialized) {
 2267              		.loc 1 672 1 is_stmt 1 view -0
 2268              		.cfi_startproc
 2269              		@ args = 0, pretend = 0, frame = 0
 2270              		@ frame_needed = 0, uses_anonymous_args = 0
 2271              		@ link register save eliminated.
 673:src/stm32/serial.c ****         s_usart->CR1 |= USART_CR1_RXNEIE;
 2272              		.loc 1 673 5 view .LVU646
 673:src/stm32/serial.c ****         s_usart->CR1 |= USART_CR1_RXNEIE;
 2273              		.loc 1 673 9 is_stmt 0 view .LVU647
 2274 0000 044B     		ldr	r3, .L216
 673:src/stm32/serial.c ****         s_usart->CR1 |= USART_CR1_RXNEIE;
 2275              		.loc 1 673 8 view .LVU648
 2276 0002 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
ARM GAS  /tmp/ccWwtxPM.s 			page 63


 2277 0004 2BB1     		cbz	r3, .L211
 674:src/stm32/serial.c ****     }
 2278              		.loc 1 674 9 is_stmt 1 view .LVU649
 674:src/stm32/serial.c ****     }
 2279              		.loc 1 674 22 is_stmt 0 view .LVU650
 2280 0006 044B     		ldr	r3, .L216+4
 2281 0008 1A68     		ldr	r2, [r3]
 2282 000a D368     		ldr	r3, [r2, #12]
 2283 000c 43F02003 		orr	r3, r3, #32
 2284 0010 D360     		str	r3, [r2, #12]
 2285              	.L211:
 676:src/stm32/serial.c **** 
 2286              		.loc 1 676 1 view .LVU651
 2287 0012 7047     		bx	lr
 2288              	.L217:
 2289              		.align	2
 2290              	.L216:
 2291 0014 00000000 		.word	.LANCHOR10
 2292 0018 00000000 		.word	.LANCHOR0
 2293              		.cfi_endproc
 2294              	.LFE33:
 2296              		.section	.text.serial_rx_disable,"ax",%progbits
 2297              		.align	1
 2298              		.p2align 2,,3
 2299              		.global	serial_rx_disable
 2300              		.syntax unified
 2301              		.thumb
 2302              		.thumb_func
 2303              		.fpu fpv4-sp-d16
 2305              	serial_rx_disable:
 2306              	.LFB34:
 683:src/stm32/serial.c ****     if (s_initialized) {
 2307              		.loc 1 683 1 is_stmt 1 view -0
 2308              		.cfi_startproc
 2309              		@ args = 0, pretend = 0, frame = 0
 2310              		@ frame_needed = 0, uses_anonymous_args = 0
 2311              		@ link register save eliminated.
 684:src/stm32/serial.c ****         s_usart->CR1 &= ~USART_CR1_RXNEIE;
 2312              		.loc 1 684 5 view .LVU653
 684:src/stm32/serial.c ****         s_usart->CR1 &= ~USART_CR1_RXNEIE;
 2313              		.loc 1 684 9 is_stmt 0 view .LVU654
 2314 0000 044B     		ldr	r3, .L223
 684:src/stm32/serial.c ****         s_usart->CR1 &= ~USART_CR1_RXNEIE;
 2315              		.loc 1 684 8 view .LVU655
 2316 0002 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 2317 0004 2BB1     		cbz	r3, .L218
 685:src/stm32/serial.c ****     }
 2318              		.loc 1 685 9 is_stmt 1 view .LVU656
 685:src/stm32/serial.c ****     }
 2319              		.loc 1 685 22 is_stmt 0 view .LVU657
 2320 0006 044B     		ldr	r3, .L223+4
 2321 0008 1A68     		ldr	r2, [r3]
 2322 000a D368     		ldr	r3, [r2, #12]
 2323 000c 23F02003 		bic	r3, r3, #32
 2324 0010 D360     		str	r3, [r2, #12]
 2325              	.L218:
 687:src/stm32/serial.c **** 
ARM GAS  /tmp/ccWwtxPM.s 			page 64


 2326              		.loc 1 687 1 view .LVU658
 2327 0012 7047     		bx	lr
 2328              	.L224:
 2329              		.align	2
 2330              	.L223:
 2331 0014 00000000 		.word	.LANCHOR10
 2332 0018 00000000 		.word	.LANCHOR0
 2333              		.cfi_endproc
 2334              	.LFE34:
 2336              		.section	.text.serial_printf,"ax",%progbits
 2337              		.align	1
 2338              		.p2align 2,,3
 2339              		.global	serial_printf
 2340              		.syntax unified
 2341              		.thumb
 2342              		.thumb_func
 2343              		.fpu fpv4-sp-d16
 2345              	serial_printf:
 2346              	.LVL161:
 2347              	.LFB37:
 730:src/stm32/serial.c **** 
 731:src/stm32/serial.c **** /**
 732:src/stm32/serial.c ****  * @brief   Print signed integer
 733:src/stm32/serial.c ****  */
 734:src/stm32/serial.c **** static int
 735:src/stm32/serial.c **** print_int(int32_t val, int width, char pad)
 736:src/stm32/serial.c **** {
 737:src/stm32/serial.c ****     int count = 0;
 738:src/stm32/serial.c ****     
 739:src/stm32/serial.c ****     if (val < 0) {
 740:src/stm32/serial.c ****         serial_putc('-');
 741:src/stm32/serial.c ****         count++;
 742:src/stm32/serial.c ****         val = -val;
 743:src/stm32/serial.c ****         if (width > 0) {
 744:src/stm32/serial.c ****             width--;
 745:src/stm32/serial.c ****         }
 746:src/stm32/serial.c ****     }
 747:src/stm32/serial.c ****     
 748:src/stm32/serial.c ****     count += print_uint((uint32_t)val, 10, width, pad);
 749:src/stm32/serial.c ****     
 750:src/stm32/serial.c ****     return count;
 751:src/stm32/serial.c **** }
 752:src/stm32/serial.c **** 
 753:src/stm32/serial.c **** /**
 754:src/stm32/serial.c ****  * @brief   Print formatted debug message
 755:src/stm32/serial.c ****  */
 756:src/stm32/serial.c **** int
 757:src/stm32/serial.c **** serial_printf(const char *fmt, ...)
 758:src/stm32/serial.c **** {
 2348              		.loc 1 758 1 is_stmt 1 view -0
 2349              		.cfi_startproc
 2350              		@ args = 4, pretend = 16, frame = 16
 2351              		@ frame_needed = 0, uses_anonymous_args = 1
 759:src/stm32/serial.c ****     if (fmt == NULL) {
 2352              		.loc 1 759 5 view .LVU660
 758:src/stm32/serial.c ****     if (fmt == NULL) {
 2353              		.loc 1 758 1 is_stmt 0 view .LVU661
ARM GAS  /tmp/ccWwtxPM.s 			page 65


 2354 0000 0FB4     		push	{r0, r1, r2, r3}
 2355              		.cfi_def_cfa_offset 16
 2356              		.cfi_offset 0, -16
 2357              		.cfi_offset 1, -12
 2358              		.cfi_offset 2, -8
 2359              		.cfi_offset 3, -4
 2360 0002 F0B5     		push	{r4, r5, r6, r7, lr}
 2361              		.cfi_def_cfa_offset 36
 2362              		.cfi_offset 4, -36
 2363              		.cfi_offset 5, -32
 2364              		.cfi_offset 6, -28
 2365              		.cfi_offset 7, -24
 2366              		.cfi_offset 14, -20
 2367 0004 85B0     		sub	sp, sp, #20
 2368              		.cfi_def_cfa_offset 56
 758:src/stm32/serial.c ****     if (fmt == NULL) {
 2369              		.loc 1 758 1 view .LVU662
 2370 0006 0A9E     		ldr	r6, [sp, #40]
 2371              		.loc 1 759 8 view .LVU663
 2372 0008 002E     		cmp	r6, #0
 2373 000a 00F0AE80 		beq	.L246
 760:src/stm32/serial.c ****         return -1;
 761:src/stm32/serial.c ****     }
 762:src/stm32/serial.c ****     
 763:src/stm32/serial.c ****     if (!s_initialized) {
 2374              		.loc 1 763 5 is_stmt 1 view .LVU664
 2375              		.loc 1 763 9 is_stmt 0 view .LVU665
 2376 000e 584B     		ldr	r3, .L264
 2377              		.loc 1 763 8 view .LVU666
 2378 0010 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 2379 0012 002B     		cmp	r3, #0
 2380 0014 00F0A680 		beq	.L247
 764:src/stm32/serial.c ****         return -2;
 765:src/stm32/serial.c ****     }
 766:src/stm32/serial.c ****     
 767:src/stm32/serial.c ****     va_list args;
 2381              		.loc 1 767 5 is_stmt 1 view .LVU667
 768:src/stm32/serial.c ****     va_start(args, fmt);
 2382              		.loc 1 768 5 view .LVU668
 769:src/stm32/serial.c ****     
 770:src/stm32/serial.c ****     int count = 0;
 771:src/stm32/serial.c ****     
 772:src/stm32/serial.c ****     while (*fmt != '\0') {
 2383              		.loc 1 772 12 is_stmt 0 view .LVU669
 2384 0018 3078     		ldrb	r0, [r6]	@ zero_extendqisi2
 768:src/stm32/serial.c ****     va_start(args, fmt);
 2385              		.loc 1 768 5 view .LVU670
 2386 001a 0BAB     		add	r3, sp, #44
 2387 001c 0393     		str	r3, [sp, #12]
 770:src/stm32/serial.c ****     
 2388              		.loc 1 770 5 is_stmt 1 view .LVU671
 2389              	.LVL162:
 2390              		.loc 1 772 5 view .LVU672
 2391              		.loc 1 772 11 view .LVU673
 2392 001e 0028     		cmp	r0, #0
 2393 0020 3DD0     		beq	.L248
 770:src/stm32/serial.c ****     
ARM GAS  /tmp/ccWwtxPM.s 			page 66


 2394              		.loc 1 770 9 is_stmt 0 view .LVU674
 2395 0022 0025     		movs	r5, #0
 2396 0024 05E0     		b	.L245
 2397              	.LVL163:
 2398              	.L228:
 773:src/stm32/serial.c ****         if (*fmt == '%') {
 774:src/stm32/serial.c ****             fmt++;
 775:src/stm32/serial.c ****             
 776:src/stm32/serial.c ****             /* Parse width */
 777:src/stm32/serial.c ****             int width = 0;
 778:src/stm32/serial.c ****             char pad = ' ';
 779:src/stm32/serial.c ****             
 780:src/stm32/serial.c ****             if (*fmt == '0') {
 781:src/stm32/serial.c ****                 pad = '0';
 782:src/stm32/serial.c ****                 fmt++;
 783:src/stm32/serial.c ****             }
 784:src/stm32/serial.c ****             
 785:src/stm32/serial.c ****             while (*fmt >= '0' && *fmt <= '9') {
 786:src/stm32/serial.c ****                 width = width * 10 + (*fmt - '0');
 787:src/stm32/serial.c ****                 fmt++;
 788:src/stm32/serial.c ****             }
 789:src/stm32/serial.c ****             
 790:src/stm32/serial.c ****             /* Parse format specifier */
 791:src/stm32/serial.c ****             switch (*fmt) {
 792:src/stm32/serial.c ****                 case 'd':
 793:src/stm32/serial.c ****                 case 'i':
 794:src/stm32/serial.c ****                     count += print_int(va_arg(args, int32_t), width, pad);
 795:src/stm32/serial.c ****                     break;
 796:src/stm32/serial.c ****                     
 797:src/stm32/serial.c ****                 case 'u':
 798:src/stm32/serial.c ****                     count += print_uint(va_arg(args, uint32_t), 10, width, pad);
 799:src/stm32/serial.c ****                     break;
 800:src/stm32/serial.c ****                     
 801:src/stm32/serial.c ****                 case 'x':
 802:src/stm32/serial.c ****                 case 'X':
 803:src/stm32/serial.c ****                     count += print_uint(va_arg(args, uint32_t), 16, width, pad);
 804:src/stm32/serial.c ****                     break;
 805:src/stm32/serial.c ****                     
 806:src/stm32/serial.c ****                 case 'c':
 807:src/stm32/serial.c ****                     serial_putc((uint8_t)va_arg(args, int));
 808:src/stm32/serial.c ****                     count++;
 809:src/stm32/serial.c ****                     break;
 810:src/stm32/serial.c ****                     
 811:src/stm32/serial.c ****                 case 's': {
 812:src/stm32/serial.c ****                     const char *str = va_arg(args, const char *);
 813:src/stm32/serial.c ****                     if (str != NULL) {
 814:src/stm32/serial.c ****                         while (*str != '\0') {
 815:src/stm32/serial.c ****                             serial_putc(*str++);
 816:src/stm32/serial.c ****                             count++;
 817:src/stm32/serial.c ****                         }
 818:src/stm32/serial.c ****                     }
 819:src/stm32/serial.c ****                     break;
 820:src/stm32/serial.c ****                 }
 821:src/stm32/serial.c ****                     
 822:src/stm32/serial.c ****                 case '%':
 823:src/stm32/serial.c ****                     serial_putc('%');
 824:src/stm32/serial.c ****                     count++;
ARM GAS  /tmp/ccWwtxPM.s 			page 67


 825:src/stm32/serial.c ****                     break;
 826:src/stm32/serial.c ****                     
 827:src/stm32/serial.c ****                 default:
 828:src/stm32/serial.c ****                     /* Unknown format, print as-is */
 829:src/stm32/serial.c ****                     serial_putc('%');
 830:src/stm32/serial.c ****                     serial_putc(*fmt);
 831:src/stm32/serial.c ****                     count += 2;
 832:src/stm32/serial.c ****                     break;
 833:src/stm32/serial.c ****             }
 834:src/stm32/serial.c ****             fmt++;
 835:src/stm32/serial.c ****         } else {
 836:src/stm32/serial.c ****             serial_putc(*fmt++);
 2399              		.loc 1 836 13 is_stmt 1 view .LVU675
 2400 0026 FFF7FEFF 		bl	serial_putc
 2401              	.LVL164:
 2402              		.loc 1 836 29 is_stmt 0 view .LVU676
 2403 002a 0136     		adds	r6, r6, #1
 2404              	.LVL165:
 837:src/stm32/serial.c ****             count++;
 2405              		.loc 1 837 13 is_stmt 1 view .LVU677
 2406              		.loc 1 837 18 is_stmt 0 view .LVU678
 2407 002c 0135     		adds	r5, r5, #1
 2408              	.LVL166:
 2409              	.L244:
 772:src/stm32/serial.c ****         if (*fmt == '%') {
 2410              		.loc 1 772 11 is_stmt 1 view .LVU679
 772:src/stm32/serial.c ****         if (*fmt == '%') {
 2411              		.loc 1 772 12 is_stmt 0 view .LVU680
 2412 002e 3078     		ldrb	r0, [r6]	@ zero_extendqisi2
 772:src/stm32/serial.c ****         if (*fmt == '%') {
 2413              		.loc 1 772 11 view .LVU681
 2414 0030 B0B3     		cbz	r0, .L225
 2415              	.LVL167:
 2416              	.L245:
 773:src/stm32/serial.c ****         if (*fmt == '%') {
 2417              		.loc 1 773 9 is_stmt 1 view .LVU682
 773:src/stm32/serial.c ****         if (*fmt == '%') {
 2418              		.loc 1 773 12 is_stmt 0 view .LVU683
 2419 0032 2528     		cmp	r0, #37
 2420 0034 F7D1     		bne	.L228
 2421              	.LBB225:
 774:src/stm32/serial.c ****             
 2422              		.loc 1 774 13 is_stmt 1 view .LVU684
 2423              	.LVL168:
 777:src/stm32/serial.c ****             char pad = ' ';
 2424              		.loc 1 777 13 view .LVU685
 778:src/stm32/serial.c ****             
 2425              		.loc 1 778 13 view .LVU686
 780:src/stm32/serial.c ****                 pad = '0';
 2426              		.loc 1 780 13 view .LVU687
 780:src/stm32/serial.c ****                 pad = '0';
 2427              		.loc 1 780 17 is_stmt 0 view .LVU688
 2428 0036 7078     		ldrb	r0, [r6, #1]	@ zero_extendqisi2
 780:src/stm32/serial.c ****                 pad = '0';
 2429              		.loc 1 780 16 view .LVU689
 2430 0038 3028     		cmp	r0, #48
 2431 003a 37D0     		beq	.L262
ARM GAS  /tmp/ccWwtxPM.s 			page 68


 774:src/stm32/serial.c ****             
 2432              		.loc 1 774 16 view .LVU690
 2433 003c 741C     		adds	r4, r6, #1
 2434              	.LVL169:
 778:src/stm32/serial.c ****             
 2435              		.loc 1 778 18 view .LVU691
 2436 003e 2023     		movs	r3, #32
 2437              	.LVL170:
 2438              	.L230:
 785:src/stm32/serial.c ****                 width = width * 10 + (*fmt - '0');
 2439              		.loc 1 785 19 is_stmt 1 view .LVU692
 785:src/stm32/serial.c ****                 width = width * 10 + (*fmt - '0');
 2440              		.loc 1 785 32 is_stmt 0 view .LVU693
 2441 0040 A0F13001 		sub	r1, r0, #48
 785:src/stm32/serial.c ****                 width = width * 10 + (*fmt - '0');
 2442              		.loc 1 785 19 view .LVU694
 2443 0044 CAB2     		uxtb	r2, r1
 2444 0046 092A     		cmp	r2, #9
 2445 0048 4FF00002 		mov	r2, #0
 2446 004c 0CD8     		bhi	.L232
 2447              	.LVL171:
 2448              	.L231:
 786:src/stm32/serial.c ****                 fmt++;
 2449              		.loc 1 786 17 is_stmt 1 view .LVU695
 785:src/stm32/serial.c ****                 width = width * 10 + (*fmt - '0');
 2450              		.loc 1 785 20 is_stmt 0 view .LVU696
 2451 004e 14F8010F 		ldrb	r0, [r4, #1]!	@ zero_extendqisi2
 2452              	.LVL172:
 786:src/stm32/serial.c ****                 fmt++;
 2453              		.loc 1 786 31 view .LVU697
 2454 0052 02EB8202 		add	r2, r2, r2, lsl #2
 2455              	.LVL173:
 786:src/stm32/serial.c ****                 fmt++;
 2456              		.loc 1 786 23 view .LVU698
 2457 0056 01EB4202 		add	r2, r1, r2, lsl #1
 2458              	.LVL174:
 787:src/stm32/serial.c ****             }
 2459              		.loc 1 787 17 is_stmt 1 view .LVU699
 785:src/stm32/serial.c ****                 width = width * 10 + (*fmt - '0');
 2460              		.loc 1 785 19 view .LVU700
 785:src/stm32/serial.c ****                 width = width * 10 + (*fmt - '0');
 2461              		.loc 1 785 32 is_stmt 0 view .LVU701
 2462 005a A0F13001 		sub	r1, r0, #48
 785:src/stm32/serial.c ****                 width = width * 10 + (*fmt - '0');
 2463              		.loc 1 785 19 view .LVU702
 2464 005e 5FFA81FC 		uxtb	ip, r1
 2465 0062 BCF1090F 		cmp	ip, #9
 2466 0066 F2D9     		bls	.L231
 2467              	.LVL175:
 2468              	.L232:
 791:src/stm32/serial.c ****                 case 'd':
 2469              		.loc 1 791 13 is_stmt 1 view .LVU703
 2470 0068 2528     		cmp	r0, #37
 2471 006a 69D0     		beq	.L233
 2472 006c 5838     		subs	r0, r0, #88
 2473 006e C1B2     		uxtb	r1, r0
 2474 0070 2029     		cmp	r1, #32
ARM GAS  /tmp/ccWwtxPM.s 			page 69


 2475 0072 1FD8     		bhi	.L234
 2476 0074 2028     		cmp	r0, #32
 2477 0076 1DD8     		bhi	.L234
 2478 0078 DFE800F0 		tbb	[pc, r0]
 2479              	.L236:
 2480 007c 33       		.byte	(.L235-.L236)/2
 2481 007d 1C       		.byte	(.L234-.L236)/2
 2482 007e 1C       		.byte	(.L234-.L236)/2
 2483 007f 1C       		.byte	(.L234-.L236)/2
 2484 0080 1C       		.byte	(.L234-.L236)/2
 2485 0081 1C       		.byte	(.L234-.L236)/2
 2486 0082 1C       		.byte	(.L234-.L236)/2
 2487 0083 1C       		.byte	(.L234-.L236)/2
 2488 0084 1C       		.byte	(.L234-.L236)/2
 2489 0085 1C       		.byte	(.L234-.L236)/2
 2490 0086 1C       		.byte	(.L234-.L236)/2
 2491 0087 3C       		.byte	(.L240-.L236)/2
 2492 0088 25       		.byte	(.L239-.L236)/2
 2493 0089 1C       		.byte	(.L234-.L236)/2
 2494 008a 1C       		.byte	(.L234-.L236)/2
 2495 008b 1C       		.byte	(.L234-.L236)/2
 2496 008c 1C       		.byte	(.L234-.L236)/2
 2497 008d 25       		.byte	(.L239-.L236)/2
 2498 008e 1C       		.byte	(.L234-.L236)/2
 2499 008f 1C       		.byte	(.L234-.L236)/2
 2500 0090 1C       		.byte	(.L234-.L236)/2
 2501 0091 1C       		.byte	(.L234-.L236)/2
 2502 0092 1C       		.byte	(.L234-.L236)/2
 2503 0093 1C       		.byte	(.L234-.L236)/2
 2504 0094 1C       		.byte	(.L234-.L236)/2
 2505 0095 1C       		.byte	(.L234-.L236)/2
 2506 0096 1C       		.byte	(.L234-.L236)/2
 2507 0097 44       		.byte	(.L238-.L236)/2
 2508 0098 1C       		.byte	(.L234-.L236)/2
 2509 0099 59       		.byte	(.L237-.L236)/2
 2510 009a 1C       		.byte	(.L234-.L236)/2
 2511 009b 1C       		.byte	(.L234-.L236)/2
 2512 009c 33       		.byte	(.L235-.L236)/2
 2513              	.LVL176:
 2514 009d 00       		.p2align 1
 2515              	.L248:
 791:src/stm32/serial.c ****                 case 'd':
 2516              		.loc 1 791 13 is_stmt 0 view .LVU704
 2517              	.LBE225:
 770:src/stm32/serial.c ****     
 2518              		.loc 1 770 9 view .LVU705
 2519 009e 0546     		mov	r5, r0
 838:src/stm32/serial.c ****         }
 839:src/stm32/serial.c ****     }
 840:src/stm32/serial.c ****     
 841:src/stm32/serial.c ****     va_end(args);
 2520              		.loc 1 841 5 is_stmt 1 view .LVU706
 842:src/stm32/serial.c ****     
 843:src/stm32/serial.c ****     return count;
 2521              		.loc 1 843 5 view .LVU707
 2522              	.LVL177:
 2523              	.L225:
ARM GAS  /tmp/ccWwtxPM.s 			page 70


 844:src/stm32/serial.c **** }
 2524              		.loc 1 844 1 is_stmt 0 view .LVU708
 2525 00a0 2846     		mov	r0, r5
 2526 00a2 05B0     		add	sp, sp, #20
 2527              		.cfi_remember_state
 2528              		.cfi_def_cfa_offset 36
 2529              		@ sp needed
 2530 00a4 BDE8F040 		pop	{r4, r5, r6, r7, lr}
 2531              		.cfi_restore 14
 2532              		.cfi_restore 7
 2533              		.cfi_restore 6
 2534              		.cfi_restore 5
 2535              		.cfi_restore 4
 2536              		.cfi_def_cfa_offset 16
 2537 00a8 04B0     		add	sp, sp, #16
 2538              		.cfi_restore 3
 2539              		.cfi_restore 2
 2540              		.cfi_restore 1
 2541              		.cfi_restore 0
 2542              		.cfi_def_cfa_offset 0
 2543 00aa 7047     		bx	lr
 2544              	.LVL178:
 2545              	.L262:
 2546              		.cfi_restore_state
 2547              	.LBB235:
 781:src/stm32/serial.c ****                 fmt++;
 2548              		.loc 1 781 17 is_stmt 1 view .LVU709
 782:src/stm32/serial.c ****             }
 2549              		.loc 1 782 17 view .LVU710
 781:src/stm32/serial.c ****                 fmt++;
 2550              		.loc 1 781 21 is_stmt 0 view .LVU711
 2551 00ac 0346     		mov	r3, r0
 782:src/stm32/serial.c ****             }
 2552              		.loc 1 782 20 view .LVU712
 2553 00ae B41C     		adds	r4, r6, #2
 2554              	.LVL179:
 785:src/stm32/serial.c ****                 width = width * 10 + (*fmt - '0');
 2555              		.loc 1 785 20 view .LVU713
 2556 00b0 B078     		ldrb	r0, [r6, #2]	@ zero_extendqisi2
 2557 00b2 C5E7     		b	.L230
 2558              	.LVL180:
 2559              	.L234:
 829:src/stm32/serial.c ****                     serial_putc(*fmt);
 2560              		.loc 1 829 21 is_stmt 1 view .LVU714
 2561 00b4 2520     		movs	r0, #37
 2562 00b6 FFF7FEFF 		bl	serial_putc
 2563              	.LVL181:
 830:src/stm32/serial.c ****                     count += 2;
 2564              		.loc 1 830 21 view .LVU715
 2565 00ba 2078     		ldrb	r0, [r4]	@ zero_extendqisi2
 2566 00bc FFF7FEFF 		bl	serial_putc
 2567              	.LVL182:
 831:src/stm32/serial.c ****                     break;
 2568              		.loc 1 831 21 view .LVU716
 831:src/stm32/serial.c ****                     break;
 2569              		.loc 1 831 27 is_stmt 0 view .LVU717
 2570 00c0 0235     		adds	r5, r5, #2
ARM GAS  /tmp/ccWwtxPM.s 			page 71


 2571              	.LVL183:
 832:src/stm32/serial.c ****             }
 2572              		.loc 1 832 21 is_stmt 1 view .LVU718
 2573              	.L242:
 834:src/stm32/serial.c ****         } else {
 2574              		.loc 1 834 13 view .LVU719
 834:src/stm32/serial.c ****         } else {
 2575              		.loc 1 834 16 is_stmt 0 view .LVU720
 2576 00c2 661C     		adds	r6, r4, #1
 2577              	.LVL184:
 834:src/stm32/serial.c ****         } else {
 2578              		.loc 1 834 16 view .LVU721
 2579              	.LBE235:
 2580 00c4 B3E7     		b	.L244
 2581              	.LVL185:
 2582              	.L239:
 2583              	.LBB236:
 794:src/stm32/serial.c ****                     break;
 2584              		.loc 1 794 21 is_stmt 1 view .LVU722
 794:src/stm32/serial.c ****                     break;
 2585              		.loc 1 794 30 is_stmt 0 view .LVU723
 2586 00c6 0399     		ldr	r1, [sp, #12]
 2587 00c8 0E68     		ldr	r6, [r1]
 2588              	.LVL186:
 2589              	.LBB226:
 2590              	.LBI226:
 735:src/stm32/serial.c **** {
 2591              		.loc 1 735 1 is_stmt 1 view .LVU724
 2592              	.LBB227:
 737:src/stm32/serial.c ****     
 2593              		.loc 1 737 5 view .LVU725
 739:src/stm32/serial.c ****         serial_putc('-');
 2594              		.loc 1 739 5 view .LVU726
 2595              	.LBE227:
 2596              	.LBE226:
 794:src/stm32/serial.c ****                     break;
 2597              		.loc 1 794 30 is_stmt 0 view .LVU727
 2598 00ca 0431     		adds	r1, r1, #4
 2599              	.LBB231:
 2600              	.LBB228:
 739:src/stm32/serial.c ****         serial_putc('-');
 2601              		.loc 1 739 8 view .LVU728
 2602 00cc 002E     		cmp	r6, #0
 2603              	.LBE228:
 2604              	.LBE231:
 794:src/stm32/serial.c ****                     break;
 2605              		.loc 1 794 30 view .LVU729
 2606 00ce 0391     		str	r1, [sp, #12]
 2607              	.LBB232:
 2608              	.LBB229:
 739:src/stm32/serial.c ****         serial_putc('-');
 2609              		.loc 1 739 8 view .LVU730
 2610 00d0 3ADB     		blt	.L263
 737:src/stm32/serial.c ****     
 2611              		.loc 1 737 9 view .LVU731
 2612 00d2 0027     		movs	r7, #0
 2613              	.LVL187:
ARM GAS  /tmp/ccWwtxPM.s 			page 72


 2614              	.L241:
 748:src/stm32/serial.c ****     
 2615              		.loc 1 748 5 is_stmt 1 view .LVU732
 748:src/stm32/serial.c ****     
 2616              		.loc 1 748 14 is_stmt 0 view .LVU733
 2617 00d4 3046     		mov	r0, r6
 2618 00d6 0A21     		movs	r1, #10
 2619 00d8 FFF7FEFF 		bl	print_uint
 2620              	.LVL188:
 750:src/stm32/serial.c **** }
 2621              		.loc 1 750 5 is_stmt 1 view .LVU734
 748:src/stm32/serial.c ****     
 2622              		.loc 1 748 11 is_stmt 0 view .LVU735
 2623 00dc 3844     		add	r0, r0, r7
 2624              	.LBE229:
 2625              	.LBE232:
 794:src/stm32/serial.c ****                     break;
 2626              		.loc 1 794 27 view .LVU736
 2627 00de 0544     		add	r5, r5, r0
 2628              	.LVL189:
 795:src/stm32/serial.c ****                     
 2629              		.loc 1 795 21 is_stmt 1 view .LVU737
 2630 00e0 EFE7     		b	.L242
 2631              	.L235:
 803:src/stm32/serial.c ****                     break;
 2632              		.loc 1 803 21 view .LVU738
 803:src/stm32/serial.c ****                     break;
 2633              		.loc 1 803 30 is_stmt 0 view .LVU739
 2634 00e2 0399     		ldr	r1, [sp, #12]
 2635 00e4 081D     		adds	r0, r1, #4
 2636 00e6 0390     		str	r0, [sp, #12]
 2637 00e8 0868     		ldr	r0, [r1]
 2638 00ea 1021     		movs	r1, #16
 2639 00ec FFF7FEFF 		bl	print_uint
 2640              	.LVL190:
 803:src/stm32/serial.c ****                     break;
 2641              		.loc 1 803 27 view .LVU740
 2642 00f0 0544     		add	r5, r5, r0
 2643              	.LVL191:
 804:src/stm32/serial.c ****                     
 2644              		.loc 1 804 21 is_stmt 1 view .LVU741
 2645 00f2 E6E7     		b	.L242
 2646              	.L240:
 807:src/stm32/serial.c ****                     count++;
 2647              		.loc 1 807 21 view .LVU742
 807:src/stm32/serial.c ****                     count++;
 2648              		.loc 1 807 42 is_stmt 0 view .LVU743
 2649 00f4 039B     		ldr	r3, [sp, #12]
 2650 00f6 1A1D     		adds	r2, r3, #4
 807:src/stm32/serial.c ****                     count++;
 2651              		.loc 1 807 21 view .LVU744
 2652 00f8 1878     		ldrb	r0, [r3]	@ zero_extendqisi2
 807:src/stm32/serial.c ****                     count++;
 2653              		.loc 1 807 42 view .LVU745
 2654 00fa 0392     		str	r2, [sp, #12]
 808:src/stm32/serial.c ****                     break;
 2655              		.loc 1 808 26 view .LVU746
ARM GAS  /tmp/ccWwtxPM.s 			page 73


 2656 00fc 0135     		adds	r5, r5, #1
 2657              	.LVL192:
 807:src/stm32/serial.c ****                     count++;
 2658              		.loc 1 807 21 view .LVU747
 2659 00fe FFF7FEFF 		bl	serial_putc
 2660              	.LVL193:
 808:src/stm32/serial.c ****                     break;
 2661              		.loc 1 808 21 is_stmt 1 view .LVU748
 809:src/stm32/serial.c ****                     
 2662              		.loc 1 809 21 view .LVU749
 2663 0102 DEE7     		b	.L242
 2664              	.L238:
 2665              	.LBB233:
 812:src/stm32/serial.c ****                     if (str != NULL) {
 2666              		.loc 1 812 21 view .LVU750
 812:src/stm32/serial.c ****                     if (str != NULL) {
 2667              		.loc 1 812 33 is_stmt 0 view .LVU751
 2668 0104 039B     		ldr	r3, [sp, #12]
 2669 0106 1E68     		ldr	r6, [r3]
 2670 0108 0433     		adds	r3, r3, #4
 2671 010a 0393     		str	r3, [sp, #12]
 813:src/stm32/serial.c ****                         while (*str != '\0') {
 2672              		.loc 1 813 21 is_stmt 1 view .LVU752
 813:src/stm32/serial.c ****                         while (*str != '\0') {
 2673              		.loc 1 813 24 is_stmt 0 view .LVU753
 2674 010c 002E     		cmp	r6, #0
 2675 010e D8D0     		beq	.L242
 2676              	.LVL194:
 814:src/stm32/serial.c ****                             serial_putc(*str++);
 2677              		.loc 1 814 31 is_stmt 1 view .LVU754
 814:src/stm32/serial.c ****                             serial_putc(*str++);
 2678              		.loc 1 814 32 is_stmt 0 view .LVU755
 2679 0110 3078     		ldrb	r0, [r6]	@ zero_extendqisi2
 814:src/stm32/serial.c ****                             serial_putc(*str++);
 2680              		.loc 1 814 31 view .LVU756
 2681 0112 0028     		cmp	r0, #0
 2682 0114 D5D0     		beq	.L242
 2683 0116 C6F10103 		rsb	r3, r6, #1
 2684              	.LVL195:
 814:src/stm32/serial.c ****                             serial_putc(*str++);
 2685              		.loc 1 814 31 view .LVU757
 2686 011a 1D44     		add	r5, r5, r3
 2687              	.LVL196:
 2688              	.L243:
 815:src/stm32/serial.c ****                             count++;
 2689              		.loc 1 815 29 is_stmt 1 view .LVU758
 815:src/stm32/serial.c ****                             count++;
 2690              		.loc 1 815 29 is_stmt 0 view .LVU759
 2691 011c FFF7FEFF 		bl	serial_putc
 2692              	.LVL197:
 816:src/stm32/serial.c ****                         }
 2693              		.loc 1 816 29 is_stmt 1 view .LVU760
 2694 0120 AB19     		adds	r3, r5, r6
 2695              	.LVL198:
 814:src/stm32/serial.c ****                             serial_putc(*str++);
 2696              		.loc 1 814 31 view .LVU761
 814:src/stm32/serial.c ****                             serial_putc(*str++);
ARM GAS  /tmp/ccWwtxPM.s 			page 74


 2697              		.loc 1 814 32 is_stmt 0 view .LVU762
 2698 0122 16F8010F 		ldrb	r0, [r6, #1]!	@ zero_extendqisi2
 2699              	.LVL199:
 814:src/stm32/serial.c ****                             serial_putc(*str++);
 2700              		.loc 1 814 31 view .LVU763
 2701 0126 0028     		cmp	r0, #0
 2702 0128 F8D1     		bne	.L243
 816:src/stm32/serial.c ****                         }
 2703              		.loc 1 816 34 view .LVU764
 2704 012a 1D46     		mov	r5, r3
 2705 012c C9E7     		b	.L242
 2706              	.LVL200:
 2707              	.L237:
 816:src/stm32/serial.c ****                         }
 2708              		.loc 1 816 34 view .LVU765
 2709              	.LBE233:
 798:src/stm32/serial.c ****                     break;
 2710              		.loc 1 798 21 is_stmt 1 view .LVU766
 798:src/stm32/serial.c ****                     break;
 2711              		.loc 1 798 30 is_stmt 0 view .LVU767
 2712 012e 0399     		ldr	r1, [sp, #12]
 2713 0130 081D     		adds	r0, r1, #4
 2714 0132 0390     		str	r0, [sp, #12]
 2715 0134 0868     		ldr	r0, [r1]
 2716 0136 0A21     		movs	r1, #10
 2717 0138 FFF7FEFF 		bl	print_uint
 2718              	.LVL201:
 798:src/stm32/serial.c ****                     break;
 2719              		.loc 1 798 27 view .LVU768
 2720 013c 0544     		add	r5, r5, r0
 2721              	.LVL202:
 799:src/stm32/serial.c ****                     
 2722              		.loc 1 799 21 is_stmt 1 view .LVU769
 2723 013e C0E7     		b	.L242
 2724              	.L233:
 823:src/stm32/serial.c ****                     count++;
 2725              		.loc 1 823 21 view .LVU770
 2726 0140 FFF7FEFF 		bl	serial_putc
 2727              	.LVL203:
 824:src/stm32/serial.c ****                     break;
 2728              		.loc 1 824 21 view .LVU771
 824:src/stm32/serial.c ****                     break;
 2729              		.loc 1 824 26 is_stmt 0 view .LVU772
 2730 0144 0135     		adds	r5, r5, #1
 2731              	.LVL204:
 825:src/stm32/serial.c ****                     
 2732              		.loc 1 825 21 is_stmt 1 view .LVU773
 2733 0146 BCE7     		b	.L242
 2734              	.LVL205:
 2735              	.L263:
 2736              	.LBB234:
 2737              	.LBB230:
 740:src/stm32/serial.c ****         count++;
 2738              		.loc 1 740 9 view .LVU774
 2739 0148 2D20     		movs	r0, #45
 2740 014a CDE90023 		strd	r2, r3, [sp]
 2741 014e FFF7FEFF 		bl	serial_putc
ARM GAS  /tmp/ccWwtxPM.s 			page 75


 2742              	.LVL206:
 741:src/stm32/serial.c ****         val = -val;
 2743              		.loc 1 741 9 view .LVU775
 742:src/stm32/serial.c ****         if (width > 0) {
 2744              		.loc 1 742 9 view .LVU776
 743:src/stm32/serial.c ****             width--;
 2745              		.loc 1 743 12 is_stmt 0 view .LVU777
 2746 0152 DDE90023 		ldrd	r2, r3, [sp]
 742:src/stm32/serial.c ****         if (width > 0) {
 2747              		.loc 1 742 13 view .LVU778
 2748 0156 7642     		rsbs	r6, r6, #0
 2749              	.LVL207:
 743:src/stm32/serial.c ****             width--;
 2750              		.loc 1 743 9 is_stmt 1 view .LVU779
 743:src/stm32/serial.c ****             width--;
 2751              		.loc 1 743 12 is_stmt 0 view .LVU780
 2752 0158 12B1     		cbz	r2, .L251
 744:src/stm32/serial.c ****         }
 2753              		.loc 1 744 13 is_stmt 1 view .LVU781
 744:src/stm32/serial.c ****         }
 2754              		.loc 1 744 18 is_stmt 0 view .LVU782
 2755 015a 013A     		subs	r2, r2, #1
 2756              	.LVL208:
 741:src/stm32/serial.c ****         val = -val;
 2757              		.loc 1 741 14 view .LVU783
 2758 015c 0127     		movs	r7, #1
 2759 015e B9E7     		b	.L241
 2760              	.LVL209:
 2761              	.L251:
 741:src/stm32/serial.c ****         val = -val;
 2762              		.loc 1 741 14 view .LVU784
 2763 0160 0127     		movs	r7, #1
 2764 0162 B7E7     		b	.L241
 2765              	.LVL210:
 2766              	.L247:
 741:src/stm32/serial.c ****         val = -val;
 2767              		.loc 1 741 14 view .LVU785
 2768              	.LBE230:
 2769              	.LBE234:
 2770              	.LBE236:
 764:src/stm32/serial.c ****     }
 2771              		.loc 1 764 16 view .LVU786
 2772 0164 6FF00105 		mvn	r5, #1
 2773 0168 9AE7     		b	.L225
 2774              	.L246:
 760:src/stm32/serial.c ****     }
 2775              		.loc 1 760 16 view .LVU787
 2776 016a 4FF0FF35 		mov	r5, #-1
 2777 016e 97E7     		b	.L225
 2778              	.L265:
 2779              		.align	2
 2780              	.L264:
 2781 0170 00000000 		.word	.LANCHOR10
 2782              		.cfi_endproc
 2783              	.LFE37:
 2785              		.section	.rodata
 2786              		.align	2
ARM GAS  /tmp/ccWwtxPM.s 			page 76


 2787              		.set	.LANCHOR9,. + 0
 2788              	.LC0:
 2789 0000 02       		.byte	2
 2790 0001 00       		.byte	0
 2791 0002 03       		.byte	3
 2792 0003 01       		.byte	1
 2793 0004 07       		.byte	7
 2794              		.section	.bss.s_initialized,"aw",%nobits
 2795              		.set	.LANCHOR10,. + 0
 2798              	s_initialized:
 2799 0000 00       		.space	1
 2800              		.section	.bss.s_line_buffer,"aw",%nobits
 2801              		.align	2
 2802              		.set	.LANCHOR4,. + 0
 2805              	s_line_buffer:
 2806 0000 00000000 		.space	128
 2806      00000000 
 2806      00000000 
 2806      00000000 
 2806      00000000 
 2807              		.section	.bss.s_line_len,"aw",%nobits
 2808              		.align	2
 2809              		.set	.LANCHOR3,. + 0
 2812              	s_line_len:
 2813 0000 00000000 		.space	4
 2814              		.section	.bss.s_line_ready,"aw",%nobits
 2815              		.set	.LANCHOR2,. + 0
 2818              	s_line_ready:
 2819 0000 00       		.space	1
 2820              		.section	.bss.s_rx_buffer,"aw",%nobits
 2821              		.align	2
 2822              		.set	.LANCHOR1,. + 0
 2825              	s_rx_buffer:
 2826 0000 00000000 		.space	268
 2826      00000000 
 2826      00000000 
 2826      00000000 
 2826      00000000 
 2827              		.section	.bss.s_tx_buffer,"aw",%nobits
 2828              		.align	2
 2829              		.set	.LANCHOR5,. + 0
 2832              	s_tx_buffer:
 2833 0000 00000000 		.space	268
 2833      00000000 
 2833      00000000 
 2833      00000000 
 2833      00000000 
 2834              		.section	.data.s_usart,"aw"
 2835              		.align	2
 2836              		.set	.LANCHOR0,. + 0
 2839              	s_usart:
 2840 0000 00100140 		.word	1073811456
 2841              		.section	.data.s_usart_irq,"aw"
 2842              		.set	.LANCHOR6,. + 0
 2845              	s_usart_irq:
 2846 0000 25       		.byte	37
 2847              		.section	.rodata.CSWTCH.70,"a"
ARM GAS  /tmp/ccWwtxPM.s 			page 77


 2848              		.align	2
 2849              		.set	.LANCHOR7,. + 0
 2852              	CSWTCH.70:
 2853 0000 09       		.byte	9
 2854 0001 02       		.byte	2
 2855 0002 1A       		.byte	26
 2856              		.section	.rodata.CSWTCH.71,"a"
 2857              		.align	2
 2858              		.set	.LANCHOR8,. + 0
 2861              	CSWTCH.71:
 2862 0000 0A       		.byte	10
 2863 0001 03       		.byte	3
 2864 0002 1B       		.byte	27
 2865              		.text
 2866              	.Letext0:
 2867              		.file 3 "/usr/lib/gcc/arm-none-eabi/10.3.1/include/stdint.h"
 2868              		.file 4 "/usr/lib/gcc/arm-none-eabi/10.3.1/include/stddef.h"
 2869              		.file 5 "src/stm32/serial.h"
 2870              		.file 6 "src/stm32/gpio.h"
 2871              		.file 7 "/usr/lib/gcc/arm-none-eabi/10.3.1/include/stdarg.h"
 2872              		.file 8 "<built-in>"
ARM GAS  /tmp/ccWwtxPM.s 			page 78


DEFINED SYMBOLS
                            *ABS*:0000000000000000 serial.c
     /tmp/ccWwtxPM.s:18     .text.serial_irq_handler:0000000000000000 $t
     /tmp/ccWwtxPM.s:27     .text.serial_irq_handler:0000000000000000 serial_irq_handler
     /tmp/ccWwtxPM.s:284    .text.serial_irq_handler:00000000000000e0 $d
     /tmp/ccWwtxPM.s:295    .text.USART1_IRQHandler:0000000000000000 $t
     /tmp/ccWwtxPM.s:303    .text.USART1_IRQHandler:0000000000000000 USART1_IRQHandler
     /tmp/ccWwtxPM.s:327    .text.USART1_IRQHandler:0000000000000010 $d
     /tmp/ccWwtxPM.s:333    .text.USART2_IRQHandler:0000000000000000 $t
     /tmp/ccWwtxPM.s:341    .text.USART2_IRQHandler:0000000000000000 USART2_IRQHandler
     /tmp/ccWwtxPM.s:365    .text.USART2_IRQHandler:0000000000000010 $d
     /tmp/ccWwtxPM.s:371    .text.USART3_IRQHandler:0000000000000000 $t
     /tmp/ccWwtxPM.s:379    .text.USART3_IRQHandler:0000000000000000 USART3_IRQHandler
     /tmp/ccWwtxPM.s:403    .text.USART3_IRQHandler:0000000000000010 $d
     /tmp/ccWwtxPM.s:409    .text.serial_init_config:0000000000000000 $t
     /tmp/ccWwtxPM.s:417    .text.serial_init_config:0000000000000000 serial_init_config
     /tmp/ccWwtxPM.s:866    .text.serial_init_config:0000000000000150 $d
     /tmp/ccWwtxPM.s:886    .text.serial_init:0000000000000000 $t
     /tmp/ccWwtxPM.s:894    .text.serial_init:0000000000000000 serial_init
     /tmp/ccWwtxPM.s:927    .text.serial_write:0000000000000000 $t
     /tmp/ccWwtxPM.s:935    .text.serial_write:0000000000000000 serial_write
     /tmp/ccWwtxPM.s:1063   .text.serial_write:000000000000004c $d
     /tmp/ccWwtxPM.s:1070   .text.serial_putc:0000000000000000 $t
     /tmp/ccWwtxPM.s:1078   .text.serial_putc:0000000000000000 serial_putc
     /tmp/ccWwtxPM.s:1154   .text.serial_putc:0000000000000024 $d
     /tmp/ccWwtxPM.s:1161   .text.print_uint:0000000000000000 $t
     /tmp/ccWwtxPM.s:1168   .text.print_uint:0000000000000000 print_uint
     /tmp/ccWwtxPM.s:1383   .text.serial_puts:0000000000000000 $t
     /tmp/ccWwtxPM.s:1391   .text.serial_puts:0000000000000000 serial_puts
     /tmp/ccWwtxPM.s:1433   .text.serial_read:0000000000000000 $t
     /tmp/ccWwtxPM.s:1441   .text.serial_read:0000000000000000 serial_read
     /tmp/ccWwtxPM.s:1642   .text.serial_read:0000000000000068 $d
     /tmp/ccWwtxPM.s:1648   .text.serial_getc:0000000000000000 $t
     /tmp/ccWwtxPM.s:1656   .text.serial_getc:0000000000000000 serial_getc
     /tmp/ccWwtxPM.s:1819   .text.serial_getc:0000000000000054 $d
     /tmp/ccWwtxPM.s:1830   .text.serial_readline:0000000000000000 $t
     /tmp/ccWwtxPM.s:1838   .text.serial_readline:0000000000000000 serial_readline
     /tmp/ccWwtxPM.s:1990   .text.serial_readline:0000000000000058 $d
     /tmp/ccWwtxPM.s:1998   .text.serial_line_available:0000000000000000 $t
     /tmp/ccWwtxPM.s:2006   .text.serial_line_available:0000000000000000 serial_line_available
     /tmp/ccWwtxPM.s:2025   .text.serial_line_available:000000000000000c $d
     /tmp/ccWwtxPM.s:2030   .text.serial_rx_available:0000000000000000 $t
     /tmp/ccWwtxPM.s:2038   .text.serial_rx_available:0000000000000000 serial_rx_available
     /tmp/ccWwtxPM.s:2054   .text.serial_rx_available:0000000000000008 $d
     /tmp/ccWwtxPM.s:2059   .text.serial_tx_free:0000000000000000 $t
     /tmp/ccWwtxPM.s:2067   .text.serial_tx_free:0000000000000000 serial_tx_free
     /tmp/ccWwtxPM.s:2084   .text.serial_tx_free:000000000000000c $d
     /tmp/ccWwtxPM.s:2089   .text.serial_flush:0000000000000000 $t
     /tmp/ccWwtxPM.s:2097   .text.serial_flush:0000000000000000 serial_flush
     /tmp/ccWwtxPM.s:2138   .text.serial_flush:000000000000001c $d
     /tmp/ccWwtxPM.s:2145   .text.serial_rx_clear:0000000000000000 $t
     /tmp/ccWwtxPM.s:2153   .text.serial_rx_clear:0000000000000000 serial_rx_clear
     /tmp/ccWwtxPM.s:2250   .text.serial_rx_clear:000000000000002c $d
     /tmp/ccWwtxPM.s:2257   .text.serial_rx_enable:0000000000000000 $t
     /tmp/ccWwtxPM.s:2265   .text.serial_rx_enable:0000000000000000 serial_rx_enable
     /tmp/ccWwtxPM.s:2291   .text.serial_rx_enable:0000000000000014 $d
     /tmp/ccWwtxPM.s:2297   .text.serial_rx_disable:0000000000000000 $t
ARM GAS  /tmp/ccWwtxPM.s 			page 79


     /tmp/ccWwtxPM.s:2305   .text.serial_rx_disable:0000000000000000 serial_rx_disable
     /tmp/ccWwtxPM.s:2331   .text.serial_rx_disable:0000000000000014 $d
     /tmp/ccWwtxPM.s:2337   .text.serial_printf:0000000000000000 $t
     /tmp/ccWwtxPM.s:2345   .text.serial_printf:0000000000000000 serial_printf
     /tmp/ccWwtxPM.s:2480   .text.serial_printf:000000000000007c $d
     /tmp/ccWwtxPM.s:2781   .text.serial_printf:0000000000000170 $d
     /tmp/ccWwtxPM.s:2786   .rodata:0000000000000000 $d
     /tmp/ccWwtxPM.s:2798   .bss.s_initialized:0000000000000000 s_initialized
     /tmp/ccWwtxPM.s:2799   .bss.s_initialized:0000000000000000 $d
     /tmp/ccWwtxPM.s:2801   .bss.s_line_buffer:0000000000000000 $d
     /tmp/ccWwtxPM.s:2805   .bss.s_line_buffer:0000000000000000 s_line_buffer
     /tmp/ccWwtxPM.s:2808   .bss.s_line_len:0000000000000000 $d
     /tmp/ccWwtxPM.s:2812   .bss.s_line_len:0000000000000000 s_line_len
     /tmp/ccWwtxPM.s:2818   .bss.s_line_ready:0000000000000000 s_line_ready
     /tmp/ccWwtxPM.s:2819   .bss.s_line_ready:0000000000000000 $d
     /tmp/ccWwtxPM.s:2821   .bss.s_rx_buffer:0000000000000000 $d
     /tmp/ccWwtxPM.s:2825   .bss.s_rx_buffer:0000000000000000 s_rx_buffer
     /tmp/ccWwtxPM.s:2828   .bss.s_tx_buffer:0000000000000000 $d
     /tmp/ccWwtxPM.s:2832   .bss.s_tx_buffer:0000000000000000 s_tx_buffer
     /tmp/ccWwtxPM.s:2835   .data.s_usart:0000000000000000 $d
     /tmp/ccWwtxPM.s:2839   .data.s_usart:0000000000000000 s_usart
     /tmp/ccWwtxPM.s:2845   .data.s_usart_irq:0000000000000000 s_usart_irq
     /tmp/ccWwtxPM.s:2848   .rodata.CSWTCH.70:0000000000000000 $d
     /tmp/ccWwtxPM.s:2852   .rodata.CSWTCH.70:0000000000000000 CSWTCH.70
     /tmp/ccWwtxPM.s:2857   .rodata.CSWTCH.71:0000000000000000 $d
     /tmp/ccWwtxPM.s:2861   .rodata.CSWTCH.71:0000000000000000 CSWTCH.71
     /tmp/ccWwtxPM.s:2514   .text.serial_printf:000000000000009d $d
     /tmp/ccWwtxPM.s:2514   .text.serial_printf:000000000000009e $t

UNDEFINED SYMBOLS
gpio_init
nvic_set_priority
nvic_enable_irq
gpio_configure
memcpy
